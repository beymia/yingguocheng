Index: pages/order/order.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n\t<view class=\"page\">\r\n\t\t<!-- 自定义导航栏start -->\r\n\t\t<uni-nav-bar :title=\"title\" statusBar style=\"\">\r\n\t\t\t<block slot=\"left\">\r\n\t\t\t\t<view style=\"height: 35px;line-height: 35px;border-radius: 18px;border: 1px solid #eaeaea;margin-left: 24rpx;padding: 0 15px;display: flex;align-self: center;\">\r\n\t\t\t\t\t<text style=\"font-size: 17px;color: #666666;\" @tap=\"pin_tap\">拼</text>\r\n\t\t\t\t\t<text style=\"width: 29px;font-size: 17px;text-align: center;color: #EAEAEA;\">|</text>\r\n\t\t\t\t\t<icon type=\"search\" size=\"17\" color=\"#666666\" style=\"display: flex;align-items: center;\" @tap=\"showSearch=true\"></icon>\r\n\t\t\t\t</view>\r\n\t\t\t</block>\r\n\t\t</uni-nav-bar>\r\n\t\t<!-- 自定义导航栏end -->\r\n\t\t\r\n\t\t<!-- 头部start -->\r\n\t\t<view class=\"order_head\">\r\n\t\t\t<!-- 位置、自取、外卖、堂食start -->\r\n\t\t\t\r\n\t\t\t<view class=\"location\">\r\n\t\t\t\t<view class=\"left\">\r\n\t\t\t\t\t<view class=\"top\" @tap=\"loca_tap\">\r\n\t\t\t\t\t\t<view class=\"loca_icon\">\r\n\t\t\t\t\t\t\t<image src=\"../../static/images/order/location.png\" mode=\"\"></image>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"shop_adress\">{{shop_info.shop_adress.length<=9 ? shop_info.shop_adress:shop_info.shop_adress.substr(0,8)+\"...\" }}</view>\r\n\t\t\t\t\t\t<uni-icons type=\"arrowright\" size=\"35\" color=\"#333333\"></uni-icons>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"bottom\">\r\n\t\t\t\t\t\t<view class=\"shop_tab_icon\">\r\n\t\t\t\t\t\t\t<image src=\"../../static/images/order/shop_tap.jpg\" mode=\"\"></image>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"shop_name\">\r\n\t\t\t\t\t\t\t{{shop_info.shop_name}}\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"tip_text\">\r\n\t\t\t\t\t\t\t{{shop_info.tip}}\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"right\">\r\n\t\t\t\t\t<view   class=\"order_type \" :class=\"orderType==2?'order_type_selected':''\" @tap=\"order_type_tap(2)\">\r\n\t\t\t\t\t\t自取\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view  class=\"order_type \" :class=\"orderType==1?'order_type_selected':''\" @tap=\"order_type_tap(1)\">\r\n\t\t\t\t\t\t外賣\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view  class=\"order_type \" :class=\"orderType==3?'order_type_selected':''\" @tap=\"order_type_tap(3)\">\r\n\t\t\t\t\t\t堂食\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<!-- 位置、自取、外卖、堂食end -->\r\n\t\t\t\r\n\t\t\t<!-- 公告栏start -->\r\n\t\t\t<view class=\"notice\">\r\n\t\t\t\t<swiper   class=\"swiper_wrap_notice\"  :autoplay=\"true\" vertical circular :interval=\"3000\" :duration=\"1000\">\r\n\t\t\t\t\t<swiper-item v-show=\"!is_notice\" v-for=\"(notice,notice_index) in notice_list\">\r\n\t\t\t\t\t\t<view class=\"swiper-item notice_title\">\r\n\t\t\t\t\t\t\t<view class=\"notice_icon\">\r\n\t\t\t\t\t\t\t\t<image src=\"../../static/images/order/blueBall.png\" mode=\"\"></image>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<text class=\"notice_text\">{{notice}}</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</swiper-item>\r\n\t\t\t\t</swiper>\r\n\t\t\t\t\r\n\t\t\t\t\t<template v-if=\"is_notice\">\r\n\t\t\t\t\t\t<view class=\"notice_more\" @tap=\"is_notice=false\">\r\n\t\t\t\t\t\t\t<text class=\"notice_more\">收起</text>\r\n\t\t\t\t\t\t\t<uni-icons type=\"arrowup\" size=\"24\" color=\"#999999\"></uni-icons>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</template>\r\n\t\t\t\t\t<template v-else>\r\n\t\t\t\t\t\t<view class=\"notice_more\" @tap=\"is_notice=true\">\r\n\t\t\t\t\t\t\t<text class=\"notice_more\">更多</text>\r\n\t\t\t\t\t\t\t<uni-icons type=\"arrowdown\" size=\"24\" color=\"#999999\"></uni-icons>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</template>\r\n\t\t\t\t\t\r\n\t\t\t</view>\r\n\t\t\t<!-- 公告栏end -->\r\n\t\t</view>\r\n\t\t<!-- 头部end-->\r\n\t\t<!-- 新聞詳情頁開始 -->\r\n\t\t<notice v-show=\"is_notice\" :news_list=\"notice_list\"></notice>\r\n\t\t<!-- 新聞詳情頁結束 -->\r\n\t\t<!-- 点单主体部分start -->\r\n\t\t<view class=\"main\" v-show=\"!is_notice\">\r\n\t\t\t<!-- 左侧菜单栏start -->\r\n\t\t\t<scroll-view class=\"menu_bar\" scroll-y=\"true\" >\r\n\t\t\t\t<view class=\"menu_item\" v-for=\"(menu,menu_index) in menu_list\"  :class=\"{active:menu.id==menu_id_current}\" @click=\"menu_Tap(menu.id)\" >\r\n\t\t\t\t\t<image class=\"menu_icon\" :src=\"menu.icon_url\" mode=\"\"></image>\r\n\t\t\t\t\t<text class=\"menu_name\">{{menu.menu_name}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t</scroll-view>\r\n\t\t\t<!-- 左侧菜单栏end -->\r\n\t\t\t<!-- 右侧商品栏start -->\r\n\t\t\t<scroll-view scroll-y=\"true\" scroll-with-animation :scroll-top=\"goods_scrollTop\"  class=\"goods\" @scroll=\"goods_scroll\" >\r\n\t\t\t\t<view class=\"pdb50\">\r\n\t\t\t\t\t<view class=\"goods_list\" :id=\"`goods_${menu.id}`\" v-for=\"(menu,menu_index) in menu_list\">\r\n\t\t\t\t\t\t<view class=\"goods_title\">\r\n\t\t\t\t\t\t\t{{menu.menu_name}}\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"goods_item\" v-for=\"(good,good_index) in menu.goods_list\" @tap=\"showProductDetailModal(good)\">\r\n\t\t\t\t\t\t\t<view class=\"good_icon\">\r\n\t\t\t\t\t\t\t\t<image :src=\"good.imgurl\" mode=\"\"></image>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<view class=\"good_intro\">\r\n\t\t\t\t\t\t\t\t<view class=\"good_name\">\r\n\t\t\t\t\t\t\t\t\t{{good.name}}\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<view class=\"good_label\">\r\n\t\t\t\t\t\t\t\t\t<!-- <view class=\"isHot\" v-if=\"good.isHot\">\r\n\t\t\t\t\t\t\t\t\t\t可做热饮\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t<view class=\"recipe\">\r\n\t\t\t\t\t\t\t\t\t\t{{good.recipe}}\r\n\t\t\t\t\t\t\t\t\t</view> -->\r\n\t\t\t\t\t\t\t\t\t<view class=\"isHot\" v-for=\"label in good.labels\">\r\n\t\t\t\t\t\t\t\t\t\t{{label}}\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<view class=\"good_des\">\r\n\t\t\t\t\t\t\t\t\t{{good.description}}\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<view class=\"price\">\r\n\t\t\t\t\t\t\t\t\t<view class=\"\">\r\n\t\t\t\t\t\t\t\t\t\t￥{{good.price}}\r\n\t\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t\t<actions :materials-btn=\"!good.is_single\"\r\n\t\t\t\t\t\t\t\t\t\t\t@materials=\"showProductDetailModal(good)\" \r\n\t\t\t\t\t\t\t\t\t\t\t:number=\"productCartNum(good.id)\"\r\n\t\t\t\t\t\t\t\t\t\t\t@add=\"handleAddToCart(good)\" \r\n\t\t\t\t\t\t\t\t\t\t\t@minus=\"handleMinusFromCart(good)\" />\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t\t\r\n\t\t\t</scroll-view>\r\n\t\t\t<!-- 右侧商品栏end -->\r\n\t\t</view>\r\n\t\t<!-- 点单主体部分end -->\r\n\t\t<!-- 商品詳情頁開始 -->\r\n\t\t<product-modal :product=\"good\"\r\n\t\t\t\t\t\t:visible=\"goodModalVisible\" \r\n\t\t\t\t\t\t@cancel=\"closeProductDetailModal\" \r\n\t\t\t\t\t\t@add-to-cart=\"handleAddToCartInModal\" \r\n\t\t/>\r\n\t\t<!-- 商品詳情頁結束 -->\r\n\t\t<!-- 购物车栏 begin -->\r\n\t\t<cart-bar v-if=\"!is_notice && !is_rest\" :cart=\"cart\" \r\n\t\t\t\t  @add=\"handleAddToCart\" \r\n\t\t\t\t  @minus=\"handleMinusFromCart\"\r\n\t\t\t\t  @clear=\"clearCart\"\r\n\t\t\t\t  @checkboxChange=\"checkboxChange\"\r\n\t\t\t\t  @checkAllChange=\"checkAllChange\"\r\n\t\t\t\t  @pay=\"pay\"\r\n\t\t/>\r\n\t\t<!-- 购物车栏 end -->\r\n\t\t<!-- 休息中 start -->\r\n\t\t<rest opening_hours=\"\"></rest>\r\n\t\t<!-- 休息中 end -->\r\n\t\t<!-- 搜索页面start -->\r\n\t\t<search :show=\"showSearch\" :categories=\"menu_list\" @hide=\"showSearch=false\" @choose=\"showProductDetailModal\" ></search>\r\n\t\t<!-- 搜索页面end -->\r\n\t\t<!-- 拼团 -->\r\n\t\t<pintuan :show=\"showPintuan\" @closePintuan=\"showPintuan = false\" @choose_type=\"choose_pintuan_type\"></pintuan>\r\n\t\t<!-- 拼团end -->\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport judgeLogin from '@/util/judgeLogin.js'\r\n\timport {mapState, mapMutations} from 'vuex'\r\n\timport {menu_list} from './data.js';\r\n\timport actions from './components/actions/actions.vue'\r\n\timport notice from './components/notice/notice.vue'\r\n\timport cartBar from './components/cartbar/cartbar.vue'\r\n\timport productModal from './components/product-modal/product-modal.vue'\r\n\timport search from './components/search/search.vue'\r\n\timport rest from './components/rest/rest.vue'\r\n\timport pintuan from './components/pintuan/pintuan.vue'\r\n\texport default{\r\n\t\tcomponents:{\r\n\t\t\tactions,\r\n\t\t\tnotice,\r\n\t\t\tproductModal,\r\n\t\t\tcartBar,\r\n\t\t\tsearch,\r\n\t\t\trest,\r\n\t\t\tpintuan\r\n\t\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tshop_info:{\r\n\t\t\t\t\tshop_adress:'合肥市蜀山區丹霞路店店',\r\n\t\t\t\t\tshop_name:'合肥正大廣場店',\r\n\t\t\t\t\ttip:'送出外賣'\r\n\t\t\t\t},\r\n\t\t\t\tnotice_list:[\r\n\t\t\t\t\t'多肉玫瓏瓜&玫瓏芒芒甘露新上市，優秀玫瓏瓜，清涼夏日解渴',\r\n\t\t\t\t\t'歐洲國外冰箱貼法國巴黎挪威英國倫敦新西蘭丹麥匈牙利出國紀念品',\r\n\t\t\t\t\t'【混合堅果】限時買壹送壹，下單兩件自動減免壹件，快來選購嘗鮮吧~',\r\n\t\t\t\t\t'生打椰系列全新上市，生打椰椰奶凍、生打椰椰芒2款可選，快來【當季限定】下單嘗鮮吧~',\r\n\t\t\t\t\t'【混合堅果】限時買壹送壹，下單兩件自動減免壹件，快來選購嘗鮮吧~'\r\n\t\t\t\t],\r\n\t\t\t\tmenu_list,\r\n\t\t\t\t//下面都是静态默认值\r\n\t\t\t\torder_type_selected:'order_type_selected',\r\n\t\t\t\ttitle:'英国城',\r\n\t\t\t\tis_notice:false,\r\n\t\t\t\tmenu_id_current:1,\r\n\t\t\t\tgoods_scrollTop:0,\r\n\t\t\t\tgood:{},\r\n\t\t\t\tgoodModalVisible:false,\r\n\t\t\t\tcart:[],\r\n\t\t\t\tshowSearch:false,\r\n\t\t\t\tlocalAdress:{},\r\n\t\t\t\tis_rest:false,\r\n\t\t\t\tshowPintuan:false\r\n\t\t\t\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync onLoad() {\r\n\t\t\tuni.request({\r\n\t\t\t    url: 'http://api.plg.wugee.net/classify/list', //仅为示例，并非真实接口地址。\r\n\t\t\t    data: {\r\n\t\t\t    },\r\n\t\t\t    header: {\r\n\t\t\t        'custom-header': 'hello' //自定义请求头信息\r\n\t\t\t    },\r\n\t\t\t    success: (res) => {\r\n\t\t\t        console.log('onload sucess data---:'+res.data);\r\n\t\t\t    },\r\n\t\t\t\tcomplete: (res) => {\r\n\t\t\t\t    console.log(res);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tthis.$nextTick(() => this.calcSize())\r\n\t\t},\r\n\t\tcomputed:{\r\n\t\t\t...mapState(['orderType','pintuanType']),\r\n\t\t\tproductCartNum(id) {\t//计算单个饮品添加到购物车的数量\r\n\t\t\t\treturn id => this.cart.reduce((acc, cur) => {\r\n\t\t\t\t\t\tif(cur.id === id) {\r\n\t\t\t\t\t\t\treturn acc += cur.number\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn acc\r\n\t\t\t\t\t}, 0)\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods:{\r\n\t\t\t...mapMutations(['SET_ORDER_TYPE','SET_PINTUAN_TYPE']),\r\n\t\t\tcalcSize() {\r\n\t\t\t\tlet h = 0\r\n\t\t\t\t\r\n\t\t\t\tthis.menu_list.forEach(item => {\r\n\t\t\t\t\tlet view = uni.createSelectorQuery().select(`#goods_${item.id}`)\r\n\t\t\t\t\tview.fields({\r\n\t\t\t\t\t\tsize: true\r\n\t\t\t\t\t}, data => {\r\n\t\t\t\t\t\titem.top = h\r\n\t\t\t\t\t\th += data.height\r\n\t\t\t\t\t\titem.ht = h\r\n\t\t\t\t\t}).exec()\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tpin_tap(){\r\n\t\t\t\tconst token = uni.getStorageSync('token');\r\n\t\t\t\tconsole.log(token)\r\n\t\t\t\tif(token){\r\n\t\t\t\t\tthis.showPintuan = true\r\n\t\t\t\t}else{\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t    content: '您還沒有登錄，請先登錄',\r\n\t\t\t\t\t\t    success: function (res) {\r\n\t\t\t\t\t\t        if (res.confirm) {\r\n\t\t\t\t\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\t\t\t\t\turl:'/pages/login/login'\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t        } else if (res.cancel) {\r\n\t\t\t\t\t\t        }\r\n\t\t\t\t\t\t    }\r\n\t\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tloca_tap(){\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl:\"/pages/chooseShop/chooseShop\"\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\torder_type_tap(type){\r\n\t\t\t\tif(type == 1){\r\n\t\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\t\turl:\"/pages/userAdress/userAdress\"\r\n\t\t\t\t\t})\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.SET_ORDER_TYPE(type)\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t},\r\n\t\t\tmenu_Tap(id){\r\n\t\t\t\tthis.menu_id_current=id;\r\n\t\t\t\tthis.goods_scrollTop = this.menu_list.find(item => item.id == id).top+Math.random();\r\n\t\t\t\tconsole.log(this.goods_scrollTop)\r\n\t\t\t\t\t\r\n\t\t\t},\r\n\t\t\tgoods_scroll({detail}) {\r\n\t\t\t\t//this.goods_scrollTop=detail.scrollTop;//仅仅起到监听作用，防止重复设值不生效\r\n\t\t\t\tlet {scrollTop} =detail;\r\n\t\t\t\tscrollTop=Math.ceil(scrollTop)+1;\r\n\t\t\t\t\r\n\t\t\t\tlet tabs = this.menu_list.filter(item=>item.top<=scrollTop&&item.ht>scrollTop)\r\n\t\t\t\tif(tabs.length>0){\r\n\t\t\t\t\tthis.menu_id_current=tabs[0].id\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tshowProductDetailModal(good) {\r\n\t\t\t\tthis.good = good\r\n\t\t\t\tthis.goodModalVisible = true\r\n\t\t\t},\r\n\t\t\thandleAddToCart(good) {\t//添加到购物车\r\n\t\t\tconsole.log(this.productCartNum());\r\n\t\t\t\tconst index = this.cart.findIndex(item => {\r\n\t\t\t\t\tif(!good.is_single) {\r\n\t\t\t\t\t\treturn (item.id == good.id) && (item.materials_text == good.materials_text)\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn item.id === good.id\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t\tif(index > -1) {\r\n\t\t\t\t\tthis.cart[index].number += (good.number || 1)\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tthis.cart.push({id: good.id,\r\n\t\t\t\t\t//cate_id: good.category_id,\r\n\t\t\t\t\tname: good.name,\r\n\t\t\t\t\tprice: good.price,\r\n\t\t\t\t\ttruePrice:good.truePrice|| good.price,\r\n\t\t\t\t\tnumber: good.number || 1,\r\n\t\t\t\t\t//image: good.images[0].url,\r\n\t\t\t\t\timgurl:good.imgurl,\r\n\t\t\t\t\tis_single: good.is_single,\r\n\t\t\t\t\tmaterials_text: good.materials_text || '',\r\n\t\t\t\t\tis_checked:true,\r\n\t\t\t\t});\r\n\t\t\t\t// this.cart.push({\r\n\t\t\t\t// \tid: good.id,\r\n\t\t\t\t// \tcate_id: good.category_id,\r\n\t\t\t\t// \tname: good.name,\r\n\t\t\t\t// \tprice: good.price,\r\n\t\t\t\t// \tnumber: good.number || 1,\r\n\t\t\t\t// \timage: good.images[0].url,\r\n\t\t\t\t// \tis_single: good.is_single,\r\n\t\t\t\t// \tmaterials_text: good.materials_text || ''\r\n\t\t\t\t// })\r\n\t\t\t},\r\n\t\t\thandleMinusFromCart(good) { //从购物车减商品\r\n\t\t\t\tlet index\r\n\t\t\t\tif(good.is_single) {\r\n\t\t\t\t   index = this.cart.findIndex(item => item.id == good.id)\r\n\t\t\t\t} else {\r\n\t\t\t\t   index = this.cart.findIndex(item => (item.id == good.id) && (item.materials_text == good.materials_text))\r\n\t\t\t\t}\r\n\t\t\t\tthis.cart[index].number -= 1\r\n\t\t\t\tif(this.cart[index].number <= 0) {\r\n\t\t\t\t\tthis.cart.splice(index, 1)\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\thandleAddToCartInModal(good) {\r\n\t\t\t\tthis.handleAddToCart(good)\r\n\t\t\t\tthis.closeProductDetailModal()\r\n\t\t\t},\r\n\t\t\tcloseProductDetailModal() {\r\n\t\t\t\tthis.goodModalVisible = false\r\n\t\t\t\tthis.good = {}\r\n\t\t\t},\r\n\t\t\tclearCart() {\r\n\t\t\t\tthis.cart = []\r\n\t\t\t},\r\n\t\t\tcheckAllChange(e){\r\n\t\t\t\tvar values = e.detail.value;\r\n\t\t\t\tconsole.log(e)\r\n\t\t\t\tif(values.length > 0){\r\n\t\t\t\t\tthis.cart.forEach(item => item.is_checked = true)\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.cart.forEach(item => item.is_checked = false)\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcheckboxChange(e){\r\n\t\t\t\tvar values = e.detail.value;\r\n\t\t\t\tvar id=e.currentTarget.dataset.id;\r\n\t\t\t\tconsole.log(e)\r\n\t\t\t\tif(values.length > 0){\r\n\t\t\t\t\tthis.cart.find(item => item.id==id).is_checked=true;\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.cart.find(item => item.id==id).is_checked= false;\r\n\t\t\t}\r\n\t\t},\r\n\t\tchoose_pintuan_type(type){\r\n\t\t\tthis.showPintuan=false;\r\n\t\t\tif(type==1 ){\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl:\"/pages/userAdress/userAdress?from=pintuan\"\r\n\t\t\t\t})\r\n\t\t\t}else{\r\n\t\t\t\tthis.SET_PINTUAN_TYPE(2)\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl:\"/pages/pintuan/pintuan\"\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\t\r\n\t\t}\r\n\t},\r\n}\r\n\t\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t@import \"order.scss\";\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/order/order.vue	(revision b7b438356754f455624de4864dd3d84ae0a14d9f)
+++ pages/order/order.vue	(date 1602685319077)
@@ -1,10 +1,11 @@
 <template>
 	<view class="page">
 		<!-- 自定义导航栏start -->
-		<uni-nav-bar :title="title" statusBar style="">
+		<uni-nav-bar :title="title" statusBar style="" >
 			<block slot="left">
 				<view style="height: 35px;line-height: 35px;border-radius: 18px;border: 1px solid #eaeaea;margin-left: 24rpx;padding: 0 15px;display: flex;align-self: center;">
-					<text style="font-size: 17px;color: #666666;" @tap="pin_tap">拼</text>
+					<text style="font-size: 17px;color: #666666;" @tap="pin_tap" v-if="!showSearch">拼</text>
+					<text style="font-size: 17px;color: #666666;" v-else>拼</text>
 					<text style="width: 29px;font-size: 17px;text-align: center;color: #EAEAEA;">|</text>
 					<icon type="search" size="17" color="#666666" style="display: flex;align-items: center;" @tap="showSearch=true"></icon>
 				</view>
@@ -22,7 +23,7 @@
 						<view class="loca_icon">
 							<image src="../../static/images/order/location.png" mode=""></image>
 						</view>
-						<view class="shop_adress">{{shop_info.shop_adress.length<=9 ? shop_info.shop_adress:shop_info.shop_adress.substr(0,8)+"..." }}</view>
+						<view class="shop_adress">{{choosedShop.shop_address.length<=9 ? choosedShop.shop_address:choosedShop.shop_address.substr(0,8)+"..." }}</view>
 						<uni-icons type="arrowright" size="35" color="#333333"></uni-icons>
 					</view>
 					<view class="bottom">
@@ -30,10 +31,10 @@
 							<image src="../../static/images/order/shop_tap.jpg" mode=""></image>
 						</view>
 						<view class="shop_name">
-							{{shop_info.shop_name}}
+							{{choosedShop.shop_name}}
 						</view>
 						<view class="tip_text">
-							{{shop_info.tip}}
+							{{choosedShop.tip}}
 						</view>
 					</view>
 					
@@ -173,7 +174,6 @@
 </template>
 
 <script>
-	import judgeLogin from '@/util/judgeLogin.js'
 	import {mapState, mapMutations} from 'vuex'
 	import {menu_list} from './data.js';
 	import actions from './components/actions/actions.vue'
@@ -195,11 +195,6 @@
 			},
 		data() {
 			return {
-				shop_info:{
-					shop_adress:'合肥市蜀山區丹霞路店店',
-					shop_name:'合肥正大廣場店',
-					tip:'送出外賣'
-				},
 				notice_list:[
 					'多肉玫瓏瓜&玫瓏芒芒甘露新上市，優秀玫瓏瓜，清涼夏日解渴',
 					'歐洲國外冰箱貼法國巴黎挪威英國倫敦新西蘭丹麥匈牙利出國紀念品',
@@ -242,7 +237,7 @@
 			this.$nextTick(() => this.calcSize())
 		},
 		computed:{
-			...mapState(['orderType','pintuanType']),
+			...mapState(['orderType','pintuanType','choosedShop','choosedAddress']),
 			productCartNum(id) {	//计算单个饮品添加到购物车的数量
 				return id => this.cart.reduce((acc, cur) => {
 						if(cur.id === id) {
@@ -253,7 +248,7 @@
 			}
 		},
 		methods:{
-			...mapMutations(['SET_ORDER_TYPE','SET_PINTUAN_TYPE']),
+			...mapMutations(['SET_ORDER_TYPE','SET_PINTUAN_TYPE','SET_CHOOSED_SHOP','SET_CHOOSED_ADDRESS']),
 			calcSize() {
 				let h = 0
 				
@@ -325,7 +320,7 @@
 			handleAddToCart(good) {	//添加到购物车
 			console.log(this.productCartNum());
 				const index = this.cart.findIndex(item => {
-					if(!good.is_single) {
+					if(good.materials.length) {
 						return (item.id == good.id) && (item.materials_text == good.materials_text)
 					} else {
 						return item.id === good.id
@@ -415,6 +410,40 @@
 				})
 			}
 			
+		},
+		pay(price){
+			var app = getApp();
+			var order_info={};
+			var goods =[];
+			var goods_data = [];
+			this.cart.filter(item => item.is_checked==true).forEach(item =>{
+				let good ={};
+				good.id = item.id;
+				good.goods_name = item.name;
+				good.goods_price = item.truePrice;
+				good.home_avatar = item.imgurl;
+				good.norm = item.materials_text;
+				good.norm_id = item.norm_id ? item.norm_id : [];
+				good.goods_num =item.number;
+				goods_data.push(good);
+				
+			})
+			order_info.goods_data = goods_data;
+			order_info.shop_id = this.choosedShop.id
+			order_info.shop_name = this.choosedShop.shop_name
+			order_info.payment_info = price
+			order_info.address_id = this.choosedAddress.id
+			order_info.contact_name = this.choosedAddress.contact_name
+			order_info.contact_sex = this.choosedAddress.contact_sex
+			order_info.contact_phone = this.choosedAddress.contact_phone
+			order_info.contact_address = this.choosedAddress.contact_address
+			order_info.contact_number = this.choosedAddress.contact_number
+			app.globalData.orderInfo = order_info;
+			uni.navigateTo({
+				url:'/pages/orderPayment/orderPayment'
+			})
+			
+			
 		}
 	},
 }
Index: store/index.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>import Vue from 'vue'\r\nimport Vuex from 'vuex'\r\n\r\nVue.use(Vuex)\r\n\r\n//为了方便测试，此处用vuex做全局数据\r\nconst store = new Vuex.Store({\r\n\tstate: {\r\n\t\torderType: 1,\r\n\t\tpintuanType:2,\r\n\t\tchoosedShop:{\r\n\t\t\t\"id\": \"15989536458951855\",\r\n\t\t\t\"shop_name\": \"天觀商城店\",\r\n\t\t\t\"shop_address\": \"安徽省合肥市蜀山区芙蓉路291号\",\r\n\t\t\t\"longitude\": \"117.2359925972313\",\r\n\t\t\t\"latitude\": \"31.78783487034122\",\r\n\t\t\t\"work_time\": \"10:0:00\",\r\n\t\t\t\"rest_time\": \"22:0:00\",\r\n\t\t\t\"current_order\": \"0\",\r\n\t\t\t\"current_cups\": \"0\",\r\n\t\t\t\"distance\": 2.24\r\n\t\t},\r\n\t\tshopList:[{\r\n\t\t\t\"id\": \"15992871171146972\",\r\n\t\t\t\"shop_name\": \"合肥百乐门广场店\",\r\n\t\t\t\"shop_address\": \"安徽省合肥市蜀山区\",\r\n\t\t\t\"longitude\": \"117.23594319042803\",\r\n\t\t\t\"latitude\": \"31.7816537753481\",\r\n\t\t\t\"work_time\": \"10:0:00\",\r\n\t\t\t\"rest_time\": \"22:0:00\",\r\n\t\t\t\"current_order\": \"0\",\r\n\t\t\t\"current_cups\": \"0\",\r\n\t\t\t\"distance\": 1.74\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"id\": \"15989536458951853\",\r\n\t\t\t\"shop_name\": \"合肥正大广场店\",\r\n\t\t\t\"shop_address\": \"安徽省合肥市蜀山区芙蓉路291号\",\r\n\t\t\t\"longitude\": \"117.2359925972313\",\r\n\t\t\t\"latitude\": \"31.78783487034122\",\r\n\t\t\t\"work_time\": \"10:0:00\",\r\n\t\t\t\"rest_time\": \"22:0:00\",\r\n\t\t\t\"current_order\": \"0\",\r\n\t\t\t\"current_cups\": \"0\",\r\n\t\t\t\"distance\": 2.24\r\n\t\t},{\r\n\t\t\t\"id\": \"15992871171146974\",\r\n\t\t\t\"shop_name\": \"柏樹人家店\",\r\n\t\t\t\"shop_address\": \"安徽省合肥市蜀山区\",\r\n\t\t\t\"longitude\": \"117.23594319042803\",\r\n\t\t\t\"latitude\": \"31.7816537753481\",\r\n\t\t\t\"work_time\": \"10:0:00\",\r\n\t\t\t\"rest_time\": \"22:0:00\",\r\n\t\t\t\"current_order\": \"0\",\r\n\t\t\t\"current_cups\": \"0\",\r\n\t\t\t\"distance\": 1.74\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"id\": \"15989536458951855\",\r\n\t\t\t\"shop_name\": \"天觀商城店\",\r\n\t\t\t\"shop_address\": \"安徽省合肥市蜀山区芙蓉路291号\",\r\n\t\t\t\"longitude\": \"117.2359925972313\",\r\n\t\t\t\"latitude\": \"31.78783487034122\",\r\n\t\t\t\"work_time\": \"10:0:00\",\r\n\t\t\t\"rest_time\": \"22:0:00\",\r\n\t\t\t\"current_order\": \"0\",\r\n\t\t\t\"current_cups\": \"0\",\r\n\t\t\t\"distance\": 2.24\r\n\t\t}],\r\n\t\tcyShopList:[{\r\n\t\t\t\"id\": \"15992871171146972\",\r\n\t\t\t\"shop_name\": \"合肥百乐门广场店\",\r\n\t\t\t\"shop_address\": \"安徽省合肥市蜀山区\",\r\n\t\t\t\"longitude\": \"117.23594319042803\",\r\n\t\t\t\"latitude\": \"31.7816537753481\",\r\n\t\t\t\"work_time\": \"10:0:00\",\r\n\t\t\t\"rest_time\": \"22:0:00\",\r\n\t\t\t\"current_order\": \"0\",\r\n\t\t\t\"current_cups\": \"0\",\r\n\t\t\t\"distance\": 1.74\r\n\t\t},\r\n\t\t{\r\n\t\t\t\"id\": \"15989536458951853\",\r\n\t\t\t\"shop_name\": \"合肥正大广场店\",\r\n\t\t\t\"shop_address\": \"安徽省合肥市蜀山区芙蓉路291号\",\r\n\t\t\t\"longitude\": \"117.2359925972313\",\r\n\t\t\t\"latitude\": \"31.78783487034122\",\r\n\t\t\t\"work_time\": \"10:0:00\",\r\n\t\t\t\"rest_time\": \"22:0:00\",\r\n\t\t\t\"current_order\": \"0\",\r\n\t\t\t\"current_cups\": \"0\",\r\n\t\t\t\"distance\": 2.24\r\n\t\t}],\r\n\t\t\r\n\t},\r\n\tmutations: {\r\n\t\tSET_ORDER_TYPE(state, orderType) {\r\n\t\t\tstate.orderType = orderType\r\n\t\t},\r\n\t\tSET_CHOOSED_SHOP(state,choosedShop){\r\n\t\t\tstate.choosedShop = choosedShop\r\n\t\t},\r\n\t\tSET_SHOP_LIST(state,shopList){\r\n\t\t\tstate.shopList = shopList\r\n\t\t},\r\n\t\tSET_CY_SHOP_LIST(state,cyShopList){\r\n\t\t\tstate.cyShopList = cyShopList\r\n\t\t},\r\n\t\tSET_PINTUAN_TYPE(state,pintuanType){\r\n\t\t\tstate.pintuanType = pintuanType\r\n\t\t}\r\n\t\t\r\n\t}\r\n})\r\n\r\nexport default store\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- store/index.js	(revision b7b438356754f455624de4864dd3d84ae0a14d9f)
+++ store/index.js	(date 1602685319084)
@@ -8,6 +8,7 @@
 	state: {
 		orderType: 1,
 		pintuanType:2,
+		token:'KbJ3eQFi3+ErJg4sgHvRxzc0Yjk0ODAzNTY2NjhkNTFkYjdjZGNkYmJjM2ZkYjdhNjY3M2ZkMmUyOWU0NGM3OTMxZTRlZWQ4ZjlhOWQ0ZDahZmrINdB5avDmJea/ep06Hunl39st/eQkAe13k7TmIQ==',
 		choosedShop:{
 			"id": "15989536458951855",
 			"shop_name": "天觀商城店",
@@ -20,6 +21,15 @@
 			"current_cups": "0",
 			"distance": 2.24
 		},
+		choosedAddress:{
+			"id": "16007580462028548",
+			"contact_name": "张三",
+			"contact_sex": "先生",
+			"contact_phone": "17714012698",
+			"contact_address": "合肥市蜀山区梅山路107号",
+			"contact_number": "人民政府办公大楼10楼107",
+			"default_status": "1"
+		},
 		shopList:[{
 			"id": "15992871171146972",
 			"shop_name": "合肥百乐门广场店",
@@ -108,6 +118,9 @@
 		},
 		SET_PINTUAN_TYPE(state,pintuanType){
 			state.pintuanType = pintuanType
+		},
+		SET_CHOOSED_ADDRESS(state,choosedAddress){
+			state.choosedAddress = choosedAddress
 		}
 		
 	}
