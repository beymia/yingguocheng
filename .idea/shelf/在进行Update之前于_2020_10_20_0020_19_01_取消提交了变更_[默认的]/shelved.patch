Index: pages/messageCenter/messageCenter.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"msg_center\">\r\n    <view v-if=\"!msgList.length\" class=\"empty\">\r\n      <image src=\"../../static/images_t/messageCenter/msg_empty.png\"></image>\r\n      <text>消息列表为空</text>\r\n    </view>\r\n    <view v-else class=\"msg_content\">\r\n      <view class=\"msg_item\"\r\n            v-for=\"(msg,index) in msgList\"\r\n            :key=\"index\">\r\n        <text>{{ msg.msg_text }}</text>\r\n        <text>{{ msg.created_at }}</text>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport {msgCenter} from \"../../request/api\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      msgList:[]\r\n    }\r\n  },\r\n  async mounted(){\r\n    this.msgList = (await msgCenter()).data;\r\n    console.log(this.msgList);\r\n  },\r\n  methods: {}\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\nuni-page-body{\r\n  height: 100%;\r\n  background-color: $main-bg;\r\n}\r\n.msg_center{\r\n  width: 100%;\r\n  background-color: $main-bg;\r\n\r\n  .empty{\r\n    font-size: $font-size-sm;\r\n    color: $font-color3;\r\n    padding-top: 254rpx;\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n\r\n    image{\r\n      width: 200rpx;\r\n      height: 217rpx;\r\n      margin-bottom: 20rpx;\r\n    }\r\n  }\r\n\r\n  .msg_content{\r\n    width: 100%;\r\n    padding: 0 $spacing-base;\r\n    box-sizing: border-box;\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n\r\n    .msg_item{\r\n      width: 100%;\r\n      height: 130rpx;\r\n      background: #ffffff;\r\n      border-radius: 20rpx;\r\n      margin-top: $spacing-lg;\r\n      font-size: $font-size-sm;\r\n      color: $font-color1;\r\n      display: flex;\r\n      flex-direction: column;\r\n      justify-content: space-between;\r\n      padding: 30rpx 0 24rpx 20rpx;\r\n      box-sizing: border-box;\r\n\r\n\r\n      text:nth-child(2){\r\n        font-size: $font-size-sm - 2rpx;\r\n        color: $font-color3;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/messageCenter/messageCenter.vue	(revision cf09c6e1e9ecb362fd78cb7b2a20d14af2da8e20)
+++ pages/messageCenter/messageCenter.vue	(date 1603177541606)
@@ -37,8 +37,10 @@
   height: 100%;
   background-color: $main-bg;
 }
+
 .msg_center{
   width: 100%;
+  height: 100%;
   background-color: $main-bg;
 
   .empty{
Index: request/api.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>const ajax = require('./ajax')\r\n\r\n//true是请求时携带token，false为不携带\r\n\r\n//致用戶\r\nexport const tolk = (data)=>ajax('/config/talk',data,'post')\r\n//订单详情\r\nexport const orderForm = (data) => ajax('/user/order', data, 'post', 1)\r\n//开发票\r\nexport const invoice = (data) => ajax('/invoice-apply/create-apply', data, 'post', 1)\r\n//发送验证码\r\nexport const sendCheckCode = (data) => ajax('/sms/login-sms', data, 'post')\r\n//效验验证码\r\nexport const verifyCode = (data) => ajax('/sms/verify-sms', data, 'post')\r\n//登录&注册\r\nexport const login = (data) => ajax('/login/login', data, 'post')\r\n//积分商城\r\nexport const convert = (data) => ajax('/convert/list', data, 'post', 1)\r\n//积分明细\r\nexport const pointsDetails = (data) => ajax('/record/integral-notes', data, 'post', 1)\r\n//积分兑换记录\r\nexport const exchangeRecord = (data) => ajax('/integral/convert-record', data, 'post', 1)\r\n//積分商品詳情\r\nexport const pointsGoodsDetail = (data) => ajax('/convert/detail', data, 'post', 1)\r\n//積分兌換禮品\r\nexport const redeemGifts = (data) => ajax('/convert/convert', data, 'post', 1)\r\n//用户信息\r\nexport const userSpace = (data) => ajax('/user/user-info', data, 'post', 1)\r\n//开通会员\r\nexport const joinMember = (data) => ajax('/pay/service', data, 'post',1)\r\n//优惠券\r\nexport const discount = (data) => ajax('/ticket/tickets', data, 'post', 1)\r\n//设置交易密码\r\nexport const setPwd = (data) => ajax('/user/setpwd', data, 'post', 1)\r\n//消费记录\r\nexport const expensesRecord = (data) => ajax('/record/balance-notes', data, 'post', 1)\r\n//会员二维码\r\nexport const qrCode = (data) => ajax('/qr-code/user-code', data, 'post', 1)\r\n//充值钱包\r\nexport const recharge = (data) => ajax('/pay/recharge', data, 'post', 1)\r\n\r\n//会员等级礼包\r\nexport const levelPack = (data)=>ajax('/grade/park-list',data,'post',1)\r\n//领取等级礼包\r\nexport const receiveLevel = (data)=>ajax('/grade/receive-park',data,'post',1)\r\n//会员月度礼包\r\nexport const monthPack = (data) => ajax('/month/park-list', data, 'post', 1)\r\n//领取月度礼包\r\nexport const receivePack = (data) => ajax('/month/receive-park', data, 'post', 1)\r\n//骑士会员礼包\r\nexport const interestsPark = (data) => ajax('/interests/park-list', data, 'post', 1)\r\n//领取骑士会员礼包\r\nexport const receiveKnight = (data) => ajax('', data, 'post', 1)\r\n//會員購買記錄\r\nexport const rechargeRecord = (data)=>ajax('/record/service-notes',data,'post',1)\r\n\r\n//消息中心\r\nexport const msgCenter = (data) => ajax('/msg-center/list', data, 'post', 1)\r\n//会员充值信息\r\nexport const memberRechargeInfo = (data) => ajax('/config/recharge-level', data, 'post', 1)\r\n\r\n//訂單結算附加服務\r\nexport const paymentAttach = (data) => ajax('/config/attach', data, 'post')\r\n//創建訂單\r\nexport const createOrder = (data) => ajax('/order/create-order', data, 'post', 1)\r\n//發起支付\r\nexport const paymentStart = (data) => ajax('/pay/pay', data, 'post', 1)\r\n//訂單可用優惠券\r\nexport const usedCoupon = (data) => ajax('/ticket/suit-tickets', data, 'post', 1)\r\n\r\n//初始化聊天室\r\nexport const initChat = (data) => ajax('/dialog/init-dialog', data, 'post', 1)\r\n//發送消息\r\nexport const sendMsg = (data) => ajax('/dialog/send-msg', data, 'post', 1)\r\n//接受消息\r\nexport const receiveMsg = (data) => ajax('/dialog/latest-dialog', data, 'post', 1)\r\n\r\n//奶茶有礼列表\r\nexport const milkList = (data) => ajax('/foreseeList-card/list', data, 'post', 1)\r\n//我的卡片\r\nexport const myForesee = (data) => ajax('/foreseeList-card/my-card', data, 'post', 1)\r\n//购买卡片\r\nexport const buyForesee = (data) => ajax('/foreseeList-card/pay-card', data, 'post', 1)\r\n//收送记录\r\nexport const mutualRecord = (data) => ajax('/foreseeList-card/my-gift', data, 'post', 1)\r\n//贈送預付卡\r\nexport const giveForesee = (data)=>ajax('/foresee-card/handsel-gift',data,'post',1)
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- request/api.js	(revision cf09c6e1e9ecb362fd78cb7b2a20d14af2da8e20)
+++ request/api.js	(date 1603163490241)
@@ -28,11 +28,11 @@
 export const userSpace = (data) => ajax('/user/user-info', data, 'post', 1)
 //开通会员
 export const joinMember = (data) => ajax('/pay/service', data, 'post',1)
-//优惠券
+//全部优惠券
 export const discount = (data) => ajax('/ticket/tickets', data, 'post', 1)
 //设置交易密码
 export const setPwd = (data) => ajax('/user/setpwd', data, 'post', 1)
-//消费记录
+//钱包余额消费记录
 export const expensesRecord = (data) => ajax('/record/balance-notes', data, 'post', 1)
 //会员二维码
 export const qrCode = (data) => ajax('/qr-code/user-code', data, 'post', 1)
@@ -47,16 +47,16 @@
 export const monthPack = (data) => ajax('/month/park-list', data, 'post', 1)
 //领取月度礼包
 export const receivePack = (data) => ajax('/month/receive-park', data, 'post', 1)
-//骑士会员礼包
+//会员等阶礼包
 export const interestsPark = (data) => ajax('/interests/park-list', data, 'post', 1)
-//领取骑士会员礼包
+//领取会员等阶礼包
 export const receiveKnight = (data) => ajax('', data, 'post', 1)
 //會員購買記錄
 export const rechargeRecord = (data)=>ajax('/record/service-notes',data,'post',1)
 
 //消息中心
 export const msgCenter = (data) => ajax('/msg-center/list', data, 'post', 1)
-//会员充值信息
+//获取会员充值等阶信息（金额 & 有效时间）
 export const memberRechargeInfo = (data) => ajax('/config/recharge-level', data, 'post', 1)
 
 //訂單結算附加服務
Index: request/ajax.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>/*\r\n * 简易封装模拟测试请求\r\n * */\r\nfunction ajax(url, data = {}, method = 'GET', h) {\r\n  // TODO 生产环境需要替换默认的URL地址\r\n\r\n  let header = {};\r\n\r\n\r\n  h && (header['token'] = getApp().globalData.userToken)\r\n\r\n  header['Content-Type'] = 'application/x-www-form-urlencoded'\r\n  let baseURL;\r\n  // #ifdef H5\r\n  baseURL = '/api'\r\n  // #endif\r\n  // #ifndef H5\r\n  baseURL = 'http://api.plg.wugee.net/'\r\n  // #endif\r\n  return new Promise((resolve, reject) => {\r\n    uni.request({\r\n      url: baseURL + url,\r\n      data,\r\n      method,\r\n      header,\r\n      success(result) {\r\n        if (result.statusCode !== 200 || result.data.code === 1001) reject(result)\r\n        resolve(result.data)\r\n      },\r\n      fail(err) {\r\n        reject(err)\r\n      }\r\n    })\r\n  })\r\n}\r\n\r\nmodule.exports = ajax\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- request/ajax.js	(revision cf09c6e1e9ecb362fd78cb7b2a20d14af2da8e20)
+++ request/ajax.js	(date 1603187377477)
@@ -6,7 +6,6 @@
 
   let header = {};
 
-
   h && (header['token'] = getApp().globalData.userToken)
 
   header['Content-Type'] = 'application/x-www-form-urlencoded'
@@ -24,14 +23,44 @@
       method,
       header,
       success(result) {
-        if (result.statusCode !== 200 || result.data.code === 1001) reject(result)
+        // TODO token错误
+        if (result.statusCode !== 200 || result.data.code === 1001) {
+          tokenError(h, result, reject)
+          return;
+        }
         resolve(result.data)
       },
       fail(err) {
+        console.log('请求出错', err.data);
         reject(err)
       }
     })
   })
 }
 
+//本地存在token，并且请求的数据需要token！但错误信息为token错误时触发
+function tokenError(h, result, reject) {
+  let token = uni.getStorageSync('token')
+  console.log(token);
+  if (token && (h && result.data.msg === 'Token Error')) {
+    uni.showModal({
+      title: '登陆状态失效!\n请重新登陆',
+      success(res) {
+        //点击确定跳转登录页
+        if (res.confirm) {
+          uni.navigateTo({
+            url: '/pages/login/login',
+          })
+          return;
+        }
+        //点击取消，抛出错误
+        reject(result)
+      },
+    })
+  } else {
+    //正常错误直接抛出
+    reject(result)
+  }
+}
+
 module.exports = ajax
Index: pages/setPassword/setPassword.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"set_password\">\r\n    <view class=\"content\">\r\n      <view class=\"head_title\">\r\n        <text v-if=\"pwd.length !== 6\">請設置交易密碼</text>\r\n        <text v-else>請确认交易密碼</text>\r\n        <text class=\"title_tip\">為了您的資金安全，請先設置交易密碼</text>\r\n      </view>\r\n      <view class=\"password\">\r\n        <label v-for=\"(code,index) in 6\" :key=\"index\">\r\n          <input class=\"pwd_content\"\r\n                 disabled\r\n                 maxlength=\"1\"\r\n                 v-model=\"currentPwd[index]\"\r\n                 type=\"password\">\r\n        </label>\r\n        <input focus\r\n               @input=\"inputPwd\"\r\n               v-model=\"currentPwd\"\r\n               maxlength=\"6\"\r\n               class=\"empty_input\"\r\n               type=\"text\">\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport {setPwd} from \"../../request/api\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      pwd:'',\r\n      currentPwd:''\r\n    }\r\n  },\r\n  methods: {\r\n    inputPwd(e){\r\n      this.currentPwd = e.detail.value;\r\n    },\r\n  },\r\n  watch:{\r\n   async currentPwd(value){\r\n      if(!value) return ;\r\n      if(value.length === 6 && this.pwd.length === 6){\r\n       if(value === this.pwd){\r\n         try{\r\n           uni.showLoading({\r\n             title:'请稍后'\r\n           });\r\n           //TODO 生产环境需删除设置的token\r\n           let result = await setPwd({\r\n             password:this.pwd,\r\n             veify_pwd:value\r\n           })\r\n           uni.hideLoading()\r\n           uni.redirectTo({\r\n             url:'/pages/wallet/wallet'\r\n           })\r\n         }catch (e){\r\n           this.customToast('密碼過於簡單')\r\n           this.currentPwd='';\r\n           this.pwd = '';\r\n         }\r\n       }else{\r\n         this.customToast('密碼不一致')\r\n         this.currentPwd = ''\r\n         this.pwd = '';\r\n       }\r\n        return\r\n      }\r\n      if(value.length === 6){\r\n        this.pwd = value;\r\n        this.currentPwd = '';\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n.set_password{\r\n  width: 100%;\r\n  height: 100%;\r\n  padding-top: 100rpx;\r\n  box-sizing: border-box;\r\n\r\n  .content{\r\n    width: 606rpx;\r\n    margin: 0 auto;\r\n\r\n    .head_title{\r\n      width: 100%;\r\n      height: 88rpx;\r\n      display: flex;\r\n      flex-direction: column;\r\n      justify-content: space-between;\r\n      text-align: center;\r\n      margin-bottom: 50rpx;\r\n\r\n      text{\r\n        font-size: $font-size-lg;\r\n        font-weight: $font-weight-lg;\r\n        color: $font-color1;\r\n      }\r\n\r\n      .title_tip{\r\n        font-size: $font-size-sm;\r\n        font-weight: $font-weight-base;\r\n        color: $font-color3;\r\n        margin-top: 10rpx;\r\n      }\r\n\r\n\r\n    }\r\n\r\n    .password{\r\n      display: flex;\r\n      justify-content: space-between;\r\n\r\n      .pwd_content{\r\n        width: 76rpx;\r\n        height: 90rpx;\r\n        background: #eaeaea;\r\n        border-radius: 4rpx;\r\n        text-align: center;\r\n        z-index: -1;\r\n      }\r\n\r\n      .empty_input{\r\n        height: 90rpx;\r\n        width: calc(100% + 200rpx);\r\n        position: absolute;\r\n        opacity: 0;\r\n        z-index: 999;\r\n        background-color: pink;\r\n        margin-left: -200rpx;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/setPassword/setPassword.vue	(revision cf09c6e1e9ecb362fd78cb7b2a20d14af2da8e20)
+++ pages/setPassword/setPassword.vue	(date 1603190554605)
@@ -6,28 +6,32 @@
         <text v-else>請确认交易密碼</text>
         <text class="title_tip">為了您的資金安全，請先設置交易密碼</text>
       </view>
-      <view class="password">
-        <label v-for="(code,index) in 6" :key="index">
-          <input class="pwd_content"
-                 disabled
-                 maxlength="1"
-                 v-model="currentPwd[index]"
-                 type="password">
-        </label>
-        <input focus
-               @input="inputPwd"
-               v-model="currentPwd"
-               maxlength="6"
-               class="empty_input"
-               type="text">
-      </view>
+<!--        <label v-for="(code,index) in 6" :key="index">-->
+<!--          <input class="pwd_content"-->
+<!--                 disabled-->
+<!--                 maxlength="1"-->
+<!--                 v-model="currentPwd[index]"-->
+<!--                 type="password">-->
+<!--        </label>-->
+<!--        <input focus-->
+<!--               @input="inputPwd"-->
+<!--               v-model="currentPwd"-->
+<!--               maxlength="6"-->
+<!--               class="empty_input"-->
+<!--               type="text">-->
+        <oneInput :isBox="true"
+                  :is-pwd="true"
+                  v-model="currentPwd"
+                  type="box"
+                  :maxlength="6">
+        </oneInput>
     </view>
   </view>
 </template>
 
 <script>
 import {setPwd} from "../../request/api";
-
+import oneInput from '../../components/myp-one/myp-one'
 export default {
   data() {
     return {
@@ -35,15 +39,12 @@
       currentPwd:''
     }
   },
-  methods: {
-    inputPwd(e){
-      this.currentPwd = e.detail.value;
-    },
-  },
   watch:{
    async currentPwd(value){
       if(!value) return ;
-      if(value.length === 6 && this.pwd.length === 6){
+     console.log(this.pwd);
+     console.log(this.currentPwd);
+     if(value.length === 6 && this.pwd.length === 6){
        if(value === this.pwd){
          try{
            uni.showLoading({
@@ -75,6 +76,9 @@
         this.currentPwd = '';
       }
     }
+  },
+  components:{
+    oneInput
   }
 }
 </script>
@@ -118,25 +122,25 @@
     .password{
       display: flex;
       justify-content: space-between;
-
-      .pwd_content{
-        width: 76rpx;
-        height: 90rpx;
-        background: #eaeaea;
-        border-radius: 4rpx;
-        text-align: center;
-        z-index: -1;
-      }
-
-      .empty_input{
-        height: 90rpx;
-        width: calc(100% + 200rpx);
-        position: absolute;
-        opacity: 0;
-        z-index: 999;
-        background-color: pink;
-        margin-left: -200rpx;
-      }
+      align-items: center;
+      //.pwd_content{
+      //  width: 76rpx;
+      //  height: 90rpx;
+      //  background: #eaeaea;
+      //  border-radius: 4rpx;
+      //  text-align: center;
+      //  z-index: -1;
+      //}
+      //
+      //.empty_input{
+      //  height: 90rpx;
+      //  width: calc(100% + 200rpx);
+      //  position: absolute;
+      //  opacity: 0;
+      //  z-index: 999;
+      //  background-color: pink;
+      //  margin-left: -200rpx;
+      //}
     }
   }
 }
Index: pages/checkCode/checkCode.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"check_code\">\r\n    <view class=\"login_head\">\r\n      <image src=\"../../static/images_t/orderForm/login_box.png\"></image>\r\n    </view>\r\n    <view class=\"input_container\">\r\n      <view class=\"login_tip\">\r\n        <text>請輸入驗證碼</text>\r\n        <text>已將驗證碼發送至{{ phone }}</text>\r\n      </view>\r\n      <view class=\"code_input\">\r\n        <label v-for=\"(code,index) in 6\" :key=\"index\">\r\n          <input class=\"input_content\"\r\n                 disabled\r\n                 maxlength=\"1\"\r\n                 v-model=\"verificationCode[index]\"\r\n                 type=\"text\">\r\n        </label>\r\n        <input focus @input=\"inputCode\" v-model=\"verificationCode\" maxlength=\"6\" class=\"empty_input\" type=\"text\">\r\n      </view>\r\n      <view class=\"code_timer\">\r\n        <text>{{ timer }}秒後重發</text>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport {login, verifyCode} from \"../../request/api\";\r\nconst APP = getApp().globalData;\r\nexport default {\r\n  data() {\r\n    return {\r\n      phone: '',\r\n      verificationCode: '',\r\n      isFocus: 0,\r\n      timer: 200,\r\n      wxCode: '',\r\n      from:''\r\n    }\r\n  },\r\n  onLoad(options) {\r\n    this.phone = options.phone || APP.userInfo.mobile;\r\n    this.change = options.change;\r\n    this.from = options.from;\r\n    this.customToast('驗證碼已發送',false)\r\n  },\r\n  onHide() {\r\n    this.verificationCode = '';\r\n    uni.hideLoading();\r\n    clearInterval(this.countDown)\r\n  },\r\n  onUnload() {\r\n    this.verificationCode = '';\r\n    uni.hideLoading();\r\n    clearInterval(this.countDown)\r\n    console.log('清除定時器');\r\n  },\r\n  mounted() {\r\n    this.countDown && clearInterval(this.countDown);\r\n    this.countDown = setInterval(() => {\r\n      let self = this;\r\n      self.timer--;\r\n      if (self.timer === 0) {\r\n        uni.showToast({\r\n          title: '已重發',\r\n          icon: 'none',\r\n          success() {\r\n            self.timer = 200\r\n          }\r\n        })\r\n      }\r\n    }, 1000)\r\n  },\r\n  methods: {\r\n    inputCode(e) {\r\n      this.verificationCode = e.detail.value\r\n    },\r\n    loginError() {\r\n      this.verificationCode = '';\r\n      this.customToast('出現了錯誤')\r\n    },\r\n    //登录成功，將token賦值給全局對象並且存入本地storage中\r\n    loginSuccess(result){\r\n      let self = this;\r\n      uni.hideLoading()\r\n      APP.userToken = result.data.token;\r\n      uni.setStorageSync('token', APP.userToken)\r\n      uni.switchTab({\r\n        url:self.from ? '/pages/order/order': '/pages/home/home',\r\n        success() {\r\n          //跳轉成功清除定時器，倒計時清零\r\n          clearInterval(self.countDown);\r\n          self.timer = 0;\r\n        }\r\n      })\r\n    }\r\n  },\r\n  watch: {\r\n    async verificationCode(value) {\r\n      let self = this;\r\n\r\n      if (value.length === 6) {\r\n        console.log('驗證碼輸入完成')\r\n        uni.showLoading({\r\n          title: this.change ? '請稍後' : '正在登錄中',\r\n        })\r\n        try {\r\n          //TODO change有值則跳轉到設置交易密碼頁面\r\n          if (this.change) {\r\n            try {\r\n              console.log(self.phone);\r\n              let result = await verifyCode({mobile: self.phone, code: self.verificationCode})\r\n              console.log(result);\r\n              uni.hideLoading()\r\n              uni.redirectTo({\r\n                url: '/pages/setPassword/setPassword',\r\n              })\r\n            } catch (e) {\r\n              console.log(e);\r\n              this.customToast('驗證碼錯誤')\r\n            }\r\n            return;\r\n          }\r\n\r\n          //TODO驗證驗證碼，\r\n          await verifyCode({mobile: self.phone, code: self.verificationCode})\r\n          let result;\r\n          // #ifndef APP-PLUS\r\n          uni.getProvider({\r\n            service: 'oauth',\r\n            async success(res) {\r\n              //小程序登錄\r\n              if (res.provider.length === 1&&res.provider[0] === 'weixin') {\r\n                uni.login({\r\n                  provider: res.provider[0],\r\n                  scopes: 'auth_base',\r\n                  async success(wxCode) {\r\n                    try {\r\n                      result = await login({\r\n                        mobile: self.phone,\r\n                        code: wxCode.code\r\n                      })\r\n                      self.loginSuccess(result)\r\n                    } catch (e) {\r\n                      console.log(e);\r\n                      console.log('api登錄出錯')\r\n                      self.loginError()\r\n                    }\r\n                  }\r\n                })\r\n              } else {\r\n                //h5登錄\r\n                try {\r\n                  result = await login({\r\n                    mobile: self.phone,\r\n                  })\r\n                  self.loginSuccess(result)\r\n                } catch (e) {\r\n                  console.log(e);\r\n                  console.log('登錄錯誤')\r\n                  self.loginError()\r\n                }\r\n              }\r\n            }\r\n          })\r\n          // #endif\r\n          // #ifdef APP-PLUS\r\n          try {\r\n            result = await login({\r\n              mobile: self.phone,\r\n            })\r\n            self.loginSuccess(result)\r\n          } catch (e) {\r\n            console.log(e);\r\n            console.log('登錄錯誤')\r\n            self.loginError()\r\n          }\r\n          // #endif\r\n        } catch (e) {\r\n          self.loginError()\r\n        }\r\n      }\r\n    }\r\n  },\r\n  components: {}\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.check_code{\r\n  width: 100vw;\r\n  padding: 0 $spacing-base;\r\n  box-sizing: border-box;\r\n\r\n  .login_head {\r\n    width: 100%;\r\n    height: 170rpx;\r\n    padding-top: 50rpx;\r\n\r\n    image {\r\n      width: 150rpx;\r\n      margin: 0 auto;\r\n    }\r\n  }\r\n\r\n  .input_container{\r\n    width: 100%;\r\n    height: 405rpx;\r\n    display: flex;\r\n    padding-top: 50rpx;\r\n    flex-direction: column;\r\n    justify-content: space-between;\r\n\r\n    .login_tip {\r\n      width: 100%;\r\n      height: 100rpx;\r\n      display: flex;\r\n      flex-direction: column;\r\n      justify-content: space-between;\r\n      margin-bottom: 103rpx;\r\n\r\n      text:nth-child(1) {\r\n        font-size: $font-size-lg + 2rpx;\r\n        font-weight: $font-weight-lg;\r\n        color: $font-color1;\r\n      }\r\n\r\n      text:nth-child(2) {\r\n        font-size: $font-size-sm;\r\n        color: $font-color3;\r\n      }\r\n    }\r\n  }\r\n\r\n  .code_input{\r\n    display: flex;\r\n    justify-content: space-between;\r\n\r\n    .input_content{\r\n      width: 80rpx;\r\n      height: 1rpx;\r\n      border-bottom: 1rpx solid #cccccc;\r\n      text-align: center;\r\n      z-index: -1;\r\n    }\r\n\r\n    .empty_input{\r\n      width: calc(100% + 200rpx);\r\n      position: absolute;\r\n      opacity: 0;\r\n      z-index: 999;\r\n      background-color: pink;\r\n      margin-left: -200rpx;\r\n\r\n    }\r\n  }\r\n\r\n  .code_timer{\r\n    height: 33rpx;\r\n    font-size: $font-size-sm;\r\n    color: $font-color3;\r\n    margin-left: auto;\r\n    line-height: 33rpx;\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/checkCode/checkCode.vue	(revision cf09c6e1e9ecb362fd78cb7b2a20d14af2da8e20)
+++ pages/checkCode/checkCode.vue	(date 1603191668122)
@@ -9,14 +9,21 @@
         <text>已將驗證碼發送至{{ phone }}</text>
       </view>
       <view class="code_input">
-        <label v-for="(code,index) in 6" :key="index">
-          <input class="input_content"
-                 disabled
-                 maxlength="1"
-                 v-model="verificationCode[index]"
-                 type="text">
-        </label>
-        <input focus @input="inputCode" v-model="verificationCode" maxlength="6" class="empty_input" type="text">
+        <!--改用组件-->
+<!--        <label v-for="(code,index) in 6" :key="index">-->
+<!--          <input class="input_content"-->
+<!--                 disabled-->
+<!--                 maxlength="1"-->
+<!--                 v-model="verificationCode[index]"-->
+<!--                 type="text">-->
+<!--        </label>-->
+<!--        <input focus @input="inputCode" v-model="verificationCode" maxlength="6" class="empty_input" type="text">-->
+
+        <view>
+          <view style="height: 100rpx;"></view>
+          <one-input v-model="verificationCode" :maxlength="6"></one-input>
+          <view style="height: 100rpx;"></view>
+        </view>
       </view>
       <view class="code_timer">
         <text>{{ timer }}秒後重發</text>
@@ -26,7 +33,9 @@
 </template>
 
 <script>
-import {login, verifyCode} from "../../request/api";
+import {login, verifyCode,sendCheckCode} from "../../request/api";
+import oneInput from '../../components/myp-one/myp-one'
+
 const APP = getApp().globalData;
 export default {
   data() {
@@ -36,154 +45,145 @@
       isFocus: 0,
       timer: 200,
       wxCode: '',
-      from:''
+      from: ''
     }
   },
+
   onLoad(options) {
-    this.phone = options.phone || APP.userInfo.mobile;
-    this.change = options.change;
-    this.from = options.from;
-    this.customToast('驗證碼已發送',false)
+    console.log(options.from);
+    this.phone = options.phone || APP.userInfo.mobile;//用户手机号
+    this.change = options.change;//有值则是修改密码
+    this.from = options.from;//登录完成后跳转的页面，默认跳转首页
+    this.customToast('驗證碼已發送', false)
   },
+  //页面隐藏式清除定时器，并且验证码归位
   onHide() {
     this.verificationCode = '';
     uni.hideLoading();
-    clearInterval(this.countDown)
-  },
-  onUnload() {
-    this.verificationCode = '';
-    uni.hideLoading();
+    self.timer = 200;
     clearInterval(this.countDown)
-    console.log('清除定時器');
+    console.log('页面隐藏，清楚定时器');
   },
+  //进入页面直接开始定时器,时间为0时自动重发验证码
   mounted() {
-    this.countDown && clearInterval(this.countDown);
-    this.countDown = setInterval(() => {
-      let self = this;
+    let self = this;
+    this.countDown && clearInterval(this.countDown);
+    this.countDown = setInterval(async() => {
       self.timer--;
       if (self.timer === 0) {
-        uni.showToast({
-          title: '已重發',
-          icon: 'none',
-          success() {
-            self.timer = 200
-          }
-        })
+        try{
+          await sendCheckCode({mobile:self.phone})
+          self.customToast('已重發',false)
+          self.timer = 200
+        }catch (e) {
+          console.log(e);
+          self.customToast('验证码发送失败');
+          //发送出错清除定时器
+          clearInterval(self.countDown)
+        }
       }
     }, 1000)
   },
+
   methods: {
-    inputCode(e) {
-      this.verificationCode = e.detail.value
-    },
+    // changeCode(e){
+    //   console.log(e);
+    // },
+    // //
+    // inputCode(e) {
+    //   this.verificationCode = e.detail.value
+    // },
+
+    //登陆失败
     loginError() {
       this.verificationCode = '';
-      this.customToast('出現了錯誤')
+      this.customToast('登陆失败')
     },
+
     //登录成功，將token賦值給全局對象並且存入本地storage中
-    loginSuccess(result){
+    loginSuccess(result) {
       let self = this;
       uni.hideLoading()
       APP.userToken = result.data.token;
+      APP.isLoginBox = false;
       uni.setStorageSync('token', APP.userToken)
       uni.switchTab({
-        url:self.from ? '/pages/order/order': '/pages/home/home',
+        url: self.from ? `/pages/${self.from}/${self.from}` : '/pages/home/home',
         success() {
-          //跳轉成功清除定時器，倒計時清零
+          //跳轉成功清除定時器，倒計時归为
           clearInterval(self.countDown);
-          self.timer = 0;
+          self.timer = 200;
+          console.log('登陆成功，清除定时器')
         }
       })
-    }
+    },
   },
+
   watch: {
     async verificationCode(value) {
       let self = this;
 
       if (value.length === 6) {
-        console.log('驗證碼輸入完成')
         uni.showLoading({
           title: this.change ? '請稍後' : '正在登錄中',
         })
-        try {
+
+          //驗證驗證碼，
+          try{
+            await verifyCode({mobile: self.phone, code: self.verificationCode})
+          }catch (e) {
+            self.customToast('验证码错误')
+            return;
+          }
+
           //TODO change有值則跳轉到設置交易密碼頁面
-          if (this.change) {
-            try {
-              console.log(self.phone);
-              let result = await verifyCode({mobile: self.phone, code: self.verificationCode})
-              console.log(result);
-              uni.hideLoading()
-              uni.redirectTo({
-                url: '/pages/setPassword/setPassword',
-              })
-            } catch (e) {
-              console.log(e);
-              this.customToast('驗證碼錯誤')
-            }
+          if (self.change) {
+            uni.hideLoading()
+            uni.redirectTo({
+              url: '/pages/setPassword/setPassword',
+            })
             return;
           }
 
-          //TODO驗證驗證碼，
-          await verifyCode({mobile: self.phone, code: self.verificationCode})
-          let result;
-          // #ifndef APP-PLUS
-          uni.getProvider({
-            service: 'oauth',
-            async success(res) {
-              //小程序登錄
-              if (res.provider.length === 1&&res.provider[0] === 'weixin') {
-                uni.login({
-                  provider: res.provider[0],
-                  scopes: 'auth_base',
-                  async success(wxCode) {
-                    try {
-                      result = await login({
-                        mobile: self.phone,
-                        code: wxCode.code
-                      })
-                      self.loginSuccess(result)
-                    } catch (e) {
-                      console.log(e);
-                      console.log('api登錄出錯')
-                      self.loginError()
-                    }
-                  }
+        let result;
+          //小程序登陆
+          // #ifdef MP-WEIXIN
+          uni.login({
+            provider:'weixin',
+            scopes: 'auth_base',
+            async success(wxCode) {
+              try {
+                result = await login({
+                  mobile: self.phone,
+                  code: wxCode.code
                 })
-              } else {
-                //h5登錄
-                try {
-                  result = await login({
-                    mobile: self.phone,
-                  })
-                  self.loginSuccess(result)
-                } catch (e) {
-                  console.log(e);
-                  console.log('登錄錯誤')
-                  self.loginError()
-                }
+                self.loginSuccess(result)
+              } catch (e) {
+                console.log('登陆失败',e)
+                self.loginError()
               }
             }
           })
           // #endif
-          // #ifdef APP-PLUS
-          try {
-            result = await login({
-              mobile: self.phone,
-            })
-            self.loginSuccess(result)
-          } catch (e) {
-            console.log(e);
-            console.log('登錄錯誤')
-            self.loginError()
-          }
-          // #endif
-        } catch (e) {
-          self.loginError()
-        }
+
+        // APP 和 H5 登陆
+        // #ifdef APP-PLUS | H5
+        try {
+          result = await login({
+            mobile: self.phone,
+          })
+          self.loginSuccess(result)
+        } catch (e) {
+          console.log('登錄錯誤',e)
+          self.loginError()
+        }
+        // #endif
       }
     }
   },
-  components: {}
+  components:{
+    oneInput
+  }
 }
 </script>
 
Index: pages/orderPayment/orderPayment.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"order_payment\">\r\n    <!--头部-->\r\n    <view class=\"order_payment_head\">\r\n      <view :class=\"['name_method',goodsData.haul_method===2?'one_self':'']\">\r\n        <view class=\"shop_name\">\r\n          <text style=\"display: inline\">{{ goodsData.shop_name }}</text>\r\n          <uni-icons style=\"display: inline-block;vertical-align: middle\"\r\n                     type=\"arrowright\"\r\n                     size=\"35\"\r\n                     color=\"#333333\">\r\n          </uni-icons>\r\n          <text v-if=\"goodsData.haul_method === 2\">距離您{{ goodsData.distance }}km</text>\r\n          <text v-else>{{ goodsData.contact_name }}({{ goodsData.contact_sex }}) {{ goodsData.contact_phone }}</text>\r\n        </view>\r\n        <view class=\"receiving_method\">\r\n          <view :class=\"[goodsData.haul_method === 2 ? 'active_method' : '']\">\r\n            <text>自取</text>\r\n          </view>\r\n          <view :class=\"['other_people',goodsData.haul_method === 1 ? 'active_method' : '']\">\r\n            <text>外卖</text>\r\n          </view>\r\n          <view :class=\"['shop',goodsData.haul_method === 3 ? 'active_method' : '']\">\r\n            <text>堂食</text>\r\n          </view>\r\n        </view>\r\n      </view>\r\n      <!--聯繫電話-->\r\n      <view class=\"phone\" v-if=\"goodsData.haul_method === 1\">\r\n        <view class=\"phone_input\">\r\n          <label>\r\n            <text>聯系電話</text>\r\n            <input :value=\"userPhone\" type=\"number\">\r\n          </label>\r\n        </view>\r\n        <button @click=\"autoFill\" class=\"auto_fill\" plain>自動填寫</button>\r\n      </view>\r\n    </view>\r\n    <!--取茶时间-->\r\n    <view class=\"order_time\">\r\n      <view class=\"time_title\">\r\n        <text>取茶時間</text>\r\n      </view>\r\n      <view class=\"order_progress\">\r\n        <text>前面</text>\r\n        <text class=\"text_color\">{{ goodsData.current_order }}單/{{ goodsData.current_cups }}</text>\r\n        <text>杯制作中，</text>\r\n        <text>預計</text>\r\n        <text class=\"text_color\">{{ goodsData.current_cups }}分鐘</text>\r\n        <text>後取茶</text>\r\n      </view>\r\n      <view class=\"current_progress\">\r\n        <progress activeColor=\"#17a1ff\" backgroundColor=\"#f0f0f0\" :percent=\"computeProgress\"></progress>\r\n      </view>\r\n    </view>\r\n    <!--商品列表-->\r\n    <view class=\"goods_list\">\r\n      <view class=\"list_detail\">\r\n        <view class=\"list_title\">\r\n          <text>商品列表</text>\r\n        </view>\r\n        <view v-for=\"(goods,index) in goodsData.goods_data\" :key=\"index\" class=\"goods_detail\">\r\n          <view class=\"goods_img\">\r\n            <image :src=\"goods.home_avatar\"></image>\r\n          </view>\r\n          <view class=\"goods_info\">\r\n            <view class=\"goods_name\">\r\n              <text>{{ goods.goods_name }}</text>\r\n            </view>\r\n            <view class=\"goods_extra_info\">\r\n              <text class=\"goods_straw\">{{ goods.norm }}</text>\r\n            </view>\r\n          </view>\r\n          <view class=\"goods_amount\">\r\n            <text>￥{{ goods.goods_price }}</text>\r\n            <text>x{{ goods.goods_num }}</text>\r\n          </view>\r\n        </view>\r\n      </view>\r\n      <!--附加服務-->\r\n      <view class=\"attach_service\">\r\n        <view class=\"delivery_fee\" v-if=\"goodsData.haul_method===1\">\r\n          <view class=\"left\">\r\n            <text>配送費</text>\r\n          </view>\r\n          <view class=\"right\">\r\n            <text>￥{{ goodsData.delivery_cost }}</text>\r\n          </view>\r\n        </view>\r\n        <view class=\"service1\">\r\n          <block v-for=\"attachItem in attach\" :key=\"attachItem.id\">\r\n            <view class=\"left\">\r\n              <view class=\"left_name\">\r\n                <text>{{ attachItem.attach_name }}</text>\r\n                <text>推薦選擇</text>\r\n              </view>\r\n              <view class=\"left_des\">\r\n                <text>保冷保暖，鎖住新鮮口感</text>\r\n              </view>\r\n            </view>\r\n            <view @click=\"addAttachFee(attachItem.id)\" class=\"right\">\r\n              <label>\r\n                <text>￥{{ attachItem.attach_price }}</text>\r\n                <radio :checked=\"attachArr.indexOf(attachItem.id) !== -1\" color=\"#17A1FF\"/>\r\n              </label>\r\n            </view>\r\n          </block>\r\n        </view>\r\n        <view class=\"service2\">\r\n          <view class=\"left\">\r\n            <text>優惠券</text>\r\n            <text>券</text>\r\n          </view>\r\n          <view class=\"right\">\r\n            <view>\r\n              <text v-if=\"!couponInfo.length\">暫無可用</text>\r\n              <text @click=\"navDiscount\"\r\n                    style=\"color:#17A1FF;\"\r\n                    v-if=\"couponInfo.length&&!discountAmount\">{{ couponInfo.length }}個可用\r\n              </text>\r\n              <uni-icons @click=\"navDiscount\"\r\n                         v-if=\"!discountAmount\"\r\n                         style=\"display: inline-block;vertical-align: middle\"\r\n                         type=\"arrowright\"\r\n                         size=\"35\"\r\n                         color=\"#999999\">\r\n              </uni-icons>\r\n            </view>\r\n            <view v-if=\"discountAmount\" class=\"discount\">\r\n              <view>【{{ discountAmount }}元抵用券】-￥{{ discountAmount }}</view>\r\n              <image @click=\"discountAmount = 0\" src=\"../../static/images/orderPayment/discount.png\"></image>\r\n            </view>\r\n          </view>\r\n        </view>\r\n        <!--訂單備註-->\r\n        <view class=\"service3\">\r\n          <view @click=\"isRemarks = !isRemarks\" class=\"left\">\r\n            <text>備註</text>\r\n          </view>\r\n          <view @click=\"isRemarks = !isRemarks\" class=\"right\">\r\n            <text v-if=\"remarksData.noContact\">無接觸配送，</text>\r\n            <text v-if=\"remarksData.paper\">纸巾，</text>\r\n            <text v-if=\"remarksData.sugar\">糖包</text>\r\n            <uni-icons style=\"display: inline-block;vertical-align: middle\"\r\n                       type=\"arrowright\"\r\n                       size=\"35\"\r\n                       color=\"#999999\">\r\n            </uni-icons>\r\n          </view>\r\n          <view v-if=\"isRemarks\" class=\"remarks\">\r\n            <remarks\r\n                :remarks=\"remarksArr\"\r\n                @close-remarks=\"closeRemarks\">\r\n            </remarks>\r\n          </view>\r\n        </view>\r\n      </view>\r\n      <view class=\"count_amount\">\r\n        <text>共{{ goodsData.goods_data.length }}件商品，小計</text>\r\n        <text>￥{{ totalAmount }}</text>\r\n      </view>\r\n    </view>\r\n    <!--支付方式-->\r\n    <view :class=\"['payment_method',goodsData.haul_method===1?'one_self':'']\">\r\n      <text>支付方式</text>\r\n      <view>\r\n        <image src=\"../../static/images/orderPayment/weixin_icon.png\"></image>\r\n        <text>微信支付</text>\r\n      </view>\r\n    </view>\r\n    <!--底部-->\r\n    <view class=\"payment_foot\">\r\n      <view class=\"payment_amount\">\r\n        <text>合計</text>\r\n        <text>￥{{ totalAmount }}</text>\r\n      </view>\r\n      <view @click=\"startPay\" class=\"payment_btn\">\r\n        <button plain>支付</button>\r\n      </view>\r\n    </view>\r\n    <view class=\"empty\"></view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport remarks from \"../../components-lk/remarks/remarks\";\r\nimport {createOrder, paymentAttach, paymentStart, usedCoupon} from \"../../request/api\";\r\nimport order from \"../order/order\";\r\n\r\nconst APP = getApp().globalData;\r\nexport default {\r\n  data() {\r\n    return {\r\n      userPhone: '',\r\n      isRemarks: false,\r\n      remarksData: {},\r\n      remarksArr: ['無接觸配送', '紙巾', '糖包'],\r\n      discountAmount: 0,\r\n      goodsPrice: 0,\r\n      goodsData: [],\r\n      attach: {},\r\n      totalAmount: 0,\r\n      attachArr: [],\r\n      couponInfo: [],\r\n      paymentTimer:null,\r\n    }\r\n  },\r\n  computed: {\r\n    //計算取茶時間進度條\r\n    computeProgress() {\r\n      let {current_cups, current_order} = this.goodsData;\r\n      return (current_order / current_cups) * 100;\r\n    }\r\n  },\r\n  async onLoad() {\r\n    console.log(APP.goodsPayment);\r\n    this.goodsData = APP.goodsPayment;\r\n    this.receivingMethod = this.goodsData.haul_method;\r\n    this.goods_data = [];\r\n    this.goodsId = ''\r\n    //獲取訂單傳參數據\r\n    this.goodsData.goods_data.forEach((item, index) => {\r\n      this.goodsId += item.id;\r\n      this.goods_data.push({\r\n        id: item.id,\r\n        num: item.goods_num,\r\n        norm: item.norm_id\r\n      })\r\n    });\r\n\r\n    this.totalAmount = parseFloat(this.goodsData.payment_info)\r\n\r\n    try {\r\n      //獲取附加服務信息\r\n      this.attach = (await paymentAttach()).data\r\n      //獲取可使用的優惠券信息\r\n      let temp = (await usedCoupon({\r\n        vehicle_method: this.goodsDatahaul_method,\r\n        goods_id: this.goodsId,\r\n        total_price: this.totalAmount\r\n      })).data\r\n      //優惠券返回一個對象，轉換為數組\r\n      for (let key in temp) {\r\n        if (temp.hasOwnProperty(key)) {\r\n          this.couponInfo.push(temp[key])\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.log(e);\r\n    }\r\n  },\r\n  onShow() {\r\n    //页面展示时从全局对象中获取优惠券的金额\r\n    if (!APP.coupon.goods_quota) return;\r\n    this.discountAmount = APP.coupon.goods_quota;\r\n  },\r\n  onUnload() {\r\n    //页面卸载时清空优惠券金额\r\n    APP.coupon = {};\r\n    //TODO清空支付定时器\r\n    clearTimeout(this.paymentTimer)\r\n  },\r\n  methods: {\r\n    // toggleReceiving(method) {\r\n    //   this.receivingMethod = method;\r\n    //   if (method === '2') {\r\n    //     this.surcharge = 5;\r\n    //     this.totalAmount += this.surcharge\r\n    //   } else {\r\n    //     this.surcharge ? this.totalAmount -= this.surcharge : null;\r\n    //     this.surcharge = 0;\r\n    //   }\r\n    // },\r\n    //自動輸入手機號\r\n    autoFill() {\r\n      console.log(APP.userInfo)\r\n      console.log(this.goodsData.contact_phone);\r\n      this.userPhone = this.goodsData.contact_phone;\r\n    },\r\n\r\n    //訂單備註\r\n    closeRemarks(remarks) {\r\n      this.isRemarks = false;\r\n      this.remarksData = remarks\r\n    },\r\n    //跳轉至優惠券\r\n    navDiscount() {\r\n      APP.couponInfo = this.couponInfo;\r\n      if (!this.couponInfo.length) return;\r\n      console.log(APP.couponInfo);\r\n      uni.navigateTo({\r\n        url: '/pages/discount/discount?couponInfo=' + encodeURIComponent(JSON.stringify(this.couponInfo))\r\n      })\r\n    },\r\n    //使用附加服務\r\n    addAttachFee(id) {\r\n      let self = this;\r\n      self.isAttach = !self.isAttach;\r\n      self.attach.forEach((item) => {\r\n        if (item.id === id) {\r\n          if (self.isAttach) {\r\n            self.totalAmount += parseFloat(this.attach[0].attach_price);\r\n            self.attachArr.push(id)\r\n          } else {\r\n            self.totalAmount -= parseFloat(this.attach[0].attach_price)\r\n            self.attachArr.splice(self.attachArr.indexOf(id), 1)\r\n          }\r\n        }\r\n      })\r\n    },\r\n    //開始支付\r\n    async startPay() {\r\n      let self = this;\r\n      uni.showLoading({\r\n        title: '請稍後'\r\n      })\r\n      //創建訂單\r\n      let {shop_id, shop_name, address_id, haul_method} = self.goodsData;\r\n      //傳參對象\r\n      let paramsObj = {\r\n        shop_id,//訂單id\r\n        shop_name,\r\n        address_id,\r\n        haul_method,\r\n        goods_data: this.goods_data,\r\n        remake: '',\r\n        attach_id: '',\r\n        ticket_id: APP.coupon.id,\r\n      }\r\n      paramsObj.goods_data = JSON.stringify(paramsObj.goods_data)\r\n      //訂單備註\r\n      for (let key in self.remarksData) {\r\n        if (self.remarksData.hasOwnProperty(key)) {\r\n          if (self.remarksData[key]) {\r\n            paramsObj.remake += (self.remarksData[key] + ',');\r\n          }\r\n        }\r\n      }\r\n      if (paramsObj.remake) {\r\n        paramsObj.remake = paramsObj.remake.substr(0, paramsObj.remake.length - 1);\r\n      }\r\n      //附加信息\r\n      if (self.attachArr.length) {\r\n        self.attachArr.forEach((item) => {\r\n          paramsObj.attach_id += item + ',';\r\n        })\r\n        paramsObj.attach_id = paramsObj.attach_id.substr(0, paramsObj.attach_id.length - 1);\r\n      }\r\n      //選填參數沒有值直接刪除\r\n      for (let key in paramsObj) {\r\n        if (paramsObj.hasOwnProperty(key)) {\r\n          if (!paramsObj[key]) {\r\n            delete paramsObj[key]\r\n          }\r\n        }\r\n      }\r\n      //创建订单并支付\r\n      try {\r\n        let orderNum = (await createOrder(paramsObj)).data.order_num;\r\n        let orderInfo = (await paymentStart({order_num: orderNum, shop_id: paramsObj.shop_id})).data\r\n        // TODO 延迟请求微信支付，非最终方案\r\n        self.paymentTimer && clearTimeout(self.paymentTimer)\r\n        //发起微信支付\r\n        try{\r\n          self.paymentTimer = setTimeout(async()=>{\r\n            await self.utilPayment(orderInfo)\r\n            await self.paymentSuccess();\r\n          },3000)\r\n        }catch (e) {\r\n          self.customToast('结算失败')\r\n          console.log(e);\r\n        }\r\n      } catch (e) {\r\n        self.customToast('结算失败')\r\n        console.log(e);\r\n      }\r\n    },\r\n   async paymentSuccess(){\r\n      this.customToast('结算成功');\r\n      uni.switchTab({\r\n        url:'/pages/orderForm/orderForm',\r\n      })\r\n    }\r\n  },\r\n  watch: {\r\n    discountAmount(newAmount, oldAmount) {\r\n      newAmount = parseFloat(newAmount);\r\n      oldAmount = parseFloat(oldAmount)\r\n      newAmount ? this.totalAmount -= newAmount : this.totalAmount += oldAmount;\r\n    },\r\n  },\r\n  components: {\r\n    remarks\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\r\n.order_payment {\r\n  width: 100%;\r\n  height: 100%;\r\n  background-color: #F7F7F7;\r\n  color: $font-color1;\r\n  font-weight: $font-weight-base;\r\n\r\n  .order_payment_head {\r\n    width: 100%;\r\n    background-color: #FFFFFF;\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-between;\r\n    padding: 0 $spacing-base;\r\n    box-sizing: border-box;\r\n\r\n    .name_method {\r\n      width: 100%;\r\n      display: flex;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n\r\n      &.one_self{\r\n        border-bottom: 1rpx solid rgba(204, 204, 204, .5);\r\n      }\r\n\r\n      .shop_name {\r\n        font-size: $font-size-lg + 2rpx;\r\n        font-weight: $font-weight-lg;\r\n\r\n        text:nth-child(3) {\r\n          font-size: $font-size-sm + 2rpx;\r\n          color: $font-color2;\r\n          display: block;\r\n          margin: 10rpx 0 $spacing-lg 0;\r\n          font-weight: $font-weight-base;\r\n        }\r\n      }\r\n\r\n      .receiving_method {\r\n        width: 240rpx;\r\n        height: 68rpx;\r\n        background: #f6f6f6;\r\n        border: 1rpx solid $main-color;\r\n        border-radius: 34rpx;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-around;\r\n        font-size: $font-size-sm;\r\n        color: $main-color;\r\n\r\n        view {\r\n          flex: 1;\r\n          text-align: center;\r\n          width: 80rpx;\r\n          height: 58rpx;\r\n          line-height: 58rpx;\r\n\r\n          &.active_method {\r\n            background: $main-color;\r\n            border-radius: 29rpx;\r\n            color: #FFFFFF;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    .phone {\r\n      width: 100%;\r\n      height: 46rpx;\r\n      display: flex;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n      margin: $spacing-lg + 4rpx 0;\r\n\r\n      .phone_input {\r\n        font-size: $font-size-base;\r\n        color: $font-color1;\r\n\r\n        label {\r\n          display: flex;\r\n          align-items: center;\r\n          flex-wrap: nowrap;\r\n\r\n          input {\r\n            font-size: $font-size-base;\r\n            color: $font-color1;\r\n            margin-left: 20rpx;\r\n          }\r\n        }\r\n      }\r\n\r\n      .auto_fill {\r\n        width: 118rpx;\r\n        height: 46rpx;\r\n        background: #ffffff;\r\n        border: 1rpx solid $main-color;\r\n        border-radius: 6rpx;\r\n        font-size: $font-size-sm;\r\n        color: $main-color;\r\n        padding: 0;\r\n        margin: 0;\r\n        line-height: 46rpx;\r\n      }\r\n    }\r\n  }\r\n\r\n  .order_time {\r\n    width: 100%;\r\n    min-height: 210rpx;\r\n    margin-top: $spacing-base;\r\n    background: #FFFFFF;\r\n    padding: $spacing-lg $spacing-base;\r\n    box-sizing: border-box;\r\n    font-size: $font-size-base;\r\n    color: $font-color1;\r\n    display: flex;\r\n    flex-direction: column;\r\n\r\n    .order_progress {\r\n      font-size: $font-size-sm;\r\n      color: $font-color3;\r\n      margin: 20rpx 0;\r\n\r\n      .text_color {\r\n        color: $main-color;\r\n        font-size: $font-size-base\r\n      }\r\n    }\r\n\r\n    .current_progress {\r\n      width: 702rpx;\r\n      height: 30rpx;\r\n      background: #f0f0f0;\r\n      border-radius: 15rpx;\r\n      overflow: hidden;\r\n\r\n      /* #ifdef H5 */\r\n      /deep/ .uni-progress-bar {\r\n        height: 30rpx !important;\r\n      }\r\n\r\n      /deep/.uni-progress-inner-bar {\r\n        border-radius: 15rpx;\r\n      }\r\n\r\n      /* #endif*/\r\n    }\r\n  }\r\n\r\n  .goods_list {\r\n    width: 100%;\r\n    padding: $spacing-lg $spacing-base;\r\n    box-sizing: border-box;\r\n    background: #FFFFFF;\r\n    margin-top: $spacing-base;\r\n\r\n    .list_detail {\r\n      width: 100%;\r\n      min-height: 220rpx;\r\n      border-bottom: 1rpx solid rgba(204, 204, 204, .4);\r\n      display: flex;\r\n      flex-direction: column;\r\n      box-sizing: border-box;\r\n\r\n      .list_title {\r\n        height: 40rpx;\r\n        font-size: $font-size-base;\r\n        color: $font-color1;\r\n      }\r\n\r\n      .goods_detail {\r\n        width: 100%;\r\n        margin-top: $spacing-lg;\r\n        display: flex;\r\n        flex-wrap: nowrap;\r\n        align-items: center;\r\n        position: relative;\r\n\r\n        .goods_img {\r\n          margin-right: 20rpx;\r\n\r\n          image {\r\n            width: 120rpx;\r\n            height: 120rpx;\r\n            vertical-align: middle;\r\n          }\r\n        }\r\n\r\n        .goods_info {\r\n          align-self: center;\r\n\r\n          .goods_name {\r\n            font-size: $font-size-base;\r\n            font-weight: $font-weight-lg;\r\n            color: $font-color1;\r\n            margin-bottom: 10rpx;\r\n          }\r\n\r\n          .goods_extra_info {\r\n            height: 60rpx;\r\n            font-size: $font-size-sm - 2rpx;\r\n            color: $font-color3;\r\n            display: flex;\r\n            flex-direction: row;\r\n            flex-wrap: wrap;\r\n          }\r\n        }\r\n\r\n        .goods_amount {\r\n          min-width: 75rpx;\r\n          height: 91rpx;\r\n          display: flex;\r\n          flex-direction: column;\r\n          justify-content: space-between;\r\n          position: absolute;\r\n          right: 0;\r\n          text-align: center;\r\n\r\n          text:nth-child(1) {\r\n            font-size: $font-size-lg + 2rpx;\r\n            font-weight: $font-weight-lg;\r\n            color: $font-color1;\r\n          }\r\n\r\n          text:nth-child(2) {\r\n            font-size: $font-size-sm;\r\n            color: $font-color3;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    .attach_service {\r\n      width: 100%;\r\n      font-size: $font-size-sm;\r\n      color: $font-color1;\r\n      padding-top: $spacing-lg;\r\n      box-sizing: border-box;\r\n\r\n      .service1,\r\n      .service2,\r\n      .service3,\r\n      .delivery_fee{\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n        margin-bottom: $spacing-lg;\r\n\r\n        .left {\r\n          display: flex;\r\n          flex-direction: column;\r\n          justify-content: space-around;\r\n        }\r\n      }\r\n\r\n      .service1 {\r\n        .left {\r\n          .left_name {\r\n            align-self: flex-start;\r\n\r\n            text:nth-child(2) {\r\n              flex: 1;\r\n              display: inline-block;\r\n              width: 80rpx;\r\n              height: 30rpx;\r\n              background: $main-color;\r\n              border-radius: 4rpx;\r\n              color: #FFFFFF;\r\n              font-size: $font-size-sm - 6rpx;\r\n              text-align: center;\r\n              line-height: 30rpx;\r\n              margin-left: 10rpx;\r\n              overflow: hidden;\r\n              vertical-align: middle;\r\n            }\r\n          }\r\n\r\n          .left_des {\r\n            flex: 1;\r\n            font-size: $font-size-sm - 2rpx;\r\n            color: $main-color;\r\n            padding-top: 10rpx;\r\n          }\r\n        }\r\n\r\n        .right {\r\n          height: 34rpx;\r\n          font-size: $font-size-sm;\r\n          color: $font-color1;\r\n\r\n          text {\r\n            margin-right: 10rpx;\r\n          }\r\n\r\n          /* #ifdef H5*/\r\n          /deep/.uni-radio-input {\r\n            width: 34rpx;\r\n            height: 34rpx;\r\n            margin-right: 0;\r\n          }\r\n\r\n          /* #endif*/\r\n        }\r\n      }\r\n\r\n      .service2,\r\n      .service3 {\r\n        .right {\r\n          font-size: $font-size-sm;\r\n          color: #cccccc;\r\n        }\r\n      }\r\n      .service3{\r\n        .right{\r\n          color: $font-color1;\r\n        }\r\n      }\r\n      .service2{\r\n        min-height: 46rpx;\r\n\r\n        .left{\r\n          position: relative;\r\n          text:nth-child(2){\r\n            width: 30rpx;\r\n            height: 30rpx;\r\n            background: $main-color;\r\n            border-radius: 4rpx;\r\n            font-size: $font-size-sm - 4rpx;\r\n            color: #ffffff;\r\n            text-align: center;\r\n            line-height: 30rpx;\r\n            position: absolute;\r\n            left: 82rpx;\r\n          }\r\n        }\r\n\r\n        .right{\r\n          .discount{\r\n            min-width: 254rpx;\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: center;\r\n            text-align: center;\r\n\r\n            view {\r\n              min-width: 214rpx;\r\n              height: 46rpx;\r\n              border: 2rpx solid $main-color;\r\n              border-radius: 23px;\r\n              font-size: $font-size-sm - 4rpx;\r\n              color: $main-color;\r\n              line-height: 42rpx;\r\n              text-align: center;\r\n              box-sizing: border-box;\r\n              margin-right: 10rpx;\r\n            }\r\n\r\n            image{\r\n              width: 34rpx;\r\n              height: 34rpx;\r\n              vertical-align: middle;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    .count_amount {\r\n      width: 100%;\r\n      text-align: right;\r\n      height: 33rpx;\r\n      font-size: $font-size-sm;\r\n      color: $font-color1;\r\n\r\n      text:nth-child(2) {\r\n        font-size: $font-size-lg + 2rpx;\r\n        font-weight: $font-weight-lg;\r\n        vertical-align: middle;\r\n      }\r\n    }\r\n  }\r\n\r\n  .payment_method {\r\n    width: 100%;\r\n    height: 93rpx;\r\n    background: #FFFFFF;\r\n    font-size: $font-size-sm;\r\n    color: $font-color1;\r\n    padding: 0 $spacing-base;\r\n    box-sizing: border-box;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n\r\n    &.one_self{\r\n      margin-top: $spacing-lg;\r\n    }\r\n\r\n    view {\r\n      display: flex;\r\n      align-items: center;\r\n\r\n      image {\r\n        width: 29rpx;\r\n        height: 25rpx;\r\n        vertical-align: middle;\r\n        margin-right: 10rpx;\r\n      }\r\n    }\r\n  }\r\n\r\n  .payment_foot {\r\n    width: 100%;\r\n    height: 97rpx;\r\n    background: #ffffff;\r\n    border-top: 1rpx solid #cccccc;\r\n    display: flex;\r\n    justify-content: flex-end;\r\n    box-sizing: border-box;\r\n    position: fixed;\r\n    bottom: 0;\r\n\r\n    .payment_amount {\r\n      font-size: $font-size-sm;\r\n      color: $font-color1;\r\n      line-height: 97rpx;\r\n      margin-right: $spacing-lg;\r\n      margin-left: 10rpx;\r\n\r\n      text:nth-child(2) {\r\n        font-size: $font-size-sm + 2rpx;\r\n        font-weight: $font-weight-lg;\r\n        color: $main-color;\r\n      }\r\n    }\r\n\r\n    button {\r\n      border: none;\r\n      width: 200rpx;\r\n      height: 97rpx;\r\n      background: $main-color;\r\n      font-size: $font-size-base;\r\n      color: #ffffff;\r\n      padding: 0;\r\n      line-height: 97rpx;\r\n      border-radius: 0;\r\n    }\r\n  }\r\n\r\n  .empty {\r\n    width: 100%;\r\n    height: 96rpx;\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/orderPayment/orderPayment.vue	(revision cf09c6e1e9ecb362fd78cb7b2a20d14af2da8e20)
+++ pages/orderPayment/orderPayment.vue	(date 1603176327898)
@@ -212,12 +212,13 @@
       return (current_order / current_cups) * 100;
     }
   },
+
   async onLoad() {
-    console.log(APP.goodsPayment);
-    this.goodsData = APP.goodsPayment;
-    this.receivingMethod = this.goodsData.haul_method;
-    this.goods_data = [];
-    this.goodsId = ''
+    this.goodsData = APP.goodsPayment;//订单整体数据
+    this.receivingMethod = this.goodsData.haul_method;//订单的配送方式
+    this.goods_data = [];//订单单个商品的信息，创建订单时传递给后台的数据
+    this.goodsId = ''//订单的单个商品的id,用户获取当前订单可使用的优惠券
+
     //獲取訂單傳參數據
     this.goodsData.goods_data.forEach((item, index) => {
       this.goodsId += item.id;
@@ -228,12 +229,19 @@
       })
     });
 
+    //订单总金额
     this.totalAmount = parseFloat(this.goodsData.payment_info)
 
-    try {
-      //獲取附加服務信息
+    //獲取附加服務信息
+    try{
       this.attach = (await paymentAttach()).data
-      //獲取可使用的優惠券信息
+    }catch (e) {
+      console.log(e);
+      this.attach = {}
+    }
+
+    //獲取可使用的優惠券信息
+    try {
       let temp = (await usedCoupon({
         vehicle_method: this.goodsDatahaul_method,
         goods_id: this.goodsId,
@@ -247,12 +255,17 @@
       }
     } catch (e) {
       console.log(e);
+      this.couponInfo = [];
     }
   },
   onShow() {
     //页面展示时从全局对象中获取优惠券的金额
-    if (!APP.coupon.goods_quota) return;
-    this.discountAmount = APP.coupon.goods_quota;
+    if(APP.coupon.goods_quota){
+      this.discountAmount = APP.coupon.goods_quota;
+    }else{
+      this.discountAmount = 0;
+      this.couponInfo = []
+    }
   },
   onUnload() {
     //页面卸载时清空优惠券金额
@@ -273,8 +286,6 @@
     // },
     //自動輸入手機號
     autoFill() {
-      console.log(APP.userInfo)
-      console.log(this.goodsData.contact_phone);
       this.userPhone = this.goodsData.contact_phone;
     },
 
@@ -285,9 +296,7 @@
     },
     //跳轉至優惠券
     navDiscount() {
-      APP.couponInfo = this.couponInfo;
       if (!this.couponInfo.length) return;
-      console.log(APP.couponInfo);
       uni.navigateTo({
         url: '/pages/discount/discount?couponInfo=' + encodeURIComponent(JSON.stringify(this.couponInfo))
       })
@@ -354,28 +363,34 @@
           }
         }
       }
-      //创建订单并支付
-      try {
-        let orderNum = (await createOrder(paramsObj)).data.order_num;
-        let orderInfo = (await paymentStart({order_num: orderNum, shop_id: paramsObj.shop_id})).data
-        // TODO 延迟请求微信支付，非最终方案
-        self.paymentTimer && clearTimeout(self.paymentTimer)
-        //发起微信支付
-        try{
-          self.paymentTimer = setTimeout(async()=>{
-            await self.utilPayment(orderInfo)
-            await self.paymentSuccess();
-          },3000)
-        }catch (e) {
-          self.customToast('结算失败')
-          console.log(e);
-        }
-      } catch (e) {
-        self.customToast('结算失败')
-        console.log(e);
-      }
+      //创建订单
+      // try {
+      //    orderNum = (await createOrder(paramsObj)).data.order_num;
+      //    orderInfo = (await paymentStart({order_num: orderNum, shop_id: paramsObj.shop_id})).data
+      // } catch (e) {
+      //   self.customToast('订单创建失败')
+      //   console.log(e);
+      //   return;
+      // }
+      //支付订单
+      // TODO 延迟请求微信支付，非最终方案
+      self.paymentTimer && clearTimeout(self.paymentTimer)
+      //发起微信支付
+      self.paymentTimer = setTimeout(async () => {
+        console.log(2);
+        try {
+          let orderNum = (await createOrder(paramsObj)).data.order_num;
+          let orderInfo = (await paymentStart({order_num: orderNum, shop_id: paramsObj.shop_id})).data
+          await self.utilPayment(orderInfo)
+          await self.paymentSuccess();
+        } catch (e) {
+          self.customToast('订单创建失败')
+          console.log(e);
+        }
+      }, 3000)
     },
-   async paymentSuccess(){
+    //订单结算成功，跳转至订单页
+    async paymentSuccess(){
       this.customToast('结算成功');
       uni.switchTab({
         url:'/pages/orderForm/orderForm',
Index: pages/login/login.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"login\">\r\n    <view class=\"login_head\">\r\n      <image src=\"../../static/images_t/orderForm/login_box.png\"></image>\r\n    </view>\r\n    <view class=\"login_tip\">\r\n      <text>您的手機號</text>\r\n      <text>未註冊的手機驗證碼將自動創建XX賬戶</text>\r\n    </view>\r\n    <view class=\"login_input\">\r\n      <picker class=\"area_code_select\"\r\n              :range=\"areaCode\"\r\n              @change=\"changeAreaCode\"\r\n              :value=\"cAreaCode\">\r\n        <text>+{{ areaCode[cAreaCode] }}</text>\r\n        <uni-icons class=\"arrow_down\"\r\n                   type=\"arrowdown\"\r\n                   size=\"30\"\r\n                   color=\"#666666\">\r\n        </uni-icons>\r\n      </picker>\r\n      <input class=\"phone_input\"\r\n             v-model=\"phone\"\r\n             type=\"number\"\r\n             placeholder=\"請輸入手機號\"/>\r\n    </view>\r\n    <view class=\"login_submit\" @click=\"loginStart\">\r\n      <button plain\r\n              :class=\"[phone.length===11?'phone_success':'']\"\r\n              hover-class=\"none\">\r\n        <uni-icons\r\n            class=\"submit\"\r\n            type=\"arrowright\"\r\n            size=\"50\"\r\n            color=\"#ffffff\">\r\n        </uni-icons>\r\n      </button>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport {sendCheckCode,login} from \"../../request/api\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      phone: '',\r\n      cAreaCode: 0,\r\n      areaCode: ['853', '86', '82', '84', '850', '852', '855', '856', '81', '880', '886'],\r\n      from:'',\r\n    }\r\n  },\r\n  onLoad(options){\r\n    options.from && (this.from = options.from)\r\n  },\r\n  methods: {\r\n    async loginStart() {\r\n      try {\r\n        //手机号错误的处理\r\n        if (this.phone.length !== 11) {\r\n          this.customToast('手機號錯誤',false)\r\n          return\r\n        }\r\n\r\n        uni.showLoading({\r\n          title: '正在發送驗證碼',\r\n          mask: true,\r\n        })\r\n        //發送驗證碼\r\n        let code = await sendCheckCode({\r\n          mobile: this.phone\r\n        })\r\n        uni.hideLoading()\r\n        /*手机号正确，跳转至验证码接收頁*/\r\n        uni.navigateTo({\r\n          url: '/pages/checkCode/checkCode?phone=' + this.phone + '&from = ' + this.from\r\n        })\r\n      } catch (e) {\r\n\t\t\t\tconsole.log(e)\r\n        //驗證碼發送失敗\r\n        this.customToast('驗證碼發送失敗')\r\n      }\r\n    },\r\n    changeAreaCode(e) {\r\n      this.cAreaCode = e.detail.value;\r\n    },\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.login {\r\n  width: 100vw;\r\n  background-color: #FFFFFF;\r\n  box-sizing: border-box;\r\n  padding: 0 $spacing-base;\r\n\r\n  .login_head {\r\n    width: 100%;\r\n    height: 170rpx;\r\n    padding-top: 50rpx;\r\n\r\n    image {\r\n      width: 150rpx;\r\n      margin: 0 auto;\r\n    }\r\n  }\r\n\r\n  .login_tip {\r\n    width: 100%;\r\n    height: 150rpx;\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-between;\r\n    padding-top: 50rpx;\r\n    margin-bottom: 103rpx;\r\n\r\n    text:nth-child(1) {\r\n      font-size: $font-size-lg + 2rpx;\r\n      font-weight: $font-weight-lg;\r\n      color: $font-color1;\r\n    }\r\n\r\n    text:nth-child(2) {\r\n      font-size: $font-size-sm;\r\n      color: $font-color3;\r\n    }\r\n  }\r\n\r\n  .login_input {\r\n    width: 100%;\r\n    height: 66rpx;\r\n    border-bottom: 1rpx solid #cccccc;\r\n    padding-bottom: 20rpx;\r\n    box-sizing: border-box;\r\n    display: flex;\r\n    justify-content: space-between;\r\n\r\n    .area_code_select {\r\n      width: 117rpx;\r\n\r\n      text {\r\n        font-size: $font-size-lg;\r\n        color: $font-color1;\r\n      }\r\n\r\n      .arrow_down {\r\n        display: inline-block;\r\n      }\r\n    }\r\n\r\n    .phone_input {\r\n      height: 30rpx;\r\n      flex: 1;\r\n      padding-left: 20rpx;\r\n      box-sizing: border-box;\r\n      font-size: $font-size-base;\r\n      color: $font-color3;\r\n      position: relative;\r\n\r\n      &:after {\r\n        width: 1rpx;\r\n        height: 30rpx;\r\n        content: '';\r\n        position: absolute;\r\n        left: 0;\r\n        top: 50%;\r\n        margin-top: -15rpx;\r\n        background-color: #707070;\r\n      }\r\n    }\r\n  }\r\n\r\n  .login_submit{\r\n    width: 156rpx;\r\n    height: 96rpx;\r\n    background-color: #E9E9E9;\r\n    border-radius: 100rpx;\r\n    //margin-top: 150rpx;\r\n    overflow: hidden;\r\n    float: right;\r\n\r\n    button{\r\n      width: 100%;\r\n      height: 100%;\r\n      border: none;\r\n      padding: 0;\r\n      text-align: center;\r\n      line-height: 96rpx;\r\n\r\n      .submit{\r\n        display: inline;\r\n        height: 100%;\r\n        text-align: center;\r\n\r\n        /deep/.uni-icons{\r\n          display: inline;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  .phone_success{\r\n    background:$main-color\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/login/login.vue	(revision cf09c6e1e9ecb362fd78cb7b2a20d14af2da8e20)
+++ pages/login/login.vue	(date 1603191243952)
@@ -52,23 +52,29 @@
     }
   },
   onLoad(options){
+    console.log(options.from);
     options.from && (this.from = options.from)
   },
   methods: {
     async loginStart() {
-      try {
-        //手机号错误的处理
-        if (this.phone.length !== 11) {
-          this.customToast('手機號錯誤',false)
-          return
-        }
+      // uni.navigateTo({
+      //   url: '/pages/checkCode/checkCode?phone=' + this.phone + '&from = ' + this.from
+      // })
+      // return
+
+      //手机号错误的处理
+      if (this.phone.length !== 11) {
+        this.customToast('手機號錯誤',false)
+        return
+      }
 
+      try {
         uni.showLoading({
           title: '正在發送驗證碼',
           mask: true,
         })
         //發送驗證碼
-        let code = await sendCheckCode({
+       await sendCheckCode({
           mobile: this.phone
         })
         uni.hideLoading()
@@ -177,7 +183,7 @@
     height: 96rpx;
     background-color: #E9E9E9;
     border-radius: 100rpx;
-    //margin-top: 150rpx;
+    margin-top: 150rpx;
     overflow: hidden;
     float: right;
 
Index: pages/wallet/wallet.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view v-if=\"reRender\" class=\"wallet\">\r\n    <view class=\"container\">\r\n      <view class=\"head\">\r\n        <text class=\"balance\">可用余額</text>\r\n        <view>\r\n          <text class=\"symbol\">￥</text>\r\n          <text class=\"amount\">{{ amount || '0' }}</text>\r\n        </view>\r\n        <text @click=\"rechargeBox = true\" class=\"btn\">立即充值</text>\r\n      </view>\r\n      <view class=\"options\">\r\n        <optionsList @options-click=\"navRecharge\" :list=\"options\"></optionsList>\r\n      </view>\r\n    </view>\r\n\r\n    <view v-if=\"rechargeBox\" class=\"recharge\">\r\n      <view class=\"content\">\r\n        <view class=\"title\">整數充值</view>\r\n        <input v-model=\"rechargeAmount\"\r\n               type=\"text\"\r\n               placeholder=\"請輸入充值金額\">\r\n        <view class=\"btn\">\r\n          <button plain @click=\"rechargeBox = false\">取消</button>\r\n          <button plain @click=\"rechargeStart\">充值</button>\r\n        </view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport optionsList from \"../../components-lk/optionsList/optionsList\";\r\nimport {recharge, sendCheckCode, userSpace} from '../../request/api'\r\n\r\nconst APP = getApp().globalData;\r\nexport default {\r\n  data() {\r\n    return {\r\n      amount: '0.00',\r\n      options: [{\r\n        title: '掃碼支付',\r\n        summary: '可使用錢包直接支付',\r\n        icon: 'arrowright'\r\n      }, {\r\n        title: '消費記錄',\r\n        icon: 'arrowright'\r\n      }, {\r\n        title: '重置交易密碼',\r\n        icon: 'arrowright'\r\n      },],\r\n      rechargePwd: false,\r\n      phone: '',\r\n      rechargeBox: false,\r\n      rechargeAmount: '',\r\n      reRender: 1,//用戶充值後強制刷新頁面的條件\r\n    }\r\n  },\r\n  onShow() {\r\n    this.amount = APP.userInfo.balance;\r\n  },\r\n  mounted() {\r\n    this.amount = APP.userInfo.balance\r\n    this.originPhone = APP.userInfo.mobile;\r\n    //处理手机号展示形式\r\n    this.phone = this.originPhone.replace(/\\d/g, function (value, index) {\r\n      if (index >= 3 && index <= 7) {\r\n        return 'x'\r\n      } else {\r\n        return value\r\n      }\r\n    })\r\n  },\r\n  methods: {\r\n    //导航到对应的页面\r\n    async navRecharge(v) {\r\n      let {page} = v;\r\n      switch (page) {\r\n        case '消費記錄':\r\n          page = 'expensesRecord';\r\n          break;\r\n        case '掃碼支付':\r\n          page = 'memberCode';\r\n          break;\r\n        case '重置交易密碼':\r\n          await this.changePayPwd()\r\n      }\r\n      uni.navigateTo({\r\n        url: `/pages/${page}/${page}`\r\n      })\r\n    },\r\n    //修改支付密码\r\n    changePayPwd() {\r\n      let self = this;\r\n      uni.showModal({\r\n        title: '重置交易密碼',\r\n        content: '短信驗證碼將發送已綁定手機\\n' + this.phone,\r\n        async success(o) {\r\n          try {\r\n            //點擊確定進入重置密碼頁面\r\n            if (o.confirm) {\r\n              uni.showLoading({\r\n                title: '正在發送驗證碼'\r\n              })\r\n              //发送验证码\r\n              let result = await sendCheckCode({mobile: self.originPhone})\r\n              uni.navigateTo({\r\n                url: '/pages/checkCode/checkCode?change=1',\r\n                success() {\r\n                  uni.hideLoading()\r\n                }\r\n              })\r\n            }\r\n          } catch (e) {\r\n            console.log(e);\r\n            this.customToast('驗證碼發送失敗')\r\n          }\r\n        }\r\n      })\r\n    },\r\n\r\n    //支付功能\r\n    async rechargeStart() {\r\n      let self = this;\r\n      if (Number(this.rechargeAmount)) {\r\n        this.rechargeBox = false;\r\n        try {\r\n          //获取支付信息\r\n          let orderInfo = (await recharge({\r\n            amount: this.rechargeAmount\r\n          })).data;\r\n\r\n          //开始支付\r\n          await self.utilPayment(orderInfo);\r\n          await self.paymentSuccess()\r\n\r\n        } catch (e) {\r\n          console.log(e);\r\n          this.customToast('充值错误')\r\n        }\r\n      }\r\n    },\r\n    //支付成功\r\n   async paymentSuccess(e){\r\n     try{\r\n       console.log(e);\r\n       this.customToast('充值成功');\r\n       this.rechargeAmount = '';\r\n       APP.userInfo = (await userSpace()).data\r\n       this.amount = APP.userInfo.balance;\r\n       console.log(APP.userInfo);\r\n       console.log(this.amount);\r\n     }catch (e) {\r\n       console.log(e);\r\n     }\r\n   },\r\n    //支付失败\r\n    paymentError(e){\r\n      console.log(e);\r\n      this.customToast('充值失败');\r\n      this.rechargeAmount = '';\r\n    }\r\n  },\r\n  //監視充值價格，為整數\r\n  // watch: {\r\n  //   rechargeAmount(n, o) {\r\n  //     let newStr = n.slice(o.length),\r\n  //         newNum = parseInt(newStr)\r\n  //     if (isNaN(newNum)) {\r\n  //       this.rechargeAmount = '';\r\n  //     }\r\n  //   },\r\n  // },\r\n  components: {\r\n    optionsList\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n.wallet {\r\n  width: 100%;\r\n  height: 100%;\r\n  padding-top: 100rpx;\r\n  box-sizing: border-box;\r\n\r\n  .container{\r\n    width: 100%;\r\n    padding: 0 24rpx;\r\n    box-sizing: border-box;\r\n\r\n    .head{\r\n      width: 100%;\r\n      height: 174rpx;\r\n      display: flex;\r\n      flex-direction: column;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n      margin-bottom: 154rpx;\r\n\r\n      .balance{\r\n        font-size: $font-size-lg;\r\n        font-weight: $font-weight-lg;\r\n        color: $font-color1;\r\n      }\r\n      .symbol{\r\n        font-size: $font-size-lg;\r\n        font-weight: $font-weight-lg;\r\n        color: $font-color1;\r\n      }\r\n      .amount{\r\n        font-size: 60rpx;\r\n        font-weight: $font-weight-lg;\r\n        color: $font-color1;\r\n      }\r\n      .btn{\r\n        display: inline-block;\r\n        width: 320rpx;\r\n        height: 80rpx;\r\n        background: $main-color;\r\n        font-size: $font-size-base;\r\n        color: #ffffff;\r\n        text-align: center;\r\n        line-height: 80rpx;\r\n      }\r\n    }\r\n\r\n    .options {\r\n      width: 100%;\r\n      height: 360rpx;\r\n    }\r\n  }\r\n  .recharge{\r\n    width: 100vw;\r\n    height: 100vh;\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    background-color: rgba(0,0,0,.6);\r\n    z-index: 1000000;\r\n\r\n    .content{\r\n      width: 480rpx;\r\n      height: 330rpx;\r\n      background: #ffffff;\r\n      border-radius: 20rpx;\r\n      position: absolute;\r\n      left: 50%;\r\n      margin-left: - 240rpx;\r\n      top:50%;\r\n      margin-top:-330rpx;\r\n      text-align: center;\r\n\r\n      .title{\r\n        font-size: $font-weight-base;\r\n        font-weight:$font-weight-lg;\r\n        color: $font-color1;\r\n        margin-top: 50rpx;\r\n      }\r\n\r\n      .btn{\r\n        width: 100%;\r\n        display: flex;\r\n        justify-content: space-around;\r\n        align-items: center;\r\n        position: absolute;\r\n        bottom: 48rpx;\r\n\r\n        button{\r\n          border:none;\r\n          width: 150rpx;\r\n          height: 58rpx;\r\n          background: $main-color;\r\n          border-radius: 4rpx;\r\n          font-size: $font-size-sm;\r\n          color: #ffffff;\r\n          padding: 0;\r\n        }\r\n      }\r\n\r\n      input{\r\n        width: 330rpx;\r\n        height: 54rpx;\r\n        border: 1rpx solid #cccccc;\r\n        border-radius: 8rpx;\r\n        position: absolute;\r\n        left: 50%;\r\n        top: 120rpx;\r\n        transform: translate(-50%,0);\r\n        padding: 0 10rpx;\r\n        box-sizing: border-box;\r\n        text-align: left;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/wallet/wallet.vue	(revision cf09c6e1e9ecb362fd78cb7b2a20d14af2da8e20)
+++ pages/wallet/wallet.vue	(date 1603191686442)
@@ -113,7 +113,7 @@
             }
           } catch (e) {
             console.log(e);
-            this.customToast('驗證碼發送失敗')
+            self.customToast('驗證碼發送失敗')
           }
         }
       })
Index: pages/my/my.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"profile\">\r\n    <!-- 头部背景 -->\r\n    <view class=\"profile_head\">\r\n      <view class=\"head_bg\">\r\n        <image mode=\"widthFix\" src=\"../../static/images_t/my/head_bg.png\"></image>\r\n      </view>\r\n      <view class=\"head_logo\">\r\n        <text>英国城</text>\r\n      </view>\r\n    </view>\r\n    <view class=\"profile_content\">\r\n      <!-- 用户相关信息 -->\r\n      <view class=\"profile_info\">\r\n        <userInfo @handler-click=\"navFitPage\" :user=\"userInfo \"></userInfo>\r\n      </view>\r\n      <!-- 开通礼包 -->\r\n      <view @click=\"navFitPage({page:'joinMember'})\" class=\"open_package\">\r\n        <giftPack></giftPack>\r\n      </view>\r\n\r\n      <!-- 功能列表 -->\r\n      <view class=\"fun_list\">\r\n        <optionsList @options-click=\"navFitPage\" :list=\"options\"></optionsList>\r\n      </view>\r\n    </view>\r\n\r\n    <!--兌換中心-->\r\n    <view></view>\r\n\r\n    <!-- #ifdef H5-->\r\n    <view class=\"empty\"></view>\r\n    <!-- #endif-->\r\n    <loginBox v-if=\"!loginBoxShow\" @close-login-box=\"loginBoxShow = true\"></loginBox>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  userSpace\r\n} from '../../request/api'\r\n\r\nimport userInfo from \"./components/userInfo\";\r\nimport giftPack from \"./components/giftPack\";\r\nimport optionsList from \"../../components-lk/optionsList/optionsList\";\r\nimport loginBox from \"../../components-lk/loginBox/loginBox\";\r\n\r\nconst APP = getApp().globalData;\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      userInfo: {},\r\n      options: [\r\n          {\r\n        title: '會員碼',\r\n        summary: '門店掃碼積分、奶茶錢包和奶茶有禮支付',\r\n        icon: 'arrowright'\r\n      }, {\r\n        title: '兌換中心',\r\n        summary: '兌換星球會員、優惠券和禮品卡',\r\n        icon: 'arrowright'\r\n      },\r\n      //   {\r\n      //   title: '星球封面',\r\n      //   icon: 'arrowright'\r\n      // },\r\n        {\r\n        title: '聯系客服',\r\n        icon: 'arrowright'\r\n      }, {\r\n        title: '消息中心',\r\n        icon: 'arrowright'\r\n      }, {\r\n        title: '更多',\r\n        icon: 'arrowright'\r\n      }],\r\n      loginBoxShow:false,//false為展示，\r\n    }\r\n  },\r\n  //获取用户信息\r\n  // async mounted() {\r\n  //   this.token = APP.userToken;\r\n  //   this.userInfo = APP.userInfo;\r\n  //   await this.getUserInfo()\r\n  // },\r\n\r\n  /**\r\n   * 页面展示时判断的情况\r\n   * 有 token 没有用户信息，请求接口获取用户信息\r\n   * token没有引导用户登录\r\n   */\r\n  async onShow() {\r\n    this.token = APP.userToken;\r\n    this.userInfo = APP.userInfo;\r\n    if (this.token && this.userInfo.level) return;\r\n    if(!this.token){\r\n      this.loginBoxShow = false;\r\n    }else{\r\n      await this.getUserInfo()\r\n    }\r\n    this.loginBoxShow = !!this.token;\r\n    if(!this.loginBoxShow) return;\r\n    !this.userInfo.level && await this.getUserInfo()\r\n  },\r\n  methods: {\r\n    //请求用户信息\r\n   async getUserInfo(){\r\n     uni.showLoading({\r\n       title:'請稍後'\r\n     })\r\n     this.loginBoxShow = this.token = APP.userToken\r\n     this.userInfo = APP.userInfo;\r\n     try{\r\n       //token存在静默登录\r\n       if (this.token || !this.userInfo.level) {\r\n         console.log(123);\r\n         this.userInfo = (await userSpace()).data;\r\n         APP.userInfo = this.userInfo;\r\n         this.loginBoxShow = true;\r\n       }\r\n       uni.hideLoading()\r\n     }catch (e){\r\n       this.loginBoxShow = false;\r\n       this.customToast('需要登錄',false)\r\n     }\r\n    },\r\n    //跳转至對應的頁面\r\n    navFitPage(aims) {\r\n      //用户没有登录不做处理\r\n      if (!this.token) {\r\n        this.customToast('請先登錄',false)\r\n        return\r\n      }\r\n      let {page, v} = aims;\r\n      switch (page) {\r\n        case 'pointsMall':\r\n          this.query = 'integral';\r\n          break;\r\n        case 'wallet':\r\n          this.query = 'wallet';\r\n          break;\r\n        case '會員碼':\r\n          // TODO 非頁面\r\n            page = 'memberCode';\r\n            this.query = 'user';\r\n            APP.userInfo = this.userInfo\r\n          break;\r\n        case '兌換中心':\r\n          // TODO 非頁面\r\n          this.query = 'integral';\r\n          page = 'pointsMall'\r\n          v = this.userInfo.integral\r\n          break;\r\n          // case '星球封面':\r\n          //   page = 'planetCover';\r\n        //   break;\r\n        case '聯系客服':\r\n          page = 'customerService';\r\n          break;\r\n        case '消息中心':\r\n          page = 'messageCenter';\r\n          break;\r\n        case '更多':\r\n          page = 'more';\r\n          break;\r\n      }\r\n      //跳转至钱包页面，没有支付密码时跳转设置密码页面\r\n      if (page === 'wallet') {\r\n        console.log(APP.userInfo.pay_pwd);\r\n        if (!(APP.userInfo.pay_pwd)) {\r\n          uni.navigateTo({\r\n            url: '/pages/setPassword/setPassword'\r\n          })\r\n          return;\r\n        }\r\n      }\r\n      //用户已经开通会员时跳转会员权益\r\n      if(page === 'joinMember' && this.userInfo.level_title !=='普通会员'){\r\n        uni.navigateTo({\r\n          url:'/pages/memberBenefits/memberBenefits'\r\n        })\r\n        return;\r\n      }\r\n      //通用的链接跳转\r\n      uni.navigateTo({\r\n        url: `/pages/${page}/${page}?${this.query}=${v}`,\r\n        complete(e){\r\n          console.log(e);\r\n        }\r\n      })\r\n    }\r\n  },\r\n  components: {\r\n    userInfo,\r\n    giftPack,\r\n    optionsList,\r\n    loginBox\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n@mixin container($h) {\r\n  width: 100%;\r\n  height: $h;\r\n  background: #ffffff;\r\n  border-radius: 30rpx;\r\n  margin-bottom: 30rpx;\r\n}\r\n\r\nuni-page-body {\r\n  height: 100%;\r\n}\r\n\r\n.profile {\r\n  width: 100%;\r\n  padding-bottom: $spacing-lg;\r\n  background-color: $main-bg;\r\n\r\n  .profile_head {\r\n    width: 100%;\r\n    height: 550rpx;\r\n    text-align: center;\r\n    background: #FFFFFF;\r\n\r\n    .head_bg {\r\n      width: 100%;\r\n      height: 450rpx;\r\n      position: relative;\r\n\r\n      image {\r\n        width: 100%;\r\n        height: 450rpx;\r\n        vertical-align: middle;\r\n      }\r\n    }\r\n\r\n    .head_logo {\r\n      width: 100%;\r\n      text-align: center;\r\n      position: absolute;\r\n      top: 60rpx;\r\n\r\n      text {\r\n        font-size: $font-size-lg + 2rpx;\r\n        font-weight: $font-weight-lg;\r\n        color: $font-color1;\r\n      }\r\n    }\r\n  }\r\n\r\n  .profile_content {\r\n    width: 100%;\r\n    padding: 0 $spacing-base;\r\n    box-sizing: border-box;\r\n    position: relative;\r\n\r\n    .profile_info {\r\n      @include container(390rpx - $spacing-lg);\r\n      border-radius: 0 0 30rpx 30rpx;\r\n    }\r\n\r\n    .open_package {\r\n      @include container(380rpx)\r\n    }\r\n\r\n    .fun_list {\r\n      @include container(500rpx);\r\n      margin-bottom: 0;\r\n      padding: 0 $spacing-lg;\r\n      box-sizing: border-box;\r\n    }\r\n  }\r\n  .empty {\r\n    width: 100%;\r\n    height: 100rpx;\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/my/my.vue	(revision cf09c6e1e9ecb362fd78cb7b2a20d14af2da8e20)
+++ pages/my/my.vue	(date 1603187221987)
@@ -31,7 +31,7 @@
     <!-- #ifdef H5-->
     <view class="empty"></view>
     <!-- #endif-->
-    <loginBox v-if="!loginBoxShow" @close-login-box="loginBoxShow = true"></loginBox>
+    <loginBox v-if="loginBoxShow" @close-login-box="hideLoginBox"></loginBox>
   </view>
 </template>
 
@@ -75,7 +75,7 @@
         title: '更多',
         icon: 'arrowright'
       }],
-      loginBoxShow:false,//false為展示，
+      loginBoxShow:false,
     }
   },
   //获取用户信息
@@ -91,17 +91,26 @@
    * token没有引导用户登录
    */
   async onShow() {
-    this.token = APP.userToken;
-    this.userInfo = APP.userInfo;
-    if (this.token && this.userInfo.level) return;
-    if(!this.token){
-      this.loginBoxShow = false;
-    }else{
-      await this.getUserInfo()
+    if (APP.userToken) {
+      APP.isLoginBox = false
+      this.token = APP.userToken;
+      if (APP.userInfo&&APP.userInfo.level) {
+        this.userInfo = APP.userInfo;
+      } else {
+        try {
+          await this.getUserInfo()
+        } catch (e) {
+          console.log(e);
+          this.customToast('信息获取失败')
+        }
+      }
+    }else{
+      APP.isLoginBox = true;
     }
-    this.loginBoxShow = !!this.token;
-    if(!this.loginBoxShow) return;
-    !this.userInfo.level && await this.getUserInfo()
+    this.loginBoxShow = APP.isLoginBox
+    // this.loginBoxShow = !!this.token;
+    // if(!this.loginBoxShow) return;
+    // !this.userInfo.level && await this.getUserInfo()
   },
   methods: {
     //请求用户信息
@@ -109,26 +118,25 @@
      uni.showLoading({
        title:'請稍後'
      })
-     this.loginBoxShow = this.token = APP.userToken
-     this.userInfo = APP.userInfo;
      try{
        //token存在静默登录
-       if (this.token || !this.userInfo.level) {
-         console.log(123);
+       if (this.token) {
          this.userInfo = (await userSpace()).data;
          APP.userInfo = this.userInfo;
-         this.loginBoxShow = true;
        }
        uni.hideLoading()
      }catch (e){
-       this.loginBoxShow = false;
        this.customToast('需要登錄',false)
      }
     },
+    //隐藏登陆引导框
+    hideLoginBox(){
+     this.loginBoxShow = APP.isLoginBox = false;
+    },
     //跳转至對應的頁面
     navFitPage(aims) {
       //用户没有登录不做处理
-      if (!this.token) {
+      if (!this.token || !this.userInfo.user_name) {
         this.customToast('請先登錄',false)
         return
       }
@@ -167,7 +175,6 @@
       }
       //跳转至钱包页面，没有支付密码时跳转设置密码页面
       if (page === 'wallet') {
-        console.log(APP.userInfo.pay_pwd);
         if (!(APP.userInfo.pay_pwd)) {
           uni.navigateTo({
             url: '/pages/setPassword/setPassword'
@@ -175,6 +182,7 @@
           return;
         }
       }
+
       //用户已经开通会员时跳转会员权益
       if(page === 'joinMember' && this.userInfo.level_title !=='普通会员'){
         uni.navigateTo({
@@ -182,12 +190,10 @@
         })
         return;
       }
+
       //通用的链接跳转
       uni.navigateTo({
         url: `/pages/${page}/${page}?${this.query}=${v}`,
-        complete(e){
-          console.log(e);
-        }
       })
     }
   },
Index: App.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><script>\r\nexport default {\r\n  globalData: {\r\n    goodsPayment: {},//訂單信息，訂單頁修改，結算頁獲取\r\n    coupon: 0,//使用的優惠券信息\r\n    userToken: null,//用戶token\r\n    userInfo:{},//用户基本信息\r\n    userAddresses: [],//用户收货地址\r\n    edit_address_id: {},//当前编辑的收货地址id\r\n    choosed_address: {},//用户选择的地址\r\n  },\r\n  onLaunch: function () {\r\n    // TODO 生產環境取消注釋L\r\n    this.globalData.userToken=uni.getStorageSync('token')\r\n    console.log('App Launch');\r\n  },\r\n  onShow: function () {\r\n    console.log('App Show');\r\n  },\r\n  onHide: function () {\r\n    console.log('App Hide');\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n/* 解决头条小程序组件内引入字体不生效的问题 */\r\n/* #ifdef MP-TOUTIAO */\r\n@font-face {\r\n  font-family: uniicons;\r\n  src: url('/static/uni.ttf');\r\n}\r\n\r\n/* #endif */\r\n.page {\r\n  position: absolute;\r\n  top: 0;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  display: flex;\r\n  flex-direction: column;\r\n  font-family: 'PingFang SC', 'Microsoft Yahei';\r\n}\r\n\r\n.container {\r\n  width: 702rpx;\r\n  height: 100%;\r\n  margin: 0 auto;\r\n  box-sizing: border-box;\r\n}\r\n\r\nimage {\r\n  width: 100%;\r\n  height: 100%;\r\n  display: block;\r\n}\r\n\r\n/* #ifdef APP-PLUS ||MP-WEIXIN */\r\n\r\npage {\r\n  height: 100%;\r\n}\r\n\r\ncheckbox .wx-checkbox-input {\r\n  width: 42rpx !important;\r\n  height: 42rpx !important;\r\n  border-radius: 50%;\r\n}\r\n\r\ncheckbox .wx-checkbox-input.wx-checkbox-input-checked {\r\n  width: 46rpx !important;\r\n  height: 46rpx !important;\r\n  border-radius: 50%;\r\n  background: #17A1FF;\r\n  color: #fff !important;\r\n  border: none;\r\n}\r\n\r\nradio .wx-radio-input {\r\n  width: 34rpx !important;\r\n  height: 34rpx !important;\r\n  padding: 0 !important;\r\n}\r\n\r\nprogress .wx-progress-bar {\r\n  height: 30rpx !important;\r\n  border-radius: 15rpx !important;\r\n}\r\n\r\nprogress .wx-progress-inner-bar {\r\n  border-radius: 15rpx !important;\r\n}\r\n\r\n/* #endif */\r\n.align-items-center {\r\n  align-items: center;\r\n}\r\n\r\n.d-flex {\r\n  display: flex;\r\n}\r\n\r\nuni-page-body, uni-view, uni-scroll-view, uni-text, uni-image, uni-textarea, uni-button, uni-swiper, uni-swiper-item, uni-input {\r\n  box-sizing: border-box;\r\n}\r\n\r\nbutton {\r\n  font-size: 26rpx;\r\n  border-radius: 4rpx;\r\n  margin: 0;\r\n\r\n  &:after {\r\n    border: 0;\r\n  }\r\n\r\n  &[type='primary'] {\r\n    background-color: $main-color;\r\n\r\n    &[plain] {\r\n      background-color: #FFFFFF;\r\n      border: 2rpx solid $main-color;;\r\n      color: $main-color;\r\n    }\r\n\r\n    &.button-hover {\r\n      background-color: rgba($color: $main-color, $alpha: 0.6);\r\n    }\r\n  }\r\n\r\n}\r\n</style>\r\n\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- App.vue	(revision cf09c6e1e9ecb362fd78cb7b2a20d14af2da8e20)
+++ App.vue	(date 1603175368059)
@@ -4,14 +4,15 @@
     goodsPayment: {},//訂單信息，訂單頁修改，結算頁獲取
     coupon: 0,//使用的優惠券信息
     userToken: null,//用戶token
-    userInfo:{},//用户基本信息
+    isLoginBox:true,
+    userInfo: {},//用户基本信息
     userAddresses: [],//用户收货地址
     edit_address_id: {},//当前编辑的收货地址id
     choosed_address: {},//用户选择的地址
   },
   onLaunch: function () {
     // TODO 生產環境取消注釋L
-    this.globalData.userToken=uni.getStorageSync('token')
+    this.globalData.userToken = uni.getStorageSync('token')
     console.log('App Launch');
   },
   onShow: function () {
@@ -44,7 +45,7 @@
 }
 
 .container {
-  width: 702rpx;
+  width: 702 rpx;
   height: 100%;
   margin: 0 auto;
   box-sizing: border-box;
@@ -63,14 +64,14 @@
 }
 
 checkbox .wx-checkbox-input {
-  width: 42rpx !important;
-  height: 42rpx !important;
+  width: 42 rpx !important;
+  height: 42 rpx !important;
   border-radius: 50%;
 }
 
 checkbox .wx-checkbox-input.wx-checkbox-input-checked {
-  width: 46rpx !important;
-  height: 46rpx !important;
+  width: 46 rpx !important;
+  height: 46 rpx !important;
   border-radius: 50%;
   background: #17A1FF;
   color: #fff !important;
@@ -78,18 +79,18 @@
 }
 
 radio .wx-radio-input {
-  width: 34rpx !important;
-  height: 34rpx !important;
+  width: 34 rpx !important;
+  height: 34 rpx !important;
   padding: 0 !important;
 }
 
 progress .wx-progress-bar {
-  height: 30rpx !important;
-  border-radius: 15rpx !important;
+  height: 30 rpx !important;
+  border-radius: 15 rpx !important;
 }
 
 progress .wx-progress-inner-bar {
-  border-radius: 15rpx !important;
+  border-radius: 15 rpx !important;
 }
 
 /* #endif */
@@ -106,8 +107,8 @@
 }
 
 button {
-  font-size: 26rpx;
-  border-radius: 4rpx;
+  font-size: 26 rpx;
+  border-radius: 4 rpx;
   margin: 0;
 
   &:after {
@@ -119,7 +120,7 @@
 
     &[plain] {
       background-color: #FFFFFF;
-      border: 2rpx solid $main-color;;
+      border: 2 rpx solid $main-color;;
       color: $main-color;
     }
 
Index: pages.json
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>{\r\n  \"pages\": [\r\n    {\r\n      \"path\": \"pages/home/home\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"英国城\",\r\n        \"navigationStyle\": \"custom\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/index/index\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"uni-ui基础项目\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/order/order\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"英国城\",\r\n        \"navigationStyle\": \"custom\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/userAdress/userAdress\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"收貨地址\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/addUserAdress/addUserAdress\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"添加地址\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/orderForm/orderForm\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"英国城\",\r\n        \"navigationStyle\": \"custom\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/my/my\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"英国城\",\r\n        \"navigationStyle\": \"custom\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/bulkInvoice/bulkInvoice\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"批量開票\",\r\n        \"navigationBarBackgroundColor\": \"#FFFFFF\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/wantTell/wantTell\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"\",\r\n        \"navigationBarBackgroundColor\": \"#FFFFFF\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/invoiceInfo/invoiceInfo\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"开票信息\",\r\n        \"navigationBarBackgroundColor\": \"#FFFFFF\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/orderPayment/orderPayment\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"订单结算\",\r\n        \"navigationBarBackgroundColor\": \"#FFFFFF\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/discount/discount\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"優惠券\",\r\n        \"navigationBarBackgroundColor\": \"#FFFFFF\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/pointsMall/pointsMall\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"積分商城\",\r\n        \"navigationBarBackgroundColor\": \"#FFFFFF\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/wallet/wallet\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"\",\r\n        \"navigationBarBackgroundColor\": \"#FFFFFF\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/customerService/customerService\",\r\n      \"style\": {\r\n        \"navigationStyle\": \"custom\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/login/login\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"登錄\",\r\n        \"navigationBarBackgroundColor\": \"#FFFFFF\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/checkCode/checkCode\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/joinMember/joinMember\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"開通星球會員\",\r\n        \"navigationBarBackgroundColor\": \"#FFFFFF\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/setPassword/setPassword\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/recharge/recharge\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/pointsDetails/pointsDetails\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"積分明細\",\r\n        \"navigationBarBackgroundColor\": \"#FFFFFF\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/exchangeRecord/exchangeRecord\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"兌換記錄\",\r\n        \"navigationBarBackgroundColor\": \"#FFFFFF\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/pintuan/pintuan\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"拼单\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/memberCode/memberCode\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/milkTeaGift/milkTeaGift\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"奶茶有禮\",\r\n        \"navigationBarBackgroundColor\": \"#FFFFFF\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/expensesRecord/expensesRecord\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"消費記錄\",\r\n        \"navigationBarBackgroundColor\": \"#FFFFFF\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/more/more\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"更多\",\r\n        \"navigationBarBackgroundColor\": \"#FFFFFF\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/profile/profile\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"個人資料\",\r\n        \"navigationBarBackgroundColor\": \"#FFFFFF\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/chooseShop/chooseShop\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"選擇門店\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/memberBenefits/memberBenefits\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"会员权益\",\r\n        \"navigationBarBackgroundColor\": \"#FFFFFF\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/pointsGoods/pointsGoods\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"禮品詳情\",\r\n        \"navigationBarBackgroundColor\": \"#FFFFFF\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/messageCenter/messageCenter\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"消息中心\",\r\n        \"navigationBarBackgroundColor\": \"#FFFFFF\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/foreseeDetails/foreseeDetails\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"奶茶禮品卡\",\r\n        \"navigationBarBackgroundColor\": \"#FFFFFF\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/buyHistory/buyHistory\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"購買歷史\",\r\n        \"navigationBarBackgroundColor\": \"#FFFFFF\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/mutualHistory/mutualHistory\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"收送歷史\",\r\n        \"navigationBarBackgroundColor\": \"#FFFFFF\"\r\n      }\r\n    },\r\n    {\r\n      \"path\": \"pages/rechargeRecord/rechargeRecord\",\r\n      \"style\": {\r\n        \"navigationBarTitleText\": \"購買記錄\",\r\n        \"navigationBarBackgroundColor\": \"#FFFFFF\"\r\n      }\r\n    }\r\n  ],\r\n  \"globalStyle\": {\r\n    \"navigationBarTextStyle\": \"black\",\r\n    \"navigationBarTitleText\": \"uni-app\",\r\n    \"navigationBarBackgroundColor\": \"#FFFFFF\",\r\n    \"backgroundColor\": \"#FFFFFF\"\r\n  },\r\n  \"tabBar\": {\r\n    \"color\": \"#C6C6C6\",\r\n    \"selectedColor\": \"#17A1FF\",\r\n    \"borderStyle\": \"white\",\r\n    \"backgroundColor\": \"#ffffff\",\r\n    \"list\": [\r\n      {\r\n        \"pagePath\": \"pages/home/home\",\r\n        \"iconPath\": \"static/icon/home.png\",\r\n        \"selectedIconPath\": \"static/icon/home_selected.png\",\r\n        \"text\": \"首頁\"\r\n      },\r\n      {\r\n        \"pagePath\": \"pages/order/order\",\r\n        \"iconPath\": \"static/icon/home.png\",\r\n        \"selectedIconPath\": \"static/icon/order_slected.png\",\r\n        \"text\": \"點單\"\r\n      },\r\n      {\r\n        \"pagePath\": \"pages/orderForm/orderForm\",\r\n        \"iconPath\": \"static/icon/orderForm.png\",\r\n        \"selectedIconPath\": \"static/icon/orderForm_selected.png\",\r\n        \"text\": \"訂單\"\r\n      },\r\n      {\r\n        \"pagePath\": \"pages/my/my\",\r\n        \"iconPath\": \"static/icon/my.png\",\r\n        \"selectedIconPath\": \"static/icon/my_selected.png\",\r\n        \"text\": \"我的\"\r\n      }\r\n    ]\r\n  }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages.json	(revision cf09c6e1e9ecb362fd78cb7b2a20d14af2da8e20)
+++ pages.json	(date 1603159188509)
@@ -247,7 +247,8 @@
     "navigationBarTextStyle": "black",
     "navigationBarTitleText": "uni-app",
     "navigationBarBackgroundColor": "#FFFFFF",
-    "backgroundColor": "#FFFFFF"
+    "backgroundColor": "#FFFFFF",
+    "onReachBottomDistance": 100
   },
   "tabBar": {
     "color": "#C6C6C6",
Index: components/myp-one/myp-one.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- components/myp-one/myp-one.vue	(date 1603190494221)
+++ components/myp-one/myp-one.vue	(date 1603190494221)
@@ -0,0 +1,222 @@
+<template>
+	<view class="code-box">
+		<view class="flex-box">
+			<input :value="inputValue"
+             :type="inputType"
+             :focus="autoFocus"
+             :maxlength="maxlength"
+             class="hide-input" @input="getVal" />
+			<block v-for="(item, index) in ranges" :key="index">
+				<view :class="['item', { active: codeIndex === item, middle: type === 'middle', bottom: type === 'bottom', box: type === 'box' }]">
+					<view class="line" v-if="type !== 'middle'"></view>
+					<view v-if="type === 'middle' && codeIndex <= item" class="bottom-line"></view>
+					<block v-if="isPwd && codeArr.length >= item">
+						<text class="dot">.</text>
+					</block>
+					<block v-else> {{ codeArr[index] ? codeArr[index] : ''}}</block>
+				</view>
+			</block>
+		</view>
+	</view>
+</template>
+
+<script>
+	// 支持使用 v-model
+	// 支持使用refs
+	export default {
+		name: 'mypOneInput',
+		props: {
+			// 支持外部提供，支持使用v-model
+			// 支持通过value来做清空
+      inputType:{
+        type:String,
+        default:'number'
+      },
+			value: {
+				type: String,
+				default: ''
+			},
+			//最大长度 4/6
+			maxlength: {
+				type: Number,
+				default: 4
+			},
+      //是否自动聚焦
+			autoFocus: {
+				type: Boolean,
+				default: true
+			},
+      //输入框的类型
+			isPwd: {
+				type: Boolean,
+				default: false
+			},
+			// middle-middle line, bottom-bottom line, box-square box
+			type: {
+				type: String,
+				default: "bottom"
+			},
+		},
+		watch: {
+			maxlength: {
+				immediate: true,
+				handler: function(newV) {
+					if (newV === 6) {
+						this.ranges = [1, 2, 3, 4, 5, 6]
+					} else {
+						this.ranges = [1, 2, 3, 4]
+					}
+				}
+			},
+			value: {
+				immediate: true,
+				handler: function(newV) {
+					if (newV !== this.inputValue) {
+						this.inputValue = newV
+						this.toMakeAndCheck(newV)
+					}
+				}
+			}
+		},
+		data() {
+			return {
+				inputValue: '',
+				codeIndex: 1,
+				codeArr: [],
+				ranges: [1, 2, 3, 4]
+			}
+		},
+		methods: {
+			getVal(e) {
+				const val = e.detail.value
+				this.inputValue = val
+				this.$emit('input', val)
+				this.toMakeAndCheck(val)
+			},
+			toMakeAndCheck(val) {
+				const arr = val.split('')
+				this.codeIndex = arr.length + 1
+				this.codeArr = arr
+				if (this.codeIndex > Number(this.maxlength)) {
+					this.$emit('finish', this.codeArr.join(''))
+				}
+			},
+			// refs 时不再提供 v-model 支持
+			// 支持使用refs来设置value
+			// 没有提供数据保护与检测，自己在外面对数据进行检测保护
+			set(val) {
+				this.inputValue = val
+				this.toMakeAndCheck(val)
+			},
+			// 支持使用refs来清空
+			clear() {
+				this.inputValue = ''
+				this.codeArr = []
+				this.codeIndex = 1
+			}
+		}
+	}
+</script>
+
+<style scoped>
+	@keyframes twinkling {
+		0% {
+			opacity: 0.2;
+		}
+
+		50% {
+			opacity: 0.5;
+		}
+
+		100% {
+			opacity: 0.2;
+		}
+	}
+
+	.code-box {
+		text-align: center;
+	}
+
+	.flex-box {
+		display: flex;
+		justify-content: center;
+		position: relative;
+	}
+
+	.flex-box .hide-input {
+		position: absolute;
+		top: 0;
+		left: -100%;
+		width: 200%;
+		height: 100%;
+		text-align: left;
+		z-index: 9;
+		opacity: 1;
+	}
+
+	.flex-box .item {
+		position: relative;
+		width: 100rpx;
+		height: 100rpx;
+		margin-right: 18rpx;
+		font-size: 28rpx;
+		color: #333333;
+		line-height: 100rpx;
+	}
+
+	.flex-box .item:last-child {
+		margin-right: 0;
+	}
+
+	.flex-box .middle {
+		border: none;
+	}
+
+	.flex-box .box {
+		box-sizing: border-box;
+		border: 2rpx solid #cccccc;
+		border-radius: 6rpx;
+    background-color: #EAEAEA;
+	}
+
+	.flex-box .bottom {
+		box-sizing: border-box;
+		border-bottom: 1rpx solid #212121;
+	}
+
+	.flex-box .active {
+		border-color:#17A1FF;
+	}
+
+	.flex-box .active .line {
+		display: block;
+	}
+
+	.flex-box .line {
+		display: none;
+		position: absolute;
+		left: 50%;
+		top: 50%;
+		transform: translate(-50%, -50%);
+		width: 2rpx;
+		height: 40rpx;
+		background: #333333;
+		animation: twinkling 1s infinite ease;
+	}
+
+	.flex-box .dot {
+		font-size: 80rpx;
+		line-height: 40rpx;
+	}
+
+	.flex-box .bottom-line {
+		height: 4px;
+		background: #000000;
+		width: 80%;
+		position: absolute;
+		border-radius: 2px;
+		top: 50%;
+		left: 50%;
+		transform: translate(-50%, -50%);
+	}
+</style>
Index: __MACOSX/._readme.md
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- __MACOSX/._readme.md	(date 1603184181100)
+++ __MACOSX/._readme.md	(date 1603184181100)
@@ -0,0 +1,1 @@
+    Mac OS X            	   2  >     p                                      ATTR      p   �   �                  �     com.apple.lastuseddate#PS       �   H  com.apple.macl     4   <  com.apple.quarantine xB�]    �V     2�&:� J��k��#                                                      q/0081;5dee33c9;Chrome;150BD59D-12B3-4C81-B3B3-6B3460266810 
\ No newline at end of file
Index: pages/rechargeRecord/rechargeRecord.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"record\">\r\n    <noMoreData v-if=\"!spliceData||spliceData.length === 0\"></noMoreData>\r\n    <view v-else\r\n          class=\"content\"\r\n          v-for=\"(d,index) in spliceData\"\r\n          :key=\"index\">\r\n      <view class=\"head\">{{ d.name }}</view>\r\n      <view class=\"details\">\r\n        <view v-for=\"(p,i) in d.data\"\r\n              :key=\"p.id\"\r\n              :class=\"['item',i!== d.data.length-1?'borderBottom':'']\">\r\n          <view>\r\n            <view>\r\n              <text>{{ p.goods_name }}</text>\r\n            </view>\r\n            <view>\r\n              <text>{{ p.created_at }}</text>\r\n            </view>\r\n          </view>\r\n          <view>\r\n            <text>{{'-' + p.barter_integral}}\r\n            </text>\r\n          </view>\r\n        </view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport {exchangeRecord} from \"../../request/api\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      record:[],\r\n      page:1\r\n    }\r\n  },\r\n  async mounted(){\r\n    this.record = (await exchangeRecord({\r\n      page:this.page,\r\n    })).data\r\n    console.log(this.record);\r\n  },\r\n  computed: {\r\n    spliceData() {\r\n      if(!this.record) return ;\r\n      let spliceObj = {},\r\n          temp = []\r\n      this.record.forEach((item, index) => {\r\n        temp = item.created_at.split('/');\r\n        item.name = `${temp[0]}年${temp[1]}月`;\r\n        if(!(spliceObj[item.name])){\r\n          spliceObj[item.name] = {\r\n            name:item.name,\r\n            data:[]\r\n          };\r\n        }\r\n        spliceObj[item.name].data.push(item)\r\n      })\r\n      return spliceObj\r\n    }\r\n  },\r\n  methods: {}\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.record {\r\n  width: 100%;\r\n  min-height: 100vh;\r\n  background-color: $main-bg;\r\n  padding: 0 $spacing-base;\r\n  box-sizing: border-box;\r\n\r\n  .content{\r\n    width: 100%;\r\n    font-size: $font-size-sm - 2rpx;\r\n    color: $font-color1;\r\n\r\n    .head{\r\n      height: 90rpx;\r\n      padding:$spacing-lg 0;\r\n      box-sizing: border-box;\r\n    }\r\n\r\n    .details{\r\n      width:100%;\r\n      background-color: #FFFFFF;\r\n      padding: 0 20rpx;\r\n      box-sizing: border-box;\r\n      border-radius: 20rpx;\r\n\r\n      .item{\r\n        width: 100%;\r\n        height: 124rpx;\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n\r\n        &.borderBottom{\r\n          border-bottom: 1rpx solid rgba(204,204,204,.4);\r\n        }\r\n\r\n        view:nth-child(1){\r\n          font-size: $font-size-sm;\r\n          color: $font-color1;\r\n          display: flex;\r\n          flex-direction: column;\r\n          justify-content: space-around;\r\n\r\n          view:nth-child(2){\r\n            font-size:$font-size-sm - 4rpx;\r\n            color: $font-color3;\r\n          }\r\n        }\r\n\r\n        view:nth-child(2){\r\n          font-size: $font-size-sm;\r\n          color: $main-color;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/rechargeRecord/rechargeRecord.vue	(revision cf09c6e1e9ecb362fd78cb7b2a20d14af2da8e20)
+++ pages/rechargeRecord/rechargeRecord.vue	(date 1603164643718)
@@ -1,8 +1,8 @@
 <template>
-  <view class="record">
+  <view class="points_details">
     <noMoreData v-if="!spliceData||spliceData.length === 0"></noMoreData>
-    <view v-else
-          class="content"
+    <view class="content"
+          v-else
           v-for="(d,index) in spliceData"
           :key="index">
       <view class="head">{{ d.name }}</view>
@@ -10,17 +10,23 @@
         <view v-for="(p,i) in d.data"
               :key="p.id"
               :class="['item',i!== d.data.length-1?'borderBottom':'']">
-          <view>
+          <view class="diff">
             <view>
-              <text>{{ p.goods_name }}</text>
+              <text>原有：{{ p.current_price }}</text>
+              <text>現有：{{ p.surplus_price }}</text>
             </view>
-            <view>
+            <view class="time">
               <text>{{ p.created_at }}</text>
             </view>
           </view>
-          <view>
-            <text>{{'-' + p.barter_integral}}
+          <view class="amount">
+            <text>{{
+                p.consume_status === '充值'
+                    ? '+' + p.consume_price
+                    : '-' + p.consume_price
+              }}
             </text>
+            <text>{{ p.consume_type }}</text>
           </view>
         </view>
       </view>
@@ -29,33 +35,37 @@
 </template>
 
 <script>
-import {exchangeRecord} from "../../request/api";
+//TODO 展示数据，API接口需替换
+import { expensesRecord} from "../../request/api";
 
 export default {
   data() {
     return {
-      record:[],
-      page:1
+      record: [],
+      page: 1
     }
   },
-  async mounted(){
-    this.record = (await exchangeRecord({
-      page:this.page,
-    })).data
-    console.log(this.record);
+  async mounted() {
+    this.token = getApp().globalData.userToken;
+    try {
+      this.record = (await expensesRecord({page: this.page})).data
+    } catch (e) {
+      console.log(e);
+      this.customToast('请求出错', false)
+    }
   },
   computed: {
+    //根据月份分割数组
     spliceData() {
-      if(!this.record) return ;
       let spliceObj = {},
           temp = []
       this.record.forEach((item, index) => {
         temp = item.created_at.split('/');
         item.name = `${temp[0]}年${temp[1]}月`;
-        if(!(spliceObj[item.name])){
+        if (!(spliceObj[item.name])) {
           spliceObj[item.name] = {
-            name:item.name,
-            data:[]
+            name: item.name,
+            data: []
           };
         }
         spliceObj[item.name].data.push(item)
@@ -63,12 +73,27 @@
       return spliceObj
     }
   },
-  methods: {}
+
+  //上拉加载更多
+  async onReachBottom(){
+    uni.showLoading({title:'加载中'})
+    try{
+      let data = (await expensesRecord({
+        page:++this.page,
+      })).data
+      !data && (data = []);
+      this.record = this.record.concat(data)
+      console.log(this.record);
+      uni.hideLoading()
+    }catch (e) {
+      this.customToast('没有更多数据了')
+    }
+  },
 }
 </script>
 
 <style lang="scss" scoped>
-.record {
+.points_details {
   width: 100%;
   min-height: 100vh;
   background-color: $main-bg;
@@ -104,22 +129,31 @@
           border-bottom: 1rpx solid rgba(204,204,204,.4);
         }
 
-        view:nth-child(1){
+        .diff{
           font-size: $font-size-sm;
           color: $font-color1;
           display: flex;
           flex-direction: column;
           justify-content: space-around;
 
+          view:nth-child(1){
+            display: flex;
+            flex-direction: column;
+          }
+
           view:nth-child(2){
             font-size:$font-size-sm - 4rpx;
             color: $font-color3;
           }
         }
 
-        view:nth-child(2){
+        .amount{
           font-size: $font-size-sm;
           color: $main-color;
+
+          text:nth-child(1){
+            margin-right: 20rpx;
+          }
         }
       }
     }
Index: pages/exchangeRecord/exchangeRecord.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"record\">\r\n    <noMoreData v-if=\"!spliceData||spliceData.length === 0\"></noMoreData>\r\n      <view v-else\r\n            class=\"content\"\r\n            v-for=\"(d,index) in spliceData\"\r\n            :key=\"index\">\r\n        <view class=\"head\">{{ d.name }}</view>\r\n        <view class=\"details\">\r\n          <view v-for=\"(p,i) in d.data\"\r\n                :key=\"p.id\"\r\n                :class=\"['item',i!== d.data.length-1?'borderBottom':'']\">\r\n            <view>\r\n              <view>\r\n                <text>{{ p.goods_name }}</text>\r\n              </view>\r\n              <view>\r\n                <text>{{ p.created_at }}</text>\r\n              </view>\r\n            </view>\r\n            <view>\r\n              <text>{{'-' + p.barter_integral}}\r\n              </text>\r\n            </view>\r\n          </view>\r\n        </view>\r\n      </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport {exchangeRecord} from \"../../request/api\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      record:[],\r\n      page:1\r\n    }\r\n  },\r\n  async mounted(){\r\n    this.record = (await exchangeRecord({\r\n      page:this.page,\r\n    })).data\r\n    console.log(this.record);\r\n  },\r\n  computed: {\r\n    spliceData() {\r\n      if(!this.record) return ;\r\n      let spliceObj = {},\r\n          temp = []\r\n      this.record.forEach((item, index) => {\r\n        temp = item.created_at.split('/');\r\n        item.name = `${temp[0]}年${temp[1]}月`;\r\n        if(!(spliceObj[item.name])){\r\n          spliceObj[item.name] = {\r\n            name:item.name,\r\n            data:[]\r\n          };\r\n        }\r\n        spliceObj[item.name].data.push(item)\r\n      })\r\n      return spliceObj\r\n    }\r\n  },\r\n  methods: {}\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.record {\r\n  width: 100%;\r\n  min-height: 100vh;\r\n  background-color: $main-bg;\r\n  padding: 0 $spacing-base;\r\n  box-sizing: border-box;\r\n\r\n  .content{\r\n    width: 100%;\r\n    font-size: $font-size-sm - 2rpx;\r\n    color: $font-color1;\r\n\r\n    .head{\r\n      height: 90rpx;\r\n      padding:$spacing-lg 0;\r\n      box-sizing: border-box;\r\n    }\r\n\r\n    .details{\r\n      width:100%;\r\n      background-color: #FFFFFF;\r\n      padding: 0 20rpx;\r\n      box-sizing: border-box;\r\n      border-radius: 20rpx;\r\n\r\n      .item{\r\n        width: 100%;\r\n        height: 124rpx;\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n\r\n        &.borderBottom{\r\n          border-bottom: 1rpx solid rgba(204,204,204,.4);\r\n        }\r\n\r\n        view:nth-child(1){\r\n          font-size: $font-size-sm;\r\n          color: $font-color1;\r\n          display: flex;\r\n          flex-direction: column;\r\n          justify-content: space-around;\r\n\r\n          view:nth-child(2){\r\n            font-size:$font-size-sm - 4rpx;\r\n            color: $font-color3;\r\n          }\r\n        }\r\n\r\n        view:nth-child(2){\r\n          font-size: $font-size-sm;\r\n          color: $main-color;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/exchangeRecord/exchangeRecord.vue	(revision cf09c6e1e9ecb362fd78cb7b2a20d14af2da8e20)
+++ pages/exchangeRecord/exchangeRecord.vue	(date 1603162876576)
@@ -1,30 +1,30 @@
 <template>
   <view class="record">
     <noMoreData v-if="!spliceData||spliceData.length === 0"></noMoreData>
-      <view v-else
-            class="content"
-            v-for="(d,index) in spliceData"
-            :key="index">
-        <view class="head">{{ d.name }}</view>
-        <view class="details">
-          <view v-for="(p,i) in d.data"
-                :key="p.id"
-                :class="['item',i!== d.data.length-1?'borderBottom':'']">
-            <view>
-              <view>
-                <text>{{ p.goods_name }}</text>
-              </view>
-              <view>
-                <text>{{ p.created_at }}</text>
-              </view>
-            </view>
-            <view>
-              <text>{{'-' + p.barter_integral}}
-              </text>
-            </view>
-          </view>
-        </view>
-      </view>
+    <view v-else
+          class="content"
+          v-for="(d,index) in spliceData"
+          :key="index">
+      <view class="head">{{ d.name }}</view>
+      <view class="details">
+        <view v-for="(p,i) in d.data"
+              :key="p.id"
+              :class="['item',i!== d.data.length-1?'borderBottom':'']">
+          <view>
+            <view>
+              <text>{{ p.goods_name }}</text>
+            </view>
+            <view>
+              <text>{{ p.created_at }}</text>
+            </view>
+          </view>
+          <view>
+            <text>{{'-' + p.barter_integral}}
+            </text>
+          </view>
+        </view>
+      </view>
+    </view>
   </view>
 </template>
 
@@ -39,17 +39,18 @@
     }
   },
   async mounted(){
+    // TODO 展示数据，API接口需替换
     this.record = (await exchangeRecord({
       page:this.page,
     })).data
-    console.log(this.record);
   },
   computed: {
+    //根据月份分离出对应的数据
     spliceData() {
       if(!this.record) return ;
       let spliceObj = {},
           temp = []
-      this.record.forEach((item, index) => {
+      this.record.forEach((item) => {
         temp = item.created_at.split('/');
         item.name = `${temp[0]}年${temp[1]}月`;
         if(!(spliceObj[item.name])){
@@ -63,7 +64,21 @@
       return spliceObj
     }
   },
-  methods: {}
+  //上拉加载更多
+  async onReachBottom(){
+    uni.showLoading({title:'加载中'})
+    try{
+      let data = (await exchangeRecord({
+        page:++this.page,
+      })).data
+      !data && (data = []);
+      this.record = this.record.concat(data)
+      console.log(this.record);
+      uni.hideLoading()
+    }catch (e) {
+      this.customToast('没有更多数据了')
+    }
+  },
 }
 </script>
 
Index: pages/milkTeaGift/milkTeaGift.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"container\">\r\n    <swiperSwitch leftTitle=\"購買奶茶有禮\"\r\n                  rightTitle=\"我的奶茶有禮\"\r\n                  :assign-index=\"assignIndex\"\r\n                  @swiper-end=\"assignIndex = false\">\r\n      <template v-slot:left>\r\n        <!--購買奶茶有禮-->\r\n        <view class=\"buy_foresee\">\r\n          <view class=\"content_list\" v-for=\"list in foreseeList\" :key=\"list.id\">\r\n            <view class=\"title\">\r\n              <text>{{ list.norm_name }}</text>\r\n            </view>\r\n            <swiper next-margin=\"40rpx\"\r\n                    display-multiple-items=\"2\"\r\n                    enable-flex\r\n                    :scroll-x=\"true\"\r\n                    class=\"list\">\r\n              <swiper-item class=\"list_item\"\r\n                           @click=\"navPage(list.child[im])\"\r\n                           v-for=\"(foresee,im) in (list.child)\"\r\n                           :key=\"im\">\r\n                <!-- TODO 替換圖片鏈接 foreseeList.worth_price-->\r\n                <image :src=\"'../../static/images_t/milkTeaGift/img.png'\"></image>\r\n              </swiper-item>\r\n            </swiper>\r\n          </view>\r\n        </view>\r\n      </template>\r\n      <template v-slot:right>\r\n        <!--我的奶茶有礼-->\r\n        <view class=\"have_foresee\">\r\n          <myForeseePage @buy-foreseeList=\"assignIndex++\"\r\n                         @give-start=\"giveInfo\"\r\n                         :foresee=\"haveForesee\"></myForeseePage>\r\n        </view>\r\n      </template>\r\n    </swiperSwitch>\r\n\r\n    <!--赠送好友-->\r\n    <view v-if=\"isGive\" class=\"give\" @touchmove.prevent.stop=\"catchTouch\">\r\n      <view class=\"mark\">\r\n        <view class=\"content\">\r\n          <uni-icons @click=\"closeGive\"\r\n                     class=\"icon\"\r\n                     type=\"close\"\r\n                     size=\"40\"\r\n                     color=\"#cccccc\">\r\n          </uni-icons>\r\n          <view class=\"title\">贈送好友</view>\r\n          <input v-model=\"givePhone\" type=\"number\" maxlength=\"11\" placeholder=\"請輸入贈送好友手機號\">\r\n          <button @click=\"giveStart\">確定贈送</button>\r\n        </view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  milkList,\r\n  myForesee,\r\n  buyForesee,\r\n  mutualRecord\r\n} from \"../../request/api\";\r\n\r\nimport swiperSwitch from \"../../components-lk/swiperSwitch/swiperSwitch\";\r\nimport myForeseePage from './components/myForeseePage'\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      foreseeList: [\r\n        {\r\n          id: \"16022649\",\r\n          norm_name: \"流心波波卡\",\r\n          child: [\r\n            {\r\n              id: \"1602670752262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"1602670725262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"1602677252262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"1602670725222564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            },\r\n          ]\r\n        },  {\r\n          id: \"1602667262842649\",\r\n          norm_name: \"流心波波卡\",\r\n          child: [\r\n            {\r\n              id: \"1602670752262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"1602670725262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"1602677252262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"1602670725222564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            },\r\n          ]\r\n        }, {\r\n          id: \"1602662062842649\",\r\n          norm_name: \"流心波波卡\",\r\n          child: [\r\n            {\r\n              id: \"1602670725226254\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"160267252262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"1602670725262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"160267072522664\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            },\r\n          ]\r\n        }, {\r\n          id: \"160266762842649\",\r\n          norm_name: \"流心波波卡\",\r\n          child: [\r\n            {\r\n              id: \"16027252262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"16026707262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"1602677252262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"160267072564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            },\r\n          ]\r\n        }, {\r\n          id: \"16026672842649\",\r\n          norm_name: \"流心波波卡\",\r\n          child: [\r\n            {\r\n              id: \"1602670762564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"1602670722564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"1602670725262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"160262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            },\r\n          ]\r\n        }, {\r\n          id: \"160266842649\",\r\n          norm_name: \"流心波波卡\",\r\n          child: [\r\n            {\r\n              id: \"1602662564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"160262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"16026764\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"160252262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            },\r\n          ]\r\n        },\r\n      ],\r\n      haveForesee: [\r\n          {\r\n        id: \"1602761166363589\",\r\n        worth_price: \"60.00\",\r\n        home_avatar: \"/uploads/202010/14/160267063599194.jpg\"\r\n      }, {\r\n        id: \"1602761616363589\",\r\n        worth_price: \"60.00\",\r\n        home_avatar: \"/uploads/202010/14/160267063599194.jpg\"\r\n      }, {\r\n        id: \"1602761161363589\",\r\n        worth_price: \"60.00\",\r\n        home_avatar: \"/uploads/202010/14/160267063599194.jpg\"\r\n      }, {\r\n        id: \"1602761161636589\",\r\n        worth_price: \"60.00\",\r\n        home_avatar: \"/uploads/202010/14/160267063599194.jpg\"\r\n      },],\r\n      // haveForesee:[],\r\n      activeFeat: 'buy',\r\n      assignIndex:0,\r\n      givePhone:'',\r\n      isGive:false,\r\n    }\r\n  },\r\n  async mounted() {\r\n    await this.getForesee()\r\n  },\r\n  methods: {\r\n    //获取数据列表\r\n    async getForesee() {\r\n      this.foreseeList = ((await milkList()).data || [])\r\n    },\r\n    //获取我的卡片\r\n    async getMyForesee() {\r\n    },\r\n    //获取购买记录\r\n    async getBuyRecord() {\r\n    },\r\n    //获取收送记录\r\n    async getMutualRecord() {\r\n    },\r\n    //贈送預付卡\r\n    async giveForeseeStart(){},\r\n    //跳轉至預付卡詳情\r\n    navPage(f) {\r\n      uni.navigateTo({\r\n        url: '/pages/foreseeDetails/foreseeDetails?foresee=' + encodeURIComponent(JSON.stringify(f))\r\n      })\r\n    },\r\n\r\n    catchTouch(){},\r\n    giveInfo(){\r\n      this.isGive = true;\r\n    },\r\n    //點擊贈送好友\r\n    giveStart(){\r\n      console.log(1);\r\n      uni.showLoading({\r\n        title:'請稍後'\r\n      })\r\n      try{\r\n        if(this.givePhone.length!==11||isNaN(this.givePhone)){\r\n          this.customToast('手機號不正確')\r\n          this.givePhone = ''\r\n          return\r\n        }\r\n        this.isGive = false;\r\n        //TODO贈送邏輯處理\r\n\r\n        this.customToast('贈送成功')\r\n        this.givePhone = '';\r\n      }catch (e){\r\n        this.givePhone = ''\r\n        this.customToast('贈送失敗')\r\n      }\r\n    },\r\n    //取消贈送\r\n    closeGive(){\r\n      this.isGive = false;\r\n      this.givePhone = '';\r\n    },\r\n  },\r\n  components: {\r\n    myForeseePage,\r\n    swiperSwitch\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\nimage{\r\n  width: 300rpx;\r\n  height: 200rpx;\r\n  vertical-align: middle;\r\n}\r\n.container{\r\n  width: 100%;\r\n  min-height: 100%;\r\n  background-color: $main-bg;\r\n\r\nswiper{\r\nheight: 100%;\r\n\r\n  .buy_foresee{\r\n    //margin-top: 150rpx;\r\n    width: 100%;\r\n    display: flex;\r\n    flex-direction: column;\r\n    background-color: $main-bg;\r\n    box-sizing: border-box;\r\n    padding:$spacing-base 0;\r\n    /* #ifdef H5 | APP-PLUS*/\r\n    padding:$spacing-base;\r\n    /* #endif*/\r\n\r\n    .content_list{\r\n      width: 100%;\r\n      /* #ifdef MP*/\r\n      padding: 0 $spacing-base;\r\n      box-sizing:border-box;\r\n      /* #endif*/\r\n\r\n      .title{\r\n        font-size: $font-size-base;\r\n        color: $font-color1;\r\n        margin-bottom: 10rpx;\r\n      }\r\n\r\n      .list{\r\n        width: 100%;\r\n        height: 200rpx;\r\n        white-space: nowrap;\r\n        margin-bottom: $spacing-lg;\r\n\r\n        .list_item{\r\n          display: inline-block;\r\n          width: 300rpx;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  .have_foresee{\r\n    //margin-top: 150rpx;\r\n    width: 100%;\r\n    //min-height: 100%;\r\n    display: flex;\r\n    flex-direction: column;\r\n    background-color: $main-bg;\r\n  }\r\n}\r\n  .give{\r\n    width: 100vw;\r\n    height: 100vh;\r\n    position: fixed;\r\n    left: 0;\r\n    top: 0;\r\n    z-index:13;\r\n\r\n    .mark{\r\n      width: 100%;\r\n      height: 100%;\r\n      background:rgba(0,0,0,.35);\r\n      z-index: 12;\r\n\r\n      .content{\r\n        width: 480rpx;\r\n        height: 330rpx;\r\n        background: #ffffff;\r\n        border-radius: 20rpx;\r\n        position: absolute;\r\n        left: 50%;\r\n        top: 50%;\r\n        transform: translate(-50%,-50%);\r\n        font-size: $font-size-base;\r\n        font-weight:$font-weight-lg;\r\n        color: $font-color1;\r\n        display: flex;\r\n        flex-direction: column;\r\n        align-items: center;\r\n\r\n        .icon{\r\n          position: absolute;\r\n          right: 20rpx;\r\n          top: 20rpx;\r\n        }\r\n\r\n        .title{\r\n          margin: 50rpx 0 $spacing-lg 0;\r\n        }\r\n\r\n        input{\r\n          width: 330rpx;\r\n          height: 54rpx;\r\n          border: 1rpx solid #cccccc;\r\n          font-size: $font-size-sm;\r\n          font-weight: $font-weight-base;\r\n          border-radius: 8rpx;\r\n          padding: 0 10rpx;\r\n          box-sizing: border-box;\r\n          margin-bottom: 50rpx;\r\n        }\r\n\r\n        button  {\r\n          width: 150rpx;\r\n          height: 58rpx;\r\n          background: $main-color;\r\n          border-radius: 4rpx;\r\n          padding: 0;\r\n          line-height: 58rpx;\r\n          font-size: $font-size-sm;\r\n          font-weight: $font-weight-base;\r\n          color: #FFFFFF;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/milkTeaGift/milkTeaGift.vue	(revision cf09c6e1e9ecb362fd78cb7b2a20d14af2da8e20)
+++ pages/milkTeaGift/milkTeaGift.vue	(date 1603164776559)
@@ -280,6 +280,7 @@
       })
     },
 
+    //在弹出赠送框后阻止滑动的空数组
     catchTouch(){},
     giveInfo(){
       this.isGive = true;
Index: __MACOSX/components/myp-one/._myp-one.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- __MACOSX/components/myp-one/._myp-one.vue	(date 1603184181093)
+++ __MACOSX/components/myp-one/._myp-one.vue	(date 1603184181093)
@@ -0,0 +1,1 @@
+    Mac OS X            	   2   �                                           ATTR         �   L                  �     com.apple.lastuseddate#PS       �   <  com.apple.quarantine GD�]    \<    q/0081;5dee33c9;Chrome;150BD59D-12B3-4C81-B3B3-6B3460266810 
\ No newline at end of file
Index: readme.md
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- readme.md	(date 1603184181098)
+++ readme.md	(date 1603184181098)
@@ -0,0 +1,87 @@
+# 使用
+下载下来直接引入，然后使用。也可以直接复制下面的源码内容。无任何依赖。
+
+`type`可以控制是 中间划线(middle) 下划线(bottom) 方宽(box) 样式。
+
+## refs
+
+`<one-input ref="one" type="box" @finish="finished"></one-input>`
+
+## v-model
+
+`<one-input v-model="test" @finish="finished"></one-input>`
+
+## 都不需要
+
+`<one-input @finish="finished"></one-input>`
+
+# 示例
+
+```
+<template>
+	<view>
+		<view style="height: 100rpx;"></view>
+		<one-input v-model="test" @finish="finishedOne"></one-input>
+		<view style="height: 100rpx;"></view>
+		<button @tap="toClear">清空</button>
+		<view style="height: 100rpx;"></view>
+		<one-input ref="hi" type="box"></one-input>
+	</view>
+</template>
+
+<script>
+	import oneInput from '@/components/one.vue'
+	
+	export default {
+		components: {
+			oneInput
+		},
+		data() {
+			return {
+				test: '48'
+			}
+		},
+		onLoad() {
+			setTimeout(()=>{
+				this.$refs.hi.set('831')
+			})
+		},
+		methods: {
+			finishedOne(val) {
+				console.log(val)
+			},
+			toClear() {
+				this.test = ''
+				this.$refs.hi.clear()
+			}
+		}
+	}
+</script>
+
+<style>
+</style>
+```
+
+# `mypUI`
+
+全新的 `nvue-uniapp` 组件，一套组件支持编译到 `mp/h5/app`。
+
+## 特点：
+
+- `nvue`页面组件，一套页面适合全端，且`app`端对应为`weex`原生，对于`app`端性能提升很大；
+- 开放主题配置，通过`scss`变量配置主题，默认配置5套主题，支持无限套主题；
+- 基于效率与细节定制双重考虑，支持快速使用与细节定制；
+- 不仅仅只是一套UI组件，还有更多关于uniapp的注意细节，使用示范；
+- 代码规范，注重代码质量与开发效率。
+
+## 包含内容
+
+- 常用组件：button/cell/icon/grid/input/item/radio/check/group/tag/notify/over/loading/popup/toast/navbar/tabbar/tabs/refresh/loading/divider/picker...UI组件上该有的都有;
+- 能够在大项目中直接使用的request请求库；
+- 打开与关闭动画都良好的popup/modal/actionsheet等，且在app端优化。百分比支持关闭动画，不只是打开动画；
+- 快速从icons的css文件中提取icon的Python脚本；
+- Vue/uni-app整套的教程，包含基础和进阶，高级，不需要再次花时间和金钱来徘徊（事件机制/通信/vuex/router/nextTrick/refs/mixin/provide/inject/...）；
+- 下拉刷新/上提加载，封装良好，scroll全平台支持，而且app支持weex中的list；
+- 自定义的tabbar（非swiper方式实现）以及navbar，支持popup全屏；
+- ...
+
Index: pages/orderForm/orderForm.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"order_form\">\r\n    <headNav @nav-click=\"navDescription\" :text=\"headNavText\" :iconURL=\"headNAVIcon\"></headNav>\r\n    <!--展示页面切换 lk -->\r\n    <view class=\"head_feat\">\r\n      <view @click=\"toggleFeat('current')\"\r\n            :class=\"['current',activeFeat === 'current'? 'active_feat':'']\">\r\n        <text>當前訂單</text>\r\n      </view>\r\n      <view @click=\"toggleFeat('history')\"\r\n            :class=\"['history',activeFeat === 'history' ? 'active_feat':'']\">\r\n        <text>歷史訂單</text>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 無訂單展示的页面 用戶沒有登錄，或者登錄後訂單數據為空時展示-->\r\n    <view v-if=\"isEmpty\" class=\"empty_order\">\r\n      <view class=\"empty_img\">\r\n        <image src=\"../../static/images_t/orderForm/orderFormEmpty.png\"></image>\r\n      </view>\r\n      <view class=\"empty_text\">\r\n        <text>您今天還沒有下單</text>\r\n        <text>快去選擇一杯喜歡的茶吧</text>\r\n      </view>\r\n      <navigator class=\"go_order\"\r\n                 hover-class=\"none\"\r\n                 open-type=\"switchTab\"\r\n                 url=\"/pages/order/order\">去點單\r\n      </navigator>\r\n      <!-- 測試 -->\r\n    </view>\r\n\r\n    <!-- 当前订单展示頁面 -->\r\n    <view v-if=\"activeFeat==='current' && currentOrderForm.data.length \" class=\"order_detail\">\r\n      <orderDetail @order-click=\"orderPayment\" :orderFormData=\"currentOrderForm.data\"></orderDetail>\r\n    </view>\r\n\r\n    <!-- 歷史訂單頁面 -->\r\n    <view v-if=\"activeFeat==='history' && historyOrderForm.data.length \" class=\"order_history\">\r\n      <view class=\"history_head\">\r\n        <view class=\"history_head_content\">\r\n          <view>\r\n            <button @click=\"historyType='oneself'\"\r\n                    :class=\"{active_btn:historyType==='oneself'}\"\r\n                    plain>自提訂單\r\n            </button>\r\n            <button @click=\"historyType='takeaway'\"\r\n                    :class=\"{active_btn:historyType==='takeaway'}\"\r\n                    plain>外賣訂單\r\n            </button>\r\n          </view>\r\n          <navigator hover-class=\"none\"\r\n                     open-type=\"navigate\"\r\n                     :url=\"`/pages/bulkInvoice/bulkInvoice?invoice=${JSON.stringify(invoiceData)}`\">\r\n            <image src=\"../../static/images/orderForm/invoice.png\"></image>\r\n            <button plain>批量開票</button>\r\n          </navigator>\r\n        </view>\r\n      </view>\r\n      <view>\r\n        <orderDetail :orderFormData=\"sliceOrder\"></orderDetail>\r\n      </view>\r\n    </view>\r\n\r\n    <!--登录提示框-->\r\n    <loginBox v-if=\"!loginBoxShow\" @close-login-box=\"loginBoxShow = true\"></loginBox>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport headNav from '../../components-lk/headNav/headNav.vue'\r\nimport orderDetail from '../../components-lk/orderDetail/orderDetail.vue'\r\nimport loginBox from \"../../components-lk/loginBox/loginBox\";\r\n\r\nimport {orderForm, paymentStart} from '../../request/api'\r\n\r\nconst APP = getApp().globalData\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      headNavText: '想對你說',\r\n      headNAVIcon: 'email',\r\n      activeFeat: 'current',\r\n      empty: true,\r\n      historyType: 'takeaway',\r\n      currentOrderForm: {data: [], page: 1},\r\n      historyOrderForm: {data: [], page: 1},\r\n      oneSelfOrder: [],//自提订单\r\n      takeawayOrder: [],//外卖订单\r\n      invoiceData: [],//未开发票订单\r\n      loginBoxShow: false,//false展示\r\n      paymentTimer:null,\r\n    }\r\n  },\r\n  computed: {\r\n    /*\r\n    * 将外卖订单和自提订单分割出来\r\n    * 根据展示板块动态切换传递给展示组件的数据\r\n    * 訂單數據為空直接返回，不做處理\r\n    * */\r\n    sliceOrder() {\r\n      this.empty = false;\r\n      this.takeawayOrder = [];\r\n      this.oneSelfOrder = [];\r\n      this.invoiceData = [];\r\n      this.historyOrderForm.data.forEach((item) => {\r\n        if (item.haul_method === '外卖') {\r\n          this.takeawayOrder.push(item)\r\n        } else {\r\n          this.oneSelfOrder.push(item)\r\n        }\r\n        //分离未开发票订单\r\n        if (item.invoice_status === '2' && item.pay_status === '已完成') {\r\n          this.invoiceData.push(item)\r\n        }\r\n      });\r\n      if (this.historyType === 'oneself') {\r\n        return this.oneSelfOrder\r\n      }\r\n      return this.takeawayOrder\r\n    },\r\n    isEmpty() {\r\n      if (this.activeFeat === 'current') {\r\n        return !(this.currentOrderForm.data.length)\r\n      } else if (this.activeFeat === 'history') {\r\n        return !(this.historyOrderForm.data.length)\r\n      }\r\n    },\r\n  },\r\n\r\n  //頁面每次展示都重新獲取本地storage中的token值\r\n  async onShow() {\r\n    this.loginBoxShow = this.token = APP.userToken;\r\n    this.token&&await this.getData()\r\n  },\r\n\r\n  onUnload(){\r\n    //TODO 清空支付定时器\r\n    clearTimeout(this.paymentTimer)\r\n  },\r\n\r\n  //請求所有的數據\r\n  // async mounted() {\r\n  //   this.loginBoxShow = this.token = APP.userToken;\r\n  //   if(this.loginBoxShow){\r\n  //    await this.getData()\r\n  //   }\r\n  // },\r\n\r\n  methods: {\r\n    //请求数据\r\n    async requestOrder(type, page) {\r\n      return (await orderForm({type, page})).data;\r\n    },\r\n\r\n    async getData() {\r\n      uni.showLoading({\r\n        title: '請稍後'\r\n      })\r\n      try {\r\n        this.currentOrderForm.data = (await this.requestOrder(1, this.currentOrderForm.page) || [])\r\n        this.historyOrderForm.data = (await this.requestOrder(2, this.historyOrderForm.page) || [])\r\n        uni.hideLoading()\r\n      } catch (e) {\r\n        this.customToast('訂單獲取失敗')\r\n      }\r\n    },\r\n\r\n    //切換展示頁\r\n    async toggleFeat(feat) {\r\n      this.activeFeat = feat;\r\n      if (feat === 'history') {\r\n        this.headNavText = '英國城探秘'\r\n        this.headNAVIcon = '';\r\n        //第一页的数据只请求一次\r\n      } else {\r\n        this.headNavText = '想對你說'\r\n        this.headNAVIcon = 'email'\r\n      }\r\n    },\r\n\r\n    navDescription() {\r\n      uni.navigateTo({\r\n        url: '/pages/wantTell/wantTell'\r\n      })\r\n    },\r\n\r\n    // 没有支付的订单，点击直接支付\r\n    async orderPayment(g) {\r\n      uni.showLoading({\r\n        title: '结算中...'\r\n      })\r\n      let self = this;\r\n      let order = g.order;\r\n      try {\r\n        let orderInfo = (await paymentStart({\r\n          order_num: order.order_num,\r\n          shop_id: order.shop_id,\r\n        })).data\r\n        try{\r\n          // TODO 延迟请求微信支付，\r\n          self.paymentTimer && clearTimeout(self.paymentTimer)\r\n          self.paymentTimer = setTimeout(async () => {\r\n            let result = await self.utilPayment(orderInfo)\r\n            console.log(result);\r\n            await self.getData()\r\n            self.customToast('结算成功了')\r\n          }, 3000)\r\n        }catch (e) {\r\n          self.customToast('结算出错了')\r\n        }\r\n      } catch (e) {\r\n        self.customToast('结算出错了')\r\n        console.log(e);\r\n      }\r\n    },\r\n  },\r\n\r\n  components: {\r\n    headNav,\r\n    orderDetail,\r\n    loginBox\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\nuni-page-body{\r\n  min-height: 100%;\r\n  background-color: $main-bg;\r\n}\r\n.order_form {\r\n  width: 100%;\r\n  background-color: $main-bg;\r\n  min-height: 100%;\r\n\r\n  .head_feat {\r\n    width: 100%;\r\n    height: 100rpx;\r\n    background: #ffffff;\r\n    display: flex;\r\n    justify-content: space-around;\r\n    align-items: center;\r\n    z-index: 1;\r\n    position: sticky;\r\n    top: 128rpx;\r\n  ;\r\n\r\n    .current,\r\n    .history {\r\n      width: 128rpx;\r\n      font-size: $font-size-lg;\r\n      font-weight: $font-weight-lg;\r\n      text-align: left;\r\n      color: $font-color1;\r\n      line-height: 100rpx;\r\n      box-sizing: border-box;\r\n\r\n      &.active_feat {\r\n        height: 100%;\r\n        border-bottom: 4rpx solid #333;\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  .empty_order {\r\n    width: 100%;\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    margin-top: 228rpx;\r\n    background-color: $main-bg;\r\n\r\n    .empty_img {\r\n      width: 264rpx;\r\n      height: 264rpx;\r\n      vertical-align: middle;\r\n    }\r\n\r\n    .empty_text {\r\n      width: 264rpx;\r\n      height: 126rpx;\r\n      display: flex;\r\n      flex-direction: column;\r\n      font-size:  $font-size-sm;\r\n      font-weight: $font-weight-base;\r\n      text-align: center;\r\n      color: $font-color3;\r\n    }\r\n\r\n    .go_order {\r\n      width: 360rpx;\r\n      height: 78rpx;\r\n      border-radius: 6rpx;\r\n      background: $main-color;\r\n      font-size:  $font-size-base;\r\n      font-weight: $font-weight-base;\r\n      text-align: center;\r\n      line-height: 78rpx;\r\n      color: #ffffff;\r\n      border: none;\r\n    }\r\n  }\r\n\r\n  .order_detail,\r\n  .order_history {\r\n    padding: 128rpx $spacing-base $spacing-lg $spacing-base;\r\n  }\r\n\r\n  .order_history {\r\n    display: flex;\r\n    flex-direction: column;\r\n\r\n    .history_head {\r\n      width: 100%;\r\n      height: 74rpx;\r\n\r\n      .history_head_content {\r\n        display: flex;\r\n        height: 74rpx;\r\n        align-items: flex-end;\r\n        justify-content: space-between;\r\n\r\n        view,navigator {\r\n\r\n          button {\r\n            width: 120rpx;\r\n            height: 44rpx;\r\n            border: none;\r\n            font-size:  $font-size-sm - 2rpx;\r\n            font-weight: $font-weight-base;\r\n            color: $font-color2;\r\n            text-align: center;\r\n            line-height: 44rpx;\r\n            padding: 0;\r\n            margin: 0;\r\n\r\n            &.active_btn {\r\n              background: #fff;\r\n              border-radius: 6rpx;\r\n              color: $main-color;\r\n            }\r\n          }\r\n        }\r\n\r\n        view:nth-child(1) {\r\n          width: 300rpx;\r\n          display: flex;\r\n          justify-content: space-between;\r\n        }\r\n\r\n        navigator {\r\n          display: flex;\r\n          line-height: 44rpx;\r\n          align-items: center;\r\n\r\n          image {\r\n            width: 23rpx;\r\n            height: 21rpx;\r\n            vertical-align: middle;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/orderForm/orderForm.vue	(revision cf09c6e1e9ecb362fd78cb7b2a20d14af2da8e20)
+++ pages/orderForm/orderForm.vue	(date 1603176209660)
@@ -63,7 +63,7 @@
     </view>
 
     <!--登录提示框-->
-    <loginBox v-if="!loginBoxShow" @close-login-box="loginBoxShow = true"></loginBox>
+    <loginBox v-if="loginBoxShow" @close-login-box="hideLoginBox"></loginBox>
   </view>
 </template>
 
@@ -89,16 +89,12 @@
       oneSelfOrder: [],//自提订单
       takeawayOrder: [],//外卖订单
       invoiceData: [],//未开发票订单
-      loginBoxShow: false,//false展示
+      loginBoxShow: false,
       paymentTimer:null,
     }
   },
   computed: {
-    /*
-    * 将外卖订单和自提订单分割出来
-    * 根据展示板块动态切换传递给展示组件的数据
-    * 訂單數據為空直接返回，不做處理
-    * */
+    //分离出外卖订单，自提订单，未开发票订单
     sliceOrder() {
       this.empty = false;
       this.takeawayOrder = [];
@@ -120,6 +116,8 @@
       }
       return this.takeawayOrder
     },
+
+    //判断是否暂时空页面
     isEmpty() {
       if (this.activeFeat === 'current') {
         return !(this.currentOrderForm.data.length)
@@ -129,26 +127,36 @@
     },
   },
 
-  //頁面每次展示都重新獲取本地storage中的token值
+  //页面每次展示重新获取token，请求重新请求订单数据
   async onShow() {
-    this.loginBoxShow = this.token = APP.userToken;
-    this.token&&await this.getData()
+    console.log(APP.userToken);
+    if (APP.userToken) {
+      this.loginBoxShow = APP.isLoginBox = false;
+      this.token = APP.userToken
+      try {
+        await this.getData()
+      } catch (e) {
+        console.log(e);
+      }
+    } else {
+      this.loginBoxShow = APP.isLoginBox = true;
+    }
   },
-
+onHide(){
+  console.log(2);
+  clearTimeout(this.paymentTimer)
+},
   onUnload(){
     //TODO 清空支付定时器
     clearTimeout(this.paymentTimer)
+    console.log(1);
   },
-
-  //請求所有的數據
-  // async mounted() {
-  //   this.loginBoxShow = this.token = APP.userToken;
-  //   if(this.loginBoxShow){
-  //    await this.getData()
-  //   }
-  // },
 
   methods: {
+    //隐藏登陆引导框
+    hideLoginBox(){
+      this.loginBoxShow = APP.isLoginBox = false;
+    },
     //请求数据
     async requestOrder(type, page) {
       return (await orderForm({type, page})).data;
@@ -173,7 +181,6 @@
       if (feat === 'history') {
         this.headNavText = '英國城探秘'
         this.headNAVIcon = '';
-        //第一页的数据只请求一次
       } else {
         this.headNavText = '想對你說'
         this.headNAVIcon = 'email'
@@ -191,29 +198,36 @@
       uni.showLoading({
         title: '结算中...'
       })
-      let self = this;
-      let order = g.order;
-      try {
-        let orderInfo = (await paymentStart({
-          order_num: order.order_num,
-          shop_id: order.shop_id,
-        })).data
-        try{
-          // TODO 延迟请求微信支付，
-          self.paymentTimer && clearTimeout(self.paymentTimer)
-          self.paymentTimer = setTimeout(async () => {
-            let result = await self.utilPayment(orderInfo)
-            console.log(result);
-            await self.getData()
-            self.customToast('结算成功了')
-          }, 3000)
-        }catch (e) {
-          self.customToast('结算出错了')
-        }
-      } catch (e) {
-        self.customToast('结算出错了')
-        console.log(e);
-      }
+      let self = this,
+          order = g.order,
+          orderInfo;
+      //获取预支付信息
+      // try {
+      //    orderInfo = (await paymentStart({
+      //     order_num: order.order_num,
+      //     shop_id: order.shop_id,
+      //   })).data
+      // } catch (e) {
+      //   console.log(e);
+      //   self.customToast('订单信息获取失败')
+      //   return;
+      // }
+        // TODO 延迟请求微信支付，
+        self.paymentTimer && clearTimeout(self.paymentTimer)
+        self.paymentTimer = setTimeout(async () => {
+         try{
+           orderInfo = (await paymentStart({
+             order_num: order.order_num,
+             shop_id: order.shop_id,
+           })).data
+           await self.utilPayment(orderInfo)
+           await self.getData()
+           self.customToast('结算成功')
+         }catch (e) {
+           uni.hideLoading()
+           console.log(e);
+         }
+        }, 3000)
     },
   },
 
Index: pages/discount/discount.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"discount\">\r\n    <view class=\"discount_head\">\r\n      <text @click=\"activeDiscount='unUsed'\" :class=\"{'active':activeDiscount==='unUsed'}\">可使用</text>\r\n      <text @click=\"activeDiscount='used'\" :class=\"{'active':activeDiscount==='used'}\">已使用</text>\r\n      <text @click=\"activeDiscount='fail'\" :class=\"{'active':activeDiscount==='fail'}\">已失效</text>\r\n    </view>\r\n    <view class=\"discount_empty\" v-if=\"!(this[activeDiscount].length)\">\r\n      <image src=\"../../static/images_t/discount/discount_empty.png\"></image>\r\n      <text>暫無優惠券可用</text>\r\n    </view>\r\n    <view v-else class=\"discount_content\">\r\n      <discountModule @use-coupon=\"useCoupon\" :discount=\"this[activeDiscount]\"></discountModule>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport discountModule from \"../../components-lk/discountModule/discountModule\";\r\nimport {discount} from \"../../request/api\";\r\n\r\nconst APP = getApp().globalData;\r\nexport default {\r\n  data() {\r\n    return {\r\n      unUsed: [],\r\n      used: [],\r\n      fail: [],\r\n      activeDiscount: 'unUsed',\r\n      coupon:false,\r\n    }\r\n  },\r\n  onLoad(options){\r\n    if(options.couponInfo){\r\n      this.unUsed = JSON.parse(decodeURIComponent(options.couponInfo));\r\n    }\r\n  },\r\n  async mounted() {\r\n    //獲取優惠券信息，onLoad生命週期內獲取不到值就發送請求獲取\r\n    if(!(this.unUsed.length)){\r\n      this.token = APP.userToken;\r\n      this.unUsed = await this.requestDiscount(1)\r\n      this.used = await this.requestDiscount(2)\r\n      this.fail = await this.requestDiscount(3)\r\n    }\r\n  },\r\n\r\n  onHide(){\r\n    APP.couponInfo = null;\r\n  },\r\n\r\n  methods: {\r\n    //點擊使用優惠券\r\n    useCoupon(coupon) {\r\n      if (this.activeDiscount === 'unUsed') {\r\n        APP.coupon = coupon;\r\n        uni.navigateBack({\r\n          url: '/pages/orderPayment/orderPayment',\r\n        })\r\n      } else {\r\n        this.customToast('無法使用',false)\r\n      }\r\n    },\r\n\r\n    //請求優惠券信息\r\n    async requestDiscount(type) {\r\n      try {\r\n        if (this.token) {\r\n          let result = (await discount({type,})).data\r\n          !result && (result = [])\r\n          return result\r\n        } else {\r\n          this.customToast('請先登錄',false)\r\n          return []\r\n        }\r\n      } catch (e) {\r\n        console.log(e);\r\n      }\r\n    },\r\n  },\r\n  watch: {\r\n    async activeDiscount(value) {\r\n      //沒有值的時候在獲取值\r\n      if (this[this.activeDiscount].length === 0) {\r\n        this.type = 1;\r\n        switch (value) {\r\n          case 'unUsed':\r\n            this.type = 1;\r\n            break;\r\n          case 'used':\r\n            this.type = 2\r\n            break;\r\n          default:\r\n            this.type = 3\r\n        }\r\n        this[this.activeDiscount] = await this.requestDiscount(this.type)\r\n      }\r\n    },\r\n  },\r\n  components: {\r\n    discountModule\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\nuni-page-body {\r\n  height: 100%;\r\n}\r\n\r\n.discount {\r\n  width: 100%;\r\n  min-height: 100%;\r\n  background: #F5F6F8;\r\n\r\n  .discount_head {\r\n    width: 100%;\r\n    height: 100rpx;\r\n    background: #FFFFFF;\r\n    display: flex;\r\n    justify-content: space-around;\r\n    align-items: center;\r\n    font-size: $font-size-lg;\r\n    font-weight: $font-weight-lg;\r\n    color: $font-color2;\r\n    box-sizing: border-box;\r\n    position: fixed;\r\n    top: --status-tab-height;\r\n\r\n    text {\r\n      display: inline-block;\r\n      height: 100%;\r\n      box-sizing: border-box;\r\n      line-height: 100rpx;\r\n\r\n      &.active {\r\n        border-bottom: 4rpx solid $font-color1;\r\n        color: $font-color1;\r\n      }\r\n    }\r\n  }\r\n\r\n  .discount_content {\r\n    padding: 150rpx $spacing-base 0 $spacing-base;\r\n    width: 100%;\r\n    min-height: 100%;\r\n    box-sizing: border-box;\r\n  }\r\n\r\n  .discount_empty{\r\n    padding-top: 293rpx;\r\n    width: 100%;\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n\r\n    image{\r\n      width: 331rpx;\r\n      height: 259rpx;\r\n    }\r\n\r\n    text{\r\n      font-size: $font-size-sm;\r\n      color: $font-color3;\r\n    }\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/discount/discount.vue	(revision cf09c6e1e9ecb362fd78cb7b2a20d14af2da8e20)
+++ pages/discount/discount.vue	(date 1603162546094)
@@ -31,6 +31,7 @@
     }
   },
   onLoad(options){
+    //从订单结算页面进入需携带优惠券信息
     if(options.couponInfo){
       this.unUsed = JSON.parse(decodeURIComponent(options.couponInfo));
     }
@@ -45,40 +46,31 @@
     }
   },
 
-  onHide(){
-    APP.couponInfo = null;
-  },
-
   methods: {
     //點擊使用優惠券
     useCoupon(coupon) {
+      //通过判断展示的页面使用优惠券，数据中没有可判断的字段
       if (this.activeDiscount === 'unUsed') {
         APP.coupon = coupon;
-        uni.navigateBack({
-          url: '/pages/orderPayment/orderPayment',
-        })
+        uni.navigateBack()
       } else {
         this.customToast('無法使用',false)
       }
     },
 
-    //請求優惠券信息
+    //請求優惠券信息，没有数据返回一个空数组
     async requestDiscount(type) {
       try {
-        if (this.token) {
-          let result = (await discount({type,})).data
+          let result = (await discount({type})).data
           !result && (result = [])
           return result
-        } else {
-          this.customToast('請先登錄',false)
-          return []
-        }
       } catch (e) {
+        this.customToast('请求出错')
         console.log(e);
       }
     },
   },
-  watch: {
+/*  watch: {
     async activeDiscount(value) {
       //沒有值的時候在獲取值
       if (this[this.activeDiscount].length === 0) {
@@ -96,7 +88,7 @@
         this[this.activeDiscount] = await this.requestDiscount(this.type)
       }
     },
-  },
+  },*/
   components: {
     discountModule
   }
Index: components-lk/swiperSwitch/swiperSwitch.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"swiper_container\">\r\n    <!--    头部-->\r\n    <view class=\"head\">\r\n      <view class=\"left\">\r\n        <text @click=\"clickSwitch(0)\" :class=\"[tabIndex===0 ? 'active':'']\">{{ leftTitle }}</text>\r\n      </view>\r\n      <view class=\"right\">\r\n        <text @click=\"clickSwitch(1)\" :class=\"[tabIndex===1 ? 'active':'']\">{{ rightTitle }}</text>\r\n      </view>\r\n    </view>\r\n    <swiper :current=\"swiperIndex\"\r\n            class=\"swiper-wrap\"\r\n            @change=\"swiperChange\">\r\n      <swiper-item class=\"swiper-slide left\">\r\n        <scroll-view enable-flex class=\"scroll_wrap\" scroll-y>\r\n          <view>\r\n            <slot name=\"left\"></slot>\r\n          </view>\r\n        </scroll-view>\r\n      </swiper-item>\r\n      <swiper-item class=\"swiper-slide right\">\r\n        <scroll-view enable-flex  class=\"scroll_wrap\" scroll-y>\r\n          <view>\r\n            <slot name=\"right\"></slot>\r\n          </view>\r\n        </scroll-view>\r\n      </swiper-item>\r\n\r\n    </swiper>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      leftHeight: '100%',\r\n      rightHeight: '100%',\r\n      swiperIndex: 0,\r\n      tabIndex: 0,\r\n    }\r\n  },\r\n  props: {\r\n    leftTitle: {\r\n      type: String,\r\n      default: ''\r\n    },\r\n    rightTitle: {\r\n      type: String,\r\n      default: ''\r\n    },\r\n    // leftLength: {\r\n    //   type: Number,\r\n    //   default: 0\r\n    // },\r\n    // rightLength: {\r\n    //   type: Number,\r\n    //   default: 0\r\n    // },\r\n    // leftName: String,\r\n    // rightName: String,\r\n    assignIndex: {\r\n      type: Number,\r\n      default: 0\r\n    },\r\n    // same: {\r\n    //   type: Boolean,\r\n    //   default: false,\r\n    // }\r\n  },\r\n  //组件初始加载计算高度\r\n  async mounted() {\r\n    await this.computeHeight()\r\n  },\r\n  methods: {\r\n    //點擊切換\r\n    clickSwitch(i) {\r\n      this.swiperIndex = i;\r\n      this.tabIndex = i;\r\n    },\r\n    //swiper改变时触发\r\n    swiperChange(e) {\r\n      this.tabIndex = e.detail.current;\r\n      this.swiperIndex = e.detail.current;\r\n      // this.computeHeight()\r\n    },\r\n\r\n    //计算swiper组件的高度,使用scroll-view替代，不需要計算\r\n    // async computeHeight() {\r\n    //   //屏幕滚动至最顶部，如果屏幕在非顶部可能会导致无法获取组件的布局信息\r\n    //   // uni.pageScrollTo({\r\n    //   //   scrollTop: 0,\r\n    //   //   duration: 0,\r\n    //   // })\r\n    //   let layout, h, diff;\r\n    //   let windowH = uni.getSystemInfoSync().windowHeight;\r\n    //   try {\r\n    //     if (this.tabIndex === 0) {\r\n    //       layout = await this.getLayoutInfo(this.leftName);\r\n    //       h = (this.leftLength * layout.height + layout.top)\r\n    //       h = h < windowH ? windowH : h;\r\n    //       this.leftHeight = h +'px';\r\n    //     } else {\r\n    //       if (this.same) {\r\n    //         // #ifdef MP\r\n    //         diff = await this.getLayoutInfo('.have_foresee >>> .foot')\r\n    //         // #endif\r\n    //         // #ifndef MP\r\n    //         diff = await this.getLayoutInfo('.foot')\r\n    //         // #endif\r\n    //         h = diff.top + diff.height;\r\n    //       } else {\r\n    //         layout = await this.getLayoutInfo(this.rightName);\r\n    //         h = (this.rightLength * layout.height + layout.top);\r\n    //       }\r\n    //       h = h < windowH ? windowH : h;\r\n    //       this.rightHeight = h + 'px';\r\n    //     }\r\n    //   } catch (e) {\r\n    //     this.leftHeight = windowH + 'px';\r\n    //     this.rightHeight = windowH + 'px';\r\n    //   }\r\n    // },\r\n  },\r\n\r\n  watch: {\r\n    // async tabIndex() {\r\n    //   // await this.computeHeight()\r\n    // },\r\n    async assignIndex() {\r\n      await this.swiperChange()\r\n      // await this.computeHeight()\r\n    }\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.swiper_container{\r\n  width: 100%;\r\n  height: 100%;\r\n  display: flex;\r\n  flex-direction: column;\r\n\r\n  .head{\r\n    width: 100%;\r\n    height: 120rpx;\r\n    background: #FFFFFF;\r\n    display: flex;\r\n    justify-content: space-around;\r\n    font-size: $font-size-lg;\r\n    color: $font-color2;\r\n    padding-top: 20rpx;\r\n    line-height: 100rpx;\r\n\r\n    text{\r\n      display: inline-block;\r\n    }\r\n\r\n    .active{\r\n      color: $font-color1;\r\n      font-weight: $font-weight-lg;\r\n      position: relative;\r\n      height: 100%;\r\n\r\n      &::after{\r\n        content: '';\r\n        display: block;\r\n        position: absolute;\r\n        bottom: 0;\r\n        width: 80rpx;\r\n        height: 4rpx;\r\n        background: $font-color1;\r\n        left: 50%;\r\n        margin-left: -40rpx;\r\n      }\r\n    }\r\n  }\r\n\r\n  .swiper-wrap{\r\n    flex: 1;\r\n    overflow: hidden;\r\n\r\n    .scroll_wrap{\r\n      height: 100%;\r\n    }\r\n  }\r\n}\r\n</style>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- components-lk/swiperSwitch/swiperSwitch.vue	(revision cf09c6e1e9ecb362fd78cb7b2a20d14af2da8e20)
+++ components-lk/swiperSwitch/swiperSwitch.vue	(date 1603159324109)
@@ -70,9 +70,9 @@
     // }
   },
   //组件初始加载计算高度
-  async mounted() {
-    await this.computeHeight()
-  },
+  // async mounted() {
+  //   await this.computeHeight()
+  // },
   methods: {
     //點擊切換
     clickSwitch(i) {
Index: pages/expensesRecord/expensesRecord.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"points_details\">\r\n    <noMoreData v-if=\"!spliceData||spliceData.length === 0\"></noMoreData>\r\n    <view class=\"content\"\r\n          v-else\r\n          v-for=\"(d,index) in spliceData\"\r\n          :key=\"index\">\r\n      <view class=\"head\">{{ d.name }}</view>\r\n      <view class=\"details\">\r\n        <view v-for=\"(p,i) in d.data\"\r\n              :key=\"p.id\"\r\n              :class=\"['item',i!== d.data.length-1?'borderBottom':'']\">\r\n          <view class=\"diff\">\r\n            <view>\r\n              <text>原有：{{ p.current_price }}</text>\r\n              <text>現有：{{ p.surplus_price }}</text>\r\n            </view>\r\n            <view class=\"time\">\r\n              <text>{{ p.created_at }}</text>\r\n            </view>\r\n          </view>\r\n          <view class=\"amount\">\r\n            <text>{{\r\n                p.consume_status === '充值'\r\n                    ? '+' + p.consume_price\r\n                    : '-' + p.consume_price\r\n              }}\r\n            </text>\r\n            <text>{{p.consume_type}}</text>\r\n          </view>\r\n        </view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport {expensesRecord} from \"../../request/api\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      record:[],\r\n      page:1\r\n    }\r\n  },\r\n  async mounted() {\r\n    this.token = getApp().globalData.userToken;\r\n    try{\r\n      this.record = (await expensesRecord({page:this.page})).data\r\n    }catch (e){\r\n      console.log(e);\r\n      this.customToast('出現了錯誤',false)\r\n    }\r\n  },\r\n  computed: {\r\n    spliceData() {\r\n      let spliceObj = {},\r\n          temp = []\r\n      this.record.forEach((item, index) => {\r\n        temp = item.created_at.split('/');\r\n        item.name = `${temp[0]}年${temp[1]}月`;\r\n        if(!(spliceObj[item.name])){\r\n          spliceObj[item.name] = {\r\n            name:item.name,\r\n            data:[]\r\n          };\r\n        }\r\n        spliceObj[item.name].data.push(item)\r\n      })\r\n      return spliceObj\r\n    }\r\n  },\r\n  methods: {}\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.points_details {\r\n  width: 100%;\r\n  min-height: 100vh;\r\n  background-color: $main-bg;\r\n  padding: 0 $spacing-base;\r\n  box-sizing: border-box;\r\n\r\n  .content{\r\n    width: 100%;\r\n    font-size: $font-size-sm - 2rpx;\r\n    color: $font-color1;\r\n\r\n    .head{\r\n      height: 90rpx;\r\n      padding:$spacing-lg 0;\r\n      box-sizing: border-box;\r\n    }\r\n\r\n    .details{\r\n      width:100%;\r\n      background-color: #FFFFFF;\r\n      padding: 0 20rpx;\r\n      box-sizing: border-box;\r\n      border-radius: 20rpx;\r\n\r\n      .item{\r\n        width: 100%;\r\n        height: 124rpx;\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n\r\n        &.borderBottom{\r\n          border-bottom: 1rpx solid rgba(204,204,204,.4);\r\n        }\r\n\r\n        .diff{\r\n          font-size: $font-size-sm;\r\n          color: $font-color1;\r\n          display: flex;\r\n          flex-direction: column;\r\n          justify-content: space-around;\r\n\r\n          view:nth-child(1){\r\n            display: flex;\r\n            flex-direction: column;\r\n          }\r\n\r\n          view:nth-child(2){\r\n            font-size:$font-size-sm - 4rpx;\r\n            color: $font-color3;\r\n          }\r\n        }\r\n\r\n        .amount{\r\n          font-size: $font-size-sm;\r\n          color: $main-color;\r\n\r\n          text:nth-child(1){\r\n            margin-right: 20rpx;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/expensesRecord/expensesRecord.vue	(revision cf09c6e1e9ecb362fd78cb7b2a20d14af2da8e20)
+++ pages/expensesRecord/expensesRecord.vue	(date 1603163217370)
@@ -26,7 +26,7 @@
                     : '-' + p.consume_price
               }}
             </text>
-            <text>{{p.consume_type}}</text>
+            <text>{{ p.consume_type }}</text>
           </view>
         </view>
       </view>
@@ -35,35 +35,37 @@
 </template>
 
 <script>
-import {expensesRecord} from "../../request/api";
+//钱包余额消费记录
+import { expensesRecord} from "../../request/api";
 
 export default {
   data() {
     return {
-      record:[],
-      page:1
+      record: [],
+      page: 1
     }
   },
   async mounted() {
     this.token = getApp().globalData.userToken;
-    try{
-      this.record = (await expensesRecord({page:this.page})).data
-    }catch (e){
+    try {
+      this.record = (await expensesRecord({page: this.page})).data
+    } catch (e) {
       console.log(e);
-      this.customToast('出現了錯誤',false)
+      this.customToast('请求出错', false)
     }
   },
   computed: {
+    //根据月份分割数组
     spliceData() {
       let spliceObj = {},
           temp = []
       this.record.forEach((item, index) => {
         temp = item.created_at.split('/');
         item.name = `${temp[0]}年${temp[1]}月`;
-        if(!(spliceObj[item.name])){
+        if (!(spliceObj[item.name])) {
           spliceObj[item.name] = {
-            name:item.name,
-            data:[]
+            name: item.name,
+            data: []
           };
         }
         spliceObj[item.name].data.push(item)
@@ -71,7 +73,22 @@
       return spliceObj
     }
   },
-  methods: {}
+
+  //上拉加载更多
+  async onReachBottom(){
+    uni.showLoading({title:'加载中'})
+    try{
+      let data = (await expensesRecord({
+        page:++this.page,
+      })).data
+      !data && (data = []);
+      this.record = this.record.concat(data)
+      console.log(this.record);
+      uni.hideLoading()
+    }catch (e) {
+      this.customToast('没有更多数据了')
+    }
+  },
 }
 </script>
 
Index: pages/invoiceInfo/invoiceInfo.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n\t<view class=\"invoice_info\">\r\n\t\t<view class=\"invoice_content\">\r\n\t\t\t<form action=\"\">\r\n        <view class=\"invoice_select\">\r\n          <view class=\"invoice_items invoice_type\">\r\n            <label class=\"invoice_title\">\r\n              <text>發票類型</text>\r\n              <input type=\"text\" value=\"電子發票\" disabled>\r\n            </label>\r\n          </view>\r\n          <view class=\"invoice_items invoice_amount\">\r\n            <label class=\"invoice_title\">\r\n              <text>發票金額</text>\r\n              <input type=\"text\" :value=\"'￥'+invoiceAmount\" disabled>\r\n            </label>\r\n          </view>\r\n          <view class=\"invoice_items invoice_method\">\r\n            <radio-group class=\"invoice_title\">\r\n              <text>開票方式</text>\r\n              <label @click=\"toggleInvoice('type',2)\" class=\"invoice_radio\">\r\n                <radio :checked=\"type ===2\" color=\"#17A1FF\" value=\"type\" />\r\n                <text class=\"incoive_radio_text\">商品類別</text>\r\n              </label>\r\n              <label @click=\"toggleInvoice('type',1)\" class=\"invoice_radio\">\r\n                <radio :checked=\"type ===1\" color=\"#17A1FF\" value=\"detail\" />\r\n                <text class=\"incoive_radio_text\">商品明細</text>\r\n              </label>\r\n            </radio-group>\r\n          </view>\r\n          <view class=\"invoice_items invoice_look\">\r\n            <radio-group class=\"invoice_title\">\r\n              <text>發票擡頭</text>\r\n              <label @click=\"toggleInvoice('lookUp',2)\" class=\"invoice_radio\">\r\n                <radio :checked=\"lookUp ===2\" color=\"#17A1FF\" value=\"personal\" />\r\n                <text class=\"incoive_radio_text\">個人</text>\r\n              </label>\r\n              <label @click=\"toggleInvoice('lookUp',1)\" class=\"invoice_radio\">\r\n                <radio :checked=\"lookUp ===1\" color=\"#17A1FF\" value=\"unit\" />\r\n                <text class=\"incoive_radio_text\">單位</text>\r\n              </label>\r\n            </radio-group>\r\n          </view>\r\n\r\n          <view class=\"invoice_items invoice_email\">\r\n            <label class=\"invoice_title\">\r\n              <text>抬頭內容</text>\r\n              <input\r\n                  v-model=\"lookUpContent\"\r\n                  type=\"text\"\r\n                  placeholder=\"（必填）\">\r\n            </label>\r\n          </view>\r\n\r\n          <view class=\"invoice_items invoice_email\">\r\n            <label class=\"invoice_title\">\r\n              <text>郵箱地址</text>\r\n              <input v-model=\"email\"\r\n                     type=\"text\"\r\n                     placeholder=\"（必填）\">\r\n            </label>\r\n          </view>\r\n\r\n          <view class=\"invoice_items invoice_email\">\r\n            <label class=\"invoice_title\">\r\n              <text>個人識別號</text>\r\n              <input\r\n                  v-model=\"identify\"\r\n                  type=\"text\"\r\n                  placeholder=\"（單位申報必填）\">\r\n            </label>\r\n          </view>\r\n\r\n        </view>\r\n\t\t\t</form>\r\n\t\t</view>\r\n\t\t<view class=\"tips\">\r\n\t\t\t<view class=\"tips_title\">\r\n\t\t\t\t<text>温馨提示：</text>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"tips_content\">\r\n\t\t\t\t<text>應國家稅務局總局要求，您若開具增值稅普通發票，須同時提供企業擡頭及納稅人識別號，否則將無法用於企業報銷。</text>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view @click=\"invoicing\" class=\"invoice_submit\">\r\n\t\t\t<button class=\"submit_btn\" plain>提交申請</button>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nimport {invoice} from \"../../request/api\";\r\n\r\nexport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t  invoiceAmount:0,\r\n        email:'',\r\n        type:1,\r\n        lookUp:1,\r\n        lookUpContent:'',\r\n        identify:''\r\n      }\r\n\t\t},\r\n    onLoad(options){\r\n      this.invoiceAmount = options.invoiceAmount;\r\n      this.orderId = options.id;\r\n    },\r\n\t\tmethods: {\r\n     async invoicing() {\r\n        let {email, type, lookUp, lookUpContent, identify} = this;\r\n\r\n        //填寫不完整提示信息,發票抬頭為個人是抬頭內容可以不寫\r\n        if (!email || !type || !lookUp || !lookUpContent || (lookUp === 1 && !identify)) {\r\n          this.customToast('請填寫完整',false)\r\n          return;\r\n        }\r\n\r\n        //驗證郵箱格式是否正確\r\n        let reg = /^[A-Za-z0-9\\u4e00-\\u9fa5]+@[a-zA-Z0-9_-]+(\\.[a-zA-Z0-9_-]+)+$/;\r\n        this.$nextTick(async () => {\r\n          if (!(reg.test(this.email))) {\r\n            this.customToast('郵箱格式錯誤',false)\r\n            return;\r\n          }\r\n\r\n          //驗證完成提交申請\r\n          if (this.type && this.lookUp) {\r\n            uni.showLoading({\r\n              title: '申請中'\r\n            })\r\n            //接口所需信息\r\n            let invoiceInfoObj = {\r\n              order_id: this.orderId,\r\n              invoice_title: lookUpContent,\r\n              invoice_type: type,\r\n              email_address: email,\r\n              identify_id: identify\r\n            }\r\n\r\n            //个人抬头并且没有个人识别号删除个人识别号字段\r\n            if(this.lookUp === 2 && !this.lookUpContent){\r\n              delete invoiceInfoObj.identify_id;\r\n            }\r\n            //TODO此處申請發票，invoiceInfoObj為傳參對象\r\n            try{\r\n              //申请开票，开票成功后跳转到订单页面\r\n              let result = (await invoice(invoiceInfoObj))\r\n              uni.hideLoading()\r\n              uni.showToast({\r\n                title:'申请成功',\r\n                icon:'none',\r\n                duration:2000,\r\n                success(){\r\n                  uni.redirectTo({\r\n                    url:'/pages/orderForm/orderForm'\r\n                  })\r\n                }\r\n              })\r\n            }catch (e){\r\n              this.customToast('出現了錯誤')\r\n            }\r\n          }\r\n        })\r\n      },\r\n      toggleInvoice(t, v) {\r\n        this[t] = v;\r\n      },\r\n    }\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\tuni-page-body {\r\n\t\theight: 100%;\r\n\t}\r\n\r\n\t.invoice_info {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tbackground: $main-bg;\r\n\t\tpadding: $spacing-lg $spacing-base;\r\n\t\tbox-sizing: border-box;\r\n\r\n\t\t.invoice_content {\r\n\t\t\twidth: 100%;\r\n\t\t\tbackground: #FFFFFF;\r\n\t\t\tborder-radius: 20rpx;\r\n\t\t\tpadding: 0 $spacing-base;\r\n\t\t\tbox-sizing: border-box;\r\n\r\n      /* H5端改版单选框的默认样式*/\r\n      /* #ifdef H5*/\r\n      /deep/.uni-radio-input {\r\n        width: 34rpx !important;\r\n        height: 34rpx !important;\r\n        margin-right: 20rpx !important;\r\n      }\r\n\r\n      /* #endif*/\r\n\r\n      .invoice_select {\r\n        width: 100%;\r\n        height: 100%;\r\n        display: flex;\r\n        flex-direction: column;\r\n        position: relative;\r\n\r\n        .invoice_items {\r\n          width: 100%;\r\n          height: 95rpx;\r\n          line-height: 95rpx;\r\n          border-bottom: 1rpx solid rgba(204, 204, 204, 0.3);\r\n\r\n          .invoice_title {\r\n            display: flex;\r\n            font-size: $font-size-sm;\r\n            color: $font-color1;\r\n\r\n            text {\r\n              margin-right: 80rpx;\r\n              font-size: $font-size-sm;\r\n              font-weight: $font-weight-lg;\r\n            }\r\n\r\n            input {\r\n              height: 95rpx;\r\n              width: 431rpx;\r\n              line-height: 95rpx;\r\n              font-size: $font-size-sm;\r\n              color: $font-color2;\r\n              box-sizing: border-box;\r\n              font-weight: $font-weight-base;\r\n            }\r\n\r\n            .incoive_radio_text {\r\n              font-weight: $font-weight-base;\r\n              color: $font-color2;\r\n            }\r\n            .invoice_radio:nth-child(2){\r\n              position: absolute;\r\n              left:405rpx;\r\n            }\r\n          }\r\n        }\r\n      }\r\n\t\t}\r\n\r\n\t\t.tips {\r\n\t\t\tmargin-top: $spacing-lg + 2rpx;\r\n\t\t\tfont-size: $font-size-sm - 2rpx;\r\n\t\t\tcolor: $font-color3;\r\n\t\t\tbox-sizing: border-box;\r\n\r\n\r\n\t\t\t.tips_title {\r\n\t\t\t\tmargin-bottom: 20rpx;\r\n\t\t\t}\r\n\r\n\t\t\t/* #ifdef H5*/\r\n\t\t\t.tips_title {\r\n\t\t\t\tmargin-bottom: 20rpx;\r\n\t\t\t\ttransform: scale(0.9);\r\n\t\t\t}\r\n\r\n\t\t\t.tips_content {\r\n\t\t\t\ttransform: scale(0.9);\r\n\t\t\t}\r\n\r\n\t\t\t/* #endif*/\r\n\t\t}\r\n\r\n\t\t/* #ifndef H5*/\r\n\t\t.tips {\r\n\t\t\tpadding: 0 $spacing-lg;\r\n\t\t}\r\n\r\n\t\t/* #endif*/\r\n\r\n\t\t.invoice_submit {\r\n\t\t\twidth: 702rpx;\r\n\t\t\theight: 78rpx;\r\n\t\t\tposition: fixed;\r\n\t\t\tleft: 0;\r\n\t\t\tbottom: 50rpx;\r\n\t\t\tmargin-left: $spacing-base;\r\n\r\n\t\t\t.submit_btn {\r\n\t\t\t\theight: 100%;\r\n\t\t\t\tpadding: 0;\r\n\t\t\t\tmargin: 0;\r\n\t\t\t\tfont-size: $font-size-base;\r\n\t\t\t\tcolor: #ffffff;\r\n\t\t\t\tbackground: $main-color;\r\n\t\t\t\tborder: none\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/invoiceInfo/invoiceInfo.vue	(revision cf09c6e1e9ecb362fd78cb7b2a20d14af2da8e20)
+++ pages/invoiceInfo/invoiceInfo.vue	(date 1603158429543)
@@ -142,27 +142,20 @@
             if(this.lookUp === 2 && !this.lookUpContent){
               delete invoiceInfoObj.identify_id;
             }
-            //TODO此處申請發票，invoiceInfoObj為傳參對象
             try{
               //申请开票，开票成功后跳转到订单页面
-              let result = (await invoice(invoiceInfoObj))
-              uni.hideLoading()
-              uni.showToast({
-                title:'申请成功',
-                icon:'none',
-                duration:2000,
-                success(){
-                  uni.redirectTo({
-                    url:'/pages/orderForm/orderForm'
-                  })
-                }
+              await invoice(invoiceInfoObj)
+              this.customToast('申请成功')
+              uni.redirectTo({
+                url:'/pages/orderForm/orderForm'
               })
             }catch (e){
-              this.customToast('出現了錯誤')
+              this.customToast('申请失败')
             }
           }
         })
       },
+      //更改发票的一些信息
       toggleInvoice(t, v) {
         this[t] = v;
       },
Index: pages/joinMember/joinMember.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"join_member\">\r\n    <!--頭部-->\r\n    <view class=\"top\">\r\n      <giftPack title=\"開通/續費星球會員後，立刻發放\"></giftPack>\r\n    </view>\r\n    <!--中間-->\r\n    <view class=\"center\">\r\n      <view class=\"items\" >\r\n        <text class=\"title\">每月等級權益</text>\r\n<!--        <text class=\"summary\">根據購買日期，每月同壹時間發放</text>-->\r\n      </view>\r\n      <view class=\"items\" v-for=\"(park,index) in monthPark\" :key=\"index\">\r\n      <text class=\"options\">{{park.goods_name}}</text>\r\n      <text class=\"month\">x{{park.goods_num}}/月</text>\r\n    </view>\r\n<!--      <view class=\"items\" >-->\r\n<!--        <text class=\"options\">滿35減3券</text>-->\r\n<!--        <text class=\"month\">x1/月</text>-->\r\n<!--      </view>-->\r\n<!--      <view>-->\r\n<!--        <text class=\"options\">滿60減5券</text>-->\r\n<!--        <text class=\"month\">x1/月</text>-->\r\n<!--      </view>-->\r\n<!--      <view>-->\r\n<!--        <text class=\"options\">整單9折</text>-->\r\n<!--        <text class=\"month\">x1/月</text>-->\r\n<!--      </view>-->\r\n<!--      <view>-->\r\n<!--        <text class=\"options\">每月28號會員日消費額外贈送5%積分</text>-->\r\n<!--        <text class=\"icon\">特权</text>-->\r\n<!--      </view>-->\r\n\r\n      <!--剔除此功能-->\r\n<!--      <view class=\"other\">-->\r\n<!--        <button plain>查看其他等級權益</button>-->\r\n<!--        <uni-icons class=\"arrow_right\"-->\r\n<!--                   style=\"display: inline-block;vertical-align: middle;\"-->\r\n<!--                   type=\"arrowright\"-->\r\n<!--                   size=\"26\"-->\r\n<!--                   color=\"#333333\">-->\r\n<!--        </uni-icons>-->\r\n<!--      </view>-->\r\n\r\n    </view>\r\n\r\n    <!--底部-->\r\n    <view class=\"bottom\">\r\n      <view  class=\"items\" >\r\n        <text class=\"title\">星球會員權益</text>\r\n        <text class=\"summary\">星球會員有效期內可使用</text>\r\n      </view>\r\n\r\n      <view class=\"items\" v-for=\"(park,index) in interestsPark\" :key=\"index\">\r\n        <text class=\"options\">{{park.goods_name}}</text>\r\n<!--        <text class=\"icon icon_red\">免排隊，優先制作</text>-->\r\n        <text class=\"month\">x{{park.goods_num}}</text>\r\n      </view>\r\n<!--      <view class=\"items\" >-->\r\n<!--        <text class=\"options\">生日贈飲券</text>-->\r\n<!--        <text class=\"icon icon_red\">免排隊，優先制作</text>-->\r\n<!--        <text class=\"month\">x1</text>-->\r\n<!--      </view>-->\r\n<!--      <view class=\"items\" >-->\r\n<!--        <text class=\"options\">星球會員開通紀念日贈飲券</text>-->\r\n<!--        <text class=\"month\">x1</text>-->\r\n<!--      </view>-->\r\n<!--      <view class=\"items\" >-->\r\n<!--        <text class=\"options\">5.28會員日贈飲券</text>-->\r\n<!--        <text class=\"month\">x1</text>-->\r\n<!--      </view>-->\r\n<!--      <view class=\"items\" >-->\r\n<!--        <text class=\"options\">積分經驗值漲速翻倍</text>-->\r\n<!--        <text class=\"icon\">特权</text>-->\r\n<!--      </view>-->\r\n    </view>\r\n\r\n    <!--会员协议-->\r\n    <view class=\"protocol\">\r\n      <button @click=\"summaryStatus = !summaryStatus\" class=\"protocol_btn\">\r\n      </button>\r\n      <uni-icons @click=\"summaryStatus = !summaryStatus\"\r\n                 v-if=\"summaryStatus\"\r\n                 type=\"checkmarkempty\"\r\n                 size=\"32\"\r\n                 class=\"summary_status\"\r\n                 color=\"#17A1FF\">\r\n      </uni-icons>\r\n      <view class=\"protocol_content\">\r\n        <text>同意</text>\r\n        <text>《會員服務協議》</text>\r\n      </view>\r\n    </view>\r\n    <!--费用支付-->\r\n    <view class=\"payment\">\r\n      <view class=\"select_type\">\r\n        <uni-icons size=\"40\"\r\n                   class=\"icon_up\"\r\n                   color=\"#333333\"\r\n                   @click=\"selectType\"\r\n                   type=\"arrowup\">\r\n        </uni-icons>\r\n        <text @click=\"selectType\" v-if=\"memberInfo[joinType]\"  class=\"type\">{{ memberInfo[joinType].level_name }}</text>\r\n        <text>總價：</text>\r\n        <text v-if=\"memberInfo[joinType]\" class=\"type_amount\">{{ memberInfo[joinType].recharge_money }}元/{{ memberInfo[joinType].expired_time }}月</text>\r\n      </view>\r\n      <button @click=\"paymentMember\" plain>支付</button>\r\n    </view>\r\n\r\n    <!--占位使用-->\r\n    <view class=\"empty\"></view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport giftPack from \"../my/components/giftPack\";\r\nimport optionsList from \"../../components-lk/optionsList/optionsList\";\r\n\r\nimport {memberRechargeInfo, joinMember, userSpace} from \"../../request/api\";\r\nconst APP = getApp().globalData\r\nexport default {\r\n  data() {\r\n    return {\r\n      memberInfo: [],\r\n      summaryStatus: false,\r\n      monthPark:[],\r\n      interestsPark:[],\r\n      joinType:0,\r\n    }\r\n  },\r\n  async mounted() {\r\n    this.monthPark = APP.userInfo.month_park;\r\n    this.interestsPark = APP.userInfo.interests_pack;\r\n    try {\r\n      this.memberInfo = (await memberRechargeInfo()).data\r\n      console.log(this.memberInfo[this.joinType]);\r\n    } catch (e) {\r\n      console.log(e);\r\n    }\r\n  },\r\n  methods: {\r\n    async paymentMember() {\r\n      let self = this;\r\n      if(!this.summaryStatus){\r\n        this.customToast('请仔细阅读协议');\r\n        return;\r\n      }\r\n      uni.showLoading({\r\n        title:'开通中...'\r\n      })\r\n      try{\r\n        //請求接口獲取支付信息\r\n        let orderInfo = (await joinMember({\r\n          level_id:this.memberInfo[this.joinType].id\r\n        })).data\r\n\r\n        console.log(orderInfo);\r\n        //开始支付\r\n        await self.utilPayment(orderInfo);\r\n        //支付成功执行\r\n        await self.joinSuccess()\r\n      } catch (e) {\r\n        console.log(e);\r\n        this.customToast('开通失敗')\r\n      }\r\n    },\r\n    //开通成功，重新获取会员信息，并且跳转会员权益页面\r\n    async joinSuccess() {\r\n      this.customToast('开通成功')\r\n      APP.userInfo = (await userSpace()).data;\r\n      // TODO 测试修改数据\r\n      APP.userInfo.user_name = 'godkonws';\r\n      console.log(APP.userInfo.user_name);\r\n      uni.redirectTo({\r\n        url:'/pages/memberBenefits/memberBenefits'\r\n      })\r\n    },\r\n    //選擇開通類型\r\n    selectType(){\r\n      let itemList = [],\r\n          self= this;\r\n      this.memberInfo.forEach((item)=>{\r\n        itemList.push(item.level_name)\r\n      });\r\n      uni.showActionSheet({\r\n        itemList,\r\n        success(index){\r\n          self.joinType = index.tapIndex;\r\n        }\r\n      })\r\n    }\r\n  },\r\n  components: {\r\n    giftPack,\r\n    optionsList\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n//字体通用样式\r\n.title{\r\n  font-size: $font-size-base;\r\n  color: $font-color1;\r\n}\r\n\r\n.summary{\r\n  font-size: $font-size-sm - 2rpx;\r\n  color: $font-color3;\r\n}\r\n\r\n.options{\r\n  font-size: $font-size-base;\r\n  color: $font-color1;\r\n}\r\n\r\n.month{\r\n  font-size: $font-size-sm;\r\n  color: $main-color;\r\n}\r\n\r\n.icon{\r\n  width: 50rpx;\r\n  height: 24rpx;\r\n  background: $main-color;\r\n  border-radius: 12rpx 12rpx 12rpx 0rpx;\r\n  font-size: 14rpx;\r\n  color: #ffffff;\r\n  text-align: center;\r\n  line-height: 24rpx;\r\n\r\n\r\n  &.icon_red{\r\n    width: 150rpx;\r\n    background-color: #e25e5c;\r\n  }\r\n}\r\n\r\n@mixin container($h) {\r\n  width: 100%;\r\n  min-height: $h;\r\n  background: #ffffff;\r\n  border-radius: 30rpx;\r\n  margin-bottom: 30rpx;\r\n}\r\n\r\n.join_member{\r\n  width: 100%;\r\n  min-height: 100%;\r\n  padding: $spacing-lg $spacing-base;\r\n  box-sizing: border-box;\r\n  background-color:#F5F6F8 ;\r\n\r\n  .top{\r\n    @include container(380rpx)\r\n  }\r\n\r\n  .center{\r\n    @include container(130rpx);\r\n\r\n  /*  .other{\r\n      height: 28rpx;\r\n      align-self: center;\r\n\r\n      button{\r\n        height: 100%;\r\n        padding: 0;\r\n        border: none;\r\n        font-size: $font-size-base - 4rpx;\r\n        color:$font-color1;\r\n        line-height: 28rpx;\r\n        margin-right: 10rpx;\r\n      }\r\n\r\n      .arrow_right {\r\n        line-height: 34rpx;\r\n      }\r\n    }*/\r\n  }\r\n\r\n  .bottom{\r\n    @include container(130rpx);\r\n    margin-bottom: 0;\r\n  }\r\n\r\n  .center,.bottom{\r\n    display: flex;\r\n    flex-direction: column;\r\n    padding: $spacing-lg $spacing-lg 0 $spacing-lg;\r\n    box-sizing: border-box;\r\n\r\n    view{\r\n      display: flex;\r\n      justify-content: space-between;\r\n\r\n      .summary,.icon{\r\n        margin-right: auto;\r\n        margin-left: 10rpx;\r\n      }\r\n    }\r\n\r\n    .items{\r\n      margin-bottom: $spacing-lg;\r\n    }\r\n  }\r\n\r\n  .protocol{\r\n    width: calc(100% + 48rpx);\r\n    min-height: 70rpx;\r\n    display: flex;\r\n    background-color: #FFFFFF;\r\n    margin-left: -24rpx;\r\n    padding:0 $spacing-base;\r\n    box-sizing: border-box;\r\n    align-items: center;\r\n    position: fixed;\r\n    bottom: 98rpx;\r\n\r\n\r\n    .protocol_btn{\r\n      width: 32rpx;\r\n      height: 32rpx;\r\n      background: #ffffff;\r\n      border: 1rpx solid #cccccc;\r\n      border-radius: 4rpx;\r\n      padding: 0;\r\n      margin-right: $spacing-lg;\r\n    }\r\n\r\n    .summary_status{\r\n      position: absolute;\r\n      left: 24rpx;\r\n    }\r\n\r\n    .protocol_content{\r\n      display: inline-block;\r\n      font-size: $font-size-sm;\r\n      color: $font-color1;\r\n\r\n      text:nth-child(2){\r\n        color:$main-color\r\n      }\r\n    }\r\n  }\r\n\r\n  .payment{\r\n    width: calc(100% + 48rpx);\r\n    height: 98rpx;\r\n    background: #ffffff;\r\n    border-top: 1rpx solid #cccccc;\r\n    padding: 0 $spacing-base;\r\n    box-sizing: border-box;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    position: fixed;\r\n    bottom: 0;\r\n    margin-left: -$spacing-base;\r\n\r\n    //text:nth-child(1){\r\n    //  font-size: $font-size-sm;\r\n    //  color: $font-color1;\r\n    //}\r\n    //\r\n    //text:nth-child(2){\r\n    //  font-size: $font-size-lg + 2rpx;\r\n    //  font-weight: $font-weight-lg;\r\n    //  color: $main-color;\r\n    //  margin-right: auto;\r\n    //}\r\n\r\n    .select_type{\r\n      flex: 1;\r\n      display: flex;\r\n      align-items: center;\r\n      font-size: $font-size-sm;\r\n      color: $font-color1;\r\n\r\n      .type_amount,.type{\r\n        font-size: $font-size-lg + 2rpx;\r\n        font-weight: $font-weight-lg;\r\n        color: $main-color;\r\n      }\r\n      .type{\r\n        margin:  0 10rpx;\r\n      }\r\n\r\n      .icon_up{\r\n        margin-right: 10rpx;\r\n      }\r\n    }\r\n\r\n    button{\r\n      width: 200rpx;\r\n      height: 98rpx;\r\n      background: $main-color;\r\n      border: none;\r\n      font-size: $font-size-base;\r\n      color: #ffffff;\r\n      padding: 0;\r\n      text-align: center;\r\n      line-height: 98rpx;\r\n    }\r\n  }\r\n\r\n  .empty{\r\n    width: 100%;\r\n    height: 138rpx;\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/joinMember/joinMember.vue	(revision cf09c6e1e9ecb362fd78cb7b2a20d14af2da8e20)
+++ pages/joinMember/joinMember.vue	(date 1603164379128)
@@ -133,7 +133,6 @@
     this.interestsPark = APP.userInfo.interests_pack;
     try {
       this.memberInfo = (await memberRechargeInfo()).data
-      console.log(this.memberInfo[this.joinType]);
     } catch (e) {
       console.log(e);
     }
@@ -142,7 +141,7 @@
     async paymentMember() {
       let self = this;
       if(!this.summaryStatus){
-        this.customToast('请仔细阅读协议');
+        this.customToast('请仔细阅读协议',false);
         return;
       }
       uni.showLoading({
@@ -154,7 +153,6 @@
           level_id:this.memberInfo[this.joinType].id
         })).data
 
-        console.log(orderInfo);
         //开始支付
         await self.utilPayment(orderInfo);
         //支付成功执行
@@ -169,8 +167,9 @@
       this.customToast('开通成功')
       APP.userInfo = (await userSpace()).data;
       // TODO 测试修改数据
-      APP.userInfo.user_name = 'godkonws';
+      APP.userInfo.user_name = '成功开通了会员';
       console.log(APP.userInfo.user_name);
+      //开通成功后跳转到会员权益页面
       uni.redirectTo({
         url:'/pages/memberBenefits/memberBenefits'
       })
Index: pages/foreseeDetails/foreseeDetails.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"foresee\">\r\n    <view class=\"head\">\r\n      <!-- TODO 替換圖片鏈接 foreseeList.worth_price-->\r\n      <image :src=\"'../../static/images_t/milkTeaGift/img.png'\"></image>\r\n    </view>\r\n    <view class=\"foresee_content\">\r\n      <view class=\"foresee_name\">{{ foresee.card_name }}</view>\r\n      <view class=\"fac_value\">\r\n        <text>選擇面額：</text>\r\n        <text>￥{{ foresee.worth_price }}</text>\r\n      </view>\r\n      <!--溫馨提示-->\r\n      <view class=\"point\">\r\n        <view class=\"tips\">\r\n          <text class=\"title\">溫馨提示：</text>\r\n          <text class=\"content\">1、成功購買奶茶有禮電子卡後，可在【我的】-【奶茶有禮】-【我的奶茶有禮】中查看卡片以及好友贈送\r\n            2、“奶茶有禮電子卡”儘通過官方運營的小程序進行售賣。如果您發現任何第三方以折扣、優惠或購物卡形式售賣“奶茶有禮電子卡”，請您務必提高警惕避免上當受騙\r\n          </text>\r\n        </view>\r\n        <view class=\"notice\">\r\n          <text class=\"title\">購買須知：</text>\r\n          <text class=\"content\">購買即視為閱讀併同意</text>\r\n          <text class=\"special\">《使用須知》</text>\r\n          <text class=\"special\">《奶茶商業預付卡章程》</text>\r\n        </view>\r\n      </view>\r\n      <!--支付按鈕-->\r\n      <view class=\"btn\">\r\n        <button plain>確認支付￥{{ foresee.worth_price }}</button>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      foresee:{}\r\n    }\r\n  },\r\n  onLoad(options){\r\n    this.foresee = JSON.parse(decodeURIComponent(options.foresee))\r\n  },\r\n  methods: {}\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\nuni-page-body{\r\n  height: 100%;\r\n}\r\n.foresee{\r\n  width: 100%;\r\n  min-height: 100%;\r\n  background-color: $main-bg;\r\n  padding: $spacing-lg $spacing-base 0 $spacing-base;\r\n  box-sizing: border-box;\r\n\r\n  .head{\r\n    width: 100%;\r\n    height: 400rpx;\r\n    background: rgba(0,0,0,0);\r\n    border-radius: 30rpx;\r\n    margin-bottom: $spacing-lg;\r\n  }\r\n\r\n  .foresee_content{\r\n    width: 100%;\r\n    height: 550rpx;\r\n    background: #ffffff;\r\n    border-radius: 20rpx;\r\n    display: flex;\r\n    flex-direction: column;\r\n    padding: $spacing-lg;\r\n    box-sizing: border-box;\r\n\r\n    .foresee_name{\r\n      width: 100%;\r\n      height: 45rpx;\r\n      font-size:$font-size-lg;\r\n      font-weight: $font-weight-lg;\r\n      color: $font-color1;\r\n      margin-bottom: 36rpx;\r\n    }\r\n\r\n    .fac_value{\r\n      width: 100%;\r\n      height: 75rpx;\r\n      font-size: $font-size-lg;\r\n      font-weight: $font-weight-lg;\r\n      color: $font-color1;\r\n      display: flex;\r\n      justify-content: space-between;\r\n      border-bottom: 1rpx solid #cccccc;\r\n      margin-bottom: $spacing-lg;\r\n\r\n      text:nth-child(1){\r\n        font-size: $font-size-sm;\r\n        font-weight: $font-weight-base;\r\n      }\r\n    }\r\n\r\n    .point{\r\n      width: 100%;\r\n      font-size: $font-size-sm - 2rpx;\r\n      font-weight: $font-weight-base;\r\n      color: $font-color3;\r\n      line-height: 1.6;\r\n\r\n      .tips{\r\n        margin-bottom: $spacing-lg;\r\n      }\r\n\r\n      .notice{\r\n        .special{\r\n          color: $main-color;\r\n        }\r\n      }\r\n      .title{\r\n        width: 120rpx;\r\n        font-size: $font-size-sm;\r\n        font-weight: $font-weight-lg;\r\n        color: $font-color1;\r\n      }\r\n    }\r\n  }\r\n\r\n  .btn{\r\n    width: 702rpx;\r\n    height: 78rpx;\r\n    background: $main-color;\r\n    border-radius: 10rpx;\r\n    position: fixed;\r\n    bottom: $spacing-lg;\r\n    left: $spacing-base;\r\n\r\n    button{\r\n      width: 100%;\r\n      height: 100%;\r\n      font-size: $font-size-base;\r\n      color: #ffffff;\r\n      border:none;\r\n      margin: 0;\r\n      padding: 0;\r\n      line-height: 78rpx;\r\n      text-align: center;\r\n    }\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/foreseeDetails/foreseeDetails.vue	(revision cf09c6e1e9ecb362fd78cb7b2a20d14af2da8e20)
+++ pages/foreseeDetails/foreseeDetails.vue	(date 1603163792569)
@@ -26,7 +26,7 @@
         </view>
       </view>
       <!--支付按鈕-->
-      <view class="btn">
+      <view @click="buy" class="btn">
         <button plain>確認支付￥{{ foresee.worth_price }}</button>
       </view>
     </view>
@@ -34,6 +34,8 @@
 </template>
 
 <script>
+import {buyForesee} from "../../request/api";
+
 export default {
   data() {
     return {
@@ -43,7 +45,21 @@
   onLoad(options){
     this.foresee = JSON.parse(decodeURIComponent(options.foresee))
   },
-  methods: {}
+  methods: {
+    async buy(){
+      uni.showLoading({title:'购买中'})
+      let self = this;
+      try{
+        //请求预支付信息
+        let orderInfo = (await buyForesee({card_id:self.foresee.id})).data;
+        self.utilPayment(orderInfo)
+        self.customToast('购买成功')
+      }catch (e) {
+        console.log(e);
+        self.customToast('购买失败')
+      }
+    }
+  }
 }
 </script>
 
Index: pages/buyHistory/buyHistory.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"record\">\r\n    <noMoreData v-if=\"!spliceData||spliceData.length === 0\"></noMoreData>\r\n    <view v-else\r\n          class=\"content\"\r\n          v-for=\"(d,index) in spliceData\"\r\n          :key=\"index\">\r\n      <view class=\"head\">{{ d.name }}</view>\r\n      <view class=\"details\">\r\n        <view v-for=\"(p,i) in d.data\"\r\n              :key=\"p.id\"\r\n              :class=\"['item',i!== d.data.length-1?'borderBottom':'']\">\r\n          <view>\r\n            <view>\r\n              <text>{{ p.goods_name }}</text>\r\n            </view>\r\n            <view>\r\n              <text>{{ p.created_at }}</text>\r\n            </view>\r\n          </view>\r\n          <view>\r\n            <text>{{'-' + p.barter_integral}}\r\n            </text>\r\n          </view>\r\n        </view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport {exchangeRecord} from \"../../request/api\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      record:[],\r\n      page:1\r\n    }\r\n  },\r\n  async mounted(){\r\n    this.record = (await exchangeRecord({\r\n      page:this.page,\r\n    })).data\r\n    console.log(this.record);\r\n  },\r\n  computed: {\r\n    spliceData() {\r\n      if(!this.record) return ;\r\n      let spliceObj = {},\r\n          temp = []\r\n      this.record.forEach((item, index) => {\r\n        temp = item.created_at.split('/');\r\n        item.name = `${temp[0]}年${temp[1]}月`;\r\n        if(!(spliceObj[item.name])){\r\n          spliceObj[item.name] = {\r\n            name:item.name,\r\n            data:[]\r\n          };\r\n        }\r\n        spliceObj[item.name].data.push(item)\r\n      })\r\n      return spliceObj\r\n    }\r\n  },\r\n  methods: {}\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.record {\r\n  width: 100%;\r\n  min-height: 100vh;\r\n  background-color: $main-bg;\r\n  padding: 0 $spacing-base;\r\n  box-sizing: border-box;\r\n\r\n  .content{\r\n    width: 100%;\r\n    font-size: $font-size-sm - 2rpx;\r\n    color: $font-color1;\r\n\r\n    .head{\r\n      height: 90rpx;\r\n      padding:$spacing-lg 0;\r\n      box-sizing: border-box;\r\n    }\r\n\r\n    .details{\r\n      width:100%;\r\n      background-color: #FFFFFF;\r\n      padding: 0 20rpx;\r\n      box-sizing: border-box;\r\n      border-radius: 20rpx;\r\n\r\n      .item{\r\n        width: 100%;\r\n        height: 124rpx;\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n\r\n        &.borderBottom{\r\n          border-bottom: 1rpx solid rgba(204,204,204,.4);\r\n        }\r\n\r\n        view:nth-child(1){\r\n          font-size: $font-size-sm;\r\n          color: $font-color1;\r\n          display: flex;\r\n          flex-direction: column;\r\n          justify-content: space-around;\r\n\r\n          view:nth-child(2){\r\n            font-size:$font-size-sm - 4rpx;\r\n            color: $font-color3;\r\n          }\r\n        }\r\n\r\n        view:nth-child(2){\r\n          font-size: $font-size-sm;\r\n          color: $main-color;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/buyHistory/buyHistory.vue	(revision cf09c6e1e9ecb362fd78cb7b2a20d14af2da8e20)
+++ pages/buyHistory/buyHistory.vue	(date 1603162898808)
@@ -39,17 +39,18 @@
     }
   },
   async mounted(){
+    // TODO 展示数据，API接口需替换
     this.record = (await exchangeRecord({
       page:this.page,
     })).data
-    console.log(this.record);
   },
   computed: {
+    //根据月份分离出对应的数据
     spliceData() {
       if(!this.record) return ;
       let spliceObj = {},
           temp = []
-      this.record.forEach((item, index) => {
+      this.record.forEach((item) => {
         temp = item.created_at.split('/');
         item.name = `${temp[0]}年${temp[1]}月`;
         if(!(spliceObj[item.name])){
@@ -63,7 +64,20 @@
       return spliceObj
     }
   },
-  methods: {}
+  //上拉加载更多
+ async onReachBottom(){
+    uni.showLoading({title:'加载中'})
+    try{
+      let data = (await exchangeRecord({
+        page:++this.page,
+      })).data
+      !data && (data = []);
+      this.record = this.record.concat(data)
+      uni.hideLoading()
+    }catch (e) {
+      this.customToast('没有更多数据了')
+    }
+  },
 }
 </script>
 
Index: pages/mutualHistory/mutualHistory.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"mutual\">\r\n    <swiperSwitch leftTitle=\"收到的\"\r\n                  rightTitle=\"送出的\">\r\n      <template v-slot:left>\r\n        <listContent :list=\"receiveList\"></listContent>\r\n      </template>\r\n      <template v-slot:right>\r\n        <listContent :list=\"giveList\"></listContent>\r\n      </template>\r\n    </swiperSwitch>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport swiperSwitch from \"../../components-lk/swiperSwitch/swiperSwitch\";\r\nimport listContent from \"./components/listContent\";\r\nexport default {\r\n  data() {\r\n    return {\r\n      giveList: [\r\n          {\r\n          home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n          worth_price: \"60.00\",\r\n          to_uid_name: \"LPQNRDnL0DKdhnbn\"\r\n        }],\r\n      receiveList: [\r\n          {\r\n          home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n          worth_price: \"60.00\",\r\n          to_uid_name: \"LPQNRDnL0DKdhnbn\"\r\n        },{\r\n          home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n          worth_price: \"60.00\",\r\n          to_uid_name: \"LPQNRDnL0DKdhnbn\"\r\n        },{\r\n          home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n          worth_price: \"60.00\",\r\n          to_uid_name: \"LPQNRDnL0DKdhnbn\"\r\n        },{\r\n          home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n          worth_price: \"60.00\",\r\n          to_uid_name: \"LPQNRDnL0DKdhnbn\"\r\n        },{\r\n          home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n          worth_price: \"60.00\",\r\n          to_uid_name: \"LPQNRDnL0DKdhnbn\"\r\n        },{\r\n          home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n          worth_price: \"60.00\",\r\n          to_uid_name: \"LPQNRDnL0DKdhnbn\"\r\n        },{\r\n          home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n          worth_price: \"60.00\",\r\n          to_uid_name: \"LPQNRDnL0DKdhnbn\"\r\n        },],\r\n      // #ifdef MP\r\n      swiperName:'.mutual>>>.mutual_list',\r\n      // #endif\r\n      // #ifndef MP\r\n      swiperName : '.mutual_list',\r\n      // #endif\r\n\r\n    }\r\n  },\r\n  methods: {},\r\n  components:{\r\n    swiperSwitch,\r\n    listContent\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\nuni-page-body{\r\n  height: 100%;\r\n}\r\n\r\n.mutual{\r\n  width: 100%;\r\n  height: 100%;\r\n  background-color: $main-bg;\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/mutualHistory/mutualHistory.vue	(revision cf09c6e1e9ecb362fd78cb7b2a20d14af2da8e20)
+++ pages/mutualHistory/mutualHistory.vue	(date 1603164801060)
@@ -63,7 +63,6 @@
 
     }
   },
-  methods: {},
   components:{
     swiperSwitch,
     listContent
Index: pages/bulkInvoice/bulkInvoice.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"bulk_invoice\">\r\n    <noMoreData v-if=\"!invoiceData.length\"></noMoreData>\r\n    <view v-for=\"(invoice,index) in invoiceData\"\r\n          :key=\"index\"\r\n          v-else\r\n          @click=\"invoiceChange(index)\"\r\n          class=\"invoice_container\">\r\n        <view class=\"invoice_content\">\r\n          <view class=\"img\">\r\n            <image v-if=\"!invoice.check\" src=\"../../static/images_t/bulkInvoice/select_false.png\"></image>\r\n            <image v-else=\"invoice.check\" src=\"../../static/images_t/bulkInvoice/select_true.png\"></image>\r\n          </view>\r\n          <view class=\"info\">\r\n            <text>開票金額：￥{{ invoice.payment_info }}</text>\r\n            <text>訂單號：{{ invoice.id }}</text>\r\n            <text>下單時間：{{ invoice.created_at }}</text>\r\n          </view>\r\n        </view>\r\n    </view>\r\n    <view class=\"invoice_foot\">\r\n      <view class=\"invoice_content\">\r\n        <view @click=\"clickSelectAll\" class=\"select_all\">\r\n          <image v-if=\"!selectAll\" src=\"../../static/images_t/bulkInvoice/select_false.png\"></image>\r\n          <image v-else=\"selectAll\" src=\"../../static/images_t/bulkInvoice/select_true.png\"></image>\r\n          <text>全選</text>\r\n        </view>\r\n        <view class=\"select_count\">\r\n          <text>共￥{{ amount || '' }}</text>\r\n          <text>{{ count || '' }}个订单</text>\r\n        </view>\r\n        <view @click=\"navInvoiceInfo\"\r\n              class=\"next_stop\">\r\n          <text>下壹步</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n    <view class=\"empty\"></view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      invoiceData: [],\r\n      amount:0,\r\n      count:0,\r\n      selectAll:false,\r\n    }\r\n  },\r\n  onLoad(options) {\r\n    console.log(options);\r\n    this.invoiceData = JSON.parse(options.invoice)\r\n  },\r\n  methods: {\r\n    invoiceChange(i) {\r\n      this.$set(this.invoiceData[i], 'check', !this.invoiceData[i].check)\r\n      if(this.invoiceData[i].check){\r\n        this.count++;\r\n        this.amount +=  parseFloat(this.invoiceData[i].payment_info)\r\n        this.orderId.push(this.invoiceData[i].id)\r\n      }else{\r\n        this.count--;\r\n        this.amount -= parseFloat(this.invoiceData[i].payment_info)\r\n        this.orderId.splice(this.orderId.indexOf(this.invoiceData[i].id),1)\r\n      }\r\n      console.log(this.orderId);\r\n    },\r\n\r\n    //点击选择全部\r\n    clickSelectAll(e) {\r\n      this.amount = 0;\r\n      this.count = 0;\r\n      this.orderId = [];\r\n      this.selectAll = !this.selectAll;\r\n      this.invoiceData.forEach((item) => {\r\n        if (this.selectAll) {\r\n          item.check = true;\r\n          this.amount += parseFloat(item.payment_info)\r\n          this.count = this.invoiceData.length;\r\n          this.orderId.push(item.id)\r\n        } else {\r\n          item.check = false;\r\n          this.orderId = [];\r\n        }\r\n      })\r\n      console.log(this.orderId)\r\n    },\r\n\r\n    // 跳转至发票详情页，并传递发票总金额\r\n    navInvoiceInfo() {\r\n      if(this.amount){\r\n        uni.navigateTo({\r\n          url: `/pages/invoiceInfo/invoiceInfo?invoiceAmount=${this.amount}&id=${this.orderId.join(',')}`\r\n        })\r\n      }else{\r\n        this.customToast('沒有選擇訂單',false)\r\n      }\r\n    }\r\n  },\r\n  watch:{\r\n    count(value){\r\n      this.selectAll = value === this.invoiceData.length;\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\r\nimage{\r\n  display: inline-block;\r\n  width: 46rpx;\r\n  height: 46rpx;\r\n  vertical-align: middle;\r\n  margin:  0 $spacing-lg;\r\n}\r\n\r\n.bulk_invoice {\r\n  width: 100%;\r\n  min-height: 100vh;\r\n  background:$main-bg;\r\n\r\n  .empty{\r\n    width: 100%;\r\n    height: 130rpx;\r\n    background: $main-bg;\r\n  }\r\n\r\n  .invoice_container{\r\n    width: 100%;\r\n    padding:$spacing-lg $spacing-base 0 $spacing-base;\r\n    box-sizing: border-box;\r\n\r\n    .invoice_content{\r\n      width: 100%;\r\n      height: 200rpx;\r\n      background-color: #FFFFFF;\r\n      border-radius: 20rpx;\r\n      display: flex;\r\n      align-items: center;\r\n      padding: $spacing-lg 0;\r\n      box-sizing: border-box;\r\n\r\n      .info{\r\n        height: 100%;\r\n        display: flex;\r\n        flex-direction: column;\r\n        justify-content: space-between;\r\n        font-size: $font-size-sm;\r\n        color: $font-color1;\r\n      }\r\n    }\r\n  }\r\n  .invoice_foot{\r\n    width: 750rpx;\r\n    height: 98rpx;\r\n    background: #ffffff;\r\n    position: fixed;\r\n    bottom: 0;\r\n    left: 0;\r\n\r\n    .invoice_content{\r\n      width: 100%;\r\n      height: 100%;\r\n      display: flex;\r\n      flex-direction: row;\r\n      justify-content: space-between;\r\n\r\n      view{\r\n        height: 100%;\r\n        line-height: 98rpx;\r\n      }\r\n      view:nth-child(1){\r\n        font-size: $font-size-sm;\r\n        color: $font-color1;\r\n\r\n        image{\r\n          margin-right: 10rpx;\r\n        }\r\n      }\r\n      view:nth-child(2){\r\n        flex: 1;\r\n        text-align: right;\r\n        line-height: inherit;\r\n        padding: 20rpx $spacing-lg 17rpx 0;\r\n        box-sizing: border-box;\r\n        color: $font-color1;\r\n\r\n        text:nth-child(1){\r\n          font-size: $font-size-sm;\r\n          display: block;\r\n        }\r\n        text:nth-child(2){\r\n          font-size: $font-size-sm - 4rpx;\r\n        }\r\n      }\r\n     .next_stop{\r\n        width: 200rpx;\r\n        line-height: 98rpx;\r\n        text-align: center;\r\n        background: $main-color;\r\n        font-size: $font-size-base;\r\n        color: #FFFFFF;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/bulkInvoice/bulkInvoice.vue	(revision cf09c6e1e9ecb362fd78cb7b2a20d14af2da8e20)
+++ pages/bulkInvoice/bulkInvoice.vue	(date 1603158102079)
@@ -22,7 +22,7 @@
       <view class="invoice_content">
         <view @click="clickSelectAll" class="select_all">
           <image v-if="!selectAll" src="../../static/images_t/bulkInvoice/select_false.png"></image>
-          <image v-else="selectAll" src="../../static/images_t/bulkInvoice/select_true.png"></image>
+          <image v-else src="../../static/images_t/bulkInvoice/select_true.png"></image>
           <text>全選</text>
         </view>
         <view class="select_count">
@@ -51,10 +51,10 @@
     }
   },
   onLoad(options) {
-    console.log(options);
-    this.invoiceData = JSON.parse(options.invoice)
+    this.invoiceData = (JSON.parse(options.invoice) || [])
   },
   methods: {
+    //点击选择单项
     invoiceChange(i) {
       this.$set(this.invoiceData[i], 'check', !this.invoiceData[i].check)
       if(this.invoiceData[i].check){
@@ -66,11 +66,10 @@
         this.amount -= parseFloat(this.invoiceData[i].payment_info)
         this.orderId.splice(this.orderId.indexOf(this.invoiceData[i].id),1)
       }
-      console.log(this.orderId);
     },
 
     //点击选择全部
-    clickSelectAll(e) {
+    clickSelectAll() {
       this.amount = 0;
       this.count = 0;
       this.orderId = [];
Index: components-lk/orderDetail/orderDetail.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n\t<view class=\"order_form_show\">\r\n\t\t<view v-for=\"(order,index) in orderFormData\"\r\n          :key=\"index\"\r\n          class=\"order_form_content\"\r\n          @click=\"orderPayment(order,index)\">\r\n\t\t\t<view class=\"order_shop\">\r\n\t\t\t\t<view class=\"order_receiving\">\r\n\t\t\t\t\t<text>{{order.haul_method}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"order_shop_name\">\r\n\t\t\t\t\t<text>{{order.shop_name}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"order_progress\">\r\n\t\t\t\t\t<text>{{order.pay_status}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"order_goods_container\">\r\n\t\t\t\t<view v-for=\"(goods,goodsIndex) in (order.goods_data)\"\r\n              :key=\"goodsIndex\"\r\n              class=\"order_goods\">\r\n\t\t\t\t\t<view class=\"goods_img\">\r\n\t\t\t\t\t\t<image :src=\"imgSrc + goods.home_avatar\"></image>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"goods_description\">\r\n\t\t\t\t\t\t<view class=\"goods_name\">\r\n\t\t\t\t\t\t\t<text>{{goods.goods_name}}</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view v-if=\"!goods.tableware\" class=\"goods_feature\">\r\n\t\t\t\t\t\t\t<text class=\"goods_straw\">{{goods.norm}},</text>\r\n<!--\t\t\t\t\t\t\t<text class=\"goods_type\">{{goods.type}},</text>-->\r\n<!--\t\t\t\t\t\t\t<text class=\"goods_size\">{{goods.size}},</text>-->\r\n<!--\t\t\t\t\t\t\t<text class=\"goods_sugar\">{{goods.sugar}}</text>-->\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view v-else class=\"goods_tableware\">\r\n\t\t\t\t\t\t\t<text>{{goods.tableware}}</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"single_count\">\r\n\t\t\t\t\t\t<text>x {{goods.goods_num}}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"order_goods_foot\">\r\n\t\t\t\t\t<view class=\"order_goods_date\">\r\n\t\t\t\t\t\t<text>{{order.created_at}}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"order_goods_amount\">\r\n\t\t\t\t\t\t<text>共{{order.goods_data.length}}件商品 合計：{{order.payment_info}}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\texport default {\r\n\t  data(){\r\n\t    return {\r\n\t      orderAmount:0\r\n      }\r\n    },\r\n\t\tprops: {\r\n\t\t\torderFormData: {\r\n\t\t\t\ttype: Array,\r\n\t\t\t\trequired: true\r\n\t\t\t}\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\tconsole.log(this.orderFormData)\r\n\t\t},\r\n    methods:{\r\n\t    /*\r\n\t    * 跳转至订单支付页，已经支付过的订单不做处理\r\n\t    * */\r\n\t    orderPayment(order,index){\r\n        if(order.pay_status === '待支付'){\r\n          this.$emit('order-click',{order,index})\r\n        }\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t.order_form_show {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tbox-sizing: border-box;\r\n\t\tbackground-color: $main-bg;\r\n\t\twidth: 100%;\r\n\r\n\t\t.order_form_content {\r\n\t\t\twidth: 702rpx;\r\n\t\t\tmin-height: 335rpx;\r\n\t\t\tbackground: #ffffff;\r\n\t\t\tborder-radius: 20rpx;\r\n\t\t\tpadding:0 $spacing-lg;\r\n\t\t\tbox-sizing: border-box;\r\n\t\t\tmargin-top: $spacing-lg;\r\n\t\t}\r\n\r\n\t\t.order_shop {\r\n\t\t\twidth: 100%;\r\n\t\t\theight: 95rpx;\r\n\t\t\tbox-sizing: border-box;\r\n\t\t\tborder-bottom: 1rpx solid #ccc;\r\n\t\t\tdisplay: flex;\r\n\t\t\tfont-size: $font-size-sm;\r\n\t\t\tposition: relative;\r\n\t\t\tfont-weight: $font-weight-base;\r\n\r\n\t\t\tview {\r\n\t\t\t\tline-height: 95rpx;\r\n\t\t\t}\r\n\r\n\t\t\t.order_shop_name {\r\n\t\t\t\twidth: 364rpx;\r\n\t\t\t\tcolor: $font-color1;\r\n\t\t\t\tmargin-left: 20rpx;\r\n\t\t\t\toverflow: hidden;\r\n\t\t\t\twhite-space: nowrap;\r\n\t\t\t\ttext-overflow: ellipsis;\r\n\t\t\t}\r\n\r\n\t\t\t.order_progress {\r\n\t\t\t\tcolor: $font-color3;\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tright: 0;\r\n\t\t\t}\r\n\r\n\t\t\t.order_receiving {\r\n\t\t\t\twidth: 74rpx;\r\n\t\t\t\theight: 34rpx;\r\n\t\t\t\tline-height: 34rpx;\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tbackground: $main-color;\r\n\t\t\t\tborder-radius: 6rpx;\r\n\t\t\t\talign-self: center;\r\n\t\t\t\tfont-size: $font-size-sm - 2rpx;\r\n\t\t\t\tcolor: #ffffff;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.order_goods_container {\r\n\t\t\tpadding: $spacing-lg 0;\r\n\t\t\tbox-sizing: border-box;\r\n\t\t\tfont-weight: $font-weight-base;\r\n\t\t\tcolor: $font-color3;\r\n\r\n\t\t\t.order_goods {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tmargin-bottom: $spacing-lg;\r\n\r\n\t\t\t\t.goods_description {\r\n\t\t\t\t\tflex-grow: 1;\r\n\t\t\t\t\tmargin-left: 20rpx;\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\tflex-direction: column;\r\n\t\t\t\t\tfont-size: $font-size-sm - 2rpx;\r\n\t\t\t\t\tfont-weight: $font-weight-base;\r\n\t\t\t\t\tcolor: $font-color3;\r\n\r\n\r\n\t\t\t\t\t.goods_name {\r\n\t\t\t\t\t\theight: 40rpx;\r\n\t\t\t\t\t\tline-height: 40rpx;\r\n\t\t\t\t\t\tfont-size: $font-size-base;\r\n\t\t\t\t\t\tcolor: $font-color1;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t.goods_feature {\r\n\t\t\t\t\t\tfont-size: $font-size-sm - 2rpx;\r\n\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\tflex-wrap: wrap;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.goods_img {\r\n\t\t\t\t\tflex-shrink: 0;\r\n\t\t\t\t\twidth: 120rpx;\r\n\t\t\t\t\theight: 120rpx;\r\n\t\t\t\t\tvertical-align: middle;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.single_count {\r\n\t\t\t\t\twidth: 130rpx;\r\n\t\t\t\t\tfont-size: $font-size-sm;\r\n\t\t\t\t\tcolor: $font-color3;\r\n\t\t\t\t\ttext-align: right;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.order_goods_foot {\r\n\t\t\twidth: 100%;\r\n\t\t\tbox-sizing: border-box;\r\n\t\t\tdisplay: flex;\r\n\t\t\tjustify-content: space-between;\r\n\r\n\t\t\t.order_goods_date {\r\n\t\t\t\tfont-size: $font-size-sm - 4rpx\r\n\t\t\t}\r\n\r\n\t\t\t.order_goods_amount {\r\n\t\t\t\tfont-size: $font-size-sm;\r\n\t\t\t\tcolor: $font-color1;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- components-lk/orderDetail/orderDetail.vue	(revision cf09c6e1e9ecb362fd78cb7b2a20d14af2da8e20)
+++ components-lk/orderDetail/orderDetail.vue	(date 1603173665466)
@@ -27,7 +27,7 @@
 							<text>{{goods.goods_name}}</text>
 						</view>
 						<view v-if="!goods.tableware" class="goods_feature">
-							<text class="goods_straw">{{goods.norm}},</text>
+							<text class="goods_straw">{{goods.norm}}</text>
 <!--							<text class="goods_type">{{goods.type}},</text>-->
 <!--							<text class="goods_size">{{goods.size}},</text>-->
 <!--							<text class="goods_sugar">{{goods.sugar}}</text>-->
