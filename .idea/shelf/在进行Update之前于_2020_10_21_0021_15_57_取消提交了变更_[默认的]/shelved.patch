Index: App.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><script>\r\nexport default {\r\n  globalData: {\r\n    goodsPayment: {},//訂單信息，訂單頁修改，結算頁獲取\r\n    coupon: 0,//使用的優惠券信息\r\n    userToken: null,//用戶token\r\n    isLoginBox:true,\r\n    userInfo: {},//用户基本信息\r\n    userAddresses: [],//用户收货地址\r\n    edit_address_id: {},//当前编辑的收货地址id\r\n    choosed_address: {},//用户选择的地址\r\n  },\r\n  onLaunch: function () {\r\n    // TODO 生產環境取消注釋L\r\n    this.globalData.userToken = uni.getStorageSync('token')\r\n    console.log('App Launch');\r\n  },\r\n  onShow: function () {\r\n    console.log('App Show');\r\n  },\r\n  onHide: function () {\r\n    console.log('App Hide');\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n/* 解决头条小程序组件内引入字体不生效的问题 */\r\n/* #ifdef MP-TOUTIAO */\r\n@font-face {\r\n  font-family: uniicons;\r\n  src: url('/static/uni.ttf');\r\n}\r\n\r\n/* #endif */\r\n.page {\r\n  position: absolute;\r\n  top: 0;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  display: flex;\r\n  flex-direction: column;\r\n  font-family: 'PingFang SC', 'Microsoft Yahei';\r\n}\r\n\r\n.container {\r\n  width: 702 rpx;\r\n  height: 100%;\r\n  margin: 0 auto;\r\n  box-sizing: border-box;\r\n}\r\n\r\nimage {\r\n  width: 100%;\r\n  height: 100%;\r\n  display: block;\r\n}\r\n\r\n/* #ifdef APP-PLUS ||MP-WEIXIN */\r\n\r\npage {\r\n  height: 100%;\r\n}\r\n\r\ncheckbox .wx-checkbox-input {\r\n  width: 42 rpx !important;\r\n  height: 42 rpx !important;\r\n  border-radius: 50%;\r\n}\r\n\r\ncheckbox .wx-checkbox-input.wx-checkbox-input-checked {\r\n  width: 46 rpx !important;\r\n  height: 46 rpx !important;\r\n  border-radius: 50%;\r\n  background: #17A1FF;\r\n  color: #fff !important;\r\n  border: none;\r\n}\r\n\r\nradio .wx-radio-input {\r\n  width: 34 rpx !important;\r\n  height: 34 rpx !important;\r\n  padding: 0 !important;\r\n}\r\n\r\nprogress .wx-progress-bar {\r\n  height: 30 rpx !important;\r\n  border-radius: 15 rpx !important;\r\n}\r\n\r\nprogress .wx-progress-inner-bar {\r\n  border-radius: 15 rpx !important;\r\n}\r\n\r\n/* #endif */\r\n.align-items-center {\r\n  align-items: center;\r\n}\r\n\r\n.d-flex {\r\n  display: flex;\r\n}\r\n\r\nuni-page-body, uni-view, uni-scroll-view, uni-text, uni-image, uni-textarea, uni-button, uni-swiper, uni-swiper-item, uni-input {\r\n  box-sizing: border-box;\r\n}\r\n\r\nbutton {\r\n  font-size: 26 rpx;\r\n  border-radius: 4 rpx;\r\n  margin: 0;\r\n\r\n  &:after {\r\n    border: 0;\r\n  }\r\n\r\n  &[type='primary'] {\r\n    background-color: $main-color;\r\n\r\n    &[plain] {\r\n      background-color: #FFFFFF;\r\n      border: 2 rpx solid $main-color;;\r\n      color: $main-color;\r\n    }\r\n\r\n    &.button-hover {\r\n      background-color: rgba($color: $main-color, $alpha: 0.6);\r\n    }\r\n  }\r\n\r\n}\r\n</style>\r\n\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- App.vue	(revision a6175d8333c8e25bf1fa5f6fd86a4a31565b5d4d)
+++ App.vue	(date 1603262396542)
@@ -1,26 +1,26 @@
 <script>
 export default {
   globalData: {
-    goodsPayment: {},//訂單信息，訂單頁修改，結算頁獲取
-    coupon: 0,//使用的優惠券信息
-    userToken: null,//用戶token
-    isLoginBox:true,
-    userInfo: {},//用户基本信息
-    userAddresses: [],//用户收货地址
-    edit_address_id: {},//当前编辑的收货地址id
-    choosed_address: {},//用户选择的地址
+    goodsPayment: {}, //订单的结算信息
+    coupon: 0, //使用的優惠券信息
+    userToken: null, //用戶token
+    isLoginBox: true, //用户登录引导框
+    userInfo: {}, //用户基本信息
+    userAddresses: [], //用户收货地址
+    edit_address_id: {}, //当前编辑的收货地址id
+    choosed_address: {}, //用户选择的地址
   },
   onLaunch: function () {
-    // TODO 生產環境取消注釋L
-    this.globalData.userToken = uni.getStorageSync('token')
-    console.log('App Launch');
+    //应用初次启动时从缓存中读取用户token
+    this.globalData.userToken = uni.getStorageSync("token");
+    console.log("App Launch");
   },
   onShow: function () {
-    console.log('App Show');
+    console.log("App Show");
   },
   onHide: function () {
-    console.log('App Hide');
-  }
+    console.log("App Hide");
+  },
 };
 </script>
 
@@ -45,7 +45,7 @@
 }
 
 .container {
-  width: 702 rpx;
+  width: 702rpx;
   height: 100%;
   margin: 0 auto;
   box-sizing: border-box;
@@ -64,14 +64,14 @@
 }
 
 checkbox .wx-checkbox-input {
-  width: 42 rpx !important;
-  height: 42 rpx !important;
+  width: 42rpx !important;
+  height: 42rpx !important;
   border-radius: 50%;
 }
 
 checkbox .wx-checkbox-input.wx-checkbox-input-checked {
-  width: 46 rpx !important;
-  height: 46 rpx !important;
+  width: 46rpx !important;
+  height: 46rpx !important;
   border-radius: 50%;
   background: #17A1FF;
   color: #fff !important;
@@ -79,23 +79,23 @@
 }
 
 radio .wx-radio-input {
-  width: 34 rpx !important;
-  height: 34 rpx !important;
+  width: 34rpx !important;
+  height: 34rpx !important;
   padding: 0 !important;
 }
 
 progress .wx-progress-bar {
-  height: 30 rpx !important;
-  border-radius: 15 rpx !important;
+  height: 30rpx !important;
+  border-radius: 15rpx !important;
 }
 
 progress .wx-progress-inner-bar {
-  border-radius: 15 rpx !important;
+  border-radius: 15rpx !important;
 }
 
 /* #endif */
 .align-items-center {
-  align-items: center;
+  align-items:center;
 }
 
 .d-flex {
@@ -107,8 +107,8 @@
 }
 
 button {
-  font-size: 26 rpx;
-  border-radius: 4 rpx;
+  font-size: 26rpx;
+  border-radius: 4rpx;
   margin: 0;
 
   &:after {
@@ -120,7 +120,7 @@
 
     &[plain] {
       background-color: #FFFFFF;
-      border: 2 rpx solid $main-color;;
+      border: 2rpx solid $main-color;;
       color: $main-color;
     }
 
@@ -130,5 +130,4 @@
   }
 
 }
-</style>
-
+</style>
\ No newline at end of file
Index: request/api.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>const ajax = require('./ajax')\r\n\r\n//true是请求时携带token，false为不携带\r\n\r\n//致用戶\r\nexport const tolk = (data)=>ajax('/config/talk',data,'post')\r\n//订单详情\r\nexport const orderForm = (data) => ajax('/user/order', data, 'post', 1)\r\n//开发票\r\nexport const invoice = (data) => ajax('/invoice-apply/create-apply', data, 'post', 1)\r\n//发送验证码\r\nexport const sendCheckCode = (data) => ajax('/sms/login-sms', data, 'post')\r\n//效验验证码\r\nexport const verifyCode = (data) => ajax('/sms/verify-sms', data, 'post')\r\n//登录&注册\r\nexport const login = (data) => ajax('/login/login', data, 'post')\r\n//积分商城\r\nexport const convert = (data) => ajax('/convert/list', data, 'post', 1)\r\n//积分明细\r\nexport const pointsDetails = (data) => ajax('/record/integral-notes', data, 'post', 1)\r\n//积分兑换记录\r\nexport const exchangeRecord = (data) => ajax('/integral/convert-record', data, 'post', 1)\r\n//積分商品詳情\r\nexport const pointsGoodsDetail = (data) => ajax('/convert/detail', data, 'post', 1)\r\n//積分兌換禮品\r\nexport const redeemGifts = (data) => ajax('/convert/convert', data, 'post', 1)\r\n//用户信息\r\nexport const userSpace = (data) => ajax('/user/user-info', data, 'post', 1)\r\n//开通会员\r\nexport const joinMember = (data) => ajax('/pay/service', data, 'post',1)\r\n//全部优惠券\r\nexport const discount = (data) => ajax('/ticket/tickets', data, 'post', 1)\r\n//设置交易密码\r\nexport const setPwd = (data) => ajax('/user/setpwd', data, 'post', 1)\r\n//钱包余额消费记录\r\nexport const expensesRecord = (data) => ajax('/record/balance-notes', data, 'post', 1)\r\n//会员二维码\r\nexport const qrCode = (data) => ajax('/qr-code/user-code', data, 'post', 1)\r\n//充值钱包\r\nexport const recharge = (data) => ajax('/pay/recharge', data, 'post', 1)\r\n\r\n//会员等级礼包\r\nexport const levelPack = (data)=>ajax('/grade/park-list',data,'post',1)\r\n//领取等级礼包\r\nexport const receiveLevel = (data)=>ajax('/grade/receive-park',data,'post',1)\r\n//会员月度礼包\r\nexport const monthPack = (data) => ajax('/month/park-list', data, 'post', 1)\r\n//领取月度礼包\r\nexport const receivePack = (data) => ajax('/month/receive-park', data, 'post', 1)\r\n//会员等阶礼包\r\nexport const interestsPark = (data) => ajax('/interests/park-list', data, 'post', 1)\r\n//领取会员等阶礼包\r\nexport const receiveKnight = (data) => ajax('', data, 'post', 1)\r\n//會員購買記錄\r\nexport const rechargeRecord = (data)=>ajax('/record/service-notes',data,'post',1)\r\n\r\n//消息中心\r\nexport const msgCenter = (data) => ajax('/msg-center/list', data, 'post', 1)\r\n//获取会员充值等阶信息（金额 & 有效时间）\r\nexport const memberRechargeInfo = (data) => ajax('/config/recharge-level', data, 'post', 1)\r\n\r\n//訂單結算附加服務\r\nexport const paymentAttach = (data) => ajax('/config/attach', data, 'post')\r\n//創建訂單\r\nexport const createOrder = (data) => ajax('/order/create-order', data, 'post', 1)\r\n//發起支付\r\nexport const paymentStart = (data) => ajax('/pay/pay', data, 'post', 1)\r\n//訂單可用優惠券\r\nexport const usedCoupon = (data) => ajax('/ticket/suit-tickets', data, 'post', 1)\r\n\r\n//初始化聊天室\r\nexport const initChat = (data) => ajax('/dialog/init-dialog', data, 'post', 1)\r\n//發送消息\r\nexport const sendMsg = (data) => ajax('/dialog/send-msg', data, 'post', 1)\r\n//接受消息\r\nexport const receiveMsg = (data) => ajax('/dialog/latest-dialog', data, 'post', 1)\r\n\r\n//奶茶有礼列表\r\nexport const milkList = (data) => ajax('/foreseeList-card/list', data, 'post', 1)\r\n//我的卡片\r\nexport const myForesee = (data) => ajax('/foreseeList-card/my-card', data, 'post', 1)\r\n//购买卡片\r\nexport const buyForesee = (data) => ajax('/foreseeList-card/pay-card', data, 'post', 1)\r\n//收送记录\r\nexport const mutualRecord = (data) => ajax('/foreseeList-card/my-gift', data, 'post', 1)\r\n//贈送預付卡\r\nexport const giveForesee = (data)=>ajax('/foresee-card/handsel-gift',data,'post',1)
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- request/api.js	(revision a6175d8333c8e25bf1fa5f6fd86a4a31565b5d4d)
+++ request/api.js	(date 1603249891839)
@@ -1,87 +1,87 @@
 const ajax = require('./ajax')
 
-//true是请求时携带token，false为不携带
+//true是请求时携带Token，false为不携带
 
 //致用戶
-export const tolk = (data)=>ajax('/config/talk',data,'post')
+export const tolk = (data)=>ajax('/config/talk',{data,isToken:false})
 //订单详情
-export const orderForm = (data) => ajax('/user/order', data, 'post', 1)
+export const orderForm = (data) => ajax('/user/order',{data})
 //开发票
-export const invoice = (data) => ajax('/invoice-apply/create-apply', data, 'post', 1)
+export const invoice = (data) => ajax('/invoice-apply/create-apply',{data})
 //发送验证码
-export const sendCheckCode = (data) => ajax('/sms/login-sms', data, 'post')
+export const sendCheckCode = (data) => ajax('/sms/login-sms',{data,isToken:false})
 //效验验证码
-export const verifyCode = (data) => ajax('/sms/verify-sms', data, 'post')
+export const verifyCode = (data) => ajax('/sms/verify-sms',{data,isToken:false})
 //登录&注册
-export const login = (data) => ajax('/login/login', data, 'post')
+export const login = (data) => ajax('/login/login', {data,isToken:false})
 //积分商城
-export const convert = (data) => ajax('/convert/list', data, 'post', 1)
+export const convert = (data) => ajax('/convert/list',{data})
 //积分明细
-export const pointsDetails = (data) => ajax('/record/integral-notes', data, 'post', 1)
+export const pointsDetails = (data) => ajax('/record/integral-notes',{data})
 //积分兑换记录
-export const exchangeRecord = (data) => ajax('/integral/convert-record', data, 'post', 1)
+export const exchangeRecord = (data) => ajax('/integral/convert-record', {data})
 //積分商品詳情
-export const pointsGoodsDetail = (data) => ajax('/convert/detail', data, 'post', 1)
+export const pointsGoodsDetail = (data) => ajax('/convert/detail',{data})
 //積分兌換禮品
-export const redeemGifts = (data) => ajax('/convert/convert', data, 'post', 1)
+export const redeemGifts = (data) => ajax('/convert/convert', {data})
 //用户信息
-export const userSpace = (data) => ajax('/user/user-info', data, 'post', 1)
+export const userSpace = (data) => ajax('/user/user-info', {data})
 //开通会员
-export const joinMember = (data) => ajax('/pay/service', data, 'post',1)
+export const joinMember = (data) => ajax('/pay/service', {data})
 //全部优惠券
-export const discount = (data) => ajax('/ticket/tickets', data, 'post', 1)
+export const discount = (data) => ajax('/ticket/tickets',{data})
 //设置交易密码
-export const setPwd = (data) => ajax('/user/setpwd', data, 'post', 1)
+export const setPwd = (data) => ajax('/user/setpwd', {data})
 //钱包余额消费记录
-export const expensesRecord = (data) => ajax('/record/balance-notes', data, 'post', 1)
+export const expensesRecord = (data) => ajax('/record/balance-notes',{data})
 //会员二维码
-export const qrCode = (data) => ajax('/qr-code/user-code', data, 'post', 1)
+export const qrCode = (data) => ajax('/qr-code/user-code', {data})
 //充值钱包
-export const recharge = (data) => ajax('/pay/recharge', data, 'post', 1)
+export const recharge = (data) => ajax('/pay/recharge', {data})
 
 //会员等级礼包
-export const levelPack = (data)=>ajax('/grade/park-list',data,'post',1)
+export const levelPack = (data)=>ajax('/grade/park-list',{data})
 //领取等级礼包
-export const receiveLevel = (data)=>ajax('/grade/receive-park',data,'post',1)
+export const receiveLevel = (data)=>ajax('/grade/receive-park',{data})
 //会员月度礼包
-export const monthPack = (data) => ajax('/month/park-list', data, 'post', 1)
+export const monthPack = (data) => ajax('/month/park-list', {data})
 //领取月度礼包
-export const receivePack = (data) => ajax('/month/receive-park', data, 'post', 1)
+export const receivePack = (data) => ajax('/month/receive-park',{data})
 //会员等阶礼包
-export const interestsPark = (data) => ajax('/interests/park-list', data, 'post', 1)
+export const interestsPark = (data) => ajax('/interests/park-list', {data})
 //领取会员等阶礼包
-export const receiveKnight = (data) => ajax('', data, 'post', 1)
+export const receiveKnight = (data) => ajax('/interests/receive-park', {data})
 //會員購買記錄
-export const rechargeRecord = (data)=>ajax('/record/service-notes',data,'post',1)
+export const rechargeRecord = (data)=>ajax('/record/service-notes',{data})
 
 //消息中心
-export const msgCenter = (data) => ajax('/msg-center/list', data, 'post', 1)
+export const msgCenter = (data) => ajax('/msg-center/list', {data})
 //获取会员充值等阶信息（金额 & 有效时间）
-export const memberRechargeInfo = (data) => ajax('/config/recharge-level', data, 'post', 1)
+export const memberRechargeInfo = (data) => ajax('/config/recharge-level',{data})
 
 //訂單結算附加服務
-export const paymentAttach = (data) => ajax('/config/attach', data, 'post')
+export const paymentAttach = (data) => ajax('/config/attach',{data,isToken:false})
 //創建訂單
-export const createOrder = (data) => ajax('/order/create-order', data, 'post', 1)
+export const createOrder = (data) => ajax('/order/create-order',{data})
 //發起支付
-export const paymentStart = (data) => ajax('/pay/pay', data, 'post', 1)
+export const paymentStart = (data) => ajax('/pay/pay', {data})
 //訂單可用優惠券
-export const usedCoupon = (data) => ajax('/ticket/suit-tickets', data, 'post', 1)
+export const usedCoupon = (data) => ajax('/ticket/suit-tickets', {data})
 
 //初始化聊天室
-export const initChat = (data) => ajax('/dialog/init-dialog', data, 'post', 1)
+export const initChat = (data) => ajax('/dialog/init-dialog', {data})
 //發送消息
-export const sendMsg = (data) => ajax('/dialog/send-msg', data, 'post', 1)
+export const sendMsg = (data) => ajax('/dialog/send-msg', {data})
 //接受消息
-export const receiveMsg = (data) => ajax('/dialog/latest-dialog', data, 'post', 1)
+export const receiveMsg = (data) => ajax('/dialog/latest-dialog',{data})
 
 //奶茶有礼列表
-export const milkList = (data) => ajax('/foreseeList-card/list', data, 'post', 1)
+export const milkList = (data) => ajax('/foreseeList-card/list', {data})
 //我的卡片
-export const myForesee = (data) => ajax('/foreseeList-card/my-card', data, 'post', 1)
+export const myForesee = (data) => ajax('/foreseeList-card/my-card',{data})
 //购买卡片
-export const buyForesee = (data) => ajax('/foreseeList-card/pay-card', data, 'post', 1)
+export const buyForesee = (data) => ajax('/foreseeList-card/pay-card',{data})
 //收送记录
-export const mutualRecord = (data) => ajax('/foreseeList-card/my-gift', data, 'post', 1)
+export const mutualRecord = (data) => ajax('/foreseeList-card/my-gift', {data})
 //贈送預付卡
-export const giveForesee = (data)=>ajax('/foresee-card/handsel-gift',data,'post',1)
\ No newline at end of file
+export const giveForesee = (data)=>ajax('/foresee-card/handsel-gift',{data})
\ No newline at end of file
Index: request/ajax.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>/*\r\n * 简易封装模拟测试请求\r\n * */\r\nfunction ajax(url, data = {}, method = 'GET', h) {\r\n  // TODO 生产环境需要替换默认的URL地址\r\n\r\n  let header = {};\r\n\r\n  h && (header['token'] = getApp().globalData.userToken)\r\n\r\n  header['Content-Type'] = 'application/x-www-form-urlencoded'\r\n  let baseURL;\r\n  // #ifdef H5\r\n  baseURL = '/api'\r\n  // #endif\r\n  // #ifndef H5\r\n  baseURL = 'http://api.plg.wugee.net/'\r\n  // #endif\r\n  return new Promise((resolve, reject) => {\r\n    uni.request({\r\n      url: baseURL + url,\r\n      data,\r\n      method,\r\n      header,\r\n      success(result) {\r\n        // TODO token错误\r\n        if (result.statusCode !== 200 || result.data.code === 1001) {\r\n          tokenError(h, result, reject)\r\n          return;\r\n        }\r\n        resolve(result.data)\r\n      },\r\n      fail(err) {\r\n        console.log('请求出错', err.data);\r\n        reject(err)\r\n      }\r\n    })\r\n  })\r\n}\r\n\r\n//本地存在token，并且请求的数据需要token！但错误信息为token错误时触发\r\nfunction tokenError(h, result, reject) {\r\n  let token = uni.getStorageSync('token')\r\n  console.log(token);\r\n  if (token && (h && result.data.msg === 'Token Error')) {\r\n    uni.showModal({\r\n      title: '登陆状态失效!\\n请重新登陆',\r\n      success(res) {\r\n        //点击确定跳转登录页\r\n        if (res.confirm) {\r\n          uni.navigateTo({\r\n            url: '/pages/login/login',\r\n          })\r\n          return;\r\n        }\r\n        //点击取消，抛出错误\r\n        reject(result)\r\n      },\r\n    })\r\n  } else {\r\n    //正常错误直接抛出\r\n    reject(result)\r\n  }\r\n}\r\n\r\nmodule.exports = ajax\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- request/ajax.js	(revision a6175d8333c8e25bf1fa5f6fd86a4a31565b5d4d)
+++ request/ajax.js	(date 1603249824524)
@@ -1,12 +1,13 @@
 /*
  * 简易封装模拟测试请求
  * */
-function ajax(url, data = {}, method = 'GET', h) {
+function ajax(url, {data={},method='POST',isToken=true}) {
+
   // TODO 生产环境需要替换默认的URL地址
 
   let header = {};
 
-  h && (header['token'] = getApp().globalData.userToken)
+  isToken && (header['token'] = getApp().globalData.userToken)
 
   header['Content-Type'] = 'application/x-www-form-urlencoded'
   let baseURL;
@@ -25,7 +26,7 @@
       success(result) {
         // TODO token错误
         if (result.statusCode !== 200 || result.data.code === 1001) {
-          tokenError(h, result, reject)
+          tokenError(isToken, result, reject)
           return;
         }
         resolve(result.data)
Index: request/api_y.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>const ajax = require('./ajax')\r\n\r\n//門店列表\r\nexport const shops_list = (data) => ajax('/shop/shop-list', data, 'post', 0)\r\n//門店詳情\r\nexport const shops_detail = (data) => ajax('/shop/shop-detail', data, 'post', 0)\r\n//商品列表\r\nexport const goods_list = (data) => ajax('/goods/list', data, 'post', 0)\r\n//商品詳情\r\nexport const goods_detail = (data) => ajax('/goods/details', data, 'post', 0)\r\n\r\n\r\n//新建拼單\r\nexport const pintuan_creat = (data) => ajax('/merger-team/create-team', data, 'post', 1)\r\n//團隊點單\r\nexport const pintuan_order = (data) => ajax('/merger-team/merger-order', data, 'post', 1)\r\n//邀請成員\r\nexport const pintuan_invite = (data) => ajax('/merger-team/join-team', data, 'post', 1)\r\n//邀請成員二维码\r\nexport const pintuan_invite_code = (data) => ajax('/qr-code/invite-code', data, 'post', 1)\r\n//拼團鎖定\r\nexport const pintuan_lock = (data) => ajax('/merger-team/lock-team', data, 'post', 1)\r\n//拼團解鎖\r\nexport const pintuan_unlock = (data) => ajax('/merger-team/unlock-team', data, 'post', 1)\r\n//組團詳情\r\nexport const pintuan_detail = (data) => ajax('/merger-team/merger-detail', data, 'post', 1)\r\n//取消拼團\r\nexport const pintuan_cancel = (data) => ajax('/merger-team/cancel-team', data, 'post', 1)\r\n\r\n\r\n//地址列表\r\nexport const userAddresses = (data) => ajax('/address/list', data, 'post', 1)\r\n//添加地址\r\nexport const address_add = (data) => ajax('/address/increase', data, 'post', 1)\r\n//修改地址\r\nexport const address_edit = (data) => ajax('/address/modify', data, 'post', 1)\r\n//刪除地址\r\nexport const address_delete = (data) => ajax('/address/delete', data, 'post', 1)\r\n\r\n\r\n//首页轮播图和logo\r\nexport const home_images = (data) => ajax('/config/poster', data, 'post', 0)
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- request/api_y.js	(revision a6175d8333c8e25bf1fa5f6fd86a4a31565b5d4d)
+++ request/api_y.js	(date 1603251037964)
@@ -1,42 +1,42 @@
 const ajax = require('./ajax')
 
 //門店列表
-export const shops_list = (data) => ajax('/shop/shop-list', data, 'post', 0)
+export const shops_list = (data) => ajax('/shop/shop-list', {data, isToken: false})
 //門店詳情
-export const shops_detail = (data) => ajax('/shop/shop-detail', data, 'post', 0)
+export const shops_detail = (data) => ajax('/shop/shop-detail', {data, isToken: false})
 //商品列表
-export const goods_list = (data) => ajax('/goods/list', data, 'post', 0)
+export const goods_list = (data) => ajax('/goods/list', {data, isToken: false})
 //商品詳情
-export const goods_detail = (data) => ajax('/goods/details', data, 'post', 0)
+export const goods_detail = (data) => ajax('/goods/details', {data, isToken: false})
 
 
 //新建拼單
-export const pintuan_creat = (data) => ajax('/merger-team/create-team', data, 'post', 1)
+export const pintuan_creat = (data) => ajax('/merger-team/create-team', {data})
 //團隊點單
-export const pintuan_order = (data) => ajax('/merger-team/merger-order', data, 'post', 1)
+export const pintuan_order = (data) => ajax('/merger-team/merger-order', {data})
 //邀請成員
-export const pintuan_invite = (data) => ajax('/merger-team/join-team', data, 'post', 1)
+export const pintuan_invite = (data) => ajax('/merger-team/join-team', {data})
 //邀請成員二维码
-export const pintuan_invite_code = (data) => ajax('/qr-code/invite-code', data, 'post', 1)
+export const pintuan_invite_code = (data) => ajax('/qr-code/invite-code', {data})
 //拼團鎖定
-export const pintuan_lock = (data) => ajax('/merger-team/lock-team', data, 'post', 1)
+export const pintuan_lock = (data) => ajax('/merger-team/lock-team', {data})
 //拼團解鎖
-export const pintuan_unlock = (data) => ajax('/merger-team/unlock-team', data, 'post', 1)
+export const pintuan_unlock = (data) => ajax('/merger-team/unlock-team', {data})
 //組團詳情
-export const pintuan_detail = (data) => ajax('/merger-team/merger-detail', data, 'post', 1)
+export const pintuan_detail = (data) => ajax('/merger-team/merger-detail', {data})
 //取消拼團
-export const pintuan_cancel = (data) => ajax('/merger-team/cancel-team', data, 'post', 1)
+export const pintuan_cancel = (data) => ajax('/merger-team/cancel-team', {data})
 
 
 //地址列表
-export const userAddresses = (data) => ajax('/address/list', data, 'post', 1)
+export const userAddresses = (data) => ajax('/address/list', {data})
 //添加地址
-export const address_add = (data) => ajax('/address/increase', data, 'post', 1)
+export const address_add = (data) => ajax('/address/increase', {data})
 //修改地址
-export const address_edit = (data) => ajax('/address/modify', data, 'post', 1)
+export const address_edit = (data) => ajax('/address/modify', {data})
 //刪除地址
-export const address_delete = (data) => ajax('/address/delete', data, 'post', 1)
+export const address_delete = (data) => ajax('/address/delete', {data})
 
 
 //首页轮播图和logo
-export const home_images = (data) => ajax('/config/poster', data, 'post', 0)
\ No newline at end of file
+export const home_images = (data) => ajax('/config/poster', {data, isToken: false})
\ No newline at end of file
Index: pages/foreseeDetails/foreseeDetails.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"foresee\">\r\n    <view class=\"head\">\r\n      <!-- TODO 替換圖片鏈接 foreseeList.worth_price-->\r\n      <image :src=\"'../../static/images_t/milkTeaGift/img.png'\"></image>\r\n    </view>\r\n    <view class=\"foresee_content\">\r\n      <view class=\"foresee_name\">{{ foresee.card_name }}</view>\r\n      <view class=\"fac_value\">\r\n        <text>選擇面額：</text>\r\n        <text>￥{{ foresee.worth_price }}</text>\r\n      </view>\r\n      <!--溫馨提示-->\r\n      <view class=\"point\">\r\n        <view class=\"tips\">\r\n          <text class=\"title\">溫馨提示：</text>\r\n          <text class=\"content\">1、成功購買奶茶有禮電子卡後，可在【我的】-【奶茶有禮】-【我的奶茶有禮】中查看卡片以及好友贈送\r\n            2、“奶茶有禮電子卡”儘通過官方運營的小程序進行售賣。如果您發現任何第三方以折扣、優惠或購物卡形式售賣“奶茶有禮電子卡”，請您務必提高警惕避免上當受騙\r\n          </text>\r\n        </view>\r\n        <view class=\"notice\">\r\n          <text class=\"title\">購買須知：</text>\r\n          <text class=\"content\">購買即視為閱讀併同意</text>\r\n          <text class=\"special\">《使用須知》</text>\r\n          <text class=\"special\">《奶茶商業預付卡章程》</text>\r\n        </view>\r\n      </view>\r\n      <!--支付按鈕-->\r\n      <view @click=\"buy\" class=\"btn\">\r\n        <button plain>確認支付￥{{ foresee.worth_price }}</button>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport {buyForesee} from \"../../request/api\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      foresee:{}\r\n    }\r\n  },\r\n  onLoad(options){\r\n    this.foresee = JSON.parse(decodeURIComponent(options.foresee))\r\n  },\r\n  methods: {\r\n    async buy(){\r\n      uni.showLoading({title:'购买中'})\r\n      let self = this;\r\n      try{\r\n        //请求预支付信息\r\n        let orderInfo = (await buyForesee({card_id:self.foresee.id})).data;\r\n        self.utilPayment(orderInfo)\r\n        self.customToast('购买成功')\r\n      }catch (e) {\r\n        console.log(e);\r\n        self.customToast('购买失败')\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\nuni-page-body{\r\n  height: 100%;\r\n}\r\n.foresee{\r\n  width: 100%;\r\n  min-height: 100%;\r\n  background-color: $main-bg;\r\n  padding: $spacing-lg $spacing-base 0 $spacing-base;\r\n  box-sizing: border-box;\r\n\r\n  .head{\r\n    width: 100%;\r\n    height: 400rpx;\r\n    background: rgba(0,0,0,0);\r\n    border-radius: 30rpx;\r\n    margin-bottom: $spacing-lg;\r\n  }\r\n\r\n  .foresee_content{\r\n    width: 100%;\r\n    height: 550rpx;\r\n    background: #ffffff;\r\n    border-radius: 20rpx;\r\n    display: flex;\r\n    flex-direction: column;\r\n    padding: $spacing-lg;\r\n    box-sizing: border-box;\r\n\r\n    .foresee_name{\r\n      width: 100%;\r\n      height: 45rpx;\r\n      font-size:$font-size-lg;\r\n      font-weight: $font-weight-lg;\r\n      color: $font-color1;\r\n      margin-bottom: 36rpx;\r\n    }\r\n\r\n    .fac_value{\r\n      width: 100%;\r\n      height: 75rpx;\r\n      font-size: $font-size-lg;\r\n      font-weight: $font-weight-lg;\r\n      color: $font-color1;\r\n      display: flex;\r\n      justify-content: space-between;\r\n      border-bottom: 1rpx solid #cccccc;\r\n      margin-bottom: $spacing-lg;\r\n\r\n      text:nth-child(1){\r\n        font-size: $font-size-sm;\r\n        font-weight: $font-weight-base;\r\n      }\r\n    }\r\n\r\n    .point{\r\n      width: 100%;\r\n      font-size: $font-size-sm - 2rpx;\r\n      font-weight: $font-weight-base;\r\n      color: $font-color3;\r\n      line-height: 1.6;\r\n\r\n      .tips{\r\n        margin-bottom: $spacing-lg;\r\n      }\r\n\r\n      .notice{\r\n        .special{\r\n          color: $main-color;\r\n        }\r\n      }\r\n      .title{\r\n        width: 120rpx;\r\n        font-size: $font-size-sm;\r\n        font-weight: $font-weight-lg;\r\n        color: $font-color1;\r\n      }\r\n    }\r\n  }\r\n\r\n  .btn{\r\n    width: 702rpx;\r\n    height: 78rpx;\r\n    background: $main-color;\r\n    border-radius: 10rpx;\r\n    position: fixed;\r\n    bottom: $spacing-lg;\r\n    left: $spacing-base;\r\n\r\n    button{\r\n      width: 100%;\r\n      height: 100%;\r\n      font-size: $font-size-base;\r\n      color: #ffffff;\r\n      border:none;\r\n      margin: 0;\r\n      padding: 0;\r\n      line-height: 78rpx;\r\n      text-align: center;\r\n    }\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/foreseeDetails/foreseeDetails.vue	(revision a6175d8333c8e25bf1fa5f6fd86a4a31565b5d4d)
+++ pages/foreseeDetails/foreseeDetails.vue	(date 1603247901659)
@@ -39,23 +39,28 @@
 export default {
   data() {
     return {
-      foresee:{}
+      foresee: {},
+      paymentStatus: false//订单状态
     }
   },
-  onLoad(options){
+  onLoad(options) {
     this.foresee = JSON.parse(decodeURIComponent(options.foresee))
   },
   methods: {
-    async buy(){
-      uni.showLoading({title:'购买中'})
+    async buy() {
+      if (this.paymentStatus) return;
+      this.paymentStatus = true;
+      uni.showLoading({title: '购买中'})
       let self = this;
-      try{
+      try {
         //请求预支付信息
-        let orderInfo = (await buyForesee({card_id:self.foresee.id})).data;
-        self.utilPayment(orderInfo)
+        let orderInfo = (await buyForesee({card_id: self.foresee.id})).data;
+        await self.utilPayment(orderInfo)
+        self.paymentStatus = false;
         self.customToast('购买成功')
-      }catch (e) {
+      } catch (e) {
         console.log(e);
+        self.paymentStatus = false;
         self.customToast('购买失败')
       }
     }
Index: pages/milkTeaGift/milkTeaGift.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"container\">\r\n    <swiperSwitch leftTitle=\"購買奶茶有禮\"\r\n                  rightTitle=\"我的奶茶有禮\"\r\n                  :assign-index=\"assignIndex\"\r\n                  @swiper-end=\"assignIndex = false\">\r\n      <template v-slot:left>\r\n        <!--購買奶茶有禮-->\r\n        <view class=\"buy_foresee\">\r\n          <view class=\"content_list\" v-for=\"list in foreseeList\" :key=\"list.id\">\r\n            <view class=\"title\">\r\n              <text>{{ list.norm_name }}</text>\r\n            </view>\r\n            <swiper next-margin=\"40rpx\"\r\n                    display-multiple-items=\"2\"\r\n                    enable-flex\r\n                    :scroll-x=\"true\"\r\n                    class=\"list\">\r\n              <swiper-item class=\"list_item\"\r\n                           @click=\"navPage(list.child[im])\"\r\n                           v-for=\"(foresee,im) in (list.child)\"\r\n                           :key=\"im\">\r\n                <!-- TODO 替換圖片鏈接 foreseeList.worth_price-->\r\n                <image :src=\"'../../static/images_t/milkTeaGift/img.png'\"></image>\r\n              </swiper-item>\r\n            </swiper>\r\n          </view>\r\n        </view>\r\n      </template>\r\n      <template v-slot:right>\r\n        <!--我的奶茶有礼-->\r\n        <view class=\"have_foresee\">\r\n          <myForeseePage @buy-foreseeList=\"assignIndex++\"\r\n                         @give-start=\"giveInfo\"\r\n                         :foresee=\"haveForesee\"></myForeseePage>\r\n        </view>\r\n      </template>\r\n    </swiperSwitch>\r\n\r\n    <!--赠送好友-->\r\n    <view v-if=\"isGive\" class=\"give\" @touchmove.prevent.stop=\"catchTouch\">\r\n      <view class=\"mark\">\r\n        <view class=\"content\">\r\n          <uni-icons @click=\"closeGive\"\r\n                     class=\"icon\"\r\n                     type=\"close\"\r\n                     size=\"40\"\r\n                     color=\"#cccccc\">\r\n          </uni-icons>\r\n          <view class=\"title\">贈送好友</view>\r\n          <input v-model=\"givePhone\" type=\"number\" maxlength=\"11\" placeholder=\"請輸入贈送好友手機號\">\r\n          <button @click=\"giveStart\">確定贈送</button>\r\n        </view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  milkList,\r\n  myForesee,\r\n  buyForesee,\r\n  mutualRecord\r\n} from \"../../request/api\";\r\n\r\nimport swiperSwitch from \"../../components-lk/swiperSwitch/swiperSwitch\";\r\nimport myForeseePage from './components/myForeseePage'\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      foreseeList: [\r\n        {\r\n          id: \"16022649\",\r\n          norm_name: \"流心波波卡\",\r\n          child: [\r\n            {\r\n              id: \"1602670752262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"1602670725262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"1602677252262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"1602670725222564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            },\r\n          ]\r\n        },  {\r\n          id: \"1602667262842649\",\r\n          norm_name: \"流心波波卡\",\r\n          child: [\r\n            {\r\n              id: \"1602670752262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"1602670725262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"1602677252262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"1602670725222564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            },\r\n          ]\r\n        }, {\r\n          id: \"1602662062842649\",\r\n          norm_name: \"流心波波卡\",\r\n          child: [\r\n            {\r\n              id: \"1602670725226254\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"160267252262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"1602670725262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"160267072522664\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            },\r\n          ]\r\n        }, {\r\n          id: \"160266762842649\",\r\n          norm_name: \"流心波波卡\",\r\n          child: [\r\n            {\r\n              id: \"16027252262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"16026707262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"1602677252262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"160267072564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            },\r\n          ]\r\n        }, {\r\n          id: \"16026672842649\",\r\n          norm_name: \"流心波波卡\",\r\n          child: [\r\n            {\r\n              id: \"1602670762564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"1602670722564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"1602670725262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"160262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            },\r\n          ]\r\n        }, {\r\n          id: \"160266842649\",\r\n          norm_name: \"流心波波卡\",\r\n          child: [\r\n            {\r\n              id: \"1602662564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"160262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"16026764\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            }, {\r\n              id: \"160252262564\",\r\n              card_name: \"恰杯茶啵\",\r\n              home_avatar: \"/uploads/202010/14/160267063599194.jpg\",\r\n              worth_price: \"60\"\r\n            },\r\n          ]\r\n        },\r\n      ],\r\n      haveForesee: [\r\n          {\r\n        id: \"1602761166363589\",\r\n        worth_price: \"60.00\",\r\n        home_avatar: \"/uploads/202010/14/160267063599194.jpg\"\r\n      }, {\r\n        id: \"1602761616363589\",\r\n        worth_price: \"60.00\",\r\n        home_avatar: \"/uploads/202010/14/160267063599194.jpg\"\r\n      }, {\r\n        id: \"1602761161363589\",\r\n        worth_price: \"60.00\",\r\n        home_avatar: \"/uploads/202010/14/160267063599194.jpg\"\r\n      }, {\r\n        id: \"1602761161636589\",\r\n        worth_price: \"60.00\",\r\n        home_avatar: \"/uploads/202010/14/160267063599194.jpg\"\r\n      },],\r\n      // haveForesee:[],\r\n      activeFeat: 'buy',\r\n      assignIndex:0,\r\n      givePhone:'',\r\n      isGive:false,\r\n    }\r\n  },\r\n  async mounted() {\r\n    await this.getForesee()\r\n  },\r\n  methods: {\r\n    //获取数据列表\r\n    async getForesee() {\r\n      this.foreseeList = ((await milkList()).data || [])\r\n    },\r\n    //获取我的卡片\r\n    async getMyForesee() {\r\n    },\r\n    //获取购买记录\r\n    async getBuyRecord() {\r\n    },\r\n    //获取收送记录\r\n    async getMutualRecord() {\r\n    },\r\n    //贈送預付卡\r\n    async giveForeseeStart(){},\r\n    //跳轉至預付卡詳情\r\n    navPage(f) {\r\n      uni.navigateTo({\r\n        url: '/pages/foreseeDetails/foreseeDetails?foresee=' + encodeURIComponent(JSON.stringify(f))\r\n      })\r\n    },\r\n\r\n    //在弹出赠送框后阻止滑动的空数组\r\n    catchTouch(){},\r\n    giveInfo(){\r\n      this.isGive = true;\r\n    },\r\n    //點擊贈送好友\r\n    giveStart(){\r\n      console.log(1);\r\n      uni.showLoading({\r\n        title:'請稍後'\r\n      })\r\n      try{\r\n        if(this.givePhone.length!==11||isNaN(this.givePhone)){\r\n          this.customToast('手機號不正確')\r\n          this.givePhone = ''\r\n          return\r\n        }\r\n        this.isGive = false;\r\n        //TODO贈送邏輯處理\r\n\r\n        this.customToast('贈送成功')\r\n        this.givePhone = '';\r\n      }catch (e){\r\n        this.givePhone = ''\r\n        this.customToast('贈送失敗')\r\n      }\r\n    },\r\n    //取消贈送\r\n    closeGive(){\r\n      this.isGive = false;\r\n      this.givePhone = '';\r\n    },\r\n  },\r\n  components: {\r\n    myForeseePage,\r\n    swiperSwitch\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\nimage{\r\n  width: 300rpx;\r\n  height: 200rpx;\r\n  vertical-align: middle;\r\n}\r\n.container{\r\n  width: 100%;\r\n  min-height: 100%;\r\n  background-color: $main-bg;\r\n\r\nswiper{\r\nheight: 100%;\r\n\r\n  .buy_foresee{\r\n    //margin-top: 150rpx;\r\n    width: 100%;\r\n    display: flex;\r\n    flex-direction: column;\r\n    background-color: $main-bg;\r\n    box-sizing: border-box;\r\n    padding:$spacing-base 0;\r\n    /* #ifdef H5 | APP-PLUS*/\r\n    padding:$spacing-base;\r\n    /* #endif*/\r\n\r\n    .content_list{\r\n      width: 100%;\r\n      /* #ifdef MP*/\r\n      padding: 0 $spacing-base;\r\n      box-sizing:border-box;\r\n      /* #endif*/\r\n\r\n      .title{\r\n        font-size: $font-size-base;\r\n        color: $font-color1;\r\n        margin-bottom: 10rpx;\r\n      }\r\n\r\n      .list{\r\n        width: 100%;\r\n        height: 200rpx;\r\n        white-space: nowrap;\r\n        margin-bottom: $spacing-lg;\r\n\r\n        .list_item{\r\n          display: inline-block;\r\n          width: 300rpx;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  .have_foresee{\r\n    //margin-top: 150rpx;\r\n    width: 100%;\r\n    //min-height: 100%;\r\n    display: flex;\r\n    flex-direction: column;\r\n    background-color: $main-bg;\r\n  }\r\n}\r\n  .give{\r\n    width: 100vw;\r\n    height: 100vh;\r\n    position: fixed;\r\n    left: 0;\r\n    top: 0;\r\n    z-index:13;\r\n\r\n    .mark{\r\n      width: 100%;\r\n      height: 100%;\r\n      background:rgba(0,0,0,.35);\r\n      z-index: 12;\r\n\r\n      .content{\r\n        width: 480rpx;\r\n        height: 330rpx;\r\n        background: #ffffff;\r\n        border-radius: 20rpx;\r\n        position: absolute;\r\n        left: 50%;\r\n        top: 50%;\r\n        transform: translate(-50%,-50%);\r\n        font-size: $font-size-base;\r\n        font-weight:$font-weight-lg;\r\n        color: $font-color1;\r\n        display: flex;\r\n        flex-direction: column;\r\n        align-items: center;\r\n\r\n        .icon{\r\n          position: absolute;\r\n          right: 20rpx;\r\n          top: 20rpx;\r\n        }\r\n\r\n        .title{\r\n          margin: 50rpx 0 $spacing-lg 0;\r\n        }\r\n\r\n        input{\r\n          width: 330rpx;\r\n          height: 54rpx;\r\n          border: 1rpx solid #cccccc;\r\n          font-size: $font-size-sm;\r\n          font-weight: $font-weight-base;\r\n          border-radius: 8rpx;\r\n          padding: 0 10rpx;\r\n          box-sizing: border-box;\r\n          margin-bottom: 50rpx;\r\n        }\r\n\r\n        button  {\r\n          width: 150rpx;\r\n          height: 58rpx;\r\n          background: $main-color;\r\n          border-radius: 4rpx;\r\n          padding: 0;\r\n          line-height: 58rpx;\r\n          font-size: $font-size-sm;\r\n          font-weight: $font-weight-base;\r\n          color: #FFFFFF;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/milkTeaGift/milkTeaGift.vue	(revision a6175d8333c8e25bf1fa5f6fd86a4a31565b5d4d)
+++ pages/milkTeaGift/milkTeaGift.vue	(date 1603266524349)
@@ -1,9 +1,11 @@
 <template>
   <view class="container">
-    <swiperSwitch leftTitle="購買奶茶有禮"
-                  rightTitle="我的奶茶有禮"
-                  :assign-index="assignIndex"
-                  @swiper-end="assignIndex = false">
+    <swiperSwitch
+        leftTitle="購買奶茶有禮"
+        rightTitle="我的奶茶有禮"
+        :assign-index="assignIndex"
+        @swiper-end="assignIndex = false"
+    >
       <template v-slot:left>
         <!--購買奶茶有禮-->
         <view class="buy_foresee">
@@ -11,17 +13,23 @@
             <view class="title">
               <text>{{ list.norm_name }}</text>
             </view>
-            <swiper next-margin="40rpx"
-                    display-multiple-items="2"
-                    enable-flex
-                    :scroll-x="true"
-                    class="list">
-              <swiper-item class="list_item"
-                           @click="navPage(list.child[im])"
-                           v-for="(foresee,im) in (list.child)"
-                           :key="im">
+            <swiper
+                next-margin="40rpx"
+                display-multiple-items="2"
+                enable-flex
+                :scroll-x="true"
+                class="list"
+            >
+              <swiper-item
+                  class="list_item"
+                  @click="navPage(list.child[im])"
+                  v-for="(foresee, im) in list.child"
+                  :key="im"
+              >
                 <!-- TODO 替換圖片鏈接 foreseeList.worth_price-->
-                <image :src="'../../static/images_t/milkTeaGift/img.png'"></image>
+                <image
+                    :src="'../../static/images_t/milkTeaGift/img.png'"
+                ></image>
               </swiper-item>
             </swiper>
           </view>
@@ -30,9 +38,11 @@
       <template v-slot:right>
         <!--我的奶茶有礼-->
         <view class="have_foresee">
-          <myForeseePage @buy-foreseeList="assignIndex++"
-                         @give-start="giveInfo"
-                         :foresee="haveForesee"></myForeseePage>
+          <myForeseePage
+              @buy-foreseeList="assignIndex++"
+              @give-start="giveInfo"
+              :foresee="haveForesee"
+          ></myForeseePage>
         </view>
       </template>
     </swiperSwitch>
@@ -41,14 +51,21 @@
     <view v-if="isGive" class="give" @touchmove.prevent.stop="catchTouch">
       <view class="mark">
         <view class="content">
-          <uni-icons @click="closeGive"
-                     class="icon"
-                     type="close"
-                     size="40"
-                     color="#cccccc">
+          <uni-icons
+              @click="closeGive"
+              class="icon"
+              type="close"
+              size="40"
+              color="#cccccc"
+          >
           </uni-icons>
           <view class="title">贈送好友</view>
-          <input v-model="givePhone" type="number" maxlength="11" placeholder="請輸入贈送好友手機號">
+          <input
+              v-model="givePhone"
+              type="number"
+              maxlength="11"
+              placeholder="請輸入贈送好友手機號"
+          />
           <button @click="giveStart">確定贈送</button>
         </view>
       </view>
@@ -61,11 +78,12 @@
   milkList,
   myForesee,
   buyForesee,
-  mutualRecord
+  mutualRecord,
+  giveForesee,
 } from "../../request/api";
 
 import swiperSwitch from "../../components-lk/swiperSwitch/swiperSwitch";
-import myForeseePage from './components/myForeseePage'
+import myForeseePage from "./components/myForeseePage";
 
 export default {
   data() {
@@ -79,25 +97,29 @@
               id: "1602670752262564",
               card_name: "恰杯茶啵",
               home_avatar: "/uploads/202010/14/160267063599194.jpg",
-              worth_price: "60"
-            }, {
+              worth_price: "60",
+            },
+            {
               id: "1602670725262564",
               card_name: "恰杯茶啵",
               home_avatar: "/uploads/202010/14/160267063599194.jpg",
-              worth_price: "60"
-            }, {
+              worth_price: "60",
+            },
+            {
               id: "1602677252262564",
               card_name: "恰杯茶啵",
               home_avatar: "/uploads/202010/14/160267063599194.jpg",
-              worth_price: "60"
-            }, {
+              worth_price: "60",
+            },
+            {
               id: "1602670725222564",
               card_name: "恰杯茶啵",
               home_avatar: "/uploads/202010/14/160267063599194.jpg",
-              worth_price: "60"
+              worth_price: "60",
             },
-          ]
-        },  {
+          ],
+        },
+        {
           id: "1602667262842649",
           norm_name: "流心波波卡",
           child: [
@@ -105,25 +127,29 @@
               id: "1602670752262564",
               card_name: "恰杯茶啵",
               home_avatar: "/uploads/202010/14/160267063599194.jpg",
-              worth_price: "60"
-            }, {
+              worth_price: "60",
+            },
+            {
               id: "1602670725262564",
               card_name: "恰杯茶啵",
               home_avatar: "/uploads/202010/14/160267063599194.jpg",
-              worth_price: "60"
-            }, {
+              worth_price: "60",
+            },
+            {
               id: "1602677252262564",
               card_name: "恰杯茶啵",
               home_avatar: "/uploads/202010/14/160267063599194.jpg",
-              worth_price: "60"
-            }, {
+              worth_price: "60",
+            },
+            {
               id: "1602670725222564",
               card_name: "恰杯茶啵",
               home_avatar: "/uploads/202010/14/160267063599194.jpg",
-              worth_price: "60"
+              worth_price: "60",
             },
-          ]
-        }, {
+          ],
+        },
+        {
           id: "1602662062842649",
           norm_name: "流心波波卡",
           child: [
@@ -131,25 +157,29 @@
               id: "1602670725226254",
               card_name: "恰杯茶啵",
               home_avatar: "/uploads/202010/14/160267063599194.jpg",
-              worth_price: "60"
-            }, {
+              worth_price: "60",
+            },
+            {
               id: "160267252262564",
               card_name: "恰杯茶啵",
               home_avatar: "/uploads/202010/14/160267063599194.jpg",
-              worth_price: "60"
-            }, {
+              worth_price: "60",
+            },
+            {
               id: "1602670725262564",
               card_name: "恰杯茶啵",
               home_avatar: "/uploads/202010/14/160267063599194.jpg",
-              worth_price: "60"
-            }, {
+              worth_price: "60",
+            },
+            {
               id: "160267072522664",
               card_name: "恰杯茶啵",
               home_avatar: "/uploads/202010/14/160267063599194.jpg",
-              worth_price: "60"
+              worth_price: "60",
             },
-          ]
-        }, {
+          ],
+        },
+        {
           id: "160266762842649",
           norm_name: "流心波波卡",
           child: [
@@ -157,25 +187,29 @@
               id: "16027252262564",
               card_name: "恰杯茶啵",
               home_avatar: "/uploads/202010/14/160267063599194.jpg",
-              worth_price: "60"
-            }, {
+              worth_price: "60",
+            },
+            {
               id: "16026707262564",
               card_name: "恰杯茶啵",
               home_avatar: "/uploads/202010/14/160267063599194.jpg",
-              worth_price: "60"
-            }, {
+              worth_price: "60",
+            },
+            {
               id: "1602677252262564",
               card_name: "恰杯茶啵",
               home_avatar: "/uploads/202010/14/160267063599194.jpg",
-              worth_price: "60"
-            }, {
+              worth_price: "60",
+            },
+            {
               id: "160267072564",
               card_name: "恰杯茶啵",
               home_avatar: "/uploads/202010/14/160267063599194.jpg",
-              worth_price: "60"
+              worth_price: "60",
             },
-          ]
-        }, {
+          ],
+        },
+        {
           id: "16026672842649",
           norm_name: "流心波波卡",
           child: [
@@ -183,25 +217,29 @@
               id: "1602670762564",
               card_name: "恰杯茶啵",
               home_avatar: "/uploads/202010/14/160267063599194.jpg",
-              worth_price: "60"
-            }, {
+              worth_price: "60",
+            },
+            {
               id: "1602670722564",
               card_name: "恰杯茶啵",
               home_avatar: "/uploads/202010/14/160267063599194.jpg",
-              worth_price: "60"
-            }, {
+              worth_price: "60",
+            },
+            {
               id: "1602670725262564",
               card_name: "恰杯茶啵",
               home_avatar: "/uploads/202010/14/160267063599194.jpg",
-              worth_price: "60"
-            }, {
+              worth_price: "60",
+            },
+            {
               id: "160262564",
               card_name: "恰杯茶啵",
               home_avatar: "/uploads/202010/14/160267063599194.jpg",
-              worth_price: "60"
+              worth_price: "60",
             },
-          ]
-        }, {
+          ],
+        },
+        {
           id: "160266842649",
           norm_name: "流心波波卡",
           child: [
@@ -209,58 +247,66 @@
               id: "1602662564",
               card_name: "恰杯茶啵",
               home_avatar: "/uploads/202010/14/160267063599194.jpg",
-              worth_price: "60"
-            }, {
+              worth_price: "60",
+            },
+            {
               id: "160262564",
               card_name: "恰杯茶啵",
               home_avatar: "/uploads/202010/14/160267063599194.jpg",
-              worth_price: "60"
-            }, {
+              worth_price: "60",
+            },
+            {
               id: "16026764",
               card_name: "恰杯茶啵",
               home_avatar: "/uploads/202010/14/160267063599194.jpg",
-              worth_price: "60"
-            }, {
+              worth_price: "60",
+            },
+            {
               id: "160252262564",
               card_name: "恰杯茶啵",
               home_avatar: "/uploads/202010/14/160267063599194.jpg",
-              worth_price: "60"
+              worth_price: "60",
             },
-          ]
+          ],
         },
       ],
       haveForesee: [
-          {
-        id: "1602761166363589",
-        worth_price: "60.00",
-        home_avatar: "/uploads/202010/14/160267063599194.jpg"
-      }, {
-        id: "1602761616363589",
-        worth_price: "60.00",
-        home_avatar: "/uploads/202010/14/160267063599194.jpg"
-      }, {
-        id: "1602761161363589",
-        worth_price: "60.00",
-        home_avatar: "/uploads/202010/14/160267063599194.jpg"
-      }, {
-        id: "1602761161636589",
-        worth_price: "60.00",
-        home_avatar: "/uploads/202010/14/160267063599194.jpg"
-      },],
+        {
+          id: "1602761166363589",
+          worth_price: "60.00",
+          home_avatar: "/uploads/202010/14/160267063599194.jpg",
+        },
+        {
+          id: "1602761616363589",
+          worth_price: "60.00",
+          home_avatar: "/uploads/202010/14/160267063599194.jpg",
+        },
+        {
+          id: "1602761161363589",
+          worth_price: "60.00",
+          home_avatar: "/uploads/202010/14/160267063599194.jpg",
+        },
+        {
+          id: "1602761161636589",
+          worth_price: "60.00",
+          home_avatar: "/uploads/202010/14/160267063599194.jpg",
+        },
+      ],
       // haveForesee:[],
-      activeFeat: 'buy',
-      assignIndex:0,
-      givePhone:'',
-      isGive:false,
-    }
+      activeFeat: "buy",
+      assignIndex: 0,
+      givePhone: "",
+      isGive: false,
+      giveForeseeId:''
+    };
   },
   async mounted() {
-    await this.getForesee()
+    await this.getForesee();
   },
   methods: {
     //获取数据列表
     async getForesee() {
-      this.foreseeList = ((await milkList()).data || [])
+      this.foreseeList = (await milkList()).data || [];
     },
     //获取我的卡片
     async getMyForesee() {
@@ -272,131 +318,143 @@
     async getMutualRecord() {
     },
     //贈送預付卡
-    async giveForeseeStart(){},
+    async giveForeseeStart() {
+    },
     //跳轉至預付卡詳情
     navPage(f) {
       uni.navigateTo({
-        url: '/pages/foreseeDetails/foreseeDetails?foresee=' + encodeURIComponent(JSON.stringify(f))
-      })
+        url:
+            "/pages/foreseeDetails/foreseeDetails?foresee=" +
+            encodeURIComponent(JSON.stringify(f)),
+      });
     },
 
     //在弹出赠送框后阻止滑动的空数组
-    catchTouch(){},
-    giveInfo(){
+    catchTouch() {},
+    //展示赠送框，并存储赠送的预付卡ID
+    giveInfo(e) {
+      console.log(e);
       this.isGive = true;
+      this.giveForeseeId = e.id;
     },
     //點擊贈送好友
-    giveStart(){
-      console.log(1);
+    async giveStart(e) {
+      let self = this;
+      //手机号位数不对直接返回
+      if (self.givePhone.length !== 11) {
+        self.customToast("手機號不正確");
+        self.givePhone = "";
+        return;
+      }
+
       uni.showLoading({
-        title:'請稍後'
-      })
-      try{
-        if(this.givePhone.length!==11||isNaN(this.givePhone)){
-          this.customToast('手機號不正確')
-          this.givePhone = ''
-          return
-        }
-        this.isGive = false;
-        //TODO贈送邏輯處理
-
-        this.customToast('贈送成功')
-        this.givePhone = '';
-      }catch (e){
-        this.givePhone = ''
-        this.customToast('贈送失敗')
+        title: "赠送中",
+      });
+
+      self.isGive = false;
+      //TODO贈送邏輯處理
+      try {
+        await giveForesee({
+          card_id: self.giveForeseeId,
+          mobile: self.givePhone,
+        })
+        self.customToast("贈送成功");
+        self.givePhone = "";
+      } catch (e) {
+        self.givePhone = '';
+        self.customToast('赠送失败')
       }
     },
     //取消贈送
-    closeGive(){
+    closeGive() {
       this.isGive = false;
-      this.givePhone = '';
+      this.givePhone = "";
     },
   },
   components: {
     myForeseePage,
-    swiperSwitch
-  }
-}
+    swiperSwitch,
+  },
+};
 </script>
 
 <style lang="scss" scoped>
-image{
+image {
   width: 300rpx;
   height: 200rpx;
   vertical-align: middle;
 }
-.container{
+.container {
   width: 100%;
   min-height: 100%;
   background-color: $main-bg;
 
-swiper{
-height: 100%;
+  swiper {
+    height: 100%;
 
-  .buy_foresee{
-    //margin-top: 150rpx;
-    width: 100%;
-    display: flex;
-    flex-direction: column;
-    background-color: $main-bg;
-    box-sizing: border-box;
-    padding:$spacing-base 0;
-    /* #ifdef H5 | APP-PLUS*/
-    padding:$spacing-base;
-    /* #endif*/
+    .buy_foresee {
+      //margin-top: 150rpx;
+      width: 100%;
+      display: flex;
+      flex-direction: column;
+      background-color: $main-bg;
+      box-sizing: border-box;
+      padding: $spacing-base 0;
+      /* #ifdef H5 | APP-PLUS*/
+      padding: $spacing-base;
+      /* #endif*/
 
-    .content_list{
-      width: 100%;
-      /* #ifdef MP*/
-      padding: 0 $spacing-base;
-      box-sizing:border-box;
-      /* #endif*/
+      .content_list {
+        width: 100%;
+        /* #ifdef MP*/
+        padding: 0 $spacing-base;
+        box-sizing: border-box;
+        /* #endif*/
 
-      .title{
-        font-size: $font-size-base;
-        color: $font-color1;
-        margin-bottom: 10rpx;
-      }
+        .title {
+          font-size: $font-size-base;
+          color: $font-color1;
+          margin-bottom: 10rpx;
+        }
 
-      .list{
-        width: 100%;
-        height: 200rpx;
-        white-space: nowrap;
-        margin-bottom: $spacing-lg;
+        .list {
+          width: 100%;
+          height: 200rpx;
+          white-space: nowrap;
+          margin-bottom: $spacing-lg;
 
-        .list_item{
-          display: inline-block;
-          width: 300rpx;
-        }
-      }
-    }
-  }
+          .list_item {
+            display: inline-block;
+            width: 300rpx;
+          }
+        }
+      }
+    }
 
-  .have_foresee{
-    //margin-top: 150rpx;
-    width: 100%;
-    //min-height: 100%;
-    display: flex;
-    flex-direction: column;
-    background-color: $main-bg;
-  }
-}
-  .give{
+    .have_foresee {
+      //margin-top: 150rpx;
+      width: 100%;
+      //min-height: 100%;
+      display: flex;
+      flex-direction: column;
+      background-color: $main-bg;
+    }
+  }
+  .give {
     width: 100vw;
     height: 100vh;
     position: fixed;
     left: 0;
     top: 0;
-    z-index:13;
+    z-index: 13;
 
-    .mark{
+    .mark {
       width: 100%;
       height: 100%;
-      background:rgba(0,0,0,.35);
+      background: rgba(0, 0, 0, 0.35);
       z-index: 12;
 
-      .content{
+      .content {
         width: 480rpx;
         height: 330rpx;
         background: #ffffff;
@@ -404,25 +462,25 @@
         position: absolute;
         left: 50%;
         top: 50%;
-        transform: translate(-50%,-50%);
+        transform: translate(-50%, -50%);
         font-size: $font-size-base;
-        font-weight:$font-weight-lg;
+        font-weight: $font-weight-lg;
         color: $font-color1;
         display: flex;
         flex-direction: column;
         align-items: center;
 
-        .icon{
+        .icon {
           position: absolute;
           right: 20rpx;
           top: 20rpx;
         }
 
-        .title{
+        .title {
           margin: 50rpx 0 $spacing-lg 0;
         }
 
-        input{
+        input {
           width: 330rpx;
           height: 54rpx;
           border: 1rpx solid #cccccc;
@@ -434,7 +492,7 @@
           margin-bottom: 50rpx;
         }
 
-        button  {
+        button {
           width: 150rpx;
           height: 58rpx;
           background: $main-color;
@@ -443,7 +501,7 @@
           line-height: 58rpx;
           font-size: $font-size-sm;
           font-weight: $font-weight-base;
-          color: #FFFFFF;
+          color: #ffffff;
         }
       }
     }
Index: pages/orderPayment/orderPayment.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"order_payment\">\r\n    <!--头部-->\r\n    <view class=\"order_payment_head\">\r\n      <view :class=\"['name_method',goodsData.haul_method===2?'one_self':'']\">\r\n        <view class=\"shop_name\">\r\n          <text style=\"display: inline\">{{ goodsData.shop_name }}</text>\r\n          <uni-icons style=\"display: inline-block;vertical-align: middle\"\r\n                     type=\"arrowright\"\r\n                     size=\"35\"\r\n                     color=\"#333333\">\r\n          </uni-icons>\r\n          <text v-if=\"goodsData.haul_method === 2\">距離您{{ goodsData.distance }}km</text>\r\n          <text v-else>{{ goodsData.contact_name }}({{ goodsData.contact_sex }}) {{ goodsData.contact_phone }}</text>\r\n        </view>\r\n        <view class=\"receiving_method\">\r\n          <view :class=\"[goodsData.haul_method === 2 ? 'active_method' : '']\">\r\n            <text>自取</text>\r\n          </view>\r\n          <view :class=\"['other_people',goodsData.haul_method === 1 ? 'active_method' : '']\">\r\n            <text>外卖</text>\r\n          </view>\r\n          <view :class=\"['shop',goodsData.haul_method === 3 ? 'active_method' : '']\">\r\n            <text>堂食</text>\r\n          </view>\r\n        </view>\r\n      </view>\r\n      <!--聯繫電話-->\r\n      <view class=\"phone\" v-if=\"goodsData.haul_method === 1\">\r\n        <view class=\"phone_input\">\r\n          <label>\r\n            <text>聯系電話</text>\r\n            <input :value=\"userPhone\" type=\"number\">\r\n          </label>\r\n        </view>\r\n        <button @click=\"autoFill\" class=\"auto_fill\" plain>自動填寫</button>\r\n      </view>\r\n    </view>\r\n    <!--取茶时间-->\r\n    <view class=\"order_time\">\r\n      <view class=\"time_title\">\r\n        <text>取茶時間</text>\r\n      </view>\r\n      <view class=\"order_progress\">\r\n        <text>前面</text>\r\n        <text class=\"text_color\">{{ goodsData.current_order }}單/{{ goodsData.current_cups }}</text>\r\n        <text>杯制作中，</text>\r\n        <text>預計</text>\r\n        <text class=\"text_color\">{{ goodsData.current_cups }}分鐘</text>\r\n        <text>後取茶</text>\r\n      </view>\r\n      <view class=\"current_progress\">\r\n        <progress activeColor=\"#17a1ff\" backgroundColor=\"#f0f0f0\" :percent=\"computeProgress\"></progress>\r\n      </view>\r\n    </view>\r\n    <!--商品列表-->\r\n    <view class=\"goods_list\">\r\n      <view class=\"list_detail\">\r\n        <view class=\"list_title\">\r\n          <text>商品列表</text>\r\n        </view>\r\n        <view v-for=\"(goods,index) in goodsData.goods_data\" :key=\"index\" class=\"goods_detail\">\r\n          <view class=\"goods_img\">\r\n            <image :src=\"goods.home_avatar\"></image>\r\n          </view>\r\n          <view class=\"goods_info\">\r\n            <view class=\"goods_name\">\r\n              <text>{{ goods.goods_name }}</text>\r\n            </view>\r\n            <view class=\"goods_extra_info\">\r\n              <text class=\"goods_straw\">{{ goods.norm }}</text>\r\n            </view>\r\n          </view>\r\n          <view class=\"goods_amount\">\r\n            <text>￥{{ goods.goods_price }}</text>\r\n            <text>x{{ goods.goods_num }}</text>\r\n          </view>\r\n        </view>\r\n      </view>\r\n      <!--附加服務-->\r\n      <view class=\"attach_service\">\r\n        <view class=\"delivery_fee\" v-if=\"goodsData.haul_method===1\">\r\n          <view class=\"left\">\r\n            <text>配送費</text>\r\n          </view>\r\n          <view class=\"right\">\r\n            <text>￥{{ goodsData.delivery_cost }}</text>\r\n          </view>\r\n        </view>\r\n        <view class=\"service1\">\r\n          <block v-for=\"attachItem in attach\" :key=\"attachItem.id\">\r\n            <view class=\"left\">\r\n              <view class=\"left_name\">\r\n                <text>{{ attachItem.attach_name }}</text>\r\n                <text>推薦選擇</text>\r\n              </view>\r\n              <view class=\"left_des\">\r\n                <text>保冷保暖，鎖住新鮮口感</text>\r\n              </view>\r\n            </view>\r\n            <view @click=\"addAttachFee(attachItem.id)\" class=\"right\">\r\n              <label>\r\n                <text>￥{{ attachItem.attach_price }}</text>\r\n                <radio :checked=\"attachArr.indexOf(attachItem.id) !== -1\" color=\"#17A1FF\"/>\r\n              </label>\r\n            </view>\r\n          </block>\r\n        </view>\r\n        <view class=\"service2\">\r\n          <view class=\"left\">\r\n            <text>優惠券</text>\r\n            <text>券</text>\r\n          </view>\r\n          <view class=\"right\">\r\n            <view>\r\n              <text v-if=\"!couponInfo.length\">暫無可用</text>\r\n              <text @click=\"navDiscount\"\r\n                    style=\"color:#17A1FF;\"\r\n                    v-if=\"couponInfo.length&&!discountAmount\">{{ couponInfo.length }}個可用\r\n              </text>\r\n              <uni-icons @click=\"navDiscount\"\r\n                         v-if=\"!discountAmount\"\r\n                         style=\"display: inline-block;vertical-align: middle\"\r\n                         type=\"arrowright\"\r\n                         size=\"35\"\r\n                         color=\"#999999\">\r\n              </uni-icons>\r\n            </view>\r\n            <view v-if=\"discountAmount\" class=\"discount\">\r\n              <view>【{{ discountAmount }}元抵用券】-￥{{ discountAmount }}</view>\r\n              <image @click=\"discountAmount = 0\" src=\"../../static/images/orderPayment/discount.png\"></image>\r\n            </view>\r\n          </view>\r\n        </view>\r\n        <!--訂單備註-->\r\n        <view class=\"service3\">\r\n          <view @click=\"isRemarks = !isRemarks\" class=\"left\">\r\n            <text>備註</text>\r\n          </view>\r\n          <view @click=\"isRemarks = !isRemarks\" class=\"right\">\r\n            <text v-if=\"remarksData.noContact\">無接觸配送，</text>\r\n            <text v-if=\"remarksData.paper\">纸巾，</text>\r\n            <text v-if=\"remarksData.sugar\">糖包</text>\r\n            <uni-icons style=\"display: inline-block;vertical-align: middle\"\r\n                       type=\"arrowright\"\r\n                       size=\"35\"\r\n                       color=\"#999999\">\r\n            </uni-icons>\r\n          </view>\r\n          <view v-if=\"isRemarks\" class=\"remarks\">\r\n            <remarks\r\n                :remarks=\"remarksArr\"\r\n                @close-remarks=\"closeRemarks\">\r\n            </remarks>\r\n          </view>\r\n        </view>\r\n      </view>\r\n      <view class=\"count_amount\">\r\n        <text>共{{ goodsData.goods_data.length }}件商品，小計</text>\r\n        <text>￥{{ totalAmount }}</text>\r\n      </view>\r\n    </view>\r\n    <!--支付方式-->\r\n    <view :class=\"['payment_method',goodsData.haul_method===1?'one_self':'']\">\r\n      <text>支付方式</text>\r\n      <view>\r\n        <image src=\"../../static/images/orderPayment/weixin_icon.png\"></image>\r\n        <text>微信支付</text>\r\n      </view>\r\n    </view>\r\n    <!--底部-->\r\n    <view class=\"payment_foot\">\r\n      <view class=\"payment_amount\">\r\n        <text>合計</text>\r\n        <text>￥{{ totalAmount }}</text>\r\n      </view>\r\n      <view @click=\"startPay\" class=\"payment_btn\">\r\n        <button plain>支付</button>\r\n      </view>\r\n    </view>\r\n    <view class=\"empty\"></view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport remarks from \"../../components-lk/remarks/remarks\";\r\nimport {createOrder, paymentAttach, paymentStart, usedCoupon} from \"../../request/api\";\r\nimport order from \"../order/order\";\r\n\r\nconst APP = getApp().globalData;\r\nexport default {\r\n  data() {\r\n    return {\r\n      userPhone: '',\r\n      isRemarks: false,\r\n      remarksData: {},\r\n      remarksArr: ['無接觸配送', '紙巾', '糖包'],\r\n      discountAmount: 0,\r\n      goodsPrice: 0,\r\n      goodsData: [],\r\n      attach: {},\r\n      totalAmount: 0,\r\n      attachArr: [],\r\n      couponInfo: [],\r\n      paymentTimer:null,\r\n    }\r\n  },\r\n  computed: {\r\n    //計算取茶時間進度條\r\n    computeProgress() {\r\n      let {current_cups, current_order} = this.goodsData;\r\n      return (current_order / current_cups) * 100;\r\n    }\r\n  },\r\n\r\n  async onLoad() {\r\n    this.goodsData = APP.goodsPayment;//订单整体数据\r\n    this.receivingMethod = this.goodsData.haul_method;//订单的配送方式\r\n    this.goods_data = [];//订单单个商品的信息，创建订单时传递给后台的数据\r\n    this.goodsId = ''//订单的单个商品的id,用户获取当前订单可使用的优惠券\r\n\r\n    //獲取訂單傳參數據\r\n    this.goodsData.goods_data.forEach((item, index) => {\r\n      this.goodsId += item.id;\r\n      this.goods_data.push({\r\n        id: item.id,\r\n        num: item.goods_num,\r\n        norm: item.norm_id\r\n      })\r\n    });\r\n\r\n    //订单总金额\r\n    this.totalAmount = parseFloat(this.goodsData.payment_info)\r\n\r\n    //獲取附加服務信息\r\n    try{\r\n      this.attach = (await paymentAttach()).data\r\n    }catch (e) {\r\n      console.log(e);\r\n      this.attach = {}\r\n    }\r\n\r\n    //獲取可使用的優惠券信息\r\n    try {\r\n      let temp = (await usedCoupon({\r\n        vehicle_method: this.goodsDatahaul_method,\r\n        goods_id: this.goodsId,\r\n        total_price: this.totalAmount\r\n      })).data\r\n      //優惠券返回一個對象，轉換為數組\r\n      for (let key in temp) {\r\n        if (temp.hasOwnProperty(key)) {\r\n          this.couponInfo.push(temp[key])\r\n        }\r\n      }\r\n    } catch (e) {\r\n      console.log(e);\r\n      this.couponInfo = [];\r\n    }\r\n  },\r\n  onShow() {\r\n    //页面展示时从全局对象中获取优惠券的金额\r\n    if(APP.coupon.goods_quota){\r\n      this.discountAmount = APP.coupon.goods_quota;\r\n    }else{\r\n      this.discountAmount = 0;\r\n      this.couponInfo = []\r\n    }\r\n  },\r\n  onUnload() {\r\n    //页面卸载时清空优惠券金额\r\n    APP.coupon = {};\r\n    //TODO清空支付定时器\r\n    clearTimeout(this.paymentTimer)\r\n  },\r\n  methods: {\r\n    // toggleReceiving(method) {\r\n    //   this.receivingMethod = method;\r\n    //   if (method === '2') {\r\n    //     this.surcharge = 5;\r\n    //     this.totalAmount += this.surcharge\r\n    //   } else {\r\n    //     this.surcharge ? this.totalAmount -= this.surcharge : null;\r\n    //     this.surcharge = 0;\r\n    //   }\r\n    // },\r\n    //自動輸入手機號\r\n    autoFill() {\r\n      this.userPhone = this.goodsData.contact_phone;\r\n    },\r\n\r\n    //訂單備註\r\n    closeRemarks(remarks) {\r\n      this.isRemarks = false;\r\n      this.remarksData = remarks\r\n    },\r\n    //跳轉至優惠券\r\n    navDiscount() {\r\n      if (!this.couponInfo.length) return;\r\n      uni.navigateTo({\r\n        url: '/pages/discount/discount?couponInfo=' + encodeURIComponent(JSON.stringify(this.couponInfo))\r\n      })\r\n    },\r\n    //使用附加服務\r\n    addAttachFee(id) {\r\n      let self = this;\r\n      self.isAttach = !self.isAttach;\r\n      self.attach.forEach((item) => {\r\n        if (item.id === id) {\r\n          if (self.isAttach) {\r\n            self.totalAmount += parseFloat(this.attach[0].attach_price);\r\n            self.attachArr.push(id)\r\n          } else {\r\n            self.totalAmount -= parseFloat(this.attach[0].attach_price)\r\n            self.attachArr.splice(self.attachArr.indexOf(id), 1)\r\n          }\r\n        }\r\n      })\r\n    },\r\n    //開始支付\r\n    async startPay() {\r\n      let self = this;\r\n      uni.showLoading({\r\n        title: '請稍後'\r\n      })\r\n      //創建訂單\r\n      let {shop_id, shop_name, address_id, haul_method} = self.goodsData;\r\n      //傳參對象\r\n      let paramsObj = {\r\n        shop_id,//訂單id\r\n        shop_name,\r\n        address_id,\r\n        haul_method,\r\n        goods_data: this.goods_data,\r\n        remake: '',\r\n        attach_id: '',\r\n        ticket_id: APP.coupon.id,\r\n      }\r\n      paramsObj.goods_data = JSON.stringify(paramsObj.goods_data)\r\n      //訂單備註\r\n      for (let key in self.remarksData) {\r\n        if (self.remarksData.hasOwnProperty(key)) {\r\n          if (self.remarksData[key]) {\r\n            paramsObj.remake += (self.remarksData[key] + ',');\r\n          }\r\n        }\r\n      }\r\n      if (paramsObj.remake) {\r\n        paramsObj.remake = paramsObj.remake.substr(0, paramsObj.remake.length - 1);\r\n      }\r\n      //附加信息\r\n      if (self.attachArr.length) {\r\n        self.attachArr.forEach((item) => {\r\n          paramsObj.attach_id += item + ',';\r\n        })\r\n        paramsObj.attach_id = paramsObj.attach_id.substr(0, paramsObj.attach_id.length - 1);\r\n      }\r\n      //選填參數沒有值直接刪除\r\n      for (let key in paramsObj) {\r\n        if (paramsObj.hasOwnProperty(key)) {\r\n          if (!paramsObj[key]) {\r\n            delete paramsObj[key]\r\n          }\r\n        }\r\n      }\r\n      //创建订单\r\n      // try {\r\n      //    orderNum = (await createOrder(paramsObj)).data.order_num;\r\n      //    orderInfo = (await paymentStart({order_num: orderNum, shop_id: paramsObj.shop_id})).data\r\n      // } catch (e) {\r\n      //   self.customToast('订单创建失败')\r\n      //   console.log(e);\r\n      //   return;\r\n      // }\r\n      //支付订单\r\n      // TODO 延迟请求微信支付，非最终方案\r\n      self.paymentTimer && clearTimeout(self.paymentTimer)\r\n      //发起微信支付\r\n      self.paymentTimer = setTimeout(async () => {\r\n        console.log(2);\r\n        try {\r\n          let orderNum = (await createOrder(paramsObj)).data.order_num;\r\n          let orderInfo = (await paymentStart({order_num: orderNum, shop_id: paramsObj.shop_id})).data\r\n          await self.utilPayment(orderInfo)\r\n          await self.paymentSuccess();\r\n        } catch (e) {\r\n          self.customToast('订单创建失败')\r\n          console.log(e);\r\n        }\r\n      }, 3000)\r\n    },\r\n    //订单结算成功，跳转至订单页\r\n    async paymentSuccess(){\r\n      this.customToast('结算成功');\r\n      uni.switchTab({\r\n        url:'/pages/orderForm/orderForm',\r\n      })\r\n    }\r\n  },\r\n  watch: {\r\n    discountAmount(newAmount, oldAmount) {\r\n      newAmount = parseFloat(newAmount);\r\n      oldAmount = parseFloat(oldAmount)\r\n      newAmount ? this.totalAmount -= newAmount : this.totalAmount += oldAmount;\r\n    },\r\n  },\r\n  components: {\r\n    remarks\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\r\n.order_payment {\r\n  width: 100%;\r\n  height: 100%;\r\n  background-color: #F7F7F7;\r\n  color: $font-color1;\r\n  font-weight: $font-weight-base;\r\n\r\n  .order_payment_head {\r\n    width: 100%;\r\n    background-color: #FFFFFF;\r\n    display: flex;\r\n    flex-direction: column;\r\n    justify-content: space-between;\r\n    padding: 0 $spacing-base;\r\n    box-sizing: border-box;\r\n\r\n    .name_method {\r\n      width: 100%;\r\n      display: flex;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n\r\n      &.one_self{\r\n        border-bottom: 1rpx solid rgba(204, 204, 204, .5);\r\n      }\r\n\r\n      .shop_name {\r\n        font-size: $font-size-lg + 2rpx;\r\n        font-weight: $font-weight-lg;\r\n\r\n        text:nth-child(3) {\r\n          font-size: $font-size-sm + 2rpx;\r\n          color: $font-color2;\r\n          display: block;\r\n          margin: 10rpx 0 $spacing-lg 0;\r\n          font-weight: $font-weight-base;\r\n        }\r\n      }\r\n\r\n      .receiving_method {\r\n        width: 240rpx;\r\n        height: 68rpx;\r\n        background: #f6f6f6;\r\n        border: 1rpx solid $main-color;\r\n        border-radius: 34rpx;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: space-around;\r\n        font-size: $font-size-sm;\r\n        color: $main-color;\r\n\r\n        view {\r\n          flex: 1;\r\n          text-align: center;\r\n          width: 80rpx;\r\n          height: 58rpx;\r\n          line-height: 58rpx;\r\n\r\n          &.active_method {\r\n            background: $main-color;\r\n            border-radius: 29rpx;\r\n            color: #FFFFFF;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    .phone {\r\n      width: 100%;\r\n      height: 46rpx;\r\n      display: flex;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n      margin: $spacing-lg + 4rpx 0;\r\n\r\n      .phone_input {\r\n        font-size: $font-size-base;\r\n        color: $font-color1;\r\n\r\n        label {\r\n          display: flex;\r\n          align-items: center;\r\n          flex-wrap: nowrap;\r\n\r\n          input {\r\n            font-size: $font-size-base;\r\n            color: $font-color1;\r\n            margin-left: 20rpx;\r\n          }\r\n        }\r\n      }\r\n\r\n      .auto_fill {\r\n        width: 118rpx;\r\n        height: 46rpx;\r\n        background: #ffffff;\r\n        border: 1rpx solid $main-color;\r\n        border-radius: 6rpx;\r\n        font-size: $font-size-sm;\r\n        color: $main-color;\r\n        padding: 0;\r\n        margin: 0;\r\n        line-height: 46rpx;\r\n      }\r\n    }\r\n  }\r\n\r\n  .order_time {\r\n    width: 100%;\r\n    min-height: 210rpx;\r\n    margin-top: $spacing-base;\r\n    background: #FFFFFF;\r\n    padding: $spacing-lg $spacing-base;\r\n    box-sizing: border-box;\r\n    font-size: $font-size-base;\r\n    color: $font-color1;\r\n    display: flex;\r\n    flex-direction: column;\r\n\r\n    .order_progress {\r\n      font-size: $font-size-sm;\r\n      color: $font-color3;\r\n      margin: 20rpx 0;\r\n\r\n      .text_color {\r\n        color: $main-color;\r\n        font-size: $font-size-base\r\n      }\r\n    }\r\n\r\n    .current_progress {\r\n      width: 702rpx;\r\n      height: 30rpx;\r\n      background: #f0f0f0;\r\n      border-radius: 15rpx;\r\n      overflow: hidden;\r\n\r\n      /* #ifdef H5 */\r\n      /deep/ .uni-progress-bar {\r\n        height: 30rpx !important;\r\n      }\r\n\r\n      /deep/.uni-progress-inner-bar {\r\n        border-radius: 15rpx;\r\n      }\r\n\r\n      /* #endif*/\r\n    }\r\n  }\r\n\r\n  .goods_list {\r\n    width: 100%;\r\n    padding: $spacing-lg $spacing-base;\r\n    box-sizing: border-box;\r\n    background: #FFFFFF;\r\n    margin-top: $spacing-base;\r\n\r\n    .list_detail {\r\n      width: 100%;\r\n      min-height: 220rpx;\r\n      border-bottom: 1rpx solid rgba(204, 204, 204, .4);\r\n      display: flex;\r\n      flex-direction: column;\r\n      box-sizing: border-box;\r\n\r\n      .list_title {\r\n        height: 40rpx;\r\n        font-size: $font-size-base;\r\n        color: $font-color1;\r\n      }\r\n\r\n      .goods_detail {\r\n        width: 100%;\r\n        margin-top: $spacing-lg;\r\n        display: flex;\r\n        flex-wrap: nowrap;\r\n        align-items: center;\r\n        position: relative;\r\n\r\n        .goods_img {\r\n          margin-right: 20rpx;\r\n\r\n          image {\r\n            width: 120rpx;\r\n            height: 120rpx;\r\n            vertical-align: middle;\r\n          }\r\n        }\r\n\r\n        .goods_info {\r\n          align-self: center;\r\n\r\n          .goods_name {\r\n            font-size: $font-size-base;\r\n            font-weight: $font-weight-lg;\r\n            color: $font-color1;\r\n            margin-bottom: 10rpx;\r\n          }\r\n\r\n          .goods_extra_info {\r\n            height: 60rpx;\r\n            font-size: $font-size-sm - 2rpx;\r\n            color: $font-color3;\r\n            display: flex;\r\n            flex-direction: row;\r\n            flex-wrap: wrap;\r\n          }\r\n        }\r\n\r\n        .goods_amount {\r\n          min-width: 75rpx;\r\n          height: 91rpx;\r\n          display: flex;\r\n          flex-direction: column;\r\n          justify-content: space-between;\r\n          position: absolute;\r\n          right: 0;\r\n          text-align: center;\r\n\r\n          text:nth-child(1) {\r\n            font-size: $font-size-lg + 2rpx;\r\n            font-weight: $font-weight-lg;\r\n            color: $font-color1;\r\n          }\r\n\r\n          text:nth-child(2) {\r\n            font-size: $font-size-sm;\r\n            color: $font-color3;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    .attach_service {\r\n      width: 100%;\r\n      font-size: $font-size-sm;\r\n      color: $font-color1;\r\n      padding-top: $spacing-lg;\r\n      box-sizing: border-box;\r\n\r\n      .service1,\r\n      .service2,\r\n      .service3,\r\n      .delivery_fee{\r\n        display: flex;\r\n        justify-content: space-between;\r\n        align-items: center;\r\n        margin-bottom: $spacing-lg;\r\n\r\n        .left {\r\n          display: flex;\r\n          flex-direction: column;\r\n          justify-content: space-around;\r\n        }\r\n      }\r\n\r\n      .service1 {\r\n        .left {\r\n          .left_name {\r\n            align-self: flex-start;\r\n\r\n            text:nth-child(2) {\r\n              flex: 1;\r\n              display: inline-block;\r\n              width: 80rpx;\r\n              height: 30rpx;\r\n              background: $main-color;\r\n              border-radius: 4rpx;\r\n              color: #FFFFFF;\r\n              font-size: $font-size-sm - 6rpx;\r\n              text-align: center;\r\n              line-height: 30rpx;\r\n              margin-left: 10rpx;\r\n              overflow: hidden;\r\n              vertical-align: middle;\r\n            }\r\n          }\r\n\r\n          .left_des {\r\n            flex: 1;\r\n            font-size: $font-size-sm - 2rpx;\r\n            color: $main-color;\r\n            padding-top: 10rpx;\r\n          }\r\n        }\r\n\r\n        .right {\r\n          height: 34rpx;\r\n          font-size: $font-size-sm;\r\n          color: $font-color1;\r\n\r\n          text {\r\n            margin-right: 10rpx;\r\n          }\r\n\r\n          /* #ifdef H5*/\r\n          /deep/.uni-radio-input {\r\n            width: 34rpx;\r\n            height: 34rpx;\r\n            margin-right: 0;\r\n          }\r\n\r\n          /* #endif*/\r\n        }\r\n      }\r\n\r\n      .service2,\r\n      .service3 {\r\n        .right {\r\n          font-size: $font-size-sm;\r\n          color: #cccccc;\r\n        }\r\n      }\r\n      .service3{\r\n        .right{\r\n          color: $font-color1;\r\n        }\r\n      }\r\n      .service2{\r\n        min-height: 46rpx;\r\n\r\n        .left{\r\n          position: relative;\r\n          text:nth-child(2){\r\n            width: 30rpx;\r\n            height: 30rpx;\r\n            background: $main-color;\r\n            border-radius: 4rpx;\r\n            font-size: $font-size-sm - 4rpx;\r\n            color: #ffffff;\r\n            text-align: center;\r\n            line-height: 30rpx;\r\n            position: absolute;\r\n            left: 82rpx;\r\n          }\r\n        }\r\n\r\n        .right{\r\n          .discount{\r\n            min-width: 254rpx;\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: center;\r\n            text-align: center;\r\n\r\n            view {\r\n              min-width: 214rpx;\r\n              height: 46rpx;\r\n              border: 2rpx solid $main-color;\r\n              border-radius: 23px;\r\n              font-size: $font-size-sm - 4rpx;\r\n              color: $main-color;\r\n              line-height: 42rpx;\r\n              text-align: center;\r\n              box-sizing: border-box;\r\n              margin-right: 10rpx;\r\n            }\r\n\r\n            image{\r\n              width: 34rpx;\r\n              height: 34rpx;\r\n              vertical-align: middle;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    .count_amount {\r\n      width: 100%;\r\n      text-align: right;\r\n      height: 33rpx;\r\n      font-size: $font-size-sm;\r\n      color: $font-color1;\r\n\r\n      text:nth-child(2) {\r\n        font-size: $font-size-lg + 2rpx;\r\n        font-weight: $font-weight-lg;\r\n        vertical-align: middle;\r\n      }\r\n    }\r\n  }\r\n\r\n  .payment_method {\r\n    width: 100%;\r\n    height: 93rpx;\r\n    background: #FFFFFF;\r\n    font-size: $font-size-sm;\r\n    color: $font-color1;\r\n    padding: 0 $spacing-base;\r\n    box-sizing: border-box;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n\r\n    &.one_self{\r\n      margin-top: $spacing-lg;\r\n    }\r\n\r\n    view {\r\n      display: flex;\r\n      align-items: center;\r\n\r\n      image {\r\n        width: 29rpx;\r\n        height: 25rpx;\r\n        vertical-align: middle;\r\n        margin-right: 10rpx;\r\n      }\r\n    }\r\n  }\r\n\r\n  .payment_foot {\r\n    width: 100%;\r\n    height: 97rpx;\r\n    background: #ffffff;\r\n    border-top: 1rpx solid #cccccc;\r\n    display: flex;\r\n    justify-content: flex-end;\r\n    box-sizing: border-box;\r\n    position: fixed;\r\n    bottom: 0;\r\n\r\n    .payment_amount {\r\n      font-size: $font-size-sm;\r\n      color: $font-color1;\r\n      line-height: 97rpx;\r\n      margin-right: $spacing-lg;\r\n      margin-left: 10rpx;\r\n\r\n      text:nth-child(2) {\r\n        font-size: $font-size-sm + 2rpx;\r\n        font-weight: $font-weight-lg;\r\n        color: $main-color;\r\n      }\r\n    }\r\n\r\n    button {\r\n      border: none;\r\n      width: 200rpx;\r\n      height: 97rpx;\r\n      background: $main-color;\r\n      font-size: $font-size-base;\r\n      color: #ffffff;\r\n      padding: 0;\r\n      line-height: 97rpx;\r\n      border-radius: 0;\r\n    }\r\n  }\r\n\r\n  .empty {\r\n    width: 100%;\r\n    height: 96rpx;\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/orderPayment/orderPayment.vue	(revision a6175d8333c8e25bf1fa5f6fd86a4a31565b5d4d)
+++ pages/orderPayment/orderPayment.vue	(date 1603259470126)
@@ -30,7 +30,7 @@
         <view class="phone_input">
           <label>
             <text>聯系電話</text>
-            <input :value="userPhone" type="number">
+            <input maxlength="11" :value="userPhone" type="number">
           </label>
         </view>
         <button @click="autoFill" class="auto_fill" plain>自動填寫</button>
@@ -203,6 +203,7 @@
       attachArr: [],
       couponInfo: [],
       paymentTimer:null,
+      paymentStatus:false,//订单的支付状态，为true时禁止再次点击支付
     }
   },
   computed: {
@@ -215,7 +216,6 @@
 
   async onLoad() {
     this.goodsData = APP.goodsPayment;//订单整体数据
-    this.receivingMethod = this.goodsData.haul_method;//订单的配送方式
     this.goods_data = [];//订单单个商品的信息，创建订单时传递给后台的数据
     this.goodsId = ''//订单的单个商品的id,用户获取当前订单可使用的优惠券
 
@@ -268,25 +268,16 @@
     }
   },
   onUnload() {
+    this.paymentStatus =  false;
     //页面卸载时清空优惠券金额
     APP.coupon = {};
     //TODO清空支付定时器
     clearTimeout(this.paymentTimer)
   },
   methods: {
-    // toggleReceiving(method) {
-    //   this.receivingMethod = method;
-    //   if (method === '2') {
-    //     this.surcharge = 5;
-    //     this.totalAmount += this.surcharge
-    //   } else {
-    //     this.surcharge ? this.totalAmount -= this.surcharge : null;
-    //     this.surcharge = 0;
-    //   }
-    // },
     //自動輸入手機號
     autoFill() {
-      this.userPhone = this.goodsData.contact_phone;
+      this.userPhone = APP.userInfo.mobile;
     },
 
     //訂單備註
@@ -319,6 +310,9 @@
     },
     //開始支付
     async startPay() {
+      //订单为支付状态时再次点击支付直接返回
+      if(this.paymentStatus) return;
+      this.paymentStatus = true;
       let self = this;
       uni.showLoading({
         title: '請稍後'
@@ -381,16 +375,19 @@
         try {
           let orderNum = (await createOrder(paramsObj)).data.order_num;
           let orderInfo = (await paymentStart({order_num: orderNum, shop_id: paramsObj.shop_id})).data
+          console.log(1);
           await self.utilPayment(orderInfo)
           await self.paymentSuccess();
         } catch (e) {
-          self.customToast('订单创建失败')
+          self.customToast('订单创建失败');
+          self.paymentStatus = false;
           console.log(e);
         }
       }, 3000)
     },
     //订单结算成功，跳转至订单页
     async paymentSuccess(){
+      this.paymentStatus = false;
       this.customToast('结算成功');
       uni.switchTab({
         url:'/pages/orderForm/orderForm',
Index: pages/setPassword/setPassword.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"set_password\">\r\n    <view class=\"content\">\r\n      <view class=\"head_title\">\r\n        <text v-if=\"pwd.length !== 6\">請設置交易密碼</text>\r\n        <text v-else>請确认交易密碼</text>\r\n        <text class=\"title_tip\">為了您的資金安全，請先設置交易密碼</text>\r\n      </view>\r\n<!--        <label v-for=\"(code,index) in 6\" :key=\"index\">-->\r\n<!--          <input class=\"pwd_content\"-->\r\n<!--                 disabled-->\r\n<!--                 maxlength=\"1\"-->\r\n<!--                 v-model=\"currentPwd[index]\"-->\r\n<!--                 type=\"password\">-->\r\n<!--        </label>-->\r\n<!--        <input focus-->\r\n<!--               @input=\"inputPwd\"-->\r\n<!--               v-model=\"currentPwd\"-->\r\n<!--               maxlength=\"6\"-->\r\n<!--               class=\"empty_input\"-->\r\n<!--               type=\"text\">-->\r\n        <oneInput :isBox=\"true\"\r\n                  :is-pwd=\"true\"\r\n                  v-model=\"currentPwd\"\r\n                  type=\"box\"\r\n                  :maxlength=\"6\">\r\n        </oneInput>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport {setPwd} from \"../../request/api\";\r\nimport oneInput from '../../components/myp-one/myp-one'\r\nexport default {\r\n  data() {\r\n    return {\r\n      pwd:'',\r\n      currentPwd:''\r\n    }\r\n  },\r\n  watch:{\r\n   async currentPwd(value){\r\n      if(!value) return ;\r\n     console.log(this.pwd);\r\n     console.log(this.currentPwd);\r\n     if(value.length === 6 && this.pwd.length === 6){\r\n       if(value === this.pwd){\r\n         try{\r\n           uni.showLoading({\r\n             title:'请稍后'\r\n           });\r\n           //TODO 生产环境需删除设置的token\r\n           let result = await setPwd({\r\n             password:this.pwd,\r\n             veify_pwd:value\r\n           })\r\n           uni.hideLoading()\r\n           uni.redirectTo({\r\n             url:'/pages/wallet/wallet'\r\n           })\r\n         }catch (e){\r\n           this.customToast('密碼過於簡單')\r\n           this.currentPwd='';\r\n           this.pwd = '';\r\n         }\r\n       }else{\r\n         this.customToast('密碼不一致')\r\n         this.currentPwd = ''\r\n         this.pwd = '';\r\n       }\r\n        return\r\n      }\r\n      if(value.length === 6){\r\n        this.pwd = value;\r\n        this.currentPwd = '';\r\n      }\r\n    }\r\n  },\r\n  components:{\r\n    oneInput\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n.set_password{\r\n  width: 100%;\r\n  height: 100%;\r\n  padding-top: 100rpx;\r\n  box-sizing: border-box;\r\n\r\n  .content{\r\n    width: 606rpx;\r\n    margin: 0 auto;\r\n\r\n    .head_title{\r\n      width: 100%;\r\n      height: 88rpx;\r\n      display: flex;\r\n      flex-direction: column;\r\n      justify-content: space-between;\r\n      text-align: center;\r\n      margin-bottom: 50rpx;\r\n\r\n      text{\r\n        font-size: $font-size-lg;\r\n        font-weight: $font-weight-lg;\r\n        color: $font-color1;\r\n      }\r\n\r\n      .title_tip{\r\n        font-size: $font-size-sm;\r\n        font-weight: $font-weight-base;\r\n        color: $font-color3;\r\n        margin-top: 10rpx;\r\n      }\r\n\r\n\r\n    }\r\n\r\n    .password{\r\n      display: flex;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n      //.pwd_content{\r\n      //  width: 76rpx;\r\n      //  height: 90rpx;\r\n      //  background: #eaeaea;\r\n      //  border-radius: 4rpx;\r\n      //  text-align: center;\r\n      //  z-index: -1;\r\n      //}\r\n      //\r\n      //.empty_input{\r\n      //  height: 90rpx;\r\n      //  width: calc(100% + 200rpx);\r\n      //  position: absolute;\r\n      //  opacity: 0;\r\n      //  z-index: 999;\r\n      //  background-color: pink;\r\n      //  margin-left: -200rpx;\r\n      //}\r\n    }\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/setPassword/setPassword.vue	(revision a6175d8333c8e25bf1fa5f6fd86a4a31565b5d4d)
+++ pages/setPassword/setPassword.vue	(date 1603245171347)
@@ -6,25 +6,26 @@
         <text v-else>請确认交易密碼</text>
         <text class="title_tip">為了您的資金安全，請先設置交易密碼</text>
       </view>
-<!--        <label v-for="(code,index) in 6" :key="index">-->
-<!--          <input class="pwd_content"-->
-<!--                 disabled-->
-<!--                 maxlength="1"-->
-<!--                 v-model="currentPwd[index]"-->
-<!--                 type="password">-->
-<!--        </label>-->
-<!--        <input focus-->
-<!--               @input="inputPwd"-->
-<!--               v-model="currentPwd"-->
-<!--               maxlength="6"-->
-<!--               class="empty_input"-->
-<!--               type="text">-->
-        <oneInput :isBox="true"
-                  :is-pwd="true"
-                  v-model="currentPwd"
-                  type="box"
-                  :maxlength="6">
-        </oneInput>
+      <!--        <label v-for="(code,index) in 6" :key="index">-->
+      <!--          <input class="pwd_content"-->
+      <!--                 disabled-->
+      <!--                 maxlength="1"-->
+      <!--                 v-model="currentPwd[index]"-->
+      <!--                 type="password">-->
+      <!--        </label>-->
+      <!--        <input focus-->
+      <!--               @input="inputPwd"-->
+      <!--               v-model="currentPwd"-->
+      <!--               maxlength="6"-->
+      <!--               class="empty_input"-->
+      <!--               type="text">-->
+      <oneInput :isBox="true"
+                :is-pwd="true"
+                :autoFocus="true"
+                v-model="currentPwd"
+                type="box"
+                :maxlength="6">
+      </oneInput>
     </view>
   </view>
 </template>
@@ -32,52 +33,49 @@
 <script>
 import {setPwd} from "../../request/api";
 import oneInput from '../../components/myp-one/myp-one'
+
 export default {
   data() {
     return {
-      pwd:'',
-      currentPwd:''
+      pwd: '',
+      currentPwd: ''
     }
   },
-  watch:{
-   async currentPwd(value){
-      if(!value) return ;
-     console.log(this.pwd);
-     console.log(this.currentPwd);
-     if(value.length === 6 && this.pwd.length === 6){
-       if(value === this.pwd){
-         try{
-           uni.showLoading({
-             title:'请稍后'
-           });
-           //TODO 生产环境需删除设置的token
-           let result = await setPwd({
-             password:this.pwd,
-             veify_pwd:value
-           })
-           uni.hideLoading()
-           uni.redirectTo({
-             url:'/pages/wallet/wallet'
-           })
-         }catch (e){
-           this.customToast('密碼過於簡單')
-           this.currentPwd='';
-           this.pwd = '';
-         }
-       }else{
-         this.customToast('密碼不一致')
-         this.currentPwd = ''
-         this.pwd = '';
-       }
+  watch: {
+    async currentPwd(value) {
+      if (!value) return;
+      if (value.length === 6 && this.pwd.length === 6) {
+        if (value === this.pwd) {
+          uni.showLoading({
+            title: '请稍后'
+          });
+          try {
+            await setPwd({password: this.pwd, veify_pwd: value})
+
+            uni.hideLoading()
+            //登录成功重定向至钱包页面
+            uni.redirectTo({
+              url: '/pages/wallet/wallet'
+            })
+          } catch (e) {
+            this.currentPwd = '';
+            this.pwd = '';
+            this.customToast('密碼設置失敗')
+          }
+        } else {
+          this.customToast('密碼不一致')
+          this.currentPwd = ''
+          this.pwd = '';
+        }
         return
       }
-      if(value.length === 6){
+      if (value.length === 6) {
         this.pwd = value;
         this.currentPwd = '';
       }
     }
   },
-  components:{
+  components: {
     oneInput
   }
 }
Index: pages/wallet/wallet.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view v-if=\"reRender\" class=\"wallet\">\r\n    <view class=\"container\">\r\n      <view class=\"head\">\r\n        <text class=\"balance\">可用余額</text>\r\n        <view>\r\n          <text class=\"symbol\">￥</text>\r\n          <text class=\"amount\">{{ amount || '0' }}</text>\r\n        </view>\r\n        <text @click=\"rechargeBox = true\" class=\"btn\">立即充值</text>\r\n      </view>\r\n      <view class=\"options\">\r\n        <optionsList @options-click=\"navRecharge\" :list=\"options\"></optionsList>\r\n      </view>\r\n    </view>\r\n\r\n    <view v-if=\"rechargeBox\" class=\"recharge\">\r\n      <view class=\"content\">\r\n        <view class=\"title\">整數充值</view>\r\n        <input v-model=\"rechargeAmount\"\r\n               type=\"text\"\r\n               placeholder=\"請輸入充值金額\">\r\n        <view class=\"btn\">\r\n          <button plain @click=\"rechargeBox = false\">取消</button>\r\n          <button plain @click=\"rechargeStart\">充值</button>\r\n        </view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport optionsList from \"../../components-lk/optionsList/optionsList\";\r\nimport {recharge, sendCheckCode, userSpace} from '../../request/api'\r\n\r\nconst APP = getApp().globalData;\r\nexport default {\r\n  data() {\r\n    return {\r\n      amount: '0.00',\r\n      options: [{\r\n        title: '掃碼支付',\r\n        summary: '可使用錢包直接支付',\r\n        icon: 'arrowright'\r\n      }, {\r\n        title: '消費記錄',\r\n        icon: 'arrowright'\r\n      }, {\r\n        title: '重置交易密碼',\r\n        icon: 'arrowright'\r\n      },],\r\n      rechargePwd: false,\r\n      phone: '',\r\n      rechargeBox: false,\r\n      rechargeAmount: '',\r\n      reRender: 1,//用戶充值後強制刷新頁面的條件\r\n    }\r\n  },\r\n  onShow() {\r\n    this.amount = APP.userInfo.balance;\r\n  },\r\n  mounted() {\r\n    this.amount = APP.userInfo.balance\r\n    this.originPhone = APP.userInfo.mobile;\r\n    //处理手机号展示形式\r\n    this.phone = this.originPhone.replace(/\\d/g, function (value, index) {\r\n      if (index >= 3 && index <= 7) {\r\n        return 'x'\r\n      } else {\r\n        return value\r\n      }\r\n    })\r\n  },\r\n  methods: {\r\n    //导航到对应的页面\r\n    async navRecharge(v) {\r\n      let {page} = v;\r\n      switch (page) {\r\n        case '消費記錄':\r\n          page = 'expensesRecord';\r\n          break;\r\n        case '掃碼支付':\r\n          page = 'memberCode';\r\n          break;\r\n        case '重置交易密碼':\r\n          await this.changePayPwd()\r\n      }\r\n      uni.navigateTo({\r\n        url: `/pages/${page}/${page}`\r\n      })\r\n    },\r\n    //修改支付密码\r\n    changePayPwd() {\r\n      let self = this;\r\n      uni.showModal({\r\n        title: '重置交易密碼',\r\n        content: '短信驗證碼將發送已綁定手機\\n' + this.phone,\r\n        async success(o) {\r\n          try {\r\n            //點擊確定進入重置密碼頁面\r\n            if (o.confirm) {\r\n              uni.showLoading({\r\n                title: '正在發送驗證碼'\r\n              })\r\n              //发送验证码\r\n              let result = await sendCheckCode({mobile: self.originPhone})\r\n              uni.navigateTo({\r\n                url: '/pages/checkCode/checkCode?change=1',\r\n                success() {\r\n                  uni.hideLoading()\r\n                }\r\n              })\r\n            }\r\n          } catch (e) {\r\n            console.log(e);\r\n            self.customToast('驗證碼發送失敗')\r\n          }\r\n        }\r\n      })\r\n    },\r\n\r\n    //支付功能\r\n    async rechargeStart() {\r\n      let self = this;\r\n      if (Number(this.rechargeAmount)) {\r\n        this.rechargeBox = false;\r\n        try {\r\n          //获取支付信息\r\n          let orderInfo = (await recharge({\r\n            amount: this.rechargeAmount\r\n          })).data;\r\n\r\n          //开始支付\r\n          await self.utilPayment(orderInfo);\r\n          await self.paymentSuccess()\r\n\r\n        } catch (e) {\r\n          console.log(e);\r\n          this.customToast('充值错误')\r\n        }\r\n      }\r\n    },\r\n    //支付成功\r\n   async paymentSuccess(e){\r\n     try{\r\n       console.log(e);\r\n       this.customToast('充值成功');\r\n       this.rechargeAmount = '';\r\n       APP.userInfo = (await userSpace()).data\r\n       this.amount = APP.userInfo.balance;\r\n       console.log(APP.userInfo);\r\n       console.log(this.amount);\r\n     }catch (e) {\r\n       console.log(e);\r\n     }\r\n   },\r\n    //支付失败\r\n    paymentError(e){\r\n      console.log(e);\r\n      this.customToast('充值失败');\r\n      this.rechargeAmount = '';\r\n    }\r\n  },\r\n  //監視充值價格，為整數\r\n  // watch: {\r\n  //   rechargeAmount(n, o) {\r\n  //     let newStr = n.slice(o.length),\r\n  //         newNum = parseInt(newStr)\r\n  //     if (isNaN(newNum)) {\r\n  //       this.rechargeAmount = '';\r\n  //     }\r\n  //   },\r\n  // },\r\n  components: {\r\n    optionsList\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"scss\">\r\n.wallet {\r\n  width: 100%;\r\n  height: 100%;\r\n  padding-top: 100rpx;\r\n  box-sizing: border-box;\r\n\r\n  .container{\r\n    width: 100%;\r\n    padding: 0 24rpx;\r\n    box-sizing: border-box;\r\n\r\n    .head{\r\n      width: 100%;\r\n      height: 174rpx;\r\n      display: flex;\r\n      flex-direction: column;\r\n      justify-content: space-between;\r\n      align-items: center;\r\n      margin-bottom: 154rpx;\r\n\r\n      .balance{\r\n        font-size: $font-size-lg;\r\n        font-weight: $font-weight-lg;\r\n        color: $font-color1;\r\n      }\r\n      .symbol{\r\n        font-size: $font-size-lg;\r\n        font-weight: $font-weight-lg;\r\n        color: $font-color1;\r\n      }\r\n      .amount{\r\n        font-size: 60rpx;\r\n        font-weight: $font-weight-lg;\r\n        color: $font-color1;\r\n      }\r\n      .btn{\r\n        display: inline-block;\r\n        width: 320rpx;\r\n        height: 80rpx;\r\n        background: $main-color;\r\n        font-size: $font-size-base;\r\n        color: #ffffff;\r\n        text-align: center;\r\n        line-height: 80rpx;\r\n      }\r\n    }\r\n\r\n    .options {\r\n      width: 100%;\r\n      height: 360rpx;\r\n    }\r\n  }\r\n  .recharge{\r\n    width: 100vw;\r\n    height: 100vh;\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    background-color: rgba(0,0,0,.6);\r\n    z-index: 1000000;\r\n\r\n    .content{\r\n      width: 480rpx;\r\n      height: 330rpx;\r\n      background: #ffffff;\r\n      border-radius: 20rpx;\r\n      position: absolute;\r\n      left: 50%;\r\n      margin-left: - 240rpx;\r\n      top:50%;\r\n      margin-top:-330rpx;\r\n      text-align: center;\r\n\r\n      .title{\r\n        font-size: $font-weight-base;\r\n        font-weight:$font-weight-lg;\r\n        color: $font-color1;\r\n        margin-top: 50rpx;\r\n      }\r\n\r\n      .btn{\r\n        width: 100%;\r\n        display: flex;\r\n        justify-content: space-around;\r\n        align-items: center;\r\n        position: absolute;\r\n        bottom: 48rpx;\r\n\r\n        button{\r\n          border:none;\r\n          width: 150rpx;\r\n          height: 58rpx;\r\n          background: $main-color;\r\n          border-radius: 4rpx;\r\n          font-size: $font-size-sm;\r\n          color: #ffffff;\r\n          padding: 0;\r\n        }\r\n      }\r\n\r\n      input{\r\n        width: 330rpx;\r\n        height: 54rpx;\r\n        border: 1rpx solid #cccccc;\r\n        border-radius: 8rpx;\r\n        position: absolute;\r\n        left: 50%;\r\n        top: 120rpx;\r\n        transform: translate(-50%,0);\r\n        padding: 0 10rpx;\r\n        box-sizing: border-box;\r\n        text-align: left;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/wallet/wallet.vue	(revision a6175d8333c8e25bf1fa5f6fd86a4a31565b5d4d)
+++ pages/wallet/wallet.vue	(date 1603247772738)
@@ -38,7 +38,8 @@
   data() {
     return {
       amount: '0.00',
-      options: [{
+      options: [
+          {
         title: '掃碼支付',
         summary: '可使用錢包直接支付',
         icon: 'arrowright'
@@ -54,6 +55,7 @@
       rechargeBox: false,
       rechargeAmount: '',
       reRender: 1,//用戶充值後強制刷新頁面的條件
+      paymentStatus:false,
     }
   },
   onShow() {
@@ -112,7 +114,7 @@
               })
             }
           } catch (e) {
-            console.log(e);
+            console.log(e.data.msg);
             self.customToast('驗證碼發送失敗')
           }
         }
@@ -121,6 +123,8 @@
 
     //支付功能
     async rechargeStart() {
+      if(this.paymentStatus) return;
+      this.paymentStatus = true;
       let self = this;
       if (Number(this.rechargeAmount)) {
         this.rechargeBox = false;
@@ -136,32 +140,28 @@
 
         } catch (e) {
           console.log(e);
-          this.customToast('充值错误')
+          self.paymentStatus = false;
+          self.rechargeAmount = '';
+          self.customToast('充值失敗')
         }
       }
     },
     //支付成功
    async paymentSuccess(e){
-     try{
-       console.log(e);
-       this.customToast('充值成功');
-       this.rechargeAmount = '';
+     console.log(e);
+     this.paymentStatus = false;
+     this.customToast('充值成功');
+     this.rechargeAmount = '';
+     //重新获取用户数据
+     try{
        APP.userInfo = (await userSpace()).data
        this.amount = APP.userInfo.balance;
-       console.log(APP.userInfo);
-       console.log(this.amount);
      }catch (e) {
        console.log(e);
      }
    },
-    //支付失败
-    paymentError(e){
-      console.log(e);
-      this.customToast('充值失败');
-      this.rechargeAmount = '';
-    }
   },
-  //監視充值價格，為整數
+  //TODO 監視充值價格，為整數,生产环境需打开
   // watch: {
   //   rechargeAmount(n, o) {
   //     let newStr = n.slice(o.length),
Index: pages/checkCode/checkCode.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"check_code\">\r\n    <view class=\"login_head\">\r\n      <image src=\"../../static/images_t/orderForm/login_box.png\"></image>\r\n    </view>\r\n    <view class=\"input_container\">\r\n      <view class=\"login_tip\">\r\n        <text>請輸入驗證碼</text>\r\n        <text>已將驗證碼發送至{{ phone }}</text>\r\n      </view>\r\n      <view class=\"code_input\">\r\n        <!--改用组件-->\r\n<!--        <label v-for=\"(code,index) in 6\" :key=\"index\">-->\r\n<!--          <input class=\"input_content\"-->\r\n<!--                 disabled-->\r\n<!--                 maxlength=\"1\"-->\r\n<!--                 v-model=\"verificationCode[index]\"-->\r\n<!--                 type=\"text\">-->\r\n<!--        </label>-->\r\n<!--        <input focus @input=\"inputCode\" v-model=\"verificationCode\" maxlength=\"6\" class=\"empty_input\" type=\"text\">-->\r\n\r\n        <view>\r\n          <view style=\"height: 100rpx;\"></view>\r\n          <one-input v-model=\"verificationCode\" :maxlength=\"6\"></one-input>\r\n          <view style=\"height: 100rpx;\"></view>\r\n        </view>\r\n      </view>\r\n      <view class=\"code_timer\">\r\n        <text>{{ timer }}秒後重發</text>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport {login, verifyCode,sendCheckCode} from \"../../request/api\";\r\nimport oneInput from '../../components/myp-one/myp-one'\r\n\r\nconst APP = getApp().globalData;\r\nexport default {\r\n  data() {\r\n    return {\r\n      phone: '',\r\n      verificationCode: '',\r\n      isFocus: 0,\r\n      timer: 200,\r\n      wxCode: '',\r\n      from: ''\r\n    }\r\n  },\r\n\r\n  onLoad(options) {\r\n    console.log(options.from);\r\n    this.phone = options.phone || APP.userInfo.mobile;//用户手机号\r\n    this.change = options.change;//有值则是修改密码\r\n    this.from = options.from;//登录完成后跳转的页面，默认跳转首页\r\n    this.customToast('驗證碼已發送', false)\r\n  },\r\n  //页面隐藏式清除定时器，并且验证码归位\r\n  onHide() {\r\n    this.verificationCode = '';\r\n    uni.hideLoading();\r\n    self.timer = 200;\r\n    clearInterval(this.countDown)\r\n    console.log('页面隐藏，清楚定时器');\r\n  },\r\n  //进入页面直接开始定时器,时间为0时自动重发验证码\r\n  mounted() {\r\n    let self = this;\r\n    this.countDown && clearInterval(this.countDown);\r\n    this.countDown = setInterval(async() => {\r\n      self.timer--;\r\n      if (self.timer === 0) {\r\n        try{\r\n          await sendCheckCode({mobile:self.phone})\r\n          self.customToast('已重發',false)\r\n          self.timer = 200\r\n        }catch (e) {\r\n          console.log(e);\r\n          self.customToast('验证码发送失败');\r\n          //发送出错清除定时器\r\n          clearInterval(self.countDown)\r\n        }\r\n      }\r\n    }, 1000)\r\n  },\r\n\r\n  methods: {\r\n    // changeCode(e){\r\n    //   console.log(e);\r\n    // },\r\n    // //\r\n    // inputCode(e) {\r\n    //   this.verificationCode = e.detail.value\r\n    // },\r\n\r\n    //登陆失败\r\n    loginError() {\r\n      this.verificationCode = '';\r\n      this.customToast('登陆失败')\r\n    },\r\n\r\n    //登录成功，將token賦值給全局對象並且存入本地storage中\r\n    loginSuccess(result) {\r\n      let self = this;\r\n      uni.hideLoading()\r\n      APP.userToken = result.data.token;\r\n      APP.isLoginBox = false;\r\n      uni.setStorageSync('token', APP.userToken)\r\n      uni.switchTab({\r\n        url: self.from ? `/pages/${self.from}/${self.from}` : '/pages/home/home',\r\n        success() {\r\n          //跳轉成功清除定時器，倒計時归为\r\n          clearInterval(self.countDown);\r\n          self.timer = 200;\r\n          console.log('登陆成功，清除定时器')\r\n        }\r\n      })\r\n    },\r\n  },\r\n\r\n  watch: {\r\n    async verificationCode(value) {\r\n      let self = this;\r\n\r\n      if (value.length === 6) {\r\n        uni.showLoading({\r\n          title: this.change ? '請稍後' : '正在登錄中',\r\n        })\r\n\r\n          //驗證驗證碼，\r\n          try{\r\n            await verifyCode({mobile: self.phone, code: self.verificationCode})\r\n          }catch (e) {\r\n            self.customToast('验证码错误')\r\n            return;\r\n          }\r\n\r\n          //TODO change有值則跳轉到設置交易密碼頁面\r\n          if (self.change) {\r\n            uni.hideLoading()\r\n            uni.redirectTo({\r\n              url: '/pages/setPassword/setPassword',\r\n            })\r\n            return;\r\n          }\r\n\r\n        let result;\r\n          //小程序登陆\r\n          // #ifdef MP-WEIXIN\r\n          uni.login({\r\n            provider:'weixin',\r\n            scopes: 'auth_base',\r\n            async success(wxCode) {\r\n              try {\r\n                result = await login({\r\n                  mobile: self.phone,\r\n                  code: wxCode.code\r\n                })\r\n                self.loginSuccess(result)\r\n              } catch (e) {\r\n                console.log('登陆失败',e)\r\n                self.loginError()\r\n              }\r\n            }\r\n          })\r\n          // #endif\r\n\r\n        // APP 和 H5 登陆\r\n        // #ifdef APP-PLUS | H5\r\n        try {\r\n          result = await login({\r\n            mobile: self.phone,\r\n          })\r\n          self.loginSuccess(result)\r\n        } catch (e) {\r\n          console.log('登錄錯誤',e)\r\n          self.loginError()\r\n        }\r\n        // #endif\r\n      }\r\n    }\r\n  },\r\n  components:{\r\n    oneInput\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.check_code{\r\n  width: 100vw;\r\n  padding: 0 $spacing-base;\r\n  box-sizing: border-box;\r\n\r\n  .login_head {\r\n    width: 100%;\r\n    height: 170rpx;\r\n    padding-top: 50rpx;\r\n\r\n    image {\r\n      width: 150rpx;\r\n      margin: 0 auto;\r\n    }\r\n  }\r\n\r\n  .input_container{\r\n    width: 100%;\r\n    height: 405rpx;\r\n    display: flex;\r\n    padding-top: 50rpx;\r\n    flex-direction: column;\r\n    justify-content: space-between;\r\n\r\n    .login_tip {\r\n      width: 100%;\r\n      height: 100rpx;\r\n      display: flex;\r\n      flex-direction: column;\r\n      justify-content: space-between;\r\n      margin-bottom: 103rpx;\r\n\r\n      text:nth-child(1) {\r\n        font-size: $font-size-lg + 2rpx;\r\n        font-weight: $font-weight-lg;\r\n        color: $font-color1;\r\n      }\r\n\r\n      text:nth-child(2) {\r\n        font-size: $font-size-sm;\r\n        color: $font-color3;\r\n      }\r\n    }\r\n  }\r\n\r\n  .code_input{\r\n    display: flex;\r\n    justify-content: space-between;\r\n\r\n    .input_content{\r\n      width: 80rpx;\r\n      height: 1rpx;\r\n      border-bottom: 1rpx solid #cccccc;\r\n      text-align: center;\r\n      z-index: -1;\r\n    }\r\n\r\n    .empty_input{\r\n      width: calc(100% + 200rpx);\r\n      position: absolute;\r\n      opacity: 0;\r\n      z-index: 999;\r\n      background-color: pink;\r\n      margin-left: -200rpx;\r\n\r\n    }\r\n  }\r\n\r\n  .code_timer{\r\n    height: 33rpx;\r\n    font-size: $font-size-sm;\r\n    color: $font-color3;\r\n    margin-left: auto;\r\n    line-height: 33rpx;\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/checkCode/checkCode.vue	(revision a6175d8333c8e25bf1fa5f6fd86a4a31565b5d4d)
+++ pages/checkCode/checkCode.vue	(date 1603244522699)
@@ -132,6 +132,8 @@
           try{
             await verifyCode({mobile: self.phone, code: self.verificationCode})
           }catch (e) {
+            console.log(self.phone);
+            console.log(self.verificationCode);
             self.customToast('验证码错误')
             return;
           }
Index: pages/orderForm/orderForm.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"order_form\">\r\n    <headNav @nav-click=\"navDescription\" :text=\"headNavText\" :iconURL=\"headNAVIcon\"></headNav>\r\n    <!--展示页面切换 lk -->\r\n    <view class=\"head_feat\">\r\n      <view @click=\"toggleFeat('current')\"\r\n            :class=\"['current',activeFeat === 'current'? 'active_feat':'']\">\r\n        <text>當前訂單</text>\r\n      </view>\r\n      <view @click=\"toggleFeat('history')\"\r\n            :class=\"['history',activeFeat === 'history' ? 'active_feat':'']\">\r\n        <text>歷史訂單</text>\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 無訂單展示的页面 用戶沒有登錄，或者登錄後訂單數據為空時展示-->\r\n    <view v-if=\"isEmpty\" class=\"empty_order\">\r\n      <view class=\"empty_img\">\r\n        <image src=\"../../static/images_t/orderForm/orderFormEmpty.png\"></image>\r\n      </view>\r\n      <view class=\"empty_text\">\r\n        <text>您今天還沒有下單</text>\r\n        <text>快去選擇一杯喜歡的茶吧</text>\r\n      </view>\r\n      <navigator class=\"go_order\"\r\n                 hover-class=\"none\"\r\n                 open-type=\"switchTab\"\r\n                 url=\"/pages/order/order\">去點單\r\n      </navigator>\r\n      <!-- 測試 -->\r\n    </view>\r\n\r\n    <!-- 当前订单展示頁面 -->\r\n    <view v-if=\"activeFeat==='current' && currentOrderForm.data.length \" class=\"order_detail\">\r\n      <orderDetail @order-click=\"orderPayment\" :orderFormData=\"currentOrderForm.data\"></orderDetail>\r\n    </view>\r\n\r\n    <!-- 歷史訂單頁面 -->\r\n    <view v-if=\"activeFeat==='history' && historyOrderForm.data.length \" class=\"order_history\">\r\n      <view class=\"history_head\">\r\n        <view class=\"history_head_content\">\r\n          <view>\r\n            <button @click=\"historyType='oneself'\"\r\n                    :class=\"{active_btn:historyType==='oneself'}\"\r\n                    plain>自提訂單\r\n            </button>\r\n            <button @click=\"historyType='takeaway'\"\r\n                    :class=\"{active_btn:historyType==='takeaway'}\"\r\n                    plain>外賣訂單\r\n            </button>\r\n          </view>\r\n          <navigator hover-class=\"none\"\r\n                     open-type=\"navigate\"\r\n                     :url=\"`/pages/bulkInvoice/bulkInvoice?invoice=${JSON.stringify(invoiceData)}`\">\r\n            <image src=\"../../static/images/orderForm/invoice.png\"></image>\r\n            <button plain>批量開票</button>\r\n          </navigator>\r\n        </view>\r\n      </view>\r\n      <view>\r\n        <orderDetail :orderFormData=\"sliceOrder\"></orderDetail>\r\n      </view>\r\n    </view>\r\n\r\n    <!--登录提示框-->\r\n    <loginBox v-if=\"loginBoxShow\" @close-login-box=\"hideLoginBox\"></loginBox>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport headNav from '../../components-lk/headNav/headNav.vue'\r\nimport orderDetail from '../../components-lk/orderDetail/orderDetail.vue'\r\nimport loginBox from \"../../components-lk/loginBox/loginBox\";\r\n\r\nimport {orderForm, paymentStart} from '../../request/api'\r\n\r\nconst APP = getApp().globalData\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      headNavText: '想對你說',\r\n      headNAVIcon: 'email',\r\n      activeFeat: 'current',\r\n      empty: true,\r\n      historyType: 'takeaway',\r\n      currentOrderForm: {data: [], page: 1},\r\n      historyOrderForm: {data: [], page: 1},\r\n      oneSelfOrder: [],//自提订单\r\n      takeawayOrder: [],//外卖订单\r\n      invoiceData: [],//未开发票订单\r\n      loginBoxShow: false,\r\n      paymentTimer:null,\r\n    }\r\n  },\r\n  computed: {\r\n    //分离出外卖订单，自提订单，未开发票订单\r\n    sliceOrder() {\r\n      this.empty = false;\r\n      this.takeawayOrder = [];\r\n      this.oneSelfOrder = [];\r\n      this.invoiceData = [];\r\n      this.historyOrderForm.data.forEach((item) => {\r\n        if (item.haul_method === '外卖') {\r\n          this.takeawayOrder.push(item)\r\n        } else {\r\n          this.oneSelfOrder.push(item)\r\n        }\r\n        //分离未开发票订单\r\n        if (item.invoice_status === '2' && item.pay_status === '已完成') {\r\n          this.invoiceData.push(item)\r\n        }\r\n      });\r\n      if (this.historyType === 'oneself') {\r\n        return this.oneSelfOrder\r\n      }\r\n      return this.takeawayOrder\r\n    },\r\n\r\n    //判断是否暂时空页面\r\n    isEmpty() {\r\n      if (this.activeFeat === 'current') {\r\n        return !(this.currentOrderForm.data.length)\r\n      } else if (this.activeFeat === 'history') {\r\n        return !(this.historyOrderForm.data.length)\r\n      }\r\n    },\r\n  },\r\n\r\n  //页面每次展示重新获取token，请求重新请求订单数据\r\n  async onShow() {\r\n    console.log(APP.userToken);\r\n    if (APP.userToken) {\r\n      this.loginBoxShow = APP.isLoginBox = false;\r\n      this.token = APP.userToken\r\n      try {\r\n        await this.getData()\r\n      } catch (e) {\r\n        console.log(e);\r\n      }\r\n    } else {\r\n      this.loginBoxShow = APP.isLoginBox = true;\r\n    }\r\n  },\r\nonHide(){\r\n  console.log(2);\r\n  clearTimeout(this.paymentTimer)\r\n},\r\n  onUnload(){\r\n    //TODO 清空支付定时器\r\n    clearTimeout(this.paymentTimer)\r\n    console.log(1);\r\n  },\r\n\r\n  methods: {\r\n    //隐藏登陆引导框\r\n    hideLoginBox(){\r\n      this.loginBoxShow = APP.isLoginBox = false;\r\n    },\r\n    //请求数据\r\n    async requestOrder(type, page) {\r\n      return (await orderForm({type, page})).data;\r\n    },\r\n\r\n    async getData() {\r\n      uni.showLoading({\r\n        title: '請稍後'\r\n      })\r\n      try {\r\n        this.currentOrderForm.data = (await this.requestOrder(1, this.currentOrderForm.page) || [])\r\n        this.historyOrderForm.data = (await this.requestOrder(2, this.historyOrderForm.page) || [])\r\n        uni.hideLoading()\r\n      } catch (e) {\r\n        this.customToast('訂單獲取失敗')\r\n      }\r\n    },\r\n\r\n    //切換展示頁\r\n    async toggleFeat(feat) {\r\n      this.activeFeat = feat;\r\n      if (feat === 'history') {\r\n        this.headNavText = '英國城探秘'\r\n        this.headNAVIcon = '';\r\n      } else {\r\n        this.headNavText = '想對你說'\r\n        this.headNAVIcon = 'email'\r\n      }\r\n    },\r\n\r\n    navDescription() {\r\n      uni.navigateTo({\r\n        url: '/pages/wantTell/wantTell'\r\n      })\r\n    },\r\n\r\n    // 没有支付的订单，点击直接支付\r\n    async orderPayment(g) {\r\n      uni.showLoading({\r\n        title: '结算中...'\r\n      })\r\n      let self = this,\r\n          order = g.order,\r\n          orderInfo;\r\n      //获取预支付信息\r\n      // try {\r\n      //    orderInfo = (await paymentStart({\r\n      //     order_num: order.order_num,\r\n      //     shop_id: order.shop_id,\r\n      //   })).data\r\n      // } catch (e) {\r\n      //   console.log(e);\r\n      //   self.customToast('订单信息获取失败')\r\n      //   return;\r\n      // }\r\n        // TODO 延迟请求微信支付，\r\n        self.paymentTimer && clearTimeout(self.paymentTimer)\r\n        self.paymentTimer = setTimeout(async () => {\r\n         try{\r\n           orderInfo = (await paymentStart({\r\n             order_num: order.order_num,\r\n             shop_id: order.shop_id,\r\n           })).data\r\n           await self.utilPayment(orderInfo)\r\n           await self.getData()\r\n           self.customToast('结算成功')\r\n         }catch (e) {\r\n           uni.hideLoading()\r\n           console.log(e);\r\n         }\r\n        }, 3000)\r\n    },\r\n  },\r\n\r\n  components: {\r\n    headNav,\r\n    orderDetail,\r\n    loginBox\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\nuni-page-body{\r\n  min-height: 100%;\r\n  background-color: $main-bg;\r\n}\r\n.order_form {\r\n  width: 100%;\r\n  background-color: $main-bg;\r\n  min-height: 100%;\r\n\r\n  .head_feat {\r\n    width: 100%;\r\n    height: 100rpx;\r\n    background: #ffffff;\r\n    display: flex;\r\n    justify-content: space-around;\r\n    align-items: center;\r\n    z-index: 1;\r\n    position: sticky;\r\n    top: 128rpx;\r\n  ;\r\n\r\n    .current,\r\n    .history {\r\n      width: 128rpx;\r\n      font-size: $font-size-lg;\r\n      font-weight: $font-weight-lg;\r\n      text-align: left;\r\n      color: $font-color1;\r\n      line-height: 100rpx;\r\n      box-sizing: border-box;\r\n\r\n      &.active_feat {\r\n        height: 100%;\r\n        border-bottom: 4rpx solid #333;\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  .empty_order {\r\n    width: 100%;\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n    margin-top: 228rpx;\r\n    background-color: $main-bg;\r\n\r\n    .empty_img {\r\n      width: 264rpx;\r\n      height: 264rpx;\r\n      vertical-align: middle;\r\n    }\r\n\r\n    .empty_text {\r\n      width: 264rpx;\r\n      height: 126rpx;\r\n      display: flex;\r\n      flex-direction: column;\r\n      font-size:  $font-size-sm;\r\n      font-weight: $font-weight-base;\r\n      text-align: center;\r\n      color: $font-color3;\r\n    }\r\n\r\n    .go_order {\r\n      width: 360rpx;\r\n      height: 78rpx;\r\n      border-radius: 6rpx;\r\n      background: $main-color;\r\n      font-size:  $font-size-base;\r\n      font-weight: $font-weight-base;\r\n      text-align: center;\r\n      line-height: 78rpx;\r\n      color: #ffffff;\r\n      border: none;\r\n    }\r\n  }\r\n\r\n  .order_detail,\r\n  .order_history {\r\n    padding: 128rpx $spacing-base $spacing-lg $spacing-base;\r\n  }\r\n\r\n  .order_history {\r\n    display: flex;\r\n    flex-direction: column;\r\n\r\n    .history_head {\r\n      width: 100%;\r\n      height: 74rpx;\r\n\r\n      .history_head_content {\r\n        display: flex;\r\n        height: 74rpx;\r\n        align-items: flex-end;\r\n        justify-content: space-between;\r\n\r\n        view,navigator {\r\n\r\n          button {\r\n            width: 120rpx;\r\n            height: 44rpx;\r\n            border: none;\r\n            font-size:  $font-size-sm - 2rpx;\r\n            font-weight: $font-weight-base;\r\n            color: $font-color2;\r\n            text-align: center;\r\n            line-height: 44rpx;\r\n            padding: 0;\r\n            margin: 0;\r\n\r\n            &.active_btn {\r\n              background: #fff;\r\n              border-radius: 6rpx;\r\n              color: $main-color;\r\n            }\r\n          }\r\n        }\r\n\r\n        view:nth-child(1) {\r\n          width: 300rpx;\r\n          display: flex;\r\n          justify-content: space-between;\r\n        }\r\n\r\n        navigator {\r\n          display: flex;\r\n          line-height: 44rpx;\r\n          align-items: center;\r\n\r\n          image {\r\n            width: 23rpx;\r\n            height: 21rpx;\r\n            vertical-align: middle;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/orderForm/orderForm.vue	(revision a6175d8333c8e25bf1fa5f6fd86a4a31565b5d4d)
+++ pages/orderForm/orderForm.vue	(date 1603262693460)
@@ -58,7 +58,8 @@
         </view>
       </view>
       <view>
-        <orderDetail :orderFormData="sliceOrder"></orderDetail>
+        <noMoreData v-if="!sliceOrder.length"></noMoreData>
+        <orderDetail v-else :orderFormData="sliceOrder"></orderDetail>
       </view>
     </view>
 
@@ -90,7 +91,8 @@
       takeawayOrder: [],//外卖订单
       invoiceData: [],//未开发票订单
       loginBoxShow: false,
-      paymentTimer:null,
+      paymentTimer: null,
+      paymentStatus: false,//订单结算状态
     }
   },
   computed: {
@@ -129,7 +131,6 @@
 
   //页面每次展示重新获取token，请求重新请求订单数据
   async onShow() {
-    console.log(APP.userToken);
     if (APP.userToken) {
       this.loginBoxShow = APP.isLoginBox = false;
       this.token = APP.userToken
@@ -142,19 +143,15 @@
       this.loginBoxShow = APP.isLoginBox = true;
     }
   },
-onHide(){
-  console.log(2);
-  clearTimeout(this.paymentTimer)
-},
-  onUnload(){
-    //TODO 清空支付定时器
+
+  onHide() {
     clearTimeout(this.paymentTimer)
-    console.log(1);
+    this.paymentStatus = false;
   },
 
   methods: {
-    //隐藏登陆引导框
-    hideLoginBox(){
+    //点击隐藏登陆引导框
+    hideLoginBox() {
       this.loginBoxShow = APP.isLoginBox = false;
     },
     //请求数据
@@ -162,6 +159,7 @@
       return (await orderForm({type, page})).data;
     },
 
+    //同时请求两种订单格式，没有值时设置空数组
     async getData() {
       uni.showLoading({
         title: '請稍後'
@@ -171,12 +169,12 @@
         this.historyOrderForm.data = (await this.requestOrder(2, this.historyOrderForm.page) || [])
         uni.hideLoading()
       } catch (e) {
-        this.customToast('訂單獲取失敗')
+        this.customToast('訂單信息獲取失敗')
       }
     },
 
     //切換展示頁
-    async toggleFeat(feat) {
+    toggleFeat(feat) {
       this.activeFeat = feat;
       if (feat === 'history') {
         this.headNavText = '英國城探秘'
@@ -195,39 +193,32 @@
 
     // 没有支付的订单，点击直接支付
     async orderPayment(g) {
+      if (this.paymentStatus) return;
+      this.paymentStatus = true;
       uni.showLoading({
         title: '结算中...'
       })
-      let self = this,
-          order = g.order,
-          orderInfo;
-      //获取预支付信息
-      // try {
-      //    orderInfo = (await paymentStart({
-      //     order_num: order.order_num,
-      //     shop_id: order.shop_id,
-      //   })).data
-      // } catch (e) {
-      //   console.log(e);
-      //   self.customToast('订单信息获取失败')
-      //   return;
-      // }
-        // TODO 延迟请求微信支付，
-        self.paymentTimer && clearTimeout(self.paymentTimer)
-        self.paymentTimer = setTimeout(async () => {
-         try{
-           orderInfo = (await paymentStart({
-             order_num: order.order_num,
-             shop_id: order.shop_id,
-           })).data
-           await self.utilPayment(orderInfo)
-           await self.getData()
-           self.customToast('结算成功')
-         }catch (e) {
-           uni.hideLoading()
-           console.log(e);
-         }
-        }, 3000)
+      let self = this,//缓存this
+          order = g.order,//当前点击的订单
+          orderInfo;//订单的预支付信息
+      // TODO 延迟请求微信支付，
+      self.paymentTimer && clearTimeout(self.paymentTimer)
+      self.paymentTimer = setTimeout(async () => {
+        try {
+          //获取订单预支付信息
+          orderInfo = (await paymentStart({order_num: order.order_num, shop_id: order.shop_id,})).data
+          //调起支付接口
+          await self.utilPayment(orderInfo)
+          //支付成功重新获取数据
+          await self.getData()
+          self.paymentStatus = false;
+          self.customToast('结算成功')
+        } catch (e) {
+          self.paymentStatus = false;
+          uni.hideLoading()
+          console.log(e);
+        }
+      }, 3000)
     },
   },
 
Index: pages/memberCode/memberCode.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"member_code\">\r\n    <popUpLayer :floor=\"1\">\r\n      <template>\r\n        <view class=\"content\">\r\n          <view class=\"user_info\">\r\n            <image src=\"../../static/images_t/my/user_avatar.png\"></image>\r\n            <view>{{ user.user_name }}</view>\r\n          </view>\r\n<!--          <view class=\"payment\">-->\r\n<!--            <image @click=\"usedWallet\" v-if=\"!isWallet\" src=\"../../static/images_t/bulkInvoice/select_false.png\"></image>-->\r\n<!--            <image @click=\"usedWallet\" v-else src=\"../../static/images_t/bulkInvoice/select_true.png\"></image>-->\r\n<!--            <view>使用奶茶錢包支付</view>-->\r\n<!--            <view>（可用餘額￥{{ user.balance || '0.00' }}）</view>-->\r\n<!--          </view>-->\r\n          <view class=\"qr_code\">\r\n            <view>此二维码可累计积分</view>\r\n            <image :src=\"qrCodeData\"></image>\r\n            <view>会员码每30秒自动刷新一次</view>\r\n          </view>\r\n        </view>\r\n      </template>\r\n    </popUpLayer>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport popUpLayer from \"../../components-lk/popUpLayer/popUpLayer\";\r\n\r\nimport {qrCode} from \"../../request/api\";\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      user: {},\r\n      qrCodeData: '',\r\n      isWallet:false,\r\n      timer :null\r\n    }\r\n  },\r\n  async onLoad() {\r\n    this.user = getApp().globalData.userInfo;\r\n    await this.QRcode();\r\n    this.timer = setInterval(async ()=>{\r\n      await this.QRcode()\r\n      console.log(1);\r\n    },30000)\r\n  },\r\n  methods: {\r\n    async QRcode() {\r\n      this.qrCodeData = (await qrCode({})).data\r\n    },\r\n    usedWallet(){\r\n      this.isWallet = !this.isWallet\r\n    }\r\n  },\r\n  onHide(){\r\n    clearInterval(this.timer)\r\n  },\r\n  onUnload(){\r\n    clearInterval(this.timer)\r\n  },\r\n  components: {\r\n    popUpLayer\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\nimage {\r\n  width:100rpx;\r\n  height:100rpx;\r\n}\r\n.member_code{\r\n  width: 100%;\r\n  height: 100vh;\r\n  z-index: -1111;\r\n\r\n  .content{\r\n    width: 100vw;\r\n    height: 984rpx;\r\n    background-color: #FFFFFF;\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n\r\n    .user_info{\r\n      font-size: $font-size-lg;\r\n      color: #000000;\r\n      margin-bottom: 50rpx;\r\n      margin-top: -75rpx;\r\n      display: flex;\r\n      flex-direction: column;\r\n      align-items: center;\r\n\r\n      image{\r\n        width: 130rpx;\r\n        height: 130rpx;\r\n        margin-bottom: 10rpx;\r\n        vertical-align: middle;\r\n      }\r\n    }\r\n\r\n    .payment{\r\n      width: 500rpx;\r\n      height: 54rpx;\r\n      display: flex;\r\n      justify-content: space-around;\r\n      border-bottom:1rpx solid #cccccc;\r\n      font-size: $font-size-sm;\r\n      color: #000000;\r\n      margin-bottom: 100rpx;\r\n\r\n      image{\r\n        width: 30rpx;\r\n        height: 30rpx;\r\n        vertical-align: middle;\r\n      }\r\n\r\n      view:nth-child(3){\r\n        color: $font-color3;\r\n      }\r\n    }\r\n\r\n    .qr_code{\r\n      display: flex;\r\n      flex-direction: column;\r\n      align-items: center;\r\n\r\n      view:nth-child(1){\r\n        font-size: $font-size-sm;\r\n        color: #000000;\r\n        margin-bottom: 30rpx;\r\n      }\r\n\r\n      image{\r\n        width: 260rpx;\r\n        height: 260rpx;\r\n        vertical-align: middle;\r\n        margin-bottom: 20rpx;\r\n      }\r\n\r\n      view:nth-child(3){\r\n        font-size:$font-size-sm - 2rpx;\r\n        color: $font-color3;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/memberCode/memberCode.vue	(revision a6175d8333c8e25bf1fa5f6fd86a4a31565b5d4d)
+++ pages/memberCode/memberCode.vue	(date 1603251948921)
@@ -39,26 +39,26 @@
     }
   },
   async onLoad() {
-    this.user = getApp().globalData.userInfo;
-    await this.QRcode();
-    this.timer = setInterval(async ()=>{
-      await this.QRcode()
-      console.log(1);
-    },30000)
+    try{
+      this.user = getApp().globalData.userInfo;
+      await this.QRcode();
+      this.timer = setInterval(async ()=>{
+        await this.QRcode()
+        console.log(1);
+      },30000)
+    }catch (e) {
+      this.customToast('會員碼獲取失敗')
+    }
   },
   methods: {
     async QRcode() {
       this.qrCodeData = (await qrCode({})).data
     },
-    usedWallet(){
-      this.isWallet = !this.isWallet
-    }
-  },
-  onHide(){
-    clearInterval(this.timer)
   },
   onUnload(){
+    console.log('定時器清除，onUnload')
     clearInterval(this.timer)
+    console.log(this.timer);
   },
   components: {
     popUpLayer
Index: pages/bulkInvoice/bulkInvoice.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"bulk_invoice\">\r\n    <noMoreData v-if=\"!invoiceData.length\"></noMoreData>\r\n    <view v-for=\"(invoice,index) in invoiceData\"\r\n          :key=\"index\"\r\n          v-else\r\n          @click=\"invoiceChange(index)\"\r\n          class=\"invoice_container\">\r\n        <view class=\"invoice_content\">\r\n          <view class=\"img\">\r\n            <image v-if=\"!invoice.check\" src=\"../../static/images_t/bulkInvoice/select_false.png\"></image>\r\n            <image v-else=\"invoice.check\" src=\"../../static/images_t/bulkInvoice/select_true.png\"></image>\r\n          </view>\r\n          <view class=\"info\">\r\n            <text>開票金額：￥{{ invoice.payment_info }}</text>\r\n            <text>訂單號：{{ invoice.id }}</text>\r\n            <text>下單時間：{{ invoice.created_at }}</text>\r\n          </view>\r\n        </view>\r\n    </view>\r\n    <view class=\"invoice_foot\">\r\n      <view class=\"invoice_content\">\r\n        <view @click=\"clickSelectAll\" class=\"select_all\">\r\n          <image v-if=\"!selectAll\" src=\"../../static/images_t/bulkInvoice/select_false.png\"></image>\r\n          <image v-else src=\"../../static/images_t/bulkInvoice/select_true.png\"></image>\r\n          <text>全選</text>\r\n        </view>\r\n        <view class=\"select_count\">\r\n          <text>共￥{{ amount || '' }}</text>\r\n          <text>{{ count || '' }}个订单</text>\r\n        </view>\r\n        <view @click=\"navInvoiceInfo\"\r\n              class=\"next_stop\">\r\n          <text>下壹步</text>\r\n        </view>\r\n      </view>\r\n    </view>\r\n    <view class=\"empty\"></view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      invoiceData: [],\r\n      amount:0,\r\n      count:0,\r\n      selectAll:false,\r\n    }\r\n  },\r\n  onLoad(options) {\r\n    this.invoiceData = (JSON.parse(options.invoice) || [])\r\n  },\r\n  methods: {\r\n    //点击选择单项\r\n    invoiceChange(i) {\r\n      this.$set(this.invoiceData[i], 'check', !this.invoiceData[i].check)\r\n      if(this.invoiceData[i].check){\r\n        this.count++;\r\n        this.amount +=  parseFloat(this.invoiceData[i].payment_info)\r\n        this.orderId.push(this.invoiceData[i].id)\r\n      }else{\r\n        this.count--;\r\n        this.amount -= parseFloat(this.invoiceData[i].payment_info)\r\n        this.orderId.splice(this.orderId.indexOf(this.invoiceData[i].id),1)\r\n      }\r\n    },\r\n\r\n    //点击选择全部\r\n    clickSelectAll() {\r\n      this.amount = 0;\r\n      this.count = 0;\r\n      this.orderId = [];\r\n      this.selectAll = !this.selectAll;\r\n      this.invoiceData.forEach((item) => {\r\n        if (this.selectAll) {\r\n          item.check = true;\r\n          this.amount += parseFloat(item.payment_info)\r\n          this.count = this.invoiceData.length;\r\n          this.orderId.push(item.id)\r\n        } else {\r\n          item.check = false;\r\n          this.orderId = [];\r\n        }\r\n      })\r\n      console.log(this.orderId)\r\n    },\r\n\r\n    // 跳转至发票详情页，并传递发票总金额\r\n    navInvoiceInfo() {\r\n      if(this.amount){\r\n        uni.navigateTo({\r\n          url: `/pages/invoiceInfo/invoiceInfo?invoiceAmount=${this.amount}&id=${this.orderId.join(',')}`\r\n        })\r\n      }else{\r\n        this.customToast('沒有選擇訂單',false)\r\n      }\r\n    }\r\n  },\r\n  watch:{\r\n    count(value){\r\n      this.selectAll = value === this.invoiceData.length;\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\r\nimage{\r\n  display: inline-block;\r\n  width: 46rpx;\r\n  height: 46rpx;\r\n  vertical-align: middle;\r\n  margin:  0 $spacing-lg;\r\n}\r\n\r\n.bulk_invoice {\r\n  width: 100%;\r\n  min-height: 100vh;\r\n  background:$main-bg;\r\n\r\n  .empty{\r\n    width: 100%;\r\n    height: 130rpx;\r\n    background: $main-bg;\r\n  }\r\n\r\n  .invoice_container{\r\n    width: 100%;\r\n    padding:$spacing-lg $spacing-base 0 $spacing-base;\r\n    box-sizing: border-box;\r\n\r\n    .invoice_content{\r\n      width: 100%;\r\n      height: 200rpx;\r\n      background-color: #FFFFFF;\r\n      border-radius: 20rpx;\r\n      display: flex;\r\n      align-items: center;\r\n      padding: $spacing-lg 0;\r\n      box-sizing: border-box;\r\n\r\n      .info{\r\n        height: 100%;\r\n        display: flex;\r\n        flex-direction: column;\r\n        justify-content: space-between;\r\n        font-size: $font-size-sm;\r\n        color: $font-color1;\r\n      }\r\n    }\r\n  }\r\n  .invoice_foot{\r\n    width: 750rpx;\r\n    height: 98rpx;\r\n    background: #ffffff;\r\n    position: fixed;\r\n    bottom: 0;\r\n    left: 0;\r\n\r\n    .invoice_content{\r\n      width: 100%;\r\n      height: 100%;\r\n      display: flex;\r\n      flex-direction: row;\r\n      justify-content: space-between;\r\n\r\n      view{\r\n        height: 100%;\r\n        line-height: 98rpx;\r\n      }\r\n      view:nth-child(1){\r\n        font-size: $font-size-sm;\r\n        color: $font-color1;\r\n\r\n        image{\r\n          margin-right: 10rpx;\r\n        }\r\n      }\r\n      view:nth-child(2){\r\n        flex: 1;\r\n        text-align: right;\r\n        line-height: inherit;\r\n        padding: 20rpx $spacing-lg 17rpx 0;\r\n        box-sizing: border-box;\r\n        color: $font-color1;\r\n\r\n        text:nth-child(1){\r\n          font-size: $font-size-sm;\r\n          display: block;\r\n        }\r\n        text:nth-child(2){\r\n          font-size: $font-size-sm - 4rpx;\r\n        }\r\n      }\r\n     .next_stop{\r\n        width: 200rpx;\r\n        line-height: 98rpx;\r\n        text-align: center;\r\n        background: $main-color;\r\n        font-size: $font-size-base;\r\n        color: #FFFFFF;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/bulkInvoice/bulkInvoice.vue	(revision a6175d8333c8e25bf1fa5f6fd86a4a31565b5d4d)
+++ pages/bulkInvoice/bulkInvoice.vue	(date 1603242723462)
@@ -85,10 +85,9 @@
           this.orderId = [];
         }
       })
-      console.log(this.orderId)
     },
 
-    // 跳转至发票详情页，并传递发票总金额
+    // 跳转至发票详情页，并传递发票总金额和id
     navInvoiceInfo() {
       if(this.amount){
         uni.navigateTo({
Index: components-lk/orderDetail/orderDetail.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n\t<view class=\"order_form_show\">\r\n\t\t<view v-for=\"(order,index) in orderFormData\"\r\n          :key=\"index\"\r\n          class=\"order_form_content\"\r\n          @click=\"orderPayment(order,index)\">\r\n\t\t\t<view class=\"order_shop\">\r\n\t\t\t\t<view class=\"order_receiving\">\r\n\t\t\t\t\t<text>{{order.haul_method}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"order_shop_name\">\r\n\t\t\t\t\t<text>{{order.shop_name}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"order_progress\">\r\n\t\t\t\t\t<text>{{order.pay_status}}</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"order_goods_container\">\r\n\t\t\t\t<view v-for=\"(goods,goodsIndex) in (order.goods_data)\"\r\n              :key=\"goodsIndex\"\r\n              class=\"order_goods\">\r\n\t\t\t\t\t<view class=\"goods_img\">\r\n\t\t\t\t\t\t<image :src=\"imgSrc + goods.home_avatar\"></image>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"goods_description\">\r\n\t\t\t\t\t\t<view class=\"goods_name\">\r\n\t\t\t\t\t\t\t<text>{{goods.goods_name}}</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view v-if=\"!goods.tableware\" class=\"goods_feature\">\r\n\t\t\t\t\t\t\t<text class=\"goods_straw\">{{goods.norm}}</text>\r\n<!--\t\t\t\t\t\t\t<text class=\"goods_type\">{{goods.type}},</text>-->\r\n<!--\t\t\t\t\t\t\t<text class=\"goods_size\">{{goods.size}},</text>-->\r\n<!--\t\t\t\t\t\t\t<text class=\"goods_sugar\">{{goods.sugar}}</text>-->\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view v-else class=\"goods_tableware\">\r\n\t\t\t\t\t\t\t<text>{{goods.tableware}}</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"single_count\">\r\n\t\t\t\t\t\t<text>x {{goods.goods_num}}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"order_goods_foot\">\r\n\t\t\t\t\t<view class=\"order_goods_date\">\r\n\t\t\t\t\t\t<text>{{order.created_at}}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<view class=\"order_goods_amount\">\r\n\t\t\t\t\t\t<text>共{{order.goods_data.length}}件商品 合計：{{order.payment_info}}</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\texport default {\r\n\t  data(){\r\n\t    return {\r\n\t      orderAmount:0\r\n      }\r\n    },\r\n\t\tprops: {\r\n\t\t\torderFormData: {\r\n\t\t\t\ttype: Array,\r\n\t\t\t\trequired: true\r\n\t\t\t}\r\n\t\t},\r\n\t\tmounted() {\r\n\t\t\tconsole.log(this.orderFormData)\r\n\t\t},\r\n    methods:{\r\n\t    /*\r\n\t    * 跳转至订单支付页，已经支付过的订单不做处理\r\n\t    * */\r\n\t    orderPayment(order,index){\r\n        if(order.pay_status === '待支付'){\r\n          this.$emit('order-click',{order,index})\r\n        }\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n\t.order_form_show {\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: center;\r\n\t\tbox-sizing: border-box;\r\n\t\tbackground-color: $main-bg;\r\n\t\twidth: 100%;\r\n\r\n\t\t.order_form_content {\r\n\t\t\twidth: 702rpx;\r\n\t\t\tmin-height: 335rpx;\r\n\t\t\tbackground: #ffffff;\r\n\t\t\tborder-radius: 20rpx;\r\n\t\t\tpadding:0 $spacing-lg;\r\n\t\t\tbox-sizing: border-box;\r\n\t\t\tmargin-top: $spacing-lg;\r\n\t\t}\r\n\r\n\t\t.order_shop {\r\n\t\t\twidth: 100%;\r\n\t\t\theight: 95rpx;\r\n\t\t\tbox-sizing: border-box;\r\n\t\t\tborder-bottom: 1rpx solid #ccc;\r\n\t\t\tdisplay: flex;\r\n\t\t\tfont-size: $font-size-sm;\r\n\t\t\tposition: relative;\r\n\t\t\tfont-weight: $font-weight-base;\r\n\r\n\t\t\tview {\r\n\t\t\t\tline-height: 95rpx;\r\n\t\t\t}\r\n\r\n\t\t\t.order_shop_name {\r\n\t\t\t\twidth: 364rpx;\r\n\t\t\t\tcolor: $font-color1;\r\n\t\t\t\tmargin-left: 20rpx;\r\n\t\t\t\toverflow: hidden;\r\n\t\t\t\twhite-space: nowrap;\r\n\t\t\t\ttext-overflow: ellipsis;\r\n\t\t\t}\r\n\r\n\t\t\t.order_progress {\r\n\t\t\t\tcolor: $font-color3;\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tright: 0;\r\n\t\t\t}\r\n\r\n\t\t\t.order_receiving {\r\n\t\t\t\twidth: 74rpx;\r\n\t\t\t\theight: 34rpx;\r\n\t\t\t\tline-height: 34rpx;\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tbackground: $main-color;\r\n\t\t\t\tborder-radius: 6rpx;\r\n\t\t\t\talign-self: center;\r\n\t\t\t\tfont-size: $font-size-sm - 2rpx;\r\n\t\t\t\tcolor: #ffffff;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.order_goods_container {\r\n\t\t\tpadding: $spacing-lg 0;\r\n\t\t\tbox-sizing: border-box;\r\n\t\t\tfont-weight: $font-weight-base;\r\n\t\t\tcolor: $font-color3;\r\n\r\n\t\t\t.order_goods {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tmargin-bottom: $spacing-lg;\r\n\r\n\t\t\t\t.goods_description {\r\n\t\t\t\t\tflex-grow: 1;\r\n\t\t\t\t\tmargin-left: 20rpx;\r\n\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\tflex-direction: column;\r\n\t\t\t\t\tfont-size: $font-size-sm - 2rpx;\r\n\t\t\t\t\tfont-weight: $font-weight-base;\r\n\t\t\t\t\tcolor: $font-color3;\r\n\r\n\r\n\t\t\t\t\t.goods_name {\r\n\t\t\t\t\t\theight: 40rpx;\r\n\t\t\t\t\t\tline-height: 40rpx;\r\n\t\t\t\t\t\tfont-size: $font-size-base;\r\n\t\t\t\t\t\tcolor: $font-color1;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t.goods_feature {\r\n\t\t\t\t\t\tfont-size: $font-size-sm - 2rpx;\r\n\t\t\t\t\t\tdisplay: flex;\r\n\t\t\t\t\t\tflex-wrap: wrap;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.goods_img {\r\n\t\t\t\t\tflex-shrink: 0;\r\n\t\t\t\t\twidth: 120rpx;\r\n\t\t\t\t\theight: 120rpx;\r\n\t\t\t\t\tvertical-align: middle;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t.single_count {\r\n\t\t\t\t\twidth: 130rpx;\r\n\t\t\t\t\tfont-size: $font-size-sm;\r\n\t\t\t\t\tcolor: $font-color3;\r\n\t\t\t\t\ttext-align: right;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t.order_goods_foot {\r\n\t\t\twidth: 100%;\r\n\t\t\tbox-sizing: border-box;\r\n\t\t\tdisplay: flex;\r\n\t\t\tjustify-content: space-between;\r\n\r\n\t\t\t.order_goods_date {\r\n\t\t\t\tfont-size: $font-size-sm - 4rpx\r\n\t\t\t}\r\n\r\n\t\t\t.order_goods_amount {\r\n\t\t\t\tfont-size: $font-size-sm;\r\n\t\t\t\tcolor: $font-color1;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- components-lk/orderDetail/orderDetail.vue	(revision a6175d8333c8e25bf1fa5f6fd86a4a31565b5d4d)
+++ components-lk/orderDetail/orderDetail.vue	(date 1603246006173)
@@ -1,212 +1,207 @@
 <template>
-	<view class="order_form_show">
-		<view v-for="(order,index) in orderFormData"
+  <view class="order_form_show">
+    <view v-for="(order,index) in orderFormData"
           :key="index"
           class="order_form_content"
           @click="orderPayment(order,index)">
-			<view class="order_shop">
-				<view class="order_receiving">
-					<text>{{order.haul_method}}</text>
-				</view>
-				<view class="order_shop_name">
-					<text>{{order.shop_name}}</text>
-				</view>
-				<view class="order_progress">
-					<text>{{order.pay_status}}</text>
-				</view>
-			</view>
-			<view class="order_goods_container">
-				<view v-for="(goods,goodsIndex) in (order.goods_data)"
+      <view class="order_shop">
+        <view class="order_receiving">
+          <text>{{ order.haul_method }}</text>
+        </view>
+        <view class="order_shop_name">
+          <text>{{ order.shop_name }}</text>
+        </view>
+        <view class="order_progress">
+          <text>{{ order.pay_status }}</text>
+        </view>
+      </view>
+      <view class="order_goods_container">
+        <view v-for="(goods,goodsIndex) in (order.goods_data)"
               :key="goodsIndex"
               class="order_goods">
-					<view class="goods_img">
-						<image :src="imgSrc + goods.home_avatar"></image>
-					</view>
-					<view class="goods_description">
-						<view class="goods_name">
-							<text>{{goods.goods_name}}</text>
-						</view>
-						<view v-if="!goods.tableware" class="goods_feature">
-							<text class="goods_straw">{{goods.norm}}</text>
-<!--							<text class="goods_type">{{goods.type}},</text>-->
-<!--							<text class="goods_size">{{goods.size}},</text>-->
-<!--							<text class="goods_sugar">{{goods.sugar}}</text>-->
-						</view>
-						<view v-else class="goods_tableware">
-							<text>{{goods.tableware}}</text>
-						</view>
-					</view>
-					<view class="single_count">
-						<text>x {{goods.goods_num}}</text>
-					</view>
-				</view>
-				<view class="order_goods_foot">
-					<view class="order_goods_date">
-						<text>{{order.created_at}}</text>
-					</view>
-					<view class="order_goods_amount">
-						<text>共{{order.goods_data.length}}件商品 合計：{{order.payment_info}}</text>
-					</view>
-				</view>
-			</view>
-		</view>
-	</view>
+          <view class="goods_img">
+            <image :src="imgSrc + goods.home_avatar"></image>
+          </view>
+          <view class="goods_description">
+            <view class="goods_name">
+              <text>{{ goods.goods_name }}</text>
+            </view>
+            <view v-if="!goods.tableware" class="goods_feature">
+              <text class="goods_straw">{{ goods.norm }}</text>
+              <!--							<text class="goods_type">{{goods.type}},</text>-->
+              <!--							<text class="goods_size">{{goods.size}},</text>-->
+              <!--							<text class="goods_sugar">{{goods.sugar}}</text>-->
+            </view>
+            <view v-else class="goods_tableware">
+              <text>{{ goods.tableware }}</text>
+            </view>
+          </view>
+          <view class="single_count">
+            <text>x {{ goods.goods_num }}</text>
+          </view>
+        </view>
+        <view class="order_goods_foot">
+          <view class="order_goods_date">
+            <text>{{ order.created_at }}</text>
+          </view>
+          <view class="order_goods_amount">
+            <text>共{{ order.goods_data.length }}件商品 合計：{{ order.payment_info }}</text>
+          </view>
+        </view>
+      </view>
+    </view>
+  </view>
 </template>
 
 <script>
-	export default {
-	  data(){
-	    return {
-	      orderAmount:0
-      }
-    },
-		props: {
-			orderFormData: {
-				type: Array,
-				required: true
-			}
-		},
-		mounted() {
-			console.log(this.orderFormData)
-		},
-    methods:{
-	    /*
-	    * 跳转至订单支付页，已经支付过的订单不做处理
-	    * */
-	    orderPayment(order,index){
-        if(order.pay_status === '待支付'){
-          this.$emit('order-click',{order,index})
-        }
-      }
-    }
-  }
+export default {
+  data() {
+    return {
+      orderAmount: 0
+    }
+  },
+  props: {
+    orderFormData: {
+      type: Array,
+      required: true
+    }
+  },
+  methods: {
+    // 跳转至订单支付页，已经支付过的订单不做处理
+    orderPayment(order, index) {
+      if (order.pay_status === '待支付') {
+        this.$emit('order-click', {order, index})
+      }
+    }
+  }
+}
 </script>
 
 <style lang="scss" scoped>
-	.order_form_show {
-		display: flex;
-		flex-direction: column;
-		align-items: center;
-		box-sizing: border-box;
-		background-color: $main-bg;
-		width: 100%;
+.order_form_show {
+  display: flex;
+  flex-direction: column;
+  align-items: center;
+  box-sizing: border-box;
+  background-color: $main-bg;
+  width: 100%;
 
-		.order_form_content {
-			width: 702rpx;
-			min-height: 335rpx;
-			background: #ffffff;
-			border-radius: 20rpx;
-			padding:0 $spacing-lg;
-			box-sizing: border-box;
-			margin-top: $spacing-lg;
-		}
+  .order_form_content {
+    width: 702rpx;
+    min-height: 335rpx;
+    background: #ffffff;
+    border-radius: 20rpx;
+    padding:0 $spacing-lg;
+    box-sizing: border-box;
+    margin-top: $spacing-lg;
+  }
 
-		.order_shop {
-			width: 100%;
-			height: 95rpx;
-			box-sizing: border-box;
-			border-bottom: 1rpx solid #ccc;
-			display: flex;
-			font-size: $font-size-sm;
-			position: relative;
-			font-weight: $font-weight-base;
+  .order_shop {
+    width: 100%;
+    height: 95rpx;
+    box-sizing: border-box;
+    border-bottom: 1rpx solid #ccc;
+    display: flex;
+    font-size: $font-size-sm;
+    position: relative;
+    font-weight: $font-weight-base;
 
-			view {
-				line-height: 95rpx;
-			}
+    view {
+      line-height: 95rpx;
+    }
 
-			.order_shop_name {
-				width: 364rpx;
-				color: $font-color1;
-				margin-left: 20rpx;
-				overflow: hidden;
-				white-space: nowrap;
-				text-overflow: ellipsis;
-			}
+    .order_shop_name {
+      width: 364rpx;
+      color: $font-color1;
+      margin-left: 20rpx;
+      overflow: hidden;
+      white-space: nowrap;
+      text-overflow: ellipsis;
+    }
 
-			.order_progress {
-				color: $font-color3;
-				position: absolute;
-				right: 0;
-			}
+    .order_progress {
+      color: $font-color3;
+      position: absolute;
+      right: 0;
+    }
 
-			.order_receiving {
-				width: 74rpx;
-				height: 34rpx;
-				line-height: 34rpx;
-				text-align: center;
-				background: $main-color;
-				border-radius: 6rpx;
-				align-self: center;
-				font-size: $font-size-sm - 2rpx;
-				color: #ffffff;
-			}
-		}
+    .order_receiving {
+      width: 74rpx;
+      height: 34rpx;
+      line-height: 34rpx;
+      text-align: center;
+      background: $main-color;
+      border-radius: 6rpx;
+      align-self: center;
+      font-size: $font-size-sm - 2rpx;
+      color: #ffffff;
+    }
+  }
 
-		.order_goods_container {
-			padding: $spacing-lg 0;
-			box-sizing: border-box;
-			font-weight: $font-weight-base;
-			color: $font-color3;
+  .order_goods_container {
+    padding: $spacing-lg 0;
+    box-sizing: border-box;
+    font-weight: $font-weight-base;
+    color: $font-color3;
 
-			.order_goods {
-				display: flex;
-				margin-bottom: $spacing-lg;
+    .order_goods {
+      display: flex;
+      margin-bottom: $spacing-lg;
 
-				.goods_description {
-					flex-grow: 1;
-					margin-left: 20rpx;
-					display: flex;
-					flex-direction: column;
-					font-size: $font-size-sm - 2rpx;
-					font-weight: $font-weight-base;
-					color: $font-color3;
+      .goods_description {
+        flex-grow: 1;
+        margin-left: 20rpx;
+        display: flex;
+        flex-direction: column;
+        font-size: $font-size-sm - 2rpx;
+        font-weight: $font-weight-base;
+        color: $font-color3;
 
 
-					.goods_name {
-						height: 40rpx;
-						line-height: 40rpx;
-						font-size: $font-size-base;
-						color: $font-color1;
-					}
+        .goods_name {
+          height: 40rpx;
+          line-height: 40rpx;
+          font-size: $font-size-base;
+          color: $font-color1;
+        }
 
-					.goods_feature {
-						font-size: $font-size-sm - 2rpx;
-						display: flex;
-						flex-wrap: wrap;
-					}
-				}
+        .goods_feature {
+          font-size: $font-size-sm - 2rpx;
+          display: flex;
+          flex-wrap: wrap;
+        }
+      }
 
-				.goods_img {
-					flex-shrink: 0;
-					width: 120rpx;
-					height: 120rpx;
-					vertical-align: middle;
-				}
+      .goods_img {
+        flex-shrink: 0;
+        width: 120rpx;
+        height: 120rpx;
+        vertical-align: middle;
+      }
 
-				.single_count {
-					width: 130rpx;
-					font-size: $font-size-sm;
-					color: $font-color3;
-					text-align: right;
-				}
-			}
-		}
+      .single_count {
+        width: 130rpx;
+        font-size: $font-size-sm;
+        color: $font-color3;
+        text-align: right;
+      }
+    }
+  }
 
-		.order_goods_foot {
-			width: 100%;
-			box-sizing: border-box;
-			display: flex;
-			justify-content: space-between;
+  .order_goods_foot {
+    width: 100%;
+    box-sizing: border-box;
+    display: flex;
+    justify-content: space-between;
 
-			.order_goods_date {
-				font-size: $font-size-sm - 4rpx
-			}
+    .order_goods_date {
+      font-size: $font-size-sm - 4rpx
+    }
 
-			.order_goods_amount {
-				font-size: $font-size-sm;
-				color: $font-color1;
-			}
-		}
-	}
+    .order_goods_amount {
+      font-size: $font-size-sm;
+      color: $font-color1;
+    }
+  }
+}
 </style>
Index: pages/joinMember/joinMember.vue
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><template>\r\n  <view class=\"join_member\">\r\n    <!--頭部-->\r\n    <view class=\"top\">\r\n      <giftPack title=\"開通/續費星球會員後，立刻發放\"></giftPack>\r\n    </view>\r\n    <!--中間-->\r\n    <view class=\"center\">\r\n      <view class=\"items\" >\r\n        <text class=\"title\">每月等級權益</text>\r\n<!--        <text class=\"summary\">根據購買日期，每月同壹時間發放</text>-->\r\n      </view>\r\n      <view class=\"items\" v-for=\"(park,index) in monthPark\" :key=\"index\">\r\n      <text class=\"options\">{{park.goods_name}}</text>\r\n      <text class=\"month\">x{{park.goods_num}}/月</text>\r\n    </view>\r\n<!--      <view class=\"items\" >-->\r\n<!--        <text class=\"options\">滿35減3券</text>-->\r\n<!--        <text class=\"month\">x1/月</text>-->\r\n<!--      </view>-->\r\n<!--      <view>-->\r\n<!--        <text class=\"options\">滿60減5券</text>-->\r\n<!--        <text class=\"month\">x1/月</text>-->\r\n<!--      </view>-->\r\n<!--      <view>-->\r\n<!--        <text class=\"options\">整單9折</text>-->\r\n<!--        <text class=\"month\">x1/月</text>-->\r\n<!--      </view>-->\r\n<!--      <view>-->\r\n<!--        <text class=\"options\">每月28號會員日消費額外贈送5%積分</text>-->\r\n<!--        <text class=\"icon\">特权</text>-->\r\n<!--      </view>-->\r\n\r\n      <!--剔除此功能-->\r\n<!--      <view class=\"other\">-->\r\n<!--        <button plain>查看其他等級權益</button>-->\r\n<!--        <uni-icons class=\"arrow_right\"-->\r\n<!--                   style=\"display: inline-block;vertical-align: middle;\"-->\r\n<!--                   type=\"arrowright\"-->\r\n<!--                   size=\"26\"-->\r\n<!--                   color=\"#333333\">-->\r\n<!--        </uni-icons>-->\r\n<!--      </view>-->\r\n\r\n    </view>\r\n\r\n    <!--底部-->\r\n    <view class=\"bottom\">\r\n      <view  class=\"items\" >\r\n        <text class=\"title\">星球會員權益</text>\r\n        <text class=\"summary\">星球會員有效期內可使用</text>\r\n      </view>\r\n\r\n      <view class=\"items\" v-for=\"(park,index) in interestsPark\" :key=\"index\">\r\n        <text class=\"options\">{{park.goods_name}}</text>\r\n<!--        <text class=\"icon icon_red\">免排隊，優先制作</text>-->\r\n        <text class=\"month\">x{{park.goods_num}}</text>\r\n      </view>\r\n<!--      <view class=\"items\" >-->\r\n<!--        <text class=\"options\">生日贈飲券</text>-->\r\n<!--        <text class=\"icon icon_red\">免排隊，優先制作</text>-->\r\n<!--        <text class=\"month\">x1</text>-->\r\n<!--      </view>-->\r\n<!--      <view class=\"items\" >-->\r\n<!--        <text class=\"options\">星球會員開通紀念日贈飲券</text>-->\r\n<!--        <text class=\"month\">x1</text>-->\r\n<!--      </view>-->\r\n<!--      <view class=\"items\" >-->\r\n<!--        <text class=\"options\">5.28會員日贈飲券</text>-->\r\n<!--        <text class=\"month\">x1</text>-->\r\n<!--      </view>-->\r\n<!--      <view class=\"items\" >-->\r\n<!--        <text class=\"options\">積分經驗值漲速翻倍</text>-->\r\n<!--        <text class=\"icon\">特权</text>-->\r\n<!--      </view>-->\r\n    </view>\r\n\r\n    <!--会员协议-->\r\n    <view class=\"protocol\">\r\n      <button @click=\"summaryStatus = !summaryStatus\" class=\"protocol_btn\">\r\n      </button>\r\n      <uni-icons @click=\"summaryStatus = !summaryStatus\"\r\n                 v-if=\"summaryStatus\"\r\n                 type=\"checkmarkempty\"\r\n                 size=\"32\"\r\n                 class=\"summary_status\"\r\n                 color=\"#17A1FF\">\r\n      </uni-icons>\r\n      <view class=\"protocol_content\">\r\n        <text>同意</text>\r\n        <text>《會員服務協議》</text>\r\n      </view>\r\n    </view>\r\n    <!--费用支付-->\r\n    <view class=\"payment\">\r\n      <view class=\"select_type\">\r\n        <uni-icons size=\"40\"\r\n                   class=\"icon_up\"\r\n                   color=\"#333333\"\r\n                   @click=\"selectType\"\r\n                   type=\"arrowup\">\r\n        </uni-icons>\r\n        <text @click=\"selectType\" v-if=\"memberInfo[joinType]\"  class=\"type\">{{ memberInfo[joinType].level_name }}</text>\r\n        <text>總價：</text>\r\n        <text v-if=\"memberInfo[joinType]\" class=\"type_amount\">{{ memberInfo[joinType].recharge_money }}元/{{ memberInfo[joinType].expired_time }}月</text>\r\n      </view>\r\n      <button @click=\"paymentMember\" plain>支付</button>\r\n    </view>\r\n\r\n    <!--占位使用-->\r\n    <view class=\"empty\"></view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport giftPack from \"../my/components/giftPack\";\r\nimport optionsList from \"../../components-lk/optionsList/optionsList\";\r\n\r\nimport {memberRechargeInfo, joinMember, userSpace} from \"../../request/api\";\r\nconst APP = getApp().globalData\r\nexport default {\r\n  data() {\r\n    return {\r\n      memberInfo: [],\r\n      summaryStatus: false,\r\n      monthPark:[],\r\n      interestsPark:[],\r\n      joinType:0,\r\n    }\r\n  },\r\n  async mounted() {\r\n    this.monthPark = APP.userInfo.month_park;\r\n    this.interestsPark = APP.userInfo.interests_pack;\r\n    try {\r\n      this.memberInfo = (await memberRechargeInfo()).data\r\n    } catch (e) {\r\n      console.log(e);\r\n    }\r\n  },\r\n  methods: {\r\n    async paymentMember() {\r\n      let self = this;\r\n      if(!this.summaryStatus){\r\n        this.customToast('请仔细阅读协议',false);\r\n        return;\r\n      }\r\n      uni.showLoading({\r\n        title:'开通中...'\r\n      })\r\n      try{\r\n        //請求接口獲取支付信息\r\n        let orderInfo = (await joinMember({\r\n          level_id:this.memberInfo[this.joinType].id\r\n        })).data\r\n\r\n        //开始支付\r\n        await self.utilPayment(orderInfo);\r\n        //支付成功执行\r\n        await self.joinSuccess()\r\n      } catch (e) {\r\n        console.log(e);\r\n        this.customToast('开通失敗')\r\n      }\r\n    },\r\n    //开通成功，重新获取会员信息，并且跳转会员权益页面\r\n    async joinSuccess() {\r\n      this.customToast('开通成功')\r\n      APP.userInfo = (await userSpace()).data;\r\n      // TODO 测试修改数据\r\n      APP.userInfo.user_name = '成功开通了会员';\r\n      console.log(APP.userInfo.user_name);\r\n      //开通成功后跳转到会员权益页面\r\n      uni.redirectTo({\r\n        url:'/pages/memberBenefits/memberBenefits'\r\n      })\r\n    },\r\n    //選擇開通類型\r\n    selectType(){\r\n      let itemList = [],\r\n          self= this;\r\n      this.memberInfo.forEach((item)=>{\r\n        itemList.push(item.level_name)\r\n      });\r\n      uni.showActionSheet({\r\n        itemList,\r\n        success(index){\r\n          self.joinType = index.tapIndex;\r\n        }\r\n      })\r\n    }\r\n  },\r\n  components: {\r\n    giftPack,\r\n    optionsList\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n//字体通用样式\r\n.title{\r\n  font-size: $font-size-base;\r\n  color: $font-color1;\r\n}\r\n\r\n.summary{\r\n  font-size: $font-size-sm - 2rpx;\r\n  color: $font-color3;\r\n}\r\n\r\n.options{\r\n  font-size: $font-size-base;\r\n  color: $font-color1;\r\n}\r\n\r\n.month{\r\n  font-size: $font-size-sm;\r\n  color: $main-color;\r\n}\r\n\r\n.icon{\r\n  width: 50rpx;\r\n  height: 24rpx;\r\n  background: $main-color;\r\n  border-radius: 12rpx 12rpx 12rpx 0rpx;\r\n  font-size: 14rpx;\r\n  color: #ffffff;\r\n  text-align: center;\r\n  line-height: 24rpx;\r\n\r\n\r\n  &.icon_red{\r\n    width: 150rpx;\r\n    background-color: #e25e5c;\r\n  }\r\n}\r\n\r\n@mixin container($h) {\r\n  width: 100%;\r\n  min-height: $h;\r\n  background: #ffffff;\r\n  border-radius: 30rpx;\r\n  margin-bottom: 30rpx;\r\n}\r\n\r\n.join_member{\r\n  width: 100%;\r\n  min-height: 100%;\r\n  padding: $spacing-lg $spacing-base;\r\n  box-sizing: border-box;\r\n  background-color:#F5F6F8 ;\r\n\r\n  .top{\r\n    @include container(380rpx)\r\n  }\r\n\r\n  .center{\r\n    @include container(130rpx);\r\n\r\n  /*  .other{\r\n      height: 28rpx;\r\n      align-self: center;\r\n\r\n      button{\r\n        height: 100%;\r\n        padding: 0;\r\n        border: none;\r\n        font-size: $font-size-base - 4rpx;\r\n        color:$font-color1;\r\n        line-height: 28rpx;\r\n        margin-right: 10rpx;\r\n      }\r\n\r\n      .arrow_right {\r\n        line-height: 34rpx;\r\n      }\r\n    }*/\r\n  }\r\n\r\n  .bottom{\r\n    @include container(130rpx);\r\n    margin-bottom: 0;\r\n  }\r\n\r\n  .center,.bottom{\r\n    display: flex;\r\n    flex-direction: column;\r\n    padding: $spacing-lg $spacing-lg 0 $spacing-lg;\r\n    box-sizing: border-box;\r\n\r\n    view{\r\n      display: flex;\r\n      justify-content: space-between;\r\n\r\n      .summary,.icon{\r\n        margin-right: auto;\r\n        margin-left: 10rpx;\r\n      }\r\n    }\r\n\r\n    .items{\r\n      margin-bottom: $spacing-lg;\r\n    }\r\n  }\r\n\r\n  .protocol{\r\n    width: calc(100% + 48rpx);\r\n    min-height: 70rpx;\r\n    display: flex;\r\n    background-color: #FFFFFF;\r\n    margin-left: -24rpx;\r\n    padding:0 $spacing-base;\r\n    box-sizing: border-box;\r\n    align-items: center;\r\n    position: fixed;\r\n    bottom: 98rpx;\r\n\r\n\r\n    .protocol_btn{\r\n      width: 32rpx;\r\n      height: 32rpx;\r\n      background: #ffffff;\r\n      border: 1rpx solid #cccccc;\r\n      border-radius: 4rpx;\r\n      padding: 0;\r\n      margin-right: $spacing-lg;\r\n    }\r\n\r\n    .summary_status{\r\n      position: absolute;\r\n      left: 24rpx;\r\n    }\r\n\r\n    .protocol_content{\r\n      display: inline-block;\r\n      font-size: $font-size-sm;\r\n      color: $font-color1;\r\n\r\n      text:nth-child(2){\r\n        color:$main-color\r\n      }\r\n    }\r\n  }\r\n\r\n  .payment{\r\n    width: calc(100% + 48rpx);\r\n    height: 98rpx;\r\n    background: #ffffff;\r\n    border-top: 1rpx solid #cccccc;\r\n    padding: 0 $spacing-base;\r\n    box-sizing: border-box;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    position: fixed;\r\n    bottom: 0;\r\n    margin-left: -$spacing-base;\r\n\r\n    //text:nth-child(1){\r\n    //  font-size: $font-size-sm;\r\n    //  color: $font-color1;\r\n    //}\r\n    //\r\n    //text:nth-child(2){\r\n    //  font-size: $font-size-lg + 2rpx;\r\n    //  font-weight: $font-weight-lg;\r\n    //  color: $main-color;\r\n    //  margin-right: auto;\r\n    //}\r\n\r\n    .select_type{\r\n      flex: 1;\r\n      display: flex;\r\n      align-items: center;\r\n      font-size: $font-size-sm;\r\n      color: $font-color1;\r\n\r\n      .type_amount,.type{\r\n        font-size: $font-size-lg + 2rpx;\r\n        font-weight: $font-weight-lg;\r\n        color: $main-color;\r\n      }\r\n      .type{\r\n        margin:  0 10rpx;\r\n      }\r\n\r\n      .icon_up{\r\n        margin-right: 10rpx;\r\n      }\r\n    }\r\n\r\n    button{\r\n      width: 200rpx;\r\n      height: 98rpx;\r\n      background: $main-color;\r\n      border: none;\r\n      font-size: $font-size-base;\r\n      color: #ffffff;\r\n      padding: 0;\r\n      text-align: center;\r\n      line-height: 98rpx;\r\n    }\r\n  }\r\n\r\n  .empty{\r\n    width: 100%;\r\n    height: 138rpx;\r\n  }\r\n}\r\n</style>\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- pages/joinMember/joinMember.vue	(revision a6175d8333c8e25bf1fa5f6fd86a4a31565b5d4d)
+++ pages/joinMember/joinMember.vue	(date 1603247772731)
@@ -125,7 +125,8 @@
       summaryStatus: false,
       monthPark:[],
       interestsPark:[],
-      joinType:0,
+      joinType:0,//根据索引读取数据中的会员等阶
+      paymentStatus:false,//支付状态，为true时禁止再次支付，防止多次提交数据
     }
   },
   async mounted() {
@@ -139,6 +140,8 @@
   },
   methods: {
     async paymentMember() {
+      if(this.paymentStatus) return;
+      this.paymentStatus = true;
       let self = this;
       if(!this.summaryStatus){
         this.customToast('请仔细阅读协议',false);
@@ -160,20 +163,23 @@
       } catch (e) {
         console.log(e);
         this.customToast('开通失敗')
+        self.paymentStatus = false;
       }
     },
+
     //开通成功，重新获取会员信息，并且跳转会员权益页面
     async joinSuccess() {
       this.customToast('开通成功')
+      this.paymentStatus = false;
       APP.userInfo = (await userSpace()).data;
       // TODO 测试修改数据
       APP.userInfo.user_name = '成功开通了会员';
-      console.log(APP.userInfo.user_name);
       //开通成功后跳转到会员权益页面
       uni.redirectTo({
         url:'/pages/memberBenefits/memberBenefits'
       })
     },
+
     //選擇開通類型
     selectType(){
       let itemList = [],
@@ -181,6 +187,7 @@
       this.memberInfo.forEach((item)=>{
         itemList.push(item.level_name)
       });
+
       uni.showActionSheet({
         itemList,
         success(index){
